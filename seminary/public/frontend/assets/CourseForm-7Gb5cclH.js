import{m as J,v as Q,y as X,r as y,l as $,L as Y,b as R,o as c,c as b,s as q,q as S,t as d,g as E,a as o,F as D,k as A,f as M,w as _,h as n,e as i,M as K,N as B,_ as F,P as H,O as G,Q as W,R as Z,d as ee,A as se,I as te,i as oe,p as re}from"./index-D2hg7nHX.js";import{_ as ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Dx4-1JCs.js";import{X as le,Q as ie,d as ne,Y as ue,J as ce,s as L,u as de,_ as P,T as me,F as pe}from"./index-CUzxg6RN.js";import{_ as fe}from"./CourseOutline-CGVkqM9v.js";import"./telemetry-CE2EJSOe.js";import{u as _e}from"./settings-CXJgiWd5.js";import"./table-DhGkjCET.js";import"./ListView-6JS4BnER.js";import"./trash-2-BHrUJgjV.js";/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=J("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),he={key:0,class:"text-ink-red-3"},ge={class:"grid grid-cols-3 gap-1"},ye={class:""},be={class:"mt-1 rounded-lg bg-surface-white py-1 text-base shadow-2xl"},xe={class:"flex flex-col gap-1 p-1"},ke={class:"text-base font-medium"},we={class:"text-sm text-ink-gray-5"},Ce={__name:"MultiSelect",props:Q({label:{type:String},size:{type:String,default:"sm"},doctype:{type:String,required:!0},filters:{type:Object,default:()=>({})},validate:{type:Function,default:null},errorMessage:{type:Function,default:v=>`${v} is an Invalid value`},required:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v,{expose:x}){const h=v,u=X(v,"modelValue"),f=y([]),k=y(null),a=y(null),g=y(""),m=y(""),w=y(!1),C=$({get:()=>g.value||"",set:s=>{g.value="",s&&(w.value=!1),s!=null&&s.value&&O(s.value)}});Y(g,s=>{s=s||"",m.value!==s&&(m.value=s,I(s))},{debounce:300,immediate:!0});const V=R({url:"frappe.desk.search.search_link",method:"POST",cache:[m.value,h.doctype],auto:!0,params:{txt:m.value,doctype:h.doctype}}),T=$(()=>V.data||[]);function I(s){V.update({params:{txt:s,doctype:h.doctype}}),V.reload()}const O=s=>{a.value=null,s&&(s.split(",").forEach(t=>{var p;if(t=t.trim(),t&&!((p=u.value)!=null&&p.includes(t))){if(t&&h.validate&&!h.validate(t)){a.value=h.errorMessage(t);return}u.value?u.value.push(t):u.value=[t],t=t.replace(t,"")}}),!a.value&&(s=""))},j=s=>{u.value=u.value.filter(l=>l!==s)},N=()=>{var l;if(g.value)return;let s=(l=f.value[f.value.length-1])==null?void 0:l.$el;document.activeElement===s?(u.value.pop(),Z(()=>{u.value.length?(s=f.value[f.value.length-1].$el,s==null||s.focus()):e()})):s==null||s.focus()};function e(){k.value.$el.focus()}x({setFocus:e});const r=$(()=>[{sm:"text-xs",md:"text-base"}[h.size||"sm"],"text-ink-gray-5"]);return(s,l)=>(c(),b("div",null,[v.label?(c(),b("label",{key:0,class:q(["block mb-1",r.value])},[S(d(v.label)+" ",1),v.required?(c(),b("span",he,"*")):E("",!0)],2)):E("",!0),o("div",ge,[(c(!0),b(D,null,A(u.value,t=>(c(),M(i(F),{ref_for:!0,ref_key:"emails",ref:f,key:t,label:t,theme:"gray",variant:"subtle",class:"rounded-md",onKeydownCapture:K(B(N,["stop"]),["delete"])},{suffix:_(()=>[n(i(le),{onClick:p=>j(t),class:"h-4 w-4 stroke-1.5"},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),o("div",ye,[n(i(ce),{modelValue:C.value,"onUpdate:modelValue":l[2]||(l[2]=t=>C.value=t),nullable:""},{default:_(()=>[n(i(H),{class:"w-full",show:w.value,"onUpdate:show":l[1]||(l[1]=t=>w.value=t)},{target:_(({togglePopover:t})=>[n(i(ie),{ref_key:"search",ref:k,class:"search-input form-input w-full focus-visible:!ring-0",type:"text",value:g.value,onChange:l[0]||(l[0]=p=>{g.value=p.target.value,w.value=!0}),autocomplete:"off",onFocus:()=>t(),onKeydownCapture:K(B(N,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:_(({isOpen:t})=>[G(o("div",null,[o("div",be,[n(i(ne),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:_(()=>[(c(!0),b(D,null,A(T.value,p=>(c(),M(i(ue),{key:p.value,value:p},{default:_(({active:U})=>[o("li",{class:q(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-2":U}])},[o("div",xe,[o("div",ke,d(p.description),1),o("div",we,d(p.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[W,t]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])])]))}},Ve={class:""},Se={class:"grid md:grid-cols-[70%,30%] h-full"},$e={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ee={class:"flex items-center mt-3 md:mt-0"},Ne={class:"mt-5 mb-10"},Fe={class:"container mb-5"},Me={class:"text-lg font-semibold mb-4"},Te={class:"mb-4"},Ie={class:"mb-1.5 text-sm text-ink-gray-5"},Oe={class:"mb-4"},je={class:"text-xs text-ink-gray-5 mb-2"},Le={class:"flex items-center"},Pe={class:"border rounded-md w-fit py-5 px-20"},Re={class:"ml-4"},Ue={class:"mt-2 text-ink-gray-5 text-sm"},qe={key:1,class:"mb-4"},De={class:"flex items-center"},Ae=["src"],Ke={class:"ml-4"},Be={class:"mt-2 text-ink-gray-5 text-sm"},ze={class:"mb-4"},Je={class:"container border-t"},Qe={key:0,class:"text-lg font-semibold mt-5 mb-4"},Xe={class:"grid grid-cols-2 gap-10 mb-4"},Ye={key:0,class:"flex flex-col space-y-4"},He={class:"border-l pt-5"},ls={__name:"CourseForm",props:{courseName:{type:String}},setup(v){const x=oe("$user");y("");const h=re(),u=y([]),f=y([]);_e();const k=v,a=ee({course:"",short_introduction:"",course_description_for_lms:"",course_image:null,published:!1});se(()=>{console.log("Mounted: courseName =",k.courseName),m.reload(),window.addEventListener("keydown",g)});const g=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(C(),e.preventDefault())};te(()=>{window.removeEventListener("keydown",g)});const m=R({url:"frappe.client.get",makeParams(e){return{doctype:"Course Schedule",name:k.courseName}},auto:!1,onSuccess(e){if(console.log("courseResource onSuccess: data =",e),!e){console.error("No data received from courseResource");return}Object.keys(e).forEach(s=>{s=="instructor1"?(u.value=[],f.value=[],e.instructor1.forEach(l=>{u.value.push(l),f.value.push(l.instructor)})):Object.hasOwn(a,s)&&(a[s]=e[s])});let r=["published"];for(let s in r){let l=r[s];a[l]=!!a[l]}e.course_image&&w.reload({image:e.course_image}),O()},onError(e){console.error("courseResource onError:",e)}}),w=R({url:"seminary.seminary.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){console.log("imageResource onSuccess: data =",e),a.course_image=e},onError(e){console.error("imageResource onError:",e)}}),C=()=>{m.data&&fetch("/api/method/seminary.seminary.api.save_course",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course:m.data.name,course_data:a})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>{e.success?L("Success","Course updated successfully","check"):L("Error",e.message||"An error occurred","x")}).catch(e=>{console.error("Fetch error:",e),L("Error",e.message||"An error occurred","x")})},V=e=>{let r=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(r))return __("Only image file is allowed.")},T=e=>{a.course_image=e},I=()=>{a.course_image=null},O=()=>{var r;console.log("check_permission: user.data =",x.data),console.log("check_permission: instructors.value =",u.value);let e=!1;(r=x.data)!=null&&r.is_moderator||(u.value.forEach(s=>{var l;!e&&s.user==((l=x.data)==null?void 0:l.name)&&(e=!0)}),console.log("check_permission: user_is_instructor =",e),e||(console.log("Redirecting to Courses due to insufficient permissions"),h.push({name:"Courses"})))},j=$(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return m.data&&e.push({label:a.course,route:{name:"CourseDetail",params:{courseName:k.courseName}}}),e.push({label:"Edit Course",route:{name:"CourseForm",params:{courseName:k.courseName}}}),e}),N=$(()=>({title:"Edit Course",description:"Edit a course for your learning system."}));return de(N),(e,r)=>{var s,l;return c(),b("div",Ve,[o("div",Se,[o("div",null,[o("header",$e,[n(i(ae),{class:"h-7",items:j.value},null,8,["items"]),o("div",Ee,[n(i(F),{variant:"solid",onClick:r[0]||(r[0]=t=>C()),class:"ml-2"},{default:_(()=>[o("span",null,d(e.__("Save")),1)]),_:1})])]),o("div",Ne,[o("div",Fe,[o("div",Me,d(e.__("Details")),1),n(i(P),{modelValue:a.course,"onUpdate:modelValue":r[1]||(r[1]=t=>a.course=t),label:e.__("Title"),class:"mb-4",required:!0},null,8,["modelValue","label"]),n(i(P),{modelValue:a.short_introduction,"onUpdate:modelValue":r[2]||(r[2]=t=>a.short_introduction=t),label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"]),o("div",Te,[o("div",Ie,[S(d(e.__("Course Description"))+" ",1),r[8]||(r[8]=o("span",{class:"text-ink-red-3"},"*",-1))]),n(i(me),{content:a.course_description_for_lms,onChange:r[3]||(r[3]=t=>a.course_description_for_lms=t),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),o("div",Oe,[o("div",je,[S(d(e.__("Course Image"))+" ",1),r[9]||(r[9]=o("span",{class:"text-ink-red-3"},"*",-1))]),a.course_image?(c(),b("div",qe,[o("div",De,[o("img",{src:a.course_image.file_url,class:"border rounded-md w-40"},null,8,Ae),o("div",Ke,[n(i(F),{onClick:r[5]||(r[5]=t=>I())},{default:_(()=>[S(d(e.__("Remove")),1)]),_:1}),o("div",Be,d(e.__("Appears on the course card in the course list")),1)])])])):(c(),M(i(pe),{key:0,fileTypes:["image/*"],validateFile:V,onSuccess:r[4]||(r[4]=t=>T(t))},{default:_(({file:t,progress:p,uploading:U,openFileSelector:z})=>[o("div",Le,[o("div",Pe,[n(i(ve),{class:"size-5 stroke-1 text-ink-gray-7"})]),o("div",Re,[n(i(F),{onClick:z},{default:_(()=>[S(d(e.__("Upload")),1)]),_:2},1032,["onClick"]),o("div",Ue,d(e.__("Appears on the course card in the course list")),1)])])]),_:1}))]),o("div",ze,[n(Ce,{modelValue:f.value,"onUpdate:modelValue":r[6]||(r[6]=t=>f.value=t),doctype:"Instructor",label:e.__("Instructors"),filters:{Status:"Active"},required:!0},null,8,["modelValue","label"])])]),o("div",Je,[(s=i(x).data)!=null&&s.is_moderator?(c(),b("div",Qe,d(e.__("Settings")),1)):E("",!0),o("div",Xe,[(l=i(x).data)!=null&&l.is_moderator?(c(),b("div",Ye,[n(i(P),{type:"checkbox",modelValue:a.published,"onUpdate:modelValue":r[7]||(r[7]=t=>a.published=t),label:e.__("Published")},null,8,["modelValue","label"])])):E("",!0)])])])]),o("div",He,[i(m).data?(c(),M(fe,{key:0,courseName:i(m).data.name,title:a.course,allowEdit:!0},null,8,["courseName","title"])):E("",!0)])])])}}};export{ls as default};
