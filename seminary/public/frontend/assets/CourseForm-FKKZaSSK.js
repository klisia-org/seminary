import{s as J,y as Q,z as X,r as y,l as C,O as Y,b as U,o as u,c as p,K as D,A as V,t as c,g as S,a as o,F as q,k as A,f as F,w as h,h as n,e as i,Q as R,R as z,_ as T,P as H,p as G,S as W,T as Z,d as ee,m as se,N as te,i as oe,x as re}from"./index-flDXq_bA.js";import{_ as ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-BCDqT5C6.js";import{s as L,u as le,T as ie,F as ne}from"./index-nCb1JY8w.js";import{Q as ue,X as ce,Y as de,J as me,a as P}from"./plus-DlUOwXB2.js";import{_ as pe}from"./CourseOutline-CZ4zmc1M.js";import{X as fe}from"./Link-DjgbRK92.js";import"./telemetry-D49vQ4Br.js";import{u as _e}from"./settings-67X4IFtx.js";import"./Badge.vue_vue_type_script_setup_true_lang-DXoAtOCS.js";import"./pencil-3qaHjsB3.js";import"./FolderPlugin.vue_vue_type_style_index_0_scoped_84b7d54d_lang-BGvM5k8c.js";import"./book-open-check-CFVdhsmI.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-DT0r2lvZ.js";import"./file-up-3cmMvdsi.js";import"./check-BZhJaMw5.js";/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=J("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),ve={key:0,class:"text-ink-red-3"},ge={class:"grid grid-cols-3 gap-1"},ye={class:""},be={class:"mt-1 rounded-lg bg-surface-white py-1 text-base shadow-2xl"},xe={class:"flex flex-col gap-1 p-1"},ke={class:"text-base font-medium"},we={class:"text-sm text-ink-gray-5"},Ce={__name:"MultiSelect",props:Q({label:{type:String},size:{type:String,default:"sm"},doctype:{type:String,required:!0},filters:{type:Object,default:()=>({})},validate:{type:Function,default:null},errorMessage:{type:Function,default:v=>`${v} is an Invalid value`},required:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v,{expose:x}){const g=v,d=X(v,"modelValue"),f=y([]),k=y(null),r=y(null),_=y(""),b=y(""),m=y(!1),$=C({get:()=>_.value||"",set:s=>{_.value="",s&&(m.value=!1),s!=null&&s.value&&O(s.value)}});Y(_,s=>{s=s||"",b.value!==s&&(b.value=s,M(s))},{debounce:300,immediate:!0});const w=U({url:"frappe.desk.search.search_link",method:"POST",cache:[b.value,g.doctype],auto:!0,params:{txt:b.value,doctype:g.doctype}}),I=C(()=>w.data||[]);function M(s){w.update({params:{txt:s,doctype:g.doctype}}),w.reload()}const O=s=>{r.value=null,s&&(s.split(",").forEach(t=>{var a;if(t=t.trim(),t&&!((a=d.value)!=null&&a.includes(t))){if(t&&g.validate&&!g.validate(t)){r.value=g.errorMessage(t);return}d.value?d.value.push(t):d.value=[t],t=t.replace(t,"")}}),!r.value&&(s=""))},j=s=>{d.value=d.value.filter(l=>l!==s)},E=()=>{var l;if(_.value)return;let s=(l=f.value[f.value.length-1])==null?void 0:l.$el;document.activeElement===s?(d.value.pop(),Z(()=>{d.value.length?(s=f.value[f.value.length-1].$el,s==null||s.focus()):N()})):s==null||s.focus()};function N(){k.value.$el.focus()}x({setFocus:N});const e=C(()=>[{sm:"text-xs",md:"text-base"}[g.size||"sm"],"text-ink-gray-5"]);return(s,l)=>(u(),p("div",null,[v.label?(u(),p("label",{key:0,class:D(["block mb-1",e.value])},[V(c(v.label)+" ",1),v.required?(u(),p("span",ve,"*")):S("",!0)],2)):S("",!0),o("div",ge,[(u(!0),p(q,null,A(d.value,t=>(u(),F(i(T),{ref_for:!0,ref_key:"emails",ref:f,key:t,label:t,theme:"gray",variant:"subtle",class:"rounded-md",onKeydownCapture:R(z(E,["stop"]),["delete"])},{suffix:h(()=>[n(i(fe),{onClick:a=>j(t),class:"h-4 w-4 stroke-1.5"},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),o("div",ye,[n(i(me),{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=t=>$.value=t),nullable:""},{default:h(()=>[n(i(H),{class:"w-full",show:m.value,"onUpdate:show":l[1]||(l[1]=t=>m.value=t)},{target:h(({togglePopover:t})=>[n(i(ue),{ref_key:"search",ref:k,class:"search-input form-input w-full focus-visible:!ring-0",type:"text",value:_.value,onChange:l[0]||(l[0]=a=>{_.value=a.target.value,m.value=!0}),autocomplete:"off",onFocus:()=>t(),onKeydownCapture:R(z(E,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:h(({isOpen:t})=>[G(o("div",null,[o("div",be,[n(i(ce),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:h(()=>[(u(!0),p(q,null,A(I.value,a=>(u(),F(i(de),{key:a.value,value:a},{default:h(({active:K})=>[o("li",{class:D(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-2":K}])},[o("div",xe,[o("div",ke,c(a.description),1),o("div",we,c(a.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[W,t]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])])]))}},Ve={class:""},Se={class:"grid md:grid-cols-[70%,30%] h-full"},$e={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ee={class:"flex items-center mt-3 md:mt-0"},Ne={class:"mt-5 mb-10"},Te={class:"container mb-5"},Fe={class:"text-lg font-semibold mb-4"},Ie={key:0},Me={key:1},Oe={class:"mb-4"},je={class:"mb-1.5 mt-4 text-sm text-ink-gray-5"},Le={class:"mb-4"},Pe={class:"text-xs text-ink-gray-5 mb-2"},Ue={class:"flex items-center"},De={class:"border rounded-md w-fit py-5 px-20"},Ke={class:"ml-4"},qe={class:"mt-2 text-ink-gray-5 text-sm"},Ae={key:1,class:"mb-4"},Re={class:"flex items-center"},ze=["src"],Be={class:"ml-4"},Je={class:"mt-2 text-ink-gray-5 text-sm"},Qe={class:"mb-4"},Xe={class:"container border-t"},Ye={key:0,class:"text-lg font-semibold mt-5 mb-4"},He={class:"grid grid-cols-2 gap-10 mb-4"},Ge={key:0,class:"flex flex-col space-y-4"},We={class:"border-l pt-5"},Ze=55,hs={__name:"CourseForm",props:{courseName:{type:String}},setup(v){const x=oe("$user");y("");const g=re(),d=y([]),f=y([]);_e();const k=v,r=ee({course:"",short_introduction:"",course_description_for_lms:"",course_image:null,published:!1}),_=C(()=>{const e=r.short_introduction.length||0;return Ze-e});se(()=>{m.reload(),window.addEventListener("keydown",b)});const b=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(w(),e.preventDefault())};te(()=>{window.removeEventListener("keydown",b)});const m=U({url:"frappe.client.get",makeParams(e){return{doctype:"Course Schedule",name:k.courseName}},auto:!1,onSuccess(e){if(!e){console.error("No data received from courseResource");return}Object.keys(e).forEach(l=>{l=="instructor1"?(d.value=[],f.value=[],e.instructor1.forEach(t=>{d.value.push(t),f.value.push(t.instructor)})):Object.hasOwn(r,l)&&(r[l]=e[l])});let s=["published"];for(let l in s){let t=s[l];r[t]=!!r[t]}e.course_image&&$.reload({image:e.course_image}),j()},onError(e){console.error("courseResource onError:",e)}}),$=U({url:"seminary.seminary.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){r.course_image=e},onError(e){console.error("imageResource onError:",e)}}),w=()=>{m.data&&fetch("/api/method/seminary.seminary.api.save_course",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course:m.data.name,course_data:r})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>{var s;e.message&&e.message.success?L("Success","Course updated successfully","check"):L("Error",((s=e.message)==null?void 0:s.message)||"An error occurred","x")}).catch(e=>{console.error("Fetch error:",e);const s=typeof e=="object"?JSON.stringify(e):e.toString();L("Error",s||"An error occurred","x")})},I=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return __("Only image file is allowed.")},M=e=>{r.course_image=e},O=()=>{r.course_image=null},j=()=>{var s;let e=!1;(s=x.data)!=null&&s.is_moderator||(d.value.forEach(l=>{var t;!e&&l.user==((t=x.data)==null?void 0:t.name)&&(e=!0)}),e||(console.log("Redirecting to Courses due to insufficient permissions"),g.push({name:"Courses"})))},E=C(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return m.data&&e.push({label:r.course,route:{name:"CourseDetail",params:{courseName:k.courseName}}}),e.push({label:"Edit Course",route:{name:"CourseForm",params:{courseName:k.courseName}}}),e}),N=C(()=>({title:"Edit Course",description:"Edit a course for your learning system."}));return le(N),(e,s)=>{var l,t;return u(),p("div",Ve,[o("div",Se,[o("div",null,[o("header",$e,[n(i(ae),{class:"h-7",items:E.value},null,8,["items"]),o("div",Ee,[n(i(T),{variant:"solid",onClick:s[0]||(s[0]=a=>w()),class:"ml-2"},{default:h(()=>[o("span",null,c(e.__("Save")),1)]),_:1})])]),o("div",Ne,[o("div",Te,[o("div",Fe,c(e.__("Details")),1),n(i(P),{modelValue:r.course,"onUpdate:modelValue":s[1]||(s[1]=a=>r.course=a),label:e.__("Title"),class:"mb-4",required:!0},null,8,["modelValue","label"]),n(i(P),{modelValue:r.short_introduction,"onUpdate:modelValue":s[2]||(s[2]=a=>r.short_introduction=a),label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card (less than 55 characters)"),class:"mb-2",required:!0},null,8,["modelValue","label","placeholder"]),o("div",{class:D(["text-sm mt-1",_.value<0?"text-red-500":"text-ink-gray-5"])},[_.value>=0?(u(),p("span",Ie,c(`${_.value} characters available`),1)):(u(),p("span",Me,c(e.__("This introduction may be truncated on the course card.")),1))],2),o("div",Oe,[o("div",je,[V(c(e.__("Course Description"))+" ",1),s[8]||(s[8]=o("span",{class:"text-ink-red-3"},"*",-1))]),n(i(ie),{content:r.course_description_for_lms,onChange:s[3]||(s[3]=a=>r.course_description_for_lms=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),o("div",Le,[o("div",Pe,[V(c(e.__("Course Image"))+" ",1),s[9]||(s[9]=o("span",{class:"text-ink-red-3"},"*",-1))]),r.course_image?(u(),p("div",Ae,[o("div",Re,[o("img",{src:r.course_image.file_url,class:"border rounded-md w-40"},null,8,ze),o("div",Be,[n(i(T),{onClick:s[5]||(s[5]=a=>O())},{default:h(()=>[V(c(e.__("Remove")),1)]),_:1}),o("div",Je,c(e.__("Appears on the course card in the course list")),1)])])])):(u(),F(i(ne),{key:0,fileTypes:["image/*"],validateFile:I,onSuccess:s[4]||(s[4]=a=>M(a))},{default:h(({file:a,progress:K,uploading:es,openFileSelector:B})=>[o("div",Ue,[o("div",De,[n(i(he),{class:"size-5 stroke-1 text-ink-gray-7"})]),o("div",Ke,[n(i(T),{onClick:B},{default:h(()=>[V(c(e.__("Upload")),1)]),_:2},1032,["onClick"]),o("div",qe,c(e.__("Appears on the course card in the course list")),1)])])]),_:1}))]),o("div",Qe,[n(Ce,{modelValue:f.value,"onUpdate:modelValue":s[6]||(s[6]=a=>f.value=a),doctype:"Instructor",label:e.__("Instructors"),filters:{Status:"Active"},required:!0},null,8,["modelValue","label"])])]),o("div",Xe,[(l=i(x).data)!=null&&l.is_moderator?(u(),p("div",Ye,c(e.__("Settings")),1)):S("",!0),o("div",He,[(t=i(x).data)!=null&&t.is_moderator?(u(),p("div",Ge,[n(i(P),{type:"checkbox",modelValue:r.published,"onUpdate:modelValue":s[7]||(s[7]=a=>r.published=a),label:e.__("Published")},null,8,["modelValue","label"])])):S("",!0)])])])]),o("div",We,[i(m).data?(u(),F(pe,{key:0,courseName:i(m).data.name,title:r.course,allowEdit:!0},null,8,["courseName","title"])):S("",!0)])])])}}};export{hs as default};
