var ie=Object.defineProperty;var Z=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var ee=(b,m,d)=>m in b?ie(b,m,{enumerable:!0,configurable:!0,writable:!0,value:d}):b[m]=d,g=(b,m)=>{for(var d in m||(m={}))ne.call(m,d)&&ee(b,d,m[d]);if(Z)for(var d of Z(m))ue.call(m,d)&&ee(b,d,m[d]);return b};import{y as re,z as se,r as G,a as j,c as h,n as le,l as O,g as Q,o as p,w as f,f as u,d as y,h as k,p as te,ad as oe,t as q,j as n,e as l,F as S,k as L,D as de,C as w,i as me,x as pe,m as ce,a0 as _e,b as fe,_ as U,A as T,a8 as be}from"./index-Bp-UPm00.js";import{_ as qe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-BKdvViSe.js";import{a as _}from"./FormControl.vue_vue_type_script_setup_true_lang-D9NZV9wG.js";import{_ as ye,a as ve,e as Ve,b as we,c as he,f as ze,d as ge}from"./ListView-By0bEH-x.js";import{_ as ke}from"./TextEditor.vue_vue_type_script_setup_true_lang-BTikwLvi.js";import{_ as ae}from"./Link-Bb8vWraq.js";import{u as Qe,T as $e}from"./index-BskJafJK.js";import{e as x}from"./exam-mhN0AOXW.js";import{P as De}from"./plus-CEpg6gV_.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-67bzkd8U.js";import"./Badge.vue_vue_type_script_setup_true_lang-BMWdk0aO.js";import"./call-DjkLykxt.js";import"./pencil-IevyI9q7.js";import"./FolderPlugin.vue_vue_type_style_index_0_scoped_84b7d54d_lang-DZhBt-lw.js";import"./book-open-check-BmkBAGoC.js";const Ue={class:"space-y-4"},xe={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},Se={class:"flex items-center space-x-2"},Ce={for:"existing",class:"cursor-pointer"},Pe={class:"flex items-center space-x-2"},Ie={for:"new",class:"cursor-pointer"},Ee={key:1,class:"space-y-2"},Me={class:"block text-xs text-ink-gray-5 mb-1"},Te={key:0,class:"divide-y border-t"},Oe={class:"space-y-4 py-2"},je={class:"space-y-2"},Le={key:2,class:"space-y-2"},Ae={__name:"Question",props:re({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(b){const m=se(b,"modelValue"),d=se(b,"quiz"),v=G(null),z=G(!1),c=j({question:"",points:0}),s=j({question:"",type:"Choices",points:0}),$=()=>{let a=["option","is_correct","explanation","possibility"],o=1;a.forEach(e=>{for(;o<=4;)s[`${e}_${o}`]=e==="is_correct"?!1:null,o++})};$();const r=b,C=h({url:"frappe.client.get",makeParams(){return{doctype:"Question",name:r.questionDetail.question}},auto:!1,onSuccess(a){let o=1;for(z.value=!0,Object.keys(a).forEach(e=>{Object.hasOwn(s,e)&&(s[e]=a[e])});o<=4;)s[`is_correct_${o}`]=!!a[`is_correct_${o}`],o++;s.points=r.questionDetail.points}});le(m,()=>{m.value&&(z.value=!1,r.questionDetail.question?C.fetch():(s.question="",s.points=0,s.type="Choices",c.question="",c.points=0,v.value=null,$()),r.questionDetail.points&&(s.points=r.questionDetail.points))});const A=h({url:"frappe.client.insert",makeParams(a){return{doc:g({doctype:"Quiz Question",parent:d.value.data.name,parentfield:"questions",parenttype:"Quiz"},a)}}}),P=h({url:"frappe.client.insert",makeParams(a){return{doc:g({doctype:"Question"},s)}}}),F=a=>{var o;(o=r.questionDetail)!=null&&o.question?R(a):N(a)},N=a=>{v.value=="existing"?I({question:c.question,points:c.points},a):P.submit({},{onSuccess(o){I({question:o.name,points:s.points},a)},onError(o){var e;w.error(((e=o.messages)==null?void 0:e[0])||o)}})},I=(a,o)=>{A.submit(g({},a),{onSuccess(){m.value=!1,w.success(__("Question added successfully")),d.value.reload(),o()},onError(e){var t;w.error(((t=e.messages)==null?void 0:t[0])||e),o()}})},E=h({url:"frappe.client.set_value",auto:!1,makeParams(a){var o;return{doctype:"Question",name:(o=C.data)==null?void 0:o.name,fieldname:g({},s)}}}),M=h({url:"frappe.client.set_value",auto:!1,makeParams(a){return{doctype:"Quiz Question",name:r.questionDetail.name,fieldname:{points:s.points}}}}),R=a=>{E.submit({},{onSuccess(){M.submit({},{onSuccess(){m.value=!1,w.success(__("Question updated successfully")),d.value.reload(),a()}})},onError(o){var e;w.error(((e=o.messages)==null?void 0:e[0])||o)}})},B=O(()=>({title:__(r.title),size:"xl",actions:[{label:__("Submit"),variant:"solid",onClick:a=>{F(a)}}]}));return(a,o)=>(p(),Q(l(de),{modelValue:m.value,"onUpdate:modelValue":o[7]||(o[7]=e=>m.value=e),options:B.value},{"body-content":f(()=>[u("div",Ue,[z.value?k("",!0):(p(),y("div",xe,[u("div",Se,[te(u("input",{type:"radio",id:"existing",value:"existing","onUpdate:modelValue":o[0]||(o[0]=e=>v.value=e),class:"w-3 h-3 cursor-pointer"},null,512),[[oe,v.value]]),u("label",Ce,q(a.__("Add an existing question")),1)]),u("div",Pe,[te(u("input",{type:"radio",id:"new",value:"new","onUpdate:modelValue":o[1]||(o[1]=e=>v.value=e),class:"w-3 h-3 cursor-pointer"},null,512),[[oe,v.value]]),u("label",Ie,q(a.__("Create a new question")),1)])])),v.value=="new"||z.value?(p(),y("div",Ee,[u("div",null,[u("label",Me,q(a.__("Question")),1),n(l(ke),{content:s.question,onChange:o[2]||(o[2]=e=>s.question=e),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),n(l(_),{modelValue:s.points,"onUpdate:modelValue":o[3]||(o[3]=e=>s.points=e),label:a.__("Points"),type:"number"},null,8,["modelValue","label"]),n(l(_),{label:a.__("Type"),modelValue:s.type,"onUpdate:modelValue":o[4]||(o[4]=e=>s.type=e),type:"select",options:["Choices","User Input"],class:"pb-2",required:!0},null,8,["label","modelValue"]),s.type=="Choices"?(p(),y("div",Te,[(p(),y(S,null,L(4,e=>u("div",Oe,[n(l(_),{label:a.__("Option")+" "+e,modelValue:s[`option_${e}`],"onUpdate:modelValue":t=>s[`option_${e}`]=t,required:e<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),n(l(_),{label:a.__("Explanation"),modelValue:s[`explanation_${e}`],"onUpdate:modelValue":t=>s[`explanation_${e}`]=t},null,8,["label","modelValue","onUpdate:modelValue"]),n(l(_),{label:a.__("Correct Answer"),modelValue:s[`is_correct_${e}`],"onUpdate:modelValue":t=>s[`is_correct_${e}`]=t,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):s.type=="User Input"?(p(),y(S,{key:1},L(4,e=>u("div",je,[n(l(_),{label:a.__("Possibility")+" "+e,modelValue:s[`possibility_${e}`],"onUpdate:modelValue":t=>s[`possibility_${e}`]=t,required:e==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64)):k("",!0)])):v.value=="existing"?(p(),y("div",Le,[n(ae,{modelValue:c.question,"onUpdate:modelValue":o[5]||(o[5]=e=>c.question=e),label:a.__("Select a question"),doctype:"Question"},null,8,["modelValue","label"]),n(l(_),{modelValue:c.points,"onUpdate:modelValue":o[6]||(o[6]=e=>c.points=e),label:a.__("Points"),type:"number"},null,8,["modelValue","label"])])):k("",!0)])]),_:1},8,["modelValue","options"]))}},Fe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ne={class:"space-x-2"},Re={class:"w-3/4 mx-auto py-5"},Be={class:"mb-8"},He={class:"font-semibold mb-4"},Ke={key:0},Ge={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Je={class:"mb-8"},We={class:"font-semibold mb-4"},Xe={class:"grid grid-cols-3 gap-5 my-4"},Ye={class:"mb-8"},Ze={class:"font-semibold mb-4"},es={class:"grid grid-cols-3"},ss={class:"flex items-center justify-between mb-4"},ts={class:"font-semibold"},os=["innerHTML"],ls={key:1,class:"text-xs"},as={class:"flex gap-2"},hs={__name:"QuizForm",props:{quizID:{type:String,required:!1}},setup(b){const m=G(!1),d=j({question:"",points:0,name:""}),v=me("$user"),z=pe(),c=b,s=j({title:"",course:"",total_points:0,passing_percentage:0,max_attempts:0,duration:0,qbyquestion:!1,limit_questions_to:0,show_answers:!0,show_submission_history:!1,shuffle_questions:!1,questions:[]});ce(()=>{var e,t;c.quizID=="new"&&!((e=v.data)!=null&&e.is_moderator)&&!((t=v.data)!=null&&t.is_instructor)&&z.push({name:"Courses"}),c.quizID==="new"&&(x.prefillData.title&&(s.title=x.prefillData.title),x.prefillData.course&&(s.course=x.prefillData.course)),c.quizID!=="new"&&r.reload(),window.addEventListener("keydown",$)});const $=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(P(),e.preventDefault())};_e(()=>{window.removeEventListener("keydown",$)}),le(()=>c.quizID!=="new",e=>{e&&(r.reload(),x.clearPrefillData())});const r=h({url:"frappe.client.get",makeParams(e){return{doctype:"Quiz",name:c.quizID}},auto:!1,onSuccess(e){Object.keys(e).forEach(V=>{Object.hasOwn(s,V)&&(s[V]=e[V])});let t=["show_answers","show_submission_history","shuffle_questions"];for(let V in t){let D=t[V];s[D]=!!s[D]}}}),C=h({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:g({doctype:"Quiz"},s)}}}),A=h({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"Quiz",name:e.quizID,fieldname:g({total_points:I()},s)}}}),P=()=>{var e;(e=r.data)!=null&&e.name?N():F()},F=()=>{C.submit({},{onSuccess(e){w.success(__("Quiz created successfully")),z.push({name:"QuizForm",params:{quizID:e.name}})},onError(e){var t;w.error(((t=e.messages)==null?void 0:t[0])||e)}})},N=()=>{var e;A.submit({quizID:(e=r.data)==null?void 0:e.name},{onSuccess(t){s.total_points=t.total_points,w.success(__("Quiz updated successfully"))},onError(t){var V;w.error(((V=t.messages)==null?void 0:V[0])||t)}})},I=()=>{let e=0;return s.limit_questions_to&&s.questions.length>0?s.questions[0].points*s.limit_questions_to:(s.questions.forEach(t=>{e+=t.points}),e)},E=O(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Points"),key:"points",width:"5rem"}]),M=(e=null)=>{e?(d.question=e.question,d.points=e.points,d.name=e.name):(d.question="",d.points=0,d.name=""),m.value=!0},R=h({url:"seminary.seminary.api.delete_documents",makeParams(e){return{doctype:"Quiz Question",documents:e.questions}}}),B=(e,t)=>{R.submit({questions:Array.from(e)},{onSuccess(){w.success(__("Questions deleted successfully")),r.reload(),t()}})},a=O(()=>{var t;let e=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return e.push({label:c.quizID=="new"?__("New Quiz"):(t=r.data)==null?void 0:t.title,route:{name:"QuizForm",params:{quizID:c.quizID}}}),e}),o=O(()=>{var e;return{title:c.quizID=="new"?__("New Quiz"):(e=r.data)==null?void 0:e.title,description:__("Form to create and edit quizzes")}});return Qe(o),(e,t)=>{var D,J,W,X;const V=fe("router-link");return p(),y(S,null,[u("header",Fe,[n(l(qe),{items:a.value},null,8,["items"]),u("div",Ne,[(D=l(r).data)!=null&&D.name?(p(),Q(V,{key:0,to:{name:"QuizPage",params:{quizID:l(r).data.name}}},{default:f(()=>[n(l(U),null,{default:f(()=>[T(q(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):k("",!0),(J=l(r).data)!=null&&J.name?(p(),Q(V,{key:1,to:{name:"QuizSubmissionList",params:{quizID:l(r).data.name}}},{default:f(()=>[n(l(U),null,{default:f(()=>[T(q(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):k("",!0),n(l(U),{variant:"solid",onClick:t[0]||(t[0]=i=>P())},{default:f(()=>[T(q(e.__("Save")),1)]),_:1})])]),u("div",Re,[u("div",Be,[u("div",He,q(e.__("Details")),1),n(l(_),{modelValue:s.title,"onUpdate:modelValue":t[1]||(t[1]=i=>s.title=i),label:(W=l(r).data)!=null&&W.name?e.__("Title"):e.__("Enter a title and save the quiz to proceed"),required:!0},null,8,["modelValue","label"]),n(ae,{modelValue:s.course,"onUpdate:modelValue":t[2]||(t[2]=i=>s.course=i),doctype:"Course",label:e.__("Course where this quiz will be used - you may reuse this quiz in other schedules"),required:!0},null,8,["modelValue","label"]),(X=l(r).data)!=null&&X.name?(p(),y("div",Ke,[u("div",Ge,[n(l(_),{type:"number",modelValue:s.max_attempts,"onUpdate:modelValue":t[3]||(t[3]=i=>s.max_attempts=i),label:e.__("Maximum Attempts"),default:1},null,8,["modelValue","label"]),n(l(_),{type:"number",modelValue:s.duration,"onUpdate:modelValue":t[4]||(t[4]=i=>s.duration=i),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),n(l(_),{modelValue:s.total_points,"onUpdate:modelValue":t[5]||(t[5]=i=>s.total_points=i),label:e.__("Total Points"),disabled:""},null,8,["modelValue","label"]),n(l(_),{modelValue:s.passing_percentage,"onUpdate:modelValue":t[6]||(t[6]=i=>s.passing_percentage=i),label:e.__("Passing Percentage. Use this to force students to retake the quiz until they pass")},null,8,["modelValue","label"])]),u("div",Je,[u("div",We,q(e.__("Settings")),1),u("div",Xe,[n(l(_),{modelValue:s.show_answers,"onUpdate:modelValue":t[7]||(t[7]=i=>s.show_answers=i),type:"checkbox",label:e.__("Show Answers")},null,8,["modelValue","label"]),n(l(_),{modelValue:s.show_submission_history,"onUpdate:modelValue":t[8]||(t[8]=i=>s.show_submission_history=i),type:"checkbox",label:e.__("Show Submission History")},null,8,["modelValue","label"]),n(l(_),{modelValue:s.qbyquestion,"onUpdate:modelValue":t[9]||(t[9]=i=>s.qbyquestion=i),type:"checkbox",label:e.__("Force student to answer a question before moving on? Each question will have its own page and a next button")},null,8,["modelValue","label"])])]),u("div",Ye,[u("div",Ze,q(e.__("Shuffle Settings")),1),u("div",es,[n(l(_),{modelValue:s.shuffle_questions,"onUpdate:modelValue":t[10]||(t[10]=i=>s.shuffle_questions=i),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),s.shuffle_questions?(p(),Q(l(_),{key:0,modelValue:s.limit_questions_to,"onUpdate:modelValue":t[11]||(t[11]=i=>s.limit_questions_to=i),label:e.__("Limit Questions To (on shuffle). Leave as zero to shuffle all questions")},null,8,["modelValue","label"])):k("",!0)])]),u("div",null,[u("div",ss,[u("div",ts,q(e.__("Questions")),1),n(l(U),{onClick:t[12]||(t[12]=i=>M())},{prefix:f(()=>[n(l(De),{class:"w-4 h-4"})]),default:f(()=>[T(" "+q(e.__("New Question")),1)]),_:1})]),n(l(ge),{columns:E.value,rows:s.questions,"row-key":"name",options:{showTooltip:!1}},{default:f(()=>[n(l(ye),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:f(()=>[(p(!0),y(S,null,L(E.value,i=>(p(),Q(l(ve),{item:i},null,8,["item"]))),256))]),_:1}),n(l(Ve),null,{default:f(()=>[(p(!0),y(S,null,L(s.questions,i=>(p(),Q(l(we),{row:i,onClick:H=>M(i),class:"cursor-pointer"},{default:f(({idx:H,column:Y,item:K})=>[n(l(he),{item:K},{default:f(()=>[Y.key=="question_detail"?(p(),y("div",{key:0,class:"text-xs truncate h-4",innerHTML:K},null,8,os)):(p(),y("div",ls,q(K),1))]),_:2},1032,["item"])]),_:1},8,["row","onClick"]))),256))]),_:1}),n(l(ze),null,{actions:f(({unselectAll:i,selections:H})=>[u("div",as,[n(l(U),{variant:"ghost",onClick:Y=>B(H,i)},{default:f(()=>[n(l($e),{class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):k("",!0)])]),n(Ae,{modelValue:m.value,"onUpdate:modelValue":t[13]||(t[13]=i=>m.value=i),questionDetail:d,quiz:l(r),"onUpdate:quiz":t[14]||(t[14]=i=>be(r)?r.value=i:null),title:d.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{hs as default};
//# sourceMappingURL=QuizForm-LzHFpnX1.js.map
