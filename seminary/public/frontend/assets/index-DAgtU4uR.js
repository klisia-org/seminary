var Rt=Object.defineProperty,qt=Object.defineProperties;var Ut=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var ft=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var ot=(c,e,t)=>e in c?Rt(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t,qe=(c,e)=>{for(var t in e||(e={}))ft.call(e,t)&&ot(c,t,e[t]);if(Ye)for(var t of Ye(e))ht.call(e,t)&&ot(c,t,e[t]);return c},Ge=(c,e)=>qt(c,Ut(e));var vt=c=>typeof c=="symbol"?c:c+"",gt=(c,e)=>{var t={};for(var l in c)ft.call(c,l)&&e.indexOf(l)<0&&(t[l]=c[l]);if(c!=null&&Ye)for(var l of Ye(c))e.indexOf(l)<0&&ht.call(c,l)&&(t[l]=c[l]);return t};var Fe=(c,e,t)=>ot(c,typeof e!="symbol"?e+"":e,t);var se=(c,e,t)=>new Promise((l,d)=>{var u=v=>{try{k(t.next(v))}catch(_){d(_)}},m=v=>{try{k(t.throw(v))}catch(_){d(_)}},k=v=>v.done?l(v.value):Promise.resolve(v.value).then(u,m);k((t=t.apply(c,e)).next())});import{b as dt,c as W,q as G,w as Pe,n as ze,r as He,H as Ue,t as ke,D as $t,G as ct,z as We,d as Ot,J as Vt,v as St}from"./frappe-ui-DItCq3tW.js";import{c as oe,a as z,b as o,w as U,g as s,m as Ht,n as Oe,u as a,bk as Ae,r as A,am as Je,F as Ze,I as ue,t as i,z as D,D as r,e as N,H as de,O as pe,L as $e,cl as nt,cm as _t,cn as rt,R as Bt,C as ie,av as Ee,J as Ct,aL as fe,q as Re,c8 as jt,bg as mt,c3 as Xe,c1 as Tt,cf as Gt,s as Qt,U as At,V as it,o as Jt,b_ as Wt,co as Yt,cp as Xt,cc as pt,a8 as Kt,cq as Zt,aw as Ne,cr as Dt,bU as es,ci as lt,cj as ts,aR as ss,cs as as,ct as Ft,cu as Mt,cv as Et,cw as Nt,cx as os,cy as ns,cz as rs,cA as ls,cB as yt,bW as is,ce as bt,bX as us,S as Qe,cC as ds,cD as cs,cE as ms,cF as ps,cG as fs,cH as hs,cI as vs,cJ as gs,cK as _s}from"./vendor-HNRiXHBS.js";import{_ as Ve}from"./Link-CDfjKa6y.js";import{t as De,r as Me,u as et,i as It}from"./index-DhRAnSEM.js";/* empty css                                                                     */const ys={class:"w-full bg-surface-gray-3 rounded-full h-1"},Lt={__name:"ProgressBar",props:{progress:{type:Number,default:0},size:{type:String,default:"sm"}},setup(c){const e=c,t=oe(()=>`${Math.min(Math.ceil(e.progress),100)}%`),l=oe(()=>{if(e.size==="sm")return"h-1";if(e.size==="md")return"h-2";if(e.size==="lg")return"h-3"});return(d,u)=>(o(),z(a(dt),{text:`${e.progress}%`},{default:U(()=>[s("div",ys,[s("div",{class:Oe(["bg-surface-gray-7 rounded-full",l.value]),style:Ht({width:t.value})},null,6)])]),_:1},8,["text"]))}},bs={key:0},ks={class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},xs={class:"leading-5"},ws={key:0,class:"leading-5"},$s={key:1,class:"leading-5"},Ss={key:2,class:"leading-relaxed"},Cs={key:3,class:"leading-relaxed"},Ts={key:0,class:"flex flex-col space-x-1 my-4"},As={class:"mb-2"},Ds={class:"font-semibold"},Fs={key:1},Ms={class:"border text-center p-20 rounded-md"},Es={class:"font-semibold text-lg"},Ns={key:2},Is={key:2},Ls={key:0,class:"border rounded-md p-5"},zs={class:"flex justify-between"},Ps={class:"text-sm text-ink-gray-5"},Rs={class:"mr-2"},qs={class:"text-ink-gray-9 text-sm font-semibold item-left"},Us=["innerHTML"],Os={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Vs=["name","onChange"],Hs=["name","onChange"],Bs={key:0},js=["innerHTML"],Gs={key:1},Qs={key:0},Js={key:2},Ws={class:"flex items-center justify-between mt-4"},Ys={class:"text-sm text-ink-gray-5"},Xs={key:3},Ks={class:"flex justify-between"},Zs={class:"text-sm text-ink-gray-5"},ea={class:"mr-2"},ta={class:"text-ink-gray-9 text-sm font-semibold item-left"},sa=["innerHTML"],aa={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},oa=["name","onChange"],na=["name","onChange"],ra=["innerHTML"],la={key:1},ia={class:"text-center mt-4"},ua={key:4,class:"border rounded-md p-20 text-center space-y-4"},da={class:"text-ink-gray-9"},ca={class:"mt-6"},ma={class:"flex justify-between"},pa={class:"text-lg text-ink-gray-5"},fa={class:"mr-2"},ha=["innerHTML"],va={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ga={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},_a={key:0,class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ya={class:"mt-4"},ba={key:1},ka={__name:"Quiz",props:{quizName:{type:String,required:!0}},setup(c){const e=Ae("$user"),t=A(!1),l=A(0),d=A(""),u=Je([0,0,0,0]),m=Je([]);let k=Je([]);const v=A(null),_=A(0);let w=null;const p=Ze(),q=A(0),g=Je({}),ae=c,y=W({url:"frappe.client.get",makeParams(b){return{doctype:"Quiz",name:ae.quizName}},cache:["quiz",ae.quizName],auto:!0,transform(b){return b?(b.duration=parseInt(b.duration)||0,b):(console.error("Quiz data is null or undefined."),null)},onSuccess(b){b?(P(),F()):console.error("Failed to load quiz data.")},onError(b){console.error("Error loading quiz data:",b)}}),B=oe(()=>!!y.data),P=()=>{let b=y.data;if(b.shuffle_questions){const f=ne([...b.questions]);k=b.limit_questions_to?f.slice(0,b.limit_questions_to):f}else k=b.questions},F=()=>{y.data.duration&&(_.value=y.data.duration*60)},$=()=>{w=setInterval(()=>{y.data.duration&&(_.value--,_.value==0&&(clearInterval(w),h())),q.value++},1e3)},V=b=>{const f=Math.floor(b/3600).toString().padStart(2,"0"),j=Math.floor(b%3600/60).toString().padStart(2,"0"),te=(b%60).toString().padStart(2,"0");return f!="00"?`${f}:${j}:${te}`:`${j}:${te}`},O=oe(()=>_.value/(y.data.duration*60)*100),ne=b=>{for(let f=b.length-1;f>0;f--){const j=Math.floor(Math.random()*(f+1));[b[f],b[j]]=[b[j],b[f]]}return b},ee=W({url:"frappe.client.get_list",makeParams(b){var f,j;return{doctype:"Quiz Submission",filters:{member:(f=e.data)==null?void 0:f.name,quiz:(j=y.data)==null?void 0:j.name},fields:["name","creation","score","score_out_of","percentage","passing_percentage"],order_by:"creation desc"}},transform(b){b.forEach((f,j)=>{f.creation=st(f.creation),f.idx=j+1})}});ue(()=>y.data,b=>{b&&P(),b&&y.data.max_attempts&&(ee.reload(),M())});const re=W({url:"seminary.seminary.doctype.quiz.quiz.quiz_summary",makeParams(b){if(!y.data)return{};const f=y.data.duration?y.data.duration*60-(_.value||0):q.value||0;return{quiz:y.data.name,course:p.currentRoute.value.params.courseName,results:(b==null?void 0:b.results)||localStorage.getItem(`${y.data.name}_results`),time_taken:f}},onSuccess(b){b.corrected_answers&&(ve.data=b.corrected_answers.map(f=>Ge(qe({},f),{user_answer:f.user_answer||null,correct_answer:f.correct_answer||null})))},onError(b){console.error("Error loading quiz summary:",b)},auto:!0}),X=W({url:"seminary.seminary.utils.get_question_details",makeParams(b){return{question:d.value}}});ue(l,b=>{b>0&&(d.value=y.data.questions[b-1].question,X.reload())}),ue(()=>ae.quizName,b=>{b&&y.reload()});const ve=W({url:"seminary.seminary.utils.get_all_questions_details",makeParams(b){return{questions:k.map(f=>f.name)}}}),S=()=>{l.value=1,localStorage.removeItem(y.data.title),$()},L=()=>{localStorage.removeItem(y.data.title),t.value=!0,$(),ve.reload()},Y=b=>{X.data.multiple||u.splice(0,u.length,0,0,0,0),u[b-1]=u[b-1]?0:1},C=()=>{let b=[];return X.data.type=="Choices"?u.forEach((j,te)=>{u[te]&&b.push(X.data[`option_${te+1}`])}):b.push(v.value),b},R=()=>{let b=C();if(!b.length){di({title:"Please select an option",icon:"alert-circle",iconClasses:"text-yellow-600 bg-yellow-100 rounded-full",position:"top-center"});return}W({url:"seminary.seminary.doctype.quiz.quiz.check_answer",params:{question:d.value,type:X.data.type,answers:JSON.stringify(b)},auto:!0,onSuccess(f){X.data.type==="Choices"?u.forEach((te,le)=>{te?m[le]=te&&f[le]:f[le]===2?m[le]=2:m[le]=void 0}):m.push(f),K(),y.data.show_answers||he()}})},K=()=>{let b=JSON.parse(localStorage.getItem(y.data.title))||[],f={question_name:d.value,answer:C().join(),is_correct:m.filter(te=>te!=null)};const j=b.findIndex(te=>te.question_name===f.question_name);j!==-1?b[j]=f:b?b.push(f):b=[f],localStorage.setItem(y.data.title,JSON.stringify(b)),localStorage.setItem(`${y.data.name}_results`,JSON.stringify(b))},ce=()=>{y.data.show_answers?(K(),he()):R()},he=()=>{l.value!=y.data.questions.length&&(l.value=l.value+1,u.splice(0,u.length,0,0,0,0),m.length=0,v.value=null)},h=()=>{if(!y.data.show_answers){R(),setTimeout(()=>{I()},500);return}I(),console.log("Quiz submitted with Submit Quiz button and asnwers shown")},T=()=>se(this,null,function*(){var j;const b=[],f=[];for(let te=0;te<ve.data.length;te++){const le=ve.data[te],xe=((j=g[te])==null?void 0:j[0])||"",Q=yield Ue("seminary.seminary.doctype.quiz.quiz.check_answer",{question:le.question,type:le.type,answers:JSON.stringify([xe])}),ge=Array.isArray(Q)?[Q.find(n=>n===1)||0]:[Q];b.push({question_name:le.question,answer:xe,is_correct:ge}),f.push({question_name:le.question,question_detail:le.question_detail,user_answer:xe,correct_answer:null,explanation:le.explanation||null})}re.submit({results:JSON.stringify(b)},{onSuccess:te=>se(this,null,function*(){const le=yield Ue("seminary.seminary.doctype.quiz.quiz.get_all_question_results",{questions:k.map(xe=>xe.question)});f.forEach(xe=>{const Q=le.find(ge=>ge.name===xe.question_name);Q&&(xe.correct_answer=Q.correct_option,xe.explanation=Q.correct_explanation||xe.explanation)}),localStorage.setItem(`${y.data.name}_questions`,JSON.stringify(f)),localStorage.setItem(`${y.data.name}_results`,JSON.stringify(b)),localStorage.setItem(`${y.data.name}_summary`,JSON.stringify(te)),re.reload(),t.value=!1}),onError(te){console.error("Error submitting quiz:",te)}})}),I=()=>{const b=localStorage.getItem(`${y.data.name}_results`);if(!b){console.error("No results found to submit.");return}re.submit({results:b},{onSuccess(f){_e(),y.data&&y.data.max_attempts&&ee.reload(),y.data.duration&&clearInterval(w)},onError(f){var te,le;((f==null?void 0:f.message)||"").includes("MaximumAttemptsExceededError")&&((te=f.messages)!=null&&te[0],ke.error(((le=f.messages)==null?void 0:le[0])||f),setTimeout(()=>{window.location.reload()},3e3))}})},M=()=>{l.value=0,u.splice(0,u.length,0,0,0,0),m.length=0,re.reset(),P(),F(),q.value=0},H=b=>b.type=="Choices"?b.multiple?"Choose all answers that apply":"Choose one answer":"Type your answer",_e=()=>{p.currentRoute.value.name==="Lesson"&&Ue("seminary.seminary.api.mark_lesson_progress",{course:p.currentRoute.value.params.courseName,chapter_number:p.currentRoute.value.params.chapterNumber,lesson_number:p.currentRoute.value.params.lessonNumber}).then(()=>{t.value&&re.reload()})},be=(b,f)=>{g[b]=[f]},me=(b,f)=>{g[b]||(g[b]=[]);const j=g[b].indexOf(f);j===-1?g[b].push(f):g[b].splice(j,1)};ue(()=>ve.data,b=>{b?console.log("All questions details updated"):console.warn("No data available in all_questions_details.")});const Se=A([]),we=A([]);return ue(()=>re.data,()=>{if(re.data){const b=localStorage.getItem(`${y.data.name}_questions`),f=localStorage.getItem(`${y.data.name}_results`);Se.value=b?JSON.parse(b):[],we.value=f?JSON.parse(f):[]}}),(b,f)=>{var j,te,le,xe;return B.value?(o(),i("div",bs,[s("div",ks,[s("div",xs,r(`This quiz consists of ${a(k).length} questions.`),1),(j=a(y).data)!=null&&j.duration?(o(),i("div",ws,r(`Please ensure that you complete all the questions in ${a(y).data.duration} minutes.`),1)):D("",!0),(te=a(y).data)!=null&&te.duration?(o(),i("div",$s,r("If you fail to do so, the quiz will be automatically submitted when the timer ends."))):D("",!0),a(y).data.passing_percentage?(o(),i("div",Ss,r(`You will have to get ${a(y).data.passing_percentage}% correct answers in order to pass the quiz.`),1)):D("",!0),a(y).data.max_attempts?(o(),i("div",Cs,r(`You can attempt this quiz ${a(y).data.max_attempts===1?"1 time":`${a(y).data.max_attempts} times`}.`),1)):D("",!0)]),a(y).data.duration?(o(),i("div",Ts,[s("div",As,[f[7]||(f[7]=s("span",{class:""},r("Time")+": ",-1)),s("span",Ds,r(V(_.value)),1)]),N(Lt,{progress:O.value},null,8,["progress"])])):D("",!0),t.value?D("",!0):(o(),i("div",Fs,[s("div",Ms,[s("div",Es,r(a(y).data.title),1),(!a(y).data.max_attempts||((le=a(ee).data)==null?void 0:le.length)<a(y).data.max_attempts)&&a(y).data.qbyquestion?(o(),z(a(G),{key:0,onClick:S,class:"mt-2"},{default:U(()=>[...f[8]||(f[8]=[s("span",null,r("Start"),-1)])]),_:1})):!a(y).data.max_attempts||((xe=a(ee).data)==null?void 0:xe.length)<a(y).data.max_attempts?(o(),z(a(G),{key:1,onClick:L,class:"mt-2"},{default:U(()=>[...f[9]||(f[9]=[s("span",null,r("Start full quiz"),-1)])]),_:1})):(o(),i("div",Ns,r("You have already exceeded the maximum number of attempts allowed for this quiz.")))])])),t.value===!1&&l.value!==0&&!a(re).data&&a(y).data.qbyquestion?(o(),i("div",Is,[(o(!0),i(de,null,pe(a(k),(Q,ge)=>(o(),i("div",null,[ge==l.value-1&&a(X).data?(o(),i("div",Ls,[s("div",zs,[s("div",Ps,[s("span",Rs,r(`Question ${l.value}`)+": ",1),s("span",null,r(H(a(X).data)),1)]),s("div",qs,r(Q.points)+" "+r(Q.points==1?"Point":"Points"),1)]),s("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:a(X).data.question},null,8,Us),a(X).data.type=="Choices"?(o(),i(de,{key:0},pe(4,n=>s("div",null,[a(X).data[`option_${n}`]?(o(),i("label",Os,[!m.length&&!a(X).data.multiple?(o(),i("input",{key:0,type:"radio",name:encodeURIComponent(a(X).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:x=>Y(n)},null,40,Vs)):!m.length&&a(X).data.multiple?(o(),i("input",{key:1,type:"checkbox",name:encodeURIComponent(a(X).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:x=>Y(n)},null,40,Hs)):a(y).data.show_answers?(o(!0),i(de,{key:2},pe(m,(x,Z)=>(o(),i("div",null,[n-1==Z?(o(),i("div",Bs,[x==1?(o(),z(a(nt),{key:0,class:"w-4 h-4 text-green-800"})):x==2?(o(),z(a(_t),{key:1,class:"w-4 h-4 text-ink-green-2"})):x==0?(o(),z(a(rt),{key:2,class:"w-4 h-4 text-red-600"})):(o(),z(a(_t),{key:3,class:"w-4 h-4"}))])):D("",!0)]))),256)):D("",!0),s("span",{class:"ml-2",innerHTML:a(X).data[`option_${n}`]},null,8,js)])):D("",!0),a(X).data[`explanation_${n}`]?$e((o(),i("div",{key:1,class:"mt-2 text-xs"},r(a(X).data[`explanation_${n}`]),513)),[[Bt,m.length]]):D("",!0)])),64)):a(X).data.type=="User Input"?(o(),i("div",Gs,[N(a(Pe),{modelValue:v.value,"onUpdate:modelValue":f[0]||(f[0]=n=>v.value=n),type:"textarea",disabled:!!m.length,class:"my-2"},null,8,["modelValue","disabled"]),m.length?(o(),i("div",Qs,[m[0]?(o(),z(a(ze),{key:0,label:"Correct",theme:"green"},{prefix:U(()=>[N(a(nt),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(o(),z(a(ze),{key:1,theme:"red",label:"Incorrect"},{prefix:U(()=>[N(a(rt),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])):D("",!0)])):(o(),i("div",Js,[N(a(He),{class:"mt-4",content:v.value,onChange:f[1]||(f[1]=n=>v.value=n),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),s("div",Ws,[s("div",Ys,r(`Question ${l.value} of ${a(k).length}`),1),a(y).data.show_answers&&!m.length?(o(),z(a(G),{key:0,onClick:f[2]||(f[2]=n=>R())},{default:U(()=>[...f[10]||(f[10]=[s("span",null,r("Check"),-1)])]),_:1})):l.value!=a(k).length?(o(),z(a(G),{key:1,onClick:f[3]||(f[3]=n=>ce())},{default:U(()=>[...f[11]||(f[11]=[s("span",null,r("Next"),-1)])]),_:1})):(o(),z(a(G),{key:2,onClick:f[4]||(f[4]=n=>h())},{default:U(()=>[...f[12]||(f[12]=[s("span",null,r("Submit"),-1)])]),_:1}))])])):D("",!0)]))),256))])):D("",!0),t.value&&a(ve).data&&a(ve).data.length>0?(o(),i("div",Xs,[(o(!0),i(de,null,pe(a(ve).data,(Q,ge)=>(o(),i("div",{key:Q.name,class:"border rounded-md p-5 mb-4"},[s("div",Ks,[s("div",Zs,[s("span",ea,r(`Question ${ge+1}`)+":",1),s("span",null,r(H(Q)),1)]),s("div",ta,r(Q.points||0)+" "+r(Q.points==1?"Point":"Points"),1)]),s("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:Q.question_detail},null,8,sa),Q.type=="Choices"?(o(),i(de,{key:0},pe(4,n=>s("div",null,[Q[`option_${n}`]?(o(),i("label",aa,[Q.multiple?Q.multiple?(o(),i("input",{key:1,type:"checkbox",name:`question_${ge}`,class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:x=>me(ge,Q[`option_${n}`])},null,40,na)):D("",!0):(o(),i("input",{key:0,type:"radio",name:`question_${ge}`,class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:x=>be(ge,Q[`option_${n}`])},null,40,oa)),s("span",{class:"ml-2",innerHTML:Q[`option_${n}`]},null,8,ra)])):D("",!0)])),64)):Q.type=="User Input"?(o(),i("div",la,[N(a(Pe),{modelValue:g[ge],"onUpdate:modelValue":n=>g[ge]=n,type:"textarea",class:"my-2"},null,8,["modelValue","onUpdate:modelValue"])])):D("",!0)]))),128)),s("div",ia,[N(a(G),{onClick:f[5]||(f[5]=Q=>T())},{default:U(()=>[...f[13]||(f[13]=[s("span",null,r("Submit Your Quiz"),-1)])]),_:1})])])):a(re).data?(o(),i("div",ua,[f[18]||(f[18]=s("div",{class:"text-lg font-semibold"},r("Quiz Summary"),-1)),s("div",da,r(`You got ${Math.ceil(a(re).data.percentage)}% correct answers with a score of ${a(re).data.score} out of ${a(re).data.score_out_of}`),1),s("div",ca,[(o(!0),i(de,null,pe(Se.value,(Q,ge)=>{var n,x;return o(),i("div",{key:Q.question_name,class:"border rounded-md p-5 mb-4"},[s("div",ma,[s("div",pa,[s("span",fa,r(`Question ${ge+1}`)+":",1),s("span",{innerHTML:Q.question_detail},null,8,ha)])]),s("div",va,[f[14]||(f[14]=s("strong",null,r("Your Answer:"),-1)),ie(" "+r(Q.user_answer||"No Answer"),1)]),s("div",ga,[f[15]||(f[15]=s("strong",null,r("Correct Answer:"),-1)),ie(" "+r(Q.correct_answer||"No Correct Answer"),1)]),Q.explanation?(o(),i("div",_a,[f[16]||(f[16]=s("strong",null,r("Explanation:"),-1)),ie(" "+r(Q.explanation),1)])):D("",!0),s("div",ya,[((x=(n=we.value[ge])==null?void 0:n.is_correct)==null?void 0:x[0])===1?(o(),z(a(ze),{key:0,label:"Correct",theme:"green"},{prefix:U(()=>[N(a(nt),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(o(),z(a(ze),{key:1,label:"Incorrect",theme:"red"},{prefix:U(()=>[N(a(rt),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])])}),128))]),N(a(G),{onClick:f[6]||(f[6]=Q=>M()),class:"mt-4"},{default:U(()=>[...f[17]||(f[17]=[s("span",null,r("Try Again"),-1)])]),_:1})])):D("",!0)])):(o(),i("div",ba,[...f[19]||(f[19]=[s("p",null,"Loading quiz data...",-1)])]))}}},xa={key:1,class:"border rounded-md text-center py-20"},wa={__name:"QuizBlock",props:{quiz:{type:String,required:!0}},setup(c){const e=Ae("$user"),t=()=>{window.location.href="/login"};return(l,d)=>a(e).data?(o(),z(ka,{key:0,quizName:c.quiz},null,8,["quizName"])):(o(),i("div",xa,[s("div",null,r(l.__("Please login to access the quiz.")),1),N(a(G),{onClick:d[0]||(d[0]=u=>t()),class:"mt-2"},{default:U(()=>[s("span",null,r(l.__("Login")),1)]),_:1})]))}},$a={class:"p-5 space-y-4"},Sa={key:0,class:"text-lg font-semibold"},Ca={key:1,class:"text-lg font-semibold"},Ta={key:2,class:"text-lg font-semibold"},Aa={key:3,class:"text-lg font-semibold"},Da={class:"flex justify-end space-x-2"},tt={__name:"AssessmentPlugin",props:{type:{type:String,required:!0},onAddition:{type:Function,required:!0}},setup(c){const e=A(!1),t=A(null),l=A(null),d=A(null),u=A(null),m=c;Ee(()=>se(this,null,function*(){yield Ct(),e.value=!0}));const k=()=>{m.type=="quiz"?m.onAddition(t.value):m.type=="exam"?m.onAddition(d.value):m.type=="discussionactivity"?m.onAddition(u.value):m.onAddition(l.value),e.value=!1},v=()=>{m.type=="quiz"?window.open("/seminary/quizzes/new","_blank"):m.type=="exam"?window.open("/seminary/exams/new","_blank"):m.type=="discussionactivity"?window.open("/seminary/discussion-activity/new","_blank"):window.open("/seminary/assignments/new","_blank")};return(_,w)=>(o(),z(a($t),{modelValue:e.value,"onUpdate:modelValue":w[5]||(w[5]=p=>e.value=p),options:{size:"xl"}},{body:U(()=>[w[6]||(w[6]=s("button",{style:{opacity:"0",position:"absolute"}},"Fallback Focus",-1)),s("div",$a,[c.type=="quiz"?(o(),i("div",Sa,r(_.__("Add a quiz to your lesson")),1)):c.type=="exam"?(o(),i("div",Ca,r(_.__("Add an exam to your lesson")),1)):c.type=="discussionactivity"?(o(),i("div",Ta,r(_.__("Add a discussion activity to your lesson")),1)):(o(),i("div",Aa,r(_.__("Add an assignment to your lesson")),1)),s("div",null,[c.type=="quiz"?(o(),z(Ve,{key:0,modelValue:t.value,"onUpdate:modelValue":w[0]||(w[0]=p=>t.value=p),doctype:"Quiz",label:_.__("Select a quiz"),onCreate:(p,q)=>v()},null,8,["modelValue","label","onCreate"])):c.type=="exam"?(o(),z(Ve,{key:1,modelValue:d.value,"onUpdate:modelValue":w[1]||(w[1]=p=>d.value=p),doctype:"Exam Activity",label:_.__("Select an exam"),onCreate:(p,q)=>v()},null,8,["modelValue","label","onCreate"])):c.type=="discussionactivity"?(o(),z(Ve,{key:2,modelValue:u.value,"onUpdate:modelValue":w[2]||(w[2]=p=>u.value=p),doctype:"Discussion Activity",label:_.__("Select a discussion activity"),onCreate:(p,q)=>v()},null,8,["modelValue","label","onCreate"])):(o(),z(Ve,{key:3,modelValue:l.value,"onUpdate:modelValue":w[3]||(w[3]=p=>l.value=p),doctype:"Assignment Activity",label:_.__("Select an assignment"),onCreate:(p,q)=>v()},null,8,["modelValue","label","onCreate"]))]),s("div",Da,[N(a(G),{variant:"solid",onClick:w[4]||(w[4]=p=>k())},{default:U(()=>[ie(r(_.__("Save")),1)]),_:1})])])]),_:1},8,["modelValue"]))}};class Fa{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(jt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Quiz"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderQuiz(this.data.quiz):this.renderQuizModal(),this.wrapper}renderQuiz(e){if(this.readOnly){const t=fe(wa,{quiz:e});t.use(De),t.use(Me);const{userResource:l}=et();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Quiz: ${e}
            </span>
        </div>`}renderQuizModal(){if(this.readOnly)return;const e=fe(tt,{type:"quiz",onAddition:t=>{this.data.quiz=t,this.renderQuiz(t)}});e.use(De),e.use(Me),e.mount(this.wrapper)}save(e){return{quiz:this.data.quiz}}}const Ma={class:"border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},Ea={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},Na={key:0},Ia={key:1},La={class:"text-sm text-ink-gray-7 font-medium mb-2"},za=["innerHTML"],Pa={class:"flex flex-col"},Ra={class:"p-5"},qa={class:"flex items-center justify-between mb-4"},Ua={class:"font-semibold text-ink-gray-9"},Oa={class:"flex items-center space-x-2"},Va={key:0,class:"bg-blue-200 p-3 rounded-md leading-5 text-sm mb-4"},Ha={key:1},Ba={class:"text-xs text-ink-gray-5 mt-1 mb-2"},ja={key:1},Ga={class:"flex text-ink-gray-7"},Qa={class:"border self-start rounded-md p-2 mr-2"},Ja=["href"],Wa={class:"text-sm leading-5"},Ya={class:"text-sm text-ink-gray-5 mt-1"},Xa={key:2},Ka={class:"text-xs text-ink-gray-5 mb-1"},Za={key:3},eo={class:"text-sm mb-4"},to={key:4,class:"mt-8 p-3 bg-blue-200 rounded-md"},so={class:"text-sm text-ink-gray-5 font-medium mb-2"},ao={class:"leading-5"},oo=["innerHTML"],no={key:5,class:"mt-8 space-y-4"},ro={class:"font-semibold mb-2 text-ink-gray-9"},lo={class:"text-sm text-ink-gray-5 mb-1"},io={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(c){var ve;const e=A(null),t=A(null),l=A(null),d=Ze(),u=Ae("$user"),m=d.currentRoute.value.name=="AssignmentSubmission",k=A(!1),v=c;Ee(()=>{window.addEventListener("keydown",_),console.log("User: ",u.data)});const _=S=>{S.key==="s"&&(S.ctrlKey||S.metaKey)&&(ae(),S.preventDefault())};mt(()=>{window.removeEventListener("keydown",_)});const w=W({url:"frappe.client.get",params:{doctype:"Assignment Activity",name:v.assignmentID},auto:!0,onSuccess(S){v.submissionName!="new"&&g.reload()}}),p=W({url:"frappe.client.insert",makeParams(S){var Y;let L={doctype:"Assignment Submission",assignment:v.assignmentID,member:(Y=u.data)==null?void 0:Y.name,course:d.currentRoute.value.params.courseName};return X()?L.assignment_attachment=e.value.file_url:L.answer=t.value,{doc:L}}}),q=W({url:"seminary.seminary.api.get_file_info",makeParams(S){return{file_url:S.image}},auto:!1,onSuccess(S){e.value=S}}),g=ct({doctype:"Assignment Submission",name:v.submissionName,onError(S){var L;ke.error(((L=S.messages)==null?void 0:L[0])||S)},auto:!1,cache:[(ve=u.data)==null?void 0:ve.name,v.assignmentID]});ue(g,()=>{g.doc&&(g.doc.assignment_attachment&&q.reload({image:g.doc.assignment_attachment}),g.doc.answer&&(t.value=g.doc.answer),g.doc.comments&&(l.value=g.doc.comments),g.isDirty||X()&&!e.value||!X()&&!t.value?k.value=!0:k.value=!1)}),ue(e,()=>{v.submissionName=="new"&&e.value&&(k.value=!0)}),ue(()=>{var S;return(S=g.doc)==null?void 0:S.grade},(S,L)=>{S!==L&&g.doc&&(g.doc.status="Graded",k.value=!0)});const ae=()=>{var S,L,Y;if(v.submissionName!="new"){let C=g.doc&&g.doc.owner!=((S=u.data)==null?void 0:S.name)?(L=u.data)==null?void 0:L.name:null;g.setValue.submit(Ge(qe({},g.doc),{assignment_attachment:(Y=e.value)==null?void 0:Y.file_url,evaluator:C,comments:l.value,answer:t.value}),{onSuccess(R){ke.success(__("Changed successfully")),k.value=!1}})}else y()},y=()=>{p.submit({},{onSuccess(S){ke.success(__("Assignment submitted successfully")),d.currentRoute.value.name=="AssignmentSubmission"?d.push({name:"AssignmentSubmission",params:{assignmentID:v.assignmentID,submissionName:S.name}}):(P(),d.go()),g.name=S.name,k.value=!1,g.reload()},onError(S){var L;ke.error(((L=S.messages)==null?void 0:L[0])||S)}})},B=S=>{k.value=!0,e.value=S},P=()=>{if(d.currentRoute.value.name=="Lesson"){let S=d.currentRoute.value.params.courseName,L=d.currentRoute.value.params.chapterNumber,Y=d.currentRoute.value.params.lessonNumber;console.log("Chapter Number: ",L),console.log("Lesson Number: ",Y),Ue("seminary.seminary.api.mark_lesson_progress",{course:S,chapter_number:L,lesson_number:Y})}},F=()=>{var L;const S=(L=w.data)==null?void 0:L.type;if(S=="Image")return["image/*"];if(S=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(S=="PDF")return[".pdf"]},$=S=>{var C;let L=(C=w.data)==null?void 0:C.type,Y=S.name.split(".").pop().toLowerCase();if(L=="Image"&&!["jpg","jpeg","png"].includes(Y))return"Only image file is allowed.";if(L=="Document"&&!["doc","docx","xml"].includes(Y))return"Only document file is allowed.";if(L=="PDF"&&!["pdf"].includes(Y))return"Only PDF file is allowed."},V=()=>{k.value=!0,e.value=null},O=oe(()=>{var S,L,Y;return(((S=u.data)==null?void 0:S.is_moderator)||((L=u.data)==null?void 0:L.is_evaluator)||((Y=u.data)==null?void 0:Y.is_instructor))&&v.submissionName!="new"&&d.currentRoute.value.name=="AssignmentSubmission"}),ne=oe(()=>{var S,L,Y;return!g.doc||((S=g.doc)==null?void 0:S.owner)==((L=u.data)==null?void 0:L.name)&&((Y=g.doc)==null?void 0:Y.status)=="Not Graded"}),ee=oe(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),re=oe(()=>g.doc?g.doc.status=="Pass"||g.doc.status=="Graded"?"green":g.doc.status=="Not Graded"?"blue":"red":"orange"),X=()=>{var S;return["PDF","Image","Document"].includes((S=w.data)==null?void 0:S.type)};return(S,L)=>{var Y,C,R,K,ce,he,h,T,I,M;return a(w).data?(o(),i("div",{key:0,class:Oe(["grid grid-cols-[65%,35%] h-full",{"border rounded-lg":!m}])},[s("div",Ma,[m?(o(),i("div",Ea,[c.submissionName==="new"?(o(),i("div",Na,r(S.__("Submission by"))+" "+r((Y=a(u).data)==null?void 0:Y.full_name),1)):(o(),i("div",Ia,r(S.__("Submission by"))+" "+r((C=a(g).doc)==null?void 0:C.member_name),1))])):D("",!0),s("div",La,r(S.__("Question"))+": ",1),s("div",{innerHTML:a(w).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,za)]),s("div",Pa,[s("div",Ra,[s("div",qa,[s("div",Ua,r(S.__("Submission")),1),s("div",Oa,[k.value?(o(),z(a(ze),{key:0,theme:"orange"},{default:U(()=>[ie(r(S.__("Not Saved")),1)]),_:1})):(R=a(g).doc)!=null&&R.status?(o(),z(a(ze),{key:1,theme:re.value,size:"lg"},{default:U(()=>{var H;return[ie(r((H=a(g).doc)==null?void 0:H.status),1)]}),_:1},8,["theme"])):D("",!0),N(a(G),{variant:"solid",onClick:L[0]||(L[0]=H=>ae())},{default:U(()=>[ie(r(S.__("Save")),1)]),_:1})])]),c.submissionName!="new"&&!["Pass","Fail","Graded"].includes((K=a(g).doc)==null?void 0:K.status)&&((ce=a(g).doc)==null?void 0:ce.owner)==((he=a(u).data)==null?void 0:he.name)?(o(),i("div",Va,r(S.__("You've successfully submitted the assignment."))+" "+r(S.__("Once the moderator grades your submission, you'll find the details here."))+" "+r(S.__("Feel free to make edits to your submission if needed, until it is graded.")),1)):D("",!0),X()?(o(),i("div",Ha,[s("div",Ba,r(S.__("Add your assignment as {0}").format(a(w).data.type)),1),e.value?(o(),i("div",ja,[s("div",Ga,[s("div",Qa,[N(a(Xe),{class:"h-5 w-5 stroke-1.5"})]),s("a",{href:e.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[s("span",Wa,r(e.value.file_name),1),s("span",Ya,r(a(Ke)(e.value.file_size)),1)],8,Ja),ne.value?(o(),z(a(Tt),{key:0,onClick:L[2]||(L[2]=H=>V()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):D("",!0)])])):(o(),z(a(We),{key:0,fileTypes:F(),validateFile:$,onSuccess:L[1]||(L[1]=H=>B(H))},{default:U(({uploading:H,progress:_e,openFileSelector:be})=>[N(a(G),{onClick:be,loading:H},{default:U(()=>[ie(r(H?S.__("Uploading {0}%").format(_e):S.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(w).data.type=="URL"?(o(),i("div",Xa,[s("div",Ka,r(S.__("Enter a URL")),1),N(a(Pe),{modelValue:t.value,"onUpdate:modelValue":L[3]||(L[3]=H=>t.value=H),type:"text",readonly:!ne.value},null,8,["modelValue","readonly"])])):(o(),i("div",Za,[s("div",eo,r(S.__("Write your answer here")),1),N(a(He),{content:t.value,onChange:L[4]||(L[4]=H=>t.value=H),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((h=a(u).data)==null?void 0:h.name)==((T=a(g).doc)==null?void 0:T.owner)&&((I=a(g).doc)!=null&&I.comments)?(o(),i("div",to,[s("div",so,r(S.__("Comments by"))+": "+r(((M=a(g).doc)==null?void 0:M.evaluator)||S.__("Evaluator")),1),s("div",ao,[s("div",{innerHTML:a(g).doc.comments},null,8,oo)])])):D("",!0),O.value?(o(),i("div",no,[s("div",ro,r(S.__("Grading")),1),a(g).doc?(o(),z(a(Pe),{key:0,modelValue:a(g).doc.status,"onUpdate:modelValue":L[5]||(L[5]=H=>a(g).doc.status=H),label:S.__("Grading Status"),type:"select",options:ee.value},null,8,["modelValue","label","options"])):D("",!0),a(g).doc?(o(),z(a(Pe),{key:1,modelValue:a(g).doc.grade,"onUpdate:modelValue":L[6]||(L[6]=H=>a(g).doc.grade=H),label:S.__("Score"),type:"number"},null,8,["modelValue","label"])):D("",!0),s("div",null,[s("div",lo,r(S.__("Comments")),1),N(a(He),{content:l.value,onChange:L[7]||(L[7]=H=>{l.value=H,k.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):D("",!0)])])],2)):D("",!0)}}},uo={key:1,class:"border rounded-md text-center py-20"},co={__name:"AssignmentBlock",props:{assignmentID:{type:String,required:!0}},setup(c){const e=Ae("$user"),t=c,l=W({url:"frappe.client.get_value",makeParams(d){var u;return{doctype:"Assignment Submission",fieldname:"name",filters:{assignment:t.assignmentID,member:(u=e.data)==null?void 0:u.name}}},auto:!0});return(d,u)=>{var m;return a(e).data&&a(l).data?(o(),z(io,{key:0,assignmentID:c.assignmentID,submissionName:((m=a(l).data)==null?void 0:m.name)||"new"},null,8,["assignmentID","submissionName"])):(o(),i("div",uo,[s("div",null,r(d.__("Please login to access the assignment.")),1),N(a(G),{onClick:u[0]||(u[0]=k=>d.redirectToLogin()),class:"mt-2"},{default:U(()=>[s("span",null,r(d.__("Login")),1)]),_:1})]))}}};class mo{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(Gt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Assignment"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderAssignment(this.data.assignment):this.renderAssignmentModal(),this.wrapper}renderAssignment(e){if(this.readOnly){const t=fe(co,{assignmentID:e});t.use(De),t.use(Me);const{userResource:l}=et();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Assignment: ${e}
            </span>
        </div>`}renderAssignmentModal(){if(this.readOnly)return;const e=fe(tt,{type:"assignment",onAddition:t=>{this.data.assignment=t,this.renderAssignment(t)}});e.use(De),e.use(Me),e.mount(this.wrapper)}save(e){return{assignment:this.data.assignment}}}const po={key:0,class:"text-center py-5"},fo={key:1,class:"space-y-5"},ho={class:"grid grid-cols-3 gap-3"},vo={class:"col-span-3 space-y-4"},go={class:"space-y-4 border p-2 rounded-md"},_o={class:"flex items-center justify-between py-4"},yo={class:"text-center ml-5"},bo={class:"text-3xl font-bold text-ink-gray-9"},ko={class:"text-center"},xo={class:"text-3xl font-semibold text-ink-gray-9"},wo={class:"text-sm text-ink-gray-5"},$o={class:"text-center mr-5"},So={class:"text-3xl font-semibold text-ink-gray-9 mt-2"},Co={class:"space-y-1"},To={class:"font-semibold text-ink-gray-9 text-left"},Ao=["innerHTML"],Do={class:"leading-5 text-ink-gray-7 space-x-1 text-left"},Fo=["innerHTML"],Mo={class:"flex justify-end items-center space-x-2"},Eo={class:"text-sm text-ink-gray-7 text-xl"},No={key:0,class:"leading-5 text-ink-gray-7 text-xl space-x-1 text-left"},Io=["innerHTML"],Lo={key:2},zo={__name:"ExamGraded",props:{submission:{type:String,required:!0}},setup(c){const e=c;console.log("ExamGraded received submission:",e.submission);const t=ct({doctype:"Exam Submission",name:e.submission,auto:!0});console.log("ExamGraded submisisonDetails:",t),ue(()=>t.doc,d=>{t.loading=!1,console.log("ExamGraded updated with new submission details:",d)});const l=d=>{if(!d)return"00:00:00";const u=Math.floor(d/3600).toString().padStart(2,"0"),m=Math.floor(d%3600/60).toString().padStart(2,"0"),k=(d%60).toString().padStart(2,"0");return`${u}:${m}:${k}`};return(d,u)=>a(t).loading?(o(),i("div",po,[...u[0]||(u[0]=[s("p",null,"Loading submission details...",-1)])])):a(t).doc?(o(),i("div",fo,[s("div",ho,[s("div",vo,[s("div",go,[s("div",_o,[s("div",yo,[s("div",bo,r(a(t).doc.percentage||0)+"% ",1),u[1]||(u[1]=s("div",{class:"text-sm text-ink-gray-5"},"Score",-1))]),s("div",ko,[s("div",xo,r(a(t).doc.score),1),s("div",wo," Out of "+r(a(t).doc.score_out_of)+" Points ",1)]),s("div",$o,[s("div",So,r(l(a(t).doc.time_taken)),1),u[2]||(u[2]=s("div",{class:"text-sm text-ink-gray-5"},"Time taken",-1))])])]),(o(!0),i(de,null,pe(a(t).doc.result,(m,k)=>(o(),i("div",{key:k,class:"border p-5 rounded-md space-y-4"},[s("div",Co,[s("div",To,r(d.__("Question"))+" "+r(k+1)+": ",1),s("div",{class:"leading-5 text-ink-gray-9 text-left",innerHTML:m.question_name},null,8,Ao)]),s("div",Do,[s("span",null,r(d.__("Your Answer"))+": ",1),s("span",{innerHTML:m.answer},null,8,Fo)]),s("div",Mo,[s("span",Eo,r(m.points)+" / "+r(parseInt(m.points_out_of,10))+" "+r(d.__("Points")),1)]),m.comments?(o(),i("div",No,[s("span",null,r(d.__("Comments"))+": ",1),s("span",{innerHTML:m.comments},null,8,Io)])):D("",!0)]))),128))])])])):(o(),i("div",Lo,[...u[3]||(u[3]=[s("p",null,"Debug: No submission details found.",-1)])]))}},zt={__name:"UserAvatar",props:{user:{type:Object,default:null},size:{type:String}},setup(c){return(e,t)=>(o(),z(a(dt),{text:c.user.full_name},{default:U(()=>[c.user?(o(),z(a(Ot),Qt({key:0,class:"avatar border border-outline-gray-2 cursor-auto",label:c.user.full_name,image:c.user.user_image,size:c.size},e.$attrs),null,16,["label","image","size"])):D("",!0)]),_:1},8,["text"]))}},Po={class:"mt-6"},Ro={key:0,class:"flex items-center mb-5"},qo={class:"text-lg font-semibold ml-2 text-ink-gray-9"},Uo={class:"flex items-center justify-between mb-2"},Oo={class:"flex items-center text-ink-gray-5"},Vo={class:"text-sm ml-2"},Ho={key:1},Bo={key:2,class:"flex justify-between mt-2"},kt={__name:"DiscussionReplies",props:At({topic:{type:Object,required:!0},singleThread:{type:Boolean,default:!1}},{showTopics:{},showTopicsModifiers:{}}),emits:["update:showTopics"],setup(c){const e=it(c,"showTopics"),t=A(""),l=Ae("$user"),d=Ae("$allUsers"),u=A([]),m=A(!1),k=window.read_only_mode,v=A(!1),_=It();_?(console.log("Socket connection initialized in Discussions.vue:",_),_.on("connect",()=>{console.log("Socket connected:",_.id),v.value=!0}),_.on("connect_error",$=>{console.error("Socket connection error:",$)}),_.on("disconnect",$=>{console.warn("Socket disconnected:",$),v.value=!1})):console.error("Socket connection not initialized in Discussions.vue.");const w=c;Ee(()=>{_.on("publish_message",$=>{p.reload()}),_.on("update_message",$=>{p.reload()}),_.on("delete_message",$=>{p.reload()}),g()});const p=W({url:"seminary.seminary.utils.get_discussion_replies",cache:["replies",w.topic],makeParams($){return{topic:w.topic.name}},auto:!0}),q=W({url:"frappe.client.insert",makeParams($){return{doc:{doctype:"Discussion Reply",reply:t.value,topic:w.topic.name}}}}),g=()=>{var $;($=l.data)!=null&&$.is_student?m.value=!0:d.reload({},{onSuccess(V){u.value=Object.values(V).map(O=>({value:O.name,label:O.full_name})),m.value=!0}})},ae=()=>{q.submit({},{validate(){if(!t.value)return"Reply cannot be empty"},onSuccess(){t.value="",p.reload()},onError($){var V;ke.error(((V=$.messages)==null?void 0:V[0])||$)}})},y=W({url:"frappe.client.set_value",makeParams($){return{doctype:"Discussion Reply",name:$.name,fieldname:"reply",value:$.reply}}}),B=$=>{y.submit({name:$.name,reply:$.reply},{validate(){if(!$.reply)return"Reply cannot be empty"},onSuccess(){$.editable=!1,p.reload()}})},P=W({url:"frappe.client.delete",makeParams($){return{doctype:"Discussion Reply",name:$.name}}}),F=$=>{P.submit({name:$.name},{onSuccess(){p.reload()}})};return Jt(()=>{_.off("publish_message"),_.off("update_message"),_.off("delete_message")}),($,V)=>(o(),i("div",Po,[c.singleThread?D("",!0):(o(),i("div",Ro,[N(a(G),{variant:"outline",onClick:V[0]||(V[0]=O=>e.value=!0)},{icon:U(()=>[N(a(Wt),{class:"w-5 h-5 stroke-1.5 text-ink-gray-7"})]),_:1}),s("span",qo,r(c.topic.title),1)])),(o(!0),i(de,null,pe(a(p).data,(O,ne)=>(o(),i("div",null,[s("div",{class:Oe(["py-3",{"border-b":ne+1!=a(p).data.length}])},[s("div",Uo,[s("div",Oo,[N(zt,{user:O.user,class:"mr-2"},null,8,["user"]),s("span",null,r(O.user.full_name),1),s("span",Vo,r(a(st)(O.creation)),1)]),a(l).data.name==O.owner&&!O.editable&&!a(k)?(o(),z(a(Vt),{key:0,options:[{label:$.__("Edit"),onClick(){O.editable=!0}},{label:$.__("Delete"),onClick(){F(O)}}]},{default:U(({open:ee})=>[N(a(Yt),{class:"w-4 h-4 stroke-1.5 cursor-pointer"})]),_:1},8,["options"])):D("",!0),O.editable?(o(),i("div",Ho,[N(a(G),{variant:"ghost",onClick:ee=>B(O)},{default:U(()=>[ie(r($.__("Post")),1)]),_:1},8,["onClick"]),N(a(G),{variant:"ghost",onClick:ee=>O.editable=!1},{default:U(()=>[ie(r($.__("Discard")),1)]),_:1},8,["onClick"])])):D("",!0)]),N(a(He),{content:O.reply,onChange:ee=>O.reply=ee,editable:O.editable||!1,fixedMenu:O.editable||!1,editorClass:O.editable?"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none":"prose-sm"},null,8,["content","onChange","editable","fixedMenu","editorClass"])],2)]))),256)),m.value&&!a(k)?(o(),z(a(He),{key:1,class:"mt-5",content:t.value,mentions:u.value,onChange:V[1]||(V[1]=O=>t.value=O),placeholder:"Type your reply here...",fixedMenu:!0,editorClass:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none border border-outline-gray-2 rounded-b-md min-h-[7rem] py-1 px-2"},null,8,["content","mentions"])):D("",!0),a(k)?D("",!0):(o(),i("div",Bo,[V[3]||(V[3]=s("span",null,null,-1)),N(a(G),{onClick:V[2]||(V[2]=O=>ae())},{default:U(()=>[s("span",null,r($.__("Post")),1)]),_:1})]))]))}},jo={class:"discussion-dialog flex flex-col gap-4 max-h-[70vh] overflow-y-auto"},Go={class:"mb-1.5 text-sm text-ink-gray-5"},xt={__name:"DiscussionModal",props:At({title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0}},{modelValue:{},modelModifiers:{},reloadTopics:{},reloadTopicsModifiers:{}}),emits:["update:modelValue","update:reloadTopics"],setup(c){const e=it(c,"modelValue"),t=it(c,"reloadTopics"),l=c,d=Je({title:"",reply:""}),u=()=>{d.title="",d.reply=""},m=W({url:"frappe.client.insert",makeParams(p){return{doc:{doctype:"Discussion Topic",reference_doctype:l.doctype,reference_docname:l.docname,title:d.title}}}}),k=W({url:"frappe.client.insert",makeParams(p){return{doc:{doctype:"Discussion Reply",topic:p.topic,reply:d.reply}}}}),v=p=>{m.submit({},{validate(){if(!d.title)return"Title cannot be empty.";if(!d.reply)return"Reply cannot be empty."},onSuccess(q){k.submit({topic:q.name},{onSuccess(){e.value=!1,t.value.reload(),u(),p()}})},onError(q){var g;ke.error(((g=q.messages)==null?void 0:g[0])||q)}})},_=p=>{e.value=!1,u(),p==null||p()};ue(e,p=>{p||u()});const w=oe(()=>({title:Pt(l.title),size:"2xl",actions:[{label:__("Post"),variant:"solid",onClick:p=>v(p)},{label:__("Cancel"),variant:"text",onClick:p=>_(p)}]}));return(p,q)=>(o(),z(a($t),{modelValue:e.value,"onUpdate:modelValue":q[2]||(q[2]=g=>e.value=g),disableOutsideClickToClose:!0,options:w.value},{"body-content":U(()=>[s("div",jo,[s("div",null,[N(a(Pe),{modelValue:d.title,"onUpdate:modelValue":q[0]||(q[0]=g=>d.title=g),label:p.__("Title"),type:"text"},null,8,["modelValue","label"])]),s("div",null,[s("div",Go,r(p.__("Details")),1),N(a(He),{content:d.reply,onChange:q[1]||(q[1]=g=>d.reply=g),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])]),_:1},8,["modelValue","options"]))}};function Qo(){return window.scrollContainer}const Jo={class:"text-xl font-semibold text-ink-gray-9"},Wo={key:0},Yo={key:1},Xo={key:2},Ko=["onClick"],Zo={class:"text-lg font-semibold mb-1 text-ink-gray-7"},en={class:"flex items-center text-ink-gray-5"},tn={class:"text-sm ml-3"},sn={key:1},an={key:3,class:"flex flex-col items-center justify-center border-2 border-dashed mt-5 py-8 rounded-md"},on={class:""},nn={key:0,class:"font-medium mb-2"},rn={class:"text-ink-gray-5"},ln={__name:"Discussions",props:{title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0},emptyStateTitle:{type:String,default:""},emptyStateText:{type:String,default:"Start a discussion"},singleThread:{type:Boolean,default:!1},scrollToBottom:{type:Boolean,default:!1},type:{type:String,default:"multi"}},setup(c){console.log("Discussions.vue script setup executed");const e=A(!0),t=A(null),l=Ae("$user"),d=A(!1),u=A(!0),m=A(!1),k=It();k?(console.log("Socket connection initialized in Discussions.vue:",k),k.on("connect",()=>{console.log("Socket connected:",k.id),m.value=!0}),k.on("connect_error",y=>{console.error("Socket connection error:",y)}),k.on("disconnect",y=>{console.warn("Socket disconnected:",y),m.value=!1})):console.error("Socket connection not initialized in Discussions.vue.");const v=c;ue(m,y=>{y&&(console.log("Socket is connected, proceeding with onMounted logic."),_())});const _=()=>{console.log("onMounted logic executed"),console.log("Props:",v),l.data&&(v.type==="single"?(console.log("Single-topic mode detected"),p.reload(),console.log("Topic",t.value)):u.value=!1,q.reload()),k.on("new_discussion_topic",y=>{q.refresh()}),v.scrollToBottom&&setTimeout(()=>{w()},100)},w=()=>{let y=Qo();y.scrollTop=y.scrollHeight},p=W({url:"seminary.seminary.utils.ensure_single_topic",cache:!1,makeParams(){return{doctype:v.doctype,docname:v.docname,title:v.title}},onSuccess(y){console.log("Ensure single topic response:",y),y&&(t.value=y,console.log("Current topic set:",t.value),e.value=!1,u.value=!1),console.log("Changed loading to:",u.value)},onError(y){console.error("Error ensuring single topic:",y),u.value=!1}}),q=W({url:"seminary.seminary.utils.get_discussion_topics",cache:["topics",v.doctype,v.docname],makeParams(){return{doctype:v.doctype,docname:v.docname,single_thread:v.singleThread}}}),g=y=>{e.value=!1,t.value=y},ae=()=>{d.value=!0};return(y,B)=>{var P;return o(),i(de,null,[s("div",null,[!c.singleThread&&v.type==="multi"?(o(),z(a(G),{key:0,class:"float-right",onClick:B[0]||(B[0]=F=>ae())},{default:U(()=>[ie(r(y.__("New {0}").format(a(Pt)(c.title))),1)]),_:1})):D("",!0),s("div",Jo,r(y.__(c.title)),1)]),u.value&&v.type==="single"?(o(),i("div",Wo,[...B[6]||(B[6]=[s("div",{class:"text-center py-10"},[s("span",null,"Loading discussion...")],-1)])])):D("",!0),v.type==="single"&&!u.value?(o(),i("div",Yo,[B[7]||(B[7]=s("div",{class:"flex flex-col items-center justify-center"},null,-1)),N(xt,{modelValue:d.value,"onUpdate:modelValue":B[1]||(B[1]=F=>d.value=F),title:c.title,doctype:v.doctype,docname:v.docname},null,8,["modelValue","title","doctype","docname"]),t.value.value?(o(),z(kt,{key:0,topic:t.value.value,singleThread:!0,showTopics:e.value,"onUpdate:showTopics":B[2]||(B[2]=F=>e.value=F)},null,8,["topic","showTopics"])):D("",!0)])):D("",!0),(P=a(q).data)!=null&&P.length&&!c.singleThread?(o(),i("div",Xo,[e.value?(o(!0),i(de,{key:0},pe(a(q).data,(F,$)=>(o(),i("div",{key:$},[s("div",{onClick:V=>g(F),class:Oe(["flex items-center cursor-pointer py-5 w-full",{"border-b":$+1!=a(q).data.length}])},[N(zt,{user:F.user,size:"2xl",class:"mr-4"},null,8,["user"]),s("div",null,[s("div",Zo,r(F.title),1),s("div",en,[s("span",null,r(F.user.full_name),1),s("span",tn,r(a(st)(F.creation)),1)])])],10,Ko)]))),128)):(o(),i("div",sn,[N(kt,{topic:t.value,showTopics:e.value,"onUpdate:showTopics":B[3]||(B[3]=F=>e.value=F)},null,8,["topic","showTopics"])]))])):(o(),i("div",an,[N(a(Xt),{class:"w-7 h-7 text-ink-gray-4 stroke-1.5 mr-2"}),s("div",on,[c.emptyStateTitle?(o(),i("div",nn,r(y.__(c.emptyStateTitle)),1)):D("",!0),s("div",rn,r(y.__(c.emptyStateText)),1)])])),N(xt,{modelValue:d.value,"onUpdate:modelValue":B[4]||(B[4]=F=>d.value=F),title:y.__("New {0}").format(c.title),doctype:v.doctype,docname:v.docname,reloadTopics:a(q),"onUpdate:reloadTopics":B[5]||(B[5]=F=>pt(q)?q.value=F:null)},null,8,["modelValue","title","doctype","docname","reloadTopics"])],64)}}},un={key:0},dn={key:0,class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},cn={class:"leading-5"},mn={key:0,class:"leading-5"},pn={key:1,class:"leading-5"},fn={key:1,class:"space-y-4 border p-5 rounded-md"},hn={key:2,class:"flex flex-col space-x-1 my-4"},vn={class:"mb-2"},gn={class:"font-semibold"},_n={key:3},yn={class:"border text-center p-20 rounded-md"},bn={class:"font-semibold text-lg"},kn={key:2,class:"w-full max-w-4xl mx-auto py-5"},xn={key:3},wn={key:4},$n={class:"border text-center p-20 rounded-md"},Sn={class:"font-semibold text-lg text-ink-gray-9 mt-3 mb-3"},Cn={class:"absolute -top-3 -left-3 bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm"},Tn={class:"text-ink-gray-9 text-sm font-semibold text-right"},An={class:"text-ink-gray-9 text-left font-semibold mt-2 leading-5"},Dn=["innerHTML"],Fn={class:"mt-4"},Mn=["onUpdate:modelValue","onInput"],En={class:"text-center mt-4"},Nn={__name:"Exam",props:{examName:{type:String,required:!0}},setup(c){var L,Y;const e=Ae("$user"),t=A(0);let l=null;const d=A(0);A("");const u=A({});A([]);const m=A(!1),k=Ze();let v=!1;const _=(C=[])=>{const R=qe({},u.value),K={};C.forEach(ce=>{const he=R[ce.name];K[ce.name]=typeof he=="string"?he:""}),u.value=K},w=c;console.log("Exam Name (PROPS):",w.examName);const p=W({url:"frappe.client.get",makeParams(C){return{doctype:"Exam Activity",name:w.examName}},cache:["exam",w.examName],auto:!0,transform(C){return C?(C.duration=parseInt(C.duration)||0,C):(console.error("Exam data is null or undefined."),null)},onSuccess(C){C?(C.questions=C.questions||[],_(C.questions)):console.error("Failed to load exam data.")},onError(C){console.error("Error loading exam data:",C)}}),q=oe(()=>!!p.data),g=oe(()=>{var C;return((C=ne.data)==null?void 0:C.length)>0}),ae=W({url:"seminary.seminary.utils.get_instructors",makeParams(C){const R=k.currentRoute.value.params.courseName;return R?{course:R}:(console.error("Course name is undefined in route parameters."),{})},auto:!0});ue(()=>ae.data,C=>{var K,ce;if(!Array.isArray(C))return;const R=v;v=C.some(he=>{var h;return he.user===((h=e.data)==null?void 0:h.name)}),!R&&v&&((ce=(K=p.data)==null?void 0:K.questions)!=null&&ce.length)&&_(p.data.questions)});const y=()=>(ae.data&&ae.data.forEach(C=>{var R;C.user===((R=e.data)==null?void 0:R.name)&&(v=!0)}),v);let B=null;const P=()=>{if(p.data.duration){t.value=p.data.duration*60,B=Date.now();const C=B+t.value*1e3;l=setInterval(()=>{const R=Date.now(),K=Math.max(0,Math.floor((C-R)/1e3));t.value=K,d.value=p.data.duration*60-K,K<=0&&(clearInterval(l),ee())},1e3)}else B=Date.now(),l=setInterval(()=>{const C=Date.now();d.value=Math.floor((C-B)/1e3)},1e3)},F=C=>{const R=Math.floor(C/60).toString().padStart(2,"0"),K=(C%60).toString().padStart(2,"0");return`${R}:${K}`},$=oe(()=>t.value/(p.data.duration*60)*100);ue(u,C=>{},{deep:!0});const V=()=>{const C=Dt(u.value);return Object.entries(C).map(([R,K])=>({question:R,answer:K}))},O=(C,R)=>{u.value[C]=R},ne=W({url:"frappe.client.get_list",makeParams(C){var R;return{doctype:"Exam Submission",filters:{member:(R=e.data)==null?void 0:R.name,exam:w.examName},fields:["name","creation"],order_by:"creation desc"}},auto:!0,transform(C){C.forEach((R,K)=>{R.creation=st(R.creation),R.idx=K+1})}});ue(()=>ne.data,C=>{console.log("Attempts data updated:",C)});const ee=()=>se(this,null,function*(){var C,R;try{const K=V(),ce=p.data.duration?p.data.duration*60-(t.value||0):d.value||0;yield Ue("seminary.seminary.doctype.exam_submission.exam_submission.create_exam_submission",{exam:w.examName,course:k.currentRoute.value.params.courseName,member:(C=e.data)==null?void 0:C.name,answers:K,time_taken:ce}),ke.success(__("Your exam was submitted successfully.")),clearInterval(l)}catch(K){console.error("Error during exam submission:",K),ke.error(((R=err.messages)==null?void 0:R[0])||err)}}),re=()=>{var C;activeQuestion.value=1,localStorage.removeItem(p.data.title),P(),_(((C=p.data)==null?void 0:C.questions)||[])},X=()=>{var C;localStorage.removeItem(p.data.title),m.value=!0,P(),_(((C=p.data)==null?void 0:C.questions)||[])},ve=W({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:w.examName,member:(L=e.data)==null?void 0:L.name,status:"Graded"}},auto:!1,transform(C){return console.log("Fetched submission data:",C),C},onError(C){console.error("Error fetching submission:",C)}}),S=W({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:w.examName,member:(Y=e.data)==null?void 0:Y.name}},auto:!1,transform(C){return console.log("Fetched submission AnyStatus:",C.name),C},onError(C){console.error("Error fetching submission:",C)}});return Ee(()=>{ve.reload(),S.reload()}),mt(()=>{l&&clearInterval(l)}),(C,R)=>{var ce,he,h,T,I,M,H,_e,be,me,Se,we,b,f;const K=Kt("router-link");return q.value?(o(),i("div",un,[g.value?D("",!0):(o(),i("div",dn,[s("div",cn,r(`This exam consists of ${a(p).data.questions.length}`)+" "+r(a(p).data.questions.length===1?"question":"questions")+". ",1),(ce=a(p).data)!=null&&ce.duration?(o(),i("div",mn,r(`Please ensure that you complete all the questions in ${a(p).data.duration} minutes.`),1)):D("",!0),(he=a(p).data)!=null&&he.duration?(o(),i("div",pn,r("If you fail to do so, the exam will be automatically submitted when the timer ends."))):D("",!0)])),g.value&&((h=a(S))!=null&&h.data||(T=a(ne).data)!=null&&T[0])?(o(),i("div",fn,[(o(),z(ln,{title:"Exam Comments",doctype:"Exam Submission",docname:((M=(I=a(S))==null?void 0:I.data)==null?void 0:M.name)||((_e=(H=a(ne).data)==null?void 0:H[0])==null?void 0:_e.name),key:((me=(be=a(S))==null?void 0:be.data)==null?void 0:me.name)||((we=(Se=a(ne).data)==null?void 0:Se[0])==null?void 0:we.name),type:"single"},null,8,["docname"]))])):D("",!0),a(p).data.duration&&!g.value?(o(),i("div",hn,[s("div",vn,[R[0]||(R[0]=s("span",{class:""},r("Time")+": ",-1)),s("span",gn,r(F(t.value)),1)]),N(Lt,{progress:$.value},null,8,["progress"])])):D("",!0),!m.value&&!y()?(o(),i("div",_n,[s("div",yn,[s("div",bn,r(a(p).data.title),1),a(p).data.qbyquestion&&!g.value?(o(),z(a(G),{key:0,onClick:re,class:"mt-2"},{default:U(()=>[...R[1]||(R[1]=[s("span",null,r("Start"),-1)])]),_:1})):g.value?g.value&&((f=(b=a(ve))==null?void 0:b.data)!=null&&f.name)?(o(),i("div",kn,[N(zo,{submission:a(ve).data.name},null,8,["submission"])])):(o(),i("div",xn,r("You have already submitted this exam. As soon as it is graded, you will see the feedback here."))):(o(),z(a(G),{key:1,onClick:X,class:"mt-2"},{default:U(()=>[...R[2]||(R[2]=[s("span",null,r("Start Exam"),-1)])]),_:1}))])])):D("",!0),m.value||y()?(o(),i("div",wn,[s("div",$n,[s("div",Sn,r(a(p).data.title),1),y()?(o(),z(K,{key:0,to:{name:"ExamForm",params:{examID:a(p).data.name}},class:"flex items-center text-gray-400 mb-3 mr-4 hover:text-gray-600"},{default:U(()=>[N(a(Zt),{class:"w-5 h-5 mr-2"}),R[3]||(R[3]=s("span",{class:"tooltip","data-tooltip":"Edit this exam"},"Edit",-1))]),_:1},8,["to"])):D("",!0),(o(!0),i(de,null,pe(a(p).data.questions,(j,te)=>(o(),i("div",{key:j.name,class:"relative border rounded-md p-5 mb-4"},[s("div",Cn,r(te+1),1),s("div",Tn,r(j.points)+" "+r(j.points===1?"Point":"Points"),1),s("div",An,[s("div",{innerHTML:j.question_detail||"No question detail provided."},null,8,Dn)]),s("div",Fn,[u.value&&u.value[j.name]!==void 0?$e((o(),i("textarea",{key:0,"onUpdate:modelValue":le=>u.value[j.name]=le,rows:"7",class:"border rounded-md p-2 w-full resize-y",placeholder:"Type your answer here",onInput:le=>O(j.name,le.target.value)},null,40,Mn)),[[Ne,u.value[j.name]]]):D("",!0)])]))),128)),s("div",En,[N(a(G),{onClick:ee},{default:U(()=>[...R[4]||(R[4]=[s("span",null,r("Submit Your Exam"),-1)])]),_:1})])])])):D("",!0)])):D("",!0)}}},In={key:1,class:"border rounded-md text-center py-20"},Ln={__name:"ExamBlock",props:{exam:{type:String,required:!0}},setup(c){const e=Ae("$user"),t=()=>{window.location.href="/login"};return(l,d)=>a(e).data?(o(),z(Nn,{key:0,examName:c.exam},null,8,["examName"])):(o(),i("div",In,[s("div",null,r(l.__("Please login to access the exam.")),1),N(a(G),{onClick:d[0]||(d[0]=u=>t()),class:"mt-2"},{default:U(()=>[s("span",null,r(l.__("Login")),1)]),_:1})]))}};class zn{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(es,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Exam"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderExam(this.data.exam):this.renderExamModal(),this.wrapper}renderExam(e){if(this.readOnly){const t=fe(Ln,{exam:e});t.use(De),t.use(Me);const{userResource:l}=et();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Exam: ${e}
            </span>
        </div>`}renderExamModal(){if(this.readOnly)return;const e=fe(tt,{type:"exam",onAddition:t=>{this.data.exam=t,this.renderExam(t)}});e.use(De),e.use(Me),e.mount(this.wrapper)}save(e){return{exam:this.data.exam}}}const Pn={class:"border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},Rn={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},qn={key:0},Un={key:1},On={class:"text-lg text-ink-gray-7 font-medium mb-2"},Vn=["innerHTML"],Hn={key:1,class:"flex-1 border-l p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},Bn={key:0,class:"mb-4 mt-4"},jn={for:"groupFilter",class:"block text-sm font-medium text-gray-700"},Gn={value:"all"},Qn=["value"],Jn={class:"original-post mb-4"},Wn={class:"font-semibold"},Yn=["innerHTML"],Xn={class:"text-sm text-ink-gray-5 mt-1 mb-2"},Kn=["href"],Zn={class:"replies pl-4 border-l border-gray-300"},er={class:"font-semibold"},tr={class:"text-sm text-ink-gray-5 mt-1 mb-2"},sr=["innerHTML"],ar=["href"],or={class:"new-reply mt-4 space-y-2"},nr=["onUpdate:modelValue","placeholder"],rr={class:"flex items-center justify-between"},lr={class:"flex items-center space-x-3"},ir={key:1,class:"flex items-center space-x-2 text-ink-gray-7"},ur={class:"border rounded-md p-2"},dr={class:"flex flex-col leading-5"},cr={class:"text-sm"},mr={class:"text-xs text-ink-gray-5"},pr={key:2,class:"text-ink-gray-5 mt-5"},fr={key:3,class:"text-ink-gray-5 mt-5"},hr={key:0,class:"mt-8 space-y-4"},vr={class:"font-semibold mb-2 text-ink-gray-9"},gr={class:"text-sm text-ink-gray-5 mb-1"},_r={key:1,class:"text-md mb-4"},yr={class:"flex flex-col"},br={class:"p-5"},kr={class:"flex items-center justify-between mb-4"},xr={class:"flex items-center space-x-2"},wr={key:0,class:"text-md mb-4"},$r={class:"text-md text-ink-gray-5 mt-1 mb-2"},Sr={key:1},Cr={class:"flex text-ink-gray-7"},Tr={class:"border self-start rounded-md p-2 mr-2"},Ar=["href"],Dr={class:"text-sm leading-5"},Fr={class:"text-sm text-ink-gray-5 mt-1"},Mr={key:2,class:"text-md mb-4 ml-2"},Er={class:"text-sm text-ink-gray-5 font-medium mb-2 mt-4"},Nr={class:"font-semibold mb-1"},Ir=["href"],Lr={class:"replies pl-4 border-l border-gray-300"},zr={class:"font-semibold"},Pr={class:"text-sm text-ink-gray-5 mt-1 mb-2"},Rr=["innerHTML"],qr=["href"],Ur={class:"new-reply mt-4 space-y-2"},Or=["onUpdate:modelValue","placeholder"],Vr={class:"flex items-center justify-between"},Hr={class:"flex items-center space-x-3"},Br={key:1,class:"flex items-center space-x-2 text-ink-gray-7"},jr={class:"border rounded-md p-2"},Gr={class:"flex flex-col leading-5"},Qr={class:"text-sm"},Jr={class:"text-xs text-ink-gray-5"},Wr={key:3,class:"mt-8 p-3 bg-blue-200 rounded-md"},Yr={class:"text-sm text-ink-gray-5 font-medium mb-2"},Xr={class:"leading-5"},Kr=["innerHTML"],Zr={__name:"DiscussionActivity",props:{discussionID:{type:String,required:!0},submissionName:{type:String,default:"new"},canGradeSubmission:{type:Boolean,default:!1,required:!1}},setup(c){var ge;const e=typeof lt=="function"?lt:lt.default;e.extend(ts);const t=A(null),l=A(""),d=A(""),u=Ze(),m=Ae("$user"),k=u.currentRoute.value.name=="DiscussionActivitySubmission",v=A(!1),_=A({}),w=oe(()=>{var n;return((n=m.data)==null?void 0:n.is_student)||!1}),p=A([]),q=A("all"),g=A(""),ae=oe(()=>u.currentRoute.value.params.courseName),y=oe(()=>O.discussionID),B=oe(()=>{var n;return(n=m.data)==null?void 0:n.name}),P=(n,x)=>{_.value=Ge(qe({},_.value),{[n]:x})},F=oe(()=>{ae.value&&y.value&&B.value}),$=n=>{const ye=_.value,{[n]:x}=ye,Z=gt(ye,[vt(n)]);_.value=Z},V=n=>!!(n!=null&&n.new_reply&&n.new_reply.toString().trim().length),O=c;Ee(()=>{var n;window.addEventListener("keydown",ne),console.log("User: ",(n=m.data)==null?void 0:n.name),console.log("Discussion ID: ",O.discussionID),console.log("Course Name: ",u.currentRoute.value.params.courseName),K(),Y.reload().then(()=>{var x;console.log("Student data after reload:",g.value),console.log("Student group:",(x=g.value)==null?void 0:x.student_group)}),console.log("Saved Submission Data on Mount:",C.data),console.log("hasSavedSubmission:",R.value),xe(),ce.value});const ne=n=>{n.key==="s"&&(n.ctrlKey||n.metaKey)&&(H(),n.preventDefault())};mt(()=>{window.removeEventListener("keydown",ne)});const ee=W({url:"frappe.client.get",params:{doctype:"Discussion Activity",name:O.discussionID},auto:!0,onSuccess(n){O.submissionName!="new"&&M.reload()}});console.log("Submission Name: ",O.submissionName);const re=oe(()=>{var n;return(n=ee.data)==null?void 0:n.post_before}),X=n=>n&&n.includes(".")?e(n.split(".")[0]).fromNow():e(n).fromNow();function ve(){const n=new Date,x=Math.floor(n.getMilliseconds()*1e3);return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}.${String(x).padStart(6,"0")}`}const S=n=>{var Te,Ie,Le;if(!V(n))return;const x=_.value[n.name],Z=((Te=g.value)==null?void 0:Te.student)||null,ye=((Ie=g.value)==null?void 0:Ie.student_name)||((Le=m.data)==null?void 0:Le.full_name),Ce=ve();T.submit({name:n.name,reply:n.new_reply,reply_attach:x,student:Z,member_name:ye,parent:n.name,reply_dt:Ce,parentfield:"replies",parenttype:"Discussion Submission"},{onSuccess(){ke.success(__("Reply posted successfully")),n.new_reply="",x&&$(n.name),he()},onError(Be){var E;ke.error(((E=Be.messages)==null?void 0:E[0])||Be)}})},L=W({url:"seminary.seminary.api.get_discussion_submissions",makeParams(n){return{course_name:u.currentRoute.value.params.courseName,discussion_id:O.discussionID}},auto:!1,onSuccess(n){n==null||n.forEach(x=>{x&&typeof x.new_reply=="undefined"&&(x.new_reply="")}),console.log("All Discussions Data Fetched: ",n)}}),Y=W({url:"seminary.seminary.api.get_student_group",makeParams(n){var x;return{course_name:u.currentRoute.value.params.courseName,user:(x=m.data)==null?void 0:x.name}},auto:!1,onSuccess(n){g.value=n,console.log("Student fetched:",g.value)}}),C=W({url:"seminary.seminary.api.get_user_discussion_submission",makeParams(n){var x;return{course_name:u.currentRoute.value.params.courseName,discussion_id:O.discussionID,owner:(x=m.data)==null?void 0:x.name}},auto:!1,onSuccess(n){console.log("Saved submission fetched:",n)}}),R=oe(()=>Array.isArray(C.data)&&C.data.length>0);ue(F,n=>se(this,null,function*(){n&&(yield K())}));const K=()=>se(this,null,function*(){try{yield L.reload({course_name:ae.value,discussion_id:y.value}),yield C.reload({course_name:ae.value,discussion_id:y.value,owner:B.value})}catch(n){console.error("Error reloading discussion lists:",n)}}),ce=oe(()=>{var x;let n=Dt(L.data);if(console.log("Discussions before filtering: ",n),w.value)if((x=ee.data)!=null&&x.use_studentgroup){let Z=Q;return n.filter(ye=>ye.student_group===Z.value)}else return n;else return!w.value&&q.value!=="all"?n.filter(Z=>Z.student_group===q.value):n}),he=()=>{K()},h=W({url:"frappe.client.insert",makeParams(n){var Z,ye,Ce,Te,Ie,Le;return{doc:{doctype:"Discussion Submission",disc_activity:O.discussionID,disc_title:(Z=ee.data)==null?void 0:Z.discussion_name,member:(ye=m.data)==null?void 0:ye.name,coursesc:u.currentRoute.value.params.courseName,original_post:l.value,original_attachment:((Ce=t.value)==null?void 0:Ce.file_url)||null,student_name:((Te=g.value)==null?void 0:Te.student_name)||((Ie=m.data)==null?void 0:Ie.full_name),student:((Le=g.value)==null?void 0:Le.student)||null}}}}),T=W({url:"frappe.client.insert",makeParams(n){var Z,ye;const x=n.reply_attach;return{doc:{doctype:"Discussion Submission Replies",member:(Z=m.data)==null?void 0:Z.name,reply:n.reply,student:n.student,member_name:n.member_name||((ye=m.data)==null?void 0:ye.full_name),reply_dt:n.reply_dt,parent:n.name,parentfield:"replies",parenttype:"Discussion Submission",reply_attach:(x==null?void 0:x.file_url)||null}}},auto:!1}),I=W({url:"seminary.seminary.api.get_file_info",makeParams(n){return{file_url:n.image}},auto:!1,onSuccess(n){t.value=n}}),M=ct({doctype:"Discussion Submission",name:O.submissionName,onError(n){var x;ke.error(((x=n.messages)==null?void 0:x[0])||n)},auto:!1,cache:[(ge=m.data)==null?void 0:ge.name,O.discussionID]});ue(M,()=>{if(M.doc){M.doc.original_attachment&&I.reload({image:M.doc.original_attachment}),l.value=M.doc.original_post||"",console.log("Original Post: ",l.value),d.value=M.doc.comments||"";const n=!!t.value,x=!!l.value;M.isDirty||!n&&!x?v.value=!0:v.value=!1}}),ue(t,()=>{O.submissionName=="new"&&t.value&&(v.value=!0)}),ue(()=>{var n;return(n=M.doc)==null?void 0:n.grade},(n,x)=>{n!==x&&M.doc&&(M.doc.status="Graded",v.value=!0)});const H=()=>{var n,x,Z;if(O.submissionName!="new"){let ye=M.doc&&M.doc.owner!=((n=m.data)==null?void 0:n.name)?(x=m.data)==null?void 0:x.name:null;M.setValue.submit(Ge(qe({},M.doc),{original_attachment:(Z=t.value)==null?void 0:Z.file_url,evaluator:ye,comments:d.value,original_post:l.value}),{onSuccess(Ce){ke.success(__("Changed successfully")),v.value=!1,he()}})}else _e()},_e=()=>{h.submit({},{onSuccess(n){ke.success(__("Discussion submitted successfully")),u.currentRoute.value.name=="DiscussionSubmission"?u.push({name:"DiscussionSubmission",params:{discussionID:O.discussionID,submissionName:n.name}}):(me(),u.go()),M.name=n.name,v.value=!1,M.reload(),he()},onError(n){var x;ke.error(((x=n.messages)==null?void 0:x[0])||n)}})},be=n=>{v.value=!0,t.value=n},me=()=>{if(u.currentRoute.value.name=="Lesson"){let n=u.currentRoute.value.params.courseName,x=u.currentRoute.value.params.chapterNumber,Z=u.currentRoute.value.params.lessonNumber;console.log("Chapter Number: ",x),console.log("Lesson Number: ",Z),Ue("seminary.seminary.api.mark_lesson_progress",{course:n,chapter_number:x,lesson_number:Z})}},Se=()=>["image/*",".pdf",".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],we=n=>{var Ce,Te;const x=(Ce=n.name.split(".").pop())==null?void 0:Ce.toLowerCase(),Z=["jpg","jpeg","png","gif","pdf","doc","docx","xml"];if(!((Te=n.type)!=null&&Te.startsWith("image/"))&&(!x||!Z.includes(x)))return"Only images, PDF, or Word documents are allowed."},b=()=>{v.value=!0,t.value=null},f=oe(()=>{var n,x,Z;return(((n=m.data)==null?void 0:n.is_moderator)||((x=m.data)==null?void 0:x.is_evaluator)||((Z=m.data)==null?void 0:Z.is_instructor))&&O.submissionName!="new"&&u.currentRoute.value.name=="DiscussionActivitySubmission"}),j=oe(()=>{var n,x,Z;return!M.doc||((n=M.doc)==null?void 0:n.owner)==((x=m.data)==null?void 0:x.name)&&((Z=M.doc)==null?void 0:Z.status)=="Not Graded"}),te=oe(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),le=oe(()=>M.doc?M.doc.status=="Pass"||M.doc.status=="Graded"?"green":M.doc.status=="Not Graded"?"blue":"red":"orange"),xe=()=>{if(!u.currentRoute.value.params.courseName){console.warn("Cannot fetch student groups: Missing course name.");return}Ue("seminary.seminary.api.get_student_groups_simple",{course_name:u.currentRoute.value.params.courseName}).then(n=>{p.value=n||[],console.log("Student groups fetched:",p.value)}).catch(n=>{console.error("Error fetching student groups:",n)})},Q=oe(()=>{var n;return Y.loading?__("Loading..."):((n=g.value)==null?void 0:n.student_group)||__("No group assigned")});return ue(()=>Y.loading,n=>{n||console.log("Student data loaded on watch:",Y.data)}),ue(()=>q.value,n=>{console.log("Selected group changed to:",n),ce.value}),(n,x)=>{var Z,ye,Ce,Te,Ie,Le,Be;return a(ee).data?(o(),i("div",{key:0,class:Oe(["grid grid-cols-[65%,35%] h-full",{"border rounded-lg":!k}])},[s("div",Pn,[k?(o(),i("div",Rn,[c.submissionName==="new"?(o(),i("div",qn,r(n.__("Submission by"))+" "+r((Z=a(m).data)==null?void 0:Z.full_name),1)):(o(),i("div",Un,r(n.__("Submission by"))+" "+r((ye=a(M).doc)==null?void 0:ye.member_name),1))])):D("",!0),s("div",On,r(n.__("Discussion Prompt"))+": ",1),s("div",{innerHTML:a(ee).data.prompt,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,Vn),a(L).data&&(R.value||!R.value&&!re.value||!w.value)?(o(),i("div",Hn,[w.value?D("",!0):(o(),i("div",Bn,[s("label",jn,r(n.__("Filter by Group")),1),$e(s("select",{id:"groupFilter","onUpdate:modelValue":x[0]||(x[0]=E=>q.value=E),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[s("option",Gn,r(n.__("All Groups")),1),(o(!0),i(de,null,pe(p.value,E=>(o(),i("option",{key:E.student_group,value:E.student_group},r(E.student_group||"No group"),9,Qn))),128))],512),[[ss,q.value]])])),(o(!0),i(de,null,pe(ce.value,E=>(o(),i("div",{key:E.name,class:"mb-6 border-round border-gray-300 p-4 bg-surface-white shadow-sm"},[s("div",Jn,[s("div",Wn,r(E.student_name),1),s("div",{innerHTML:E.original_post,class:"text-sm"},null,8,Yn),s("div",Xn,r(X(E.creation)),1),E.original_attachment?(o(),i("a",{key:0,href:E.original_attachment,target:"_blank",class:"text-blue-500 underline"},r(n.__("View Attachment")),9,Kn)):D("",!0)]),s("div",Zn,[(o(!0),i(de,null,pe(E.replies,J=>(o(),i("div",{key:J.creation,class:"mb-2"},[s("div",er,r(J.member_name||J.owner),1),s("div",tr,r(X(J.reply_dt)),1),s("div",{innerHTML:J.reply,class:"text-sm"},null,8,sr),J.reply_attach?(o(),i("a",{key:0,href:J.reply_attach,target:"_blank",class:"text-blue-500 underline"},r(n.__("View Attachment")),9,ar)):D("",!0)]))),128))]),s("div",or,[$e(s("textarea",{"onUpdate:modelValue":J=>E.new_reply=J,placeholder:n.__("Write a reply..."),class:"prose-sm max-w-none border border-outline-gray-3 bg-surface-gray-2 rounded-md py-2 px-3 min-h-[6rem] w-full focus:outline-none"},null,8,nr),[[Ne,E.new_reply]]),s("div",rr,[s("div",lr,[_.value[E.name]?(o(),i("div",ir,[s("div",ur,[N(a(Xe),{class:"h-4 w-4"})]),s("div",dr,[s("span",cr,r(_.value[E.name].file_name),1),s("span",mr,r(a(Ke)(_.value[E.name].file_size)),1)]),N(a(G),{variant:"subtle",size:"sm",onClick:J=>$(E.name)},{default:U(()=>[ie(r(n.__("Remove")),1)]),_:1},8,["onClick"])])):(o(),z(a(We),{key:0,fileTypes:Se(),validateFile:we,onSuccess:J=>P(E.name,J)},{default:U(({uploading:J,progress:je,openFileSelector:at})=>[N(a(G),{onClick:at,loading:J,variant:"outline"},{default:U(()=>[ie(r(J?n.__("Uploading {0}%").format(je):n.__("Attach File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes","onSuccess"]))]),N(a(G),{variant:"solid",disabled:!V(E),onClick:J=>S(E)},{default:U(()=>[ie(r(n.__("Post Reply")),1)]),_:1},8,["disabled","onClick"])])])]))),128))])):!R.value&&re.value&&w.value?(o(),i("div",pr,r(n.__("You have to make your original post before seeing other posts.")),1)):(o(),i("div",fr,r(n.__("No discussions available yet."))+" "+r("All discussions",a(L).data)+" "+r("hasSavedSubmission",R.value),1))]),f.value?(o(),i("div",hr,[s("div",vr,r(n.__("Grading")),1),a(M).doc?(o(),z(a(Pe),{key:0,modelValue:a(M).doc.status,"onUpdate:modelValue":x[1]||(x[1]=E=>a(M).doc.status=E),label:n.__("Grading Status"),type:"select",options:te.value},null,8,["modelValue","label","options"])):D("",!0),a(M).doc?(o(),z(a(Pe),{key:1,modelValue:a(M).doc.grade,"onUpdate:modelValue":x[2]||(x[2]=E=>a(M).doc.grade=E),label:n.__("Score"),type:"number"},null,8,["modelValue","label"])):D("",!0),s("div",null,[s("div",gr,r(n.__("Comments")),1),$e(s("textarea",{"onUpdate:modelValue":x[3]||(x[3]=E=>d.value=E),onInput:x[4]||(x[4]=E=>v.value=!0),class:"prose-sm max-w-none border border-outline-gray-3 bg-surface-gray-2 rounded-md py-2 px-3 min-h-[7rem] w-full focus:outline-none"},null,544),[[Ne,d.value]])])])):D("",!0),R.value?(o(),i("div",Mr,[s("div",Er,r(n.__("Your submission has been saved:")),1),(o(!0),i(de,null,pe(a(C).data,E=>(o(),i("div",{key:E.name||E.creation},[s("div",Nr,r(X(E.creation)),1),s("div",null,r(E.original_post),1),E.original_attachment?(o(),i("a",{key:0,href:E.original_attachment,target:"_blank",class:"text-blue-500 underline"},r(n.__("View Attachment")),9,Ir)):D("",!0),s("div",Lr,[(o(!0),i(de,null,pe(E.replies,J=>(o(),i("div",{key:J.creation,class:"mb-2"},[s("div",zr,r(J.member_name||J.owner),1),s("div",Pr,r(X(J.reply_dt)),1),s("div",{innerHTML:J.reply,class:"text-sm"},null,8,Rr),J.reply_attach?(o(),i("a",{key:0,href:J.reply_attach,target:"_blank",class:"text-blue-500 underline"},r(n.__("View Attachment")),9,qr)):D("",!0)]))),128))]),s("div",Ur,[$e(s("textarea",{"onUpdate:modelValue":J=>E.new_reply=J,placeholder:n.__("Write a reply..."),class:"prose-sm max-w-none border border-outline-gray-3 bg-surface-gray-2 rounded-md py-2 px-3 min-h-[6rem] w-full focus:outline-none"},null,8,Or),[[Ne,E.new_reply]]),s("div",Vr,[s("div",Hr,[_.value[E.name]?(o(),i("div",Br,[s("div",jr,[N(a(Xe),{class:"h-4 w-4"})]),s("div",Gr,[s("span",Qr,r(_.value[E.name].file_name),1),s("span",Jr,r(a(Ke)(_.value[E.name].file_size)),1)]),N(a(G),{variant:"subtle",size:"sm",onClick:J=>$(E.name)},{default:U(()=>[ie(r(n.__("Remove")),1)]),_:1},8,["onClick"])])):(o(),z(a(We),{key:0,fileTypes:Se(),validateFile:we,onSuccess:J=>P(E.name,J)},{default:U(({uploading:J,progress:je,openFileSelector:at})=>[N(a(G),{onClick:at,loading:J,variant:"outline"},{default:U(()=>[ie(r(J?n.__("Uploading {0}%").format(je):n.__("Attach File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes","onSuccess"]))]),N(a(G),{variant:"solid",disabled:!V(E),onClick:J=>S(E)},{default:U(()=>[ie(r(n.__("Post Reply")),1)]),_:1},8,["disabled","onClick"])])])]))),128))])):(o(),i("div",_r,[s("div",yr,[s("div",br,[s("div",kr,[s("div",xr,[v.value?(o(),z(a(ze),{key:0,theme:"orange"},{default:U(()=>[ie(r(n.__("Not Saved")),1)]),_:1})):(Ce=a(M).doc)!=null&&Ce.status?(o(),z(a(ze),{key:1,theme:le.value,size:"lg"},{default:U(()=>{var E;return[ie(r((E=a(M).doc)==null?void 0:E.status),1)]}),_:1},8,["theme"])):D("",!0),N(a(G),{variant:"solid",onClick:x[5]||(x[5]=E=>H())},{default:U(()=>[ie(r(n.__("Save")),1)]),_:1})])]),R.value?D("",!0):(o(),i("div",wr,[ie(r(n.__("Write your main post here"))+" ",1),$e(s("textarea",{"onUpdate:modelValue":x[6]||(x[6]=E=>l.value=E),onInput:x[7]||(x[7]=E=>v.value=!0),class:"prose-sm max-w-none border border-outline-gray-3 bg-surface-gray-2 rounded-md py-2 px-3 min-h-[7rem] w-full focus:outline-none"},null,544),[[Ne,l.value]]),s("div",$r,r(n.__("You may also add an attachment")),1),t.value?(o(),i("div",Sr,[s("div",Cr,[s("div",Tr,[N(a(Xe),{class:"h-5 w-5 stroke-1.5"})]),s("a",{href:t.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[s("span",Dr,r(t.value.file_name),1),s("span",Fr,r(a(Ke)(t.value.file_size)),1)],8,Ar),j.value?(o(),z(a(Tt),{key:0,onClick:x[9]||(x[9]=E=>b()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):D("",!0)])])):(o(),z(a(We),{key:0,fileTypes:Se(),validateFile:we,onSuccess:x[8]||(x[8]=E=>be(E))},{default:U(({uploading:E,progress:J,openFileSelector:je})=>[N(a(G),{onClick:je,loading:E},{default:U(()=>[ie(r(E?n.__("Uploading {0}%").format(J):n.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))]))])])])),((Te=a(m).data)==null?void 0:Te.name)==((Ie=a(M).doc)==null?void 0:Ie.owner)&&((Le=a(M).doc)!=null&&Le.comments)?(o(),i("div",Wr,[s("div",Yr,r(n.__("Comments by"))+": "+r(((Be=a(M).doc)==null?void 0:Be.evaluator)||n.__("Evaluator")),1),s("div",Xr,[s("div",{innerHTML:a(M).doc.comments},null,8,Kr)])])):D("",!0)],2)):D("",!0)}}},el={key:1,class:"border rounded-md text-center py-20"},tl={__name:"DiscussionActivityBlock",props:{discussionID:{type:String,required:!0}},setup(c){const e=Ae("$user");return console.log("Discussion ID in Block: ",c.discussionID),(l,d)=>a(e).data?(o(),z(Zr,{key:0,discussionID:c.discussionID},null,8,["discussionID"])):(o(),i("div",el,[s("div",null,r(l.__("Please login to access the Discussion Activity.")),1),N(a(G),{onClick:d[0]||(d[0]=u=>l.redirectToLogin()),class:"mt-2"},{default:U(()=>[s("span",null,r(l.__("Login")),1)]),_:1})]))}};class sl{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(as,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Discussion Activity"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){this.wrapper=document.createElement("div");const e=this.data.discussion||this.data.discussionID;return e?this.renderDiscussionActivity(e):this.renderDiscussionActivityModal(),this.wrapper}renderDiscussionActivity(e){if(!e){console.warn("[DiscussionActivity] Missing discussion id; falling back to selector"),this.renderDiscussionActivityModal();return}if(this.readOnly){const t=fe(tl,{discussionID:e});t.use(De),t.use(Me);const{userResource:l}=et();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Discussion Activity: ${e}
            </span>
        </div>`}renderDiscussionActivityModal(){if(this.readOnly)return;const e=fe(tt,{type:"discussionactivity",onAddition:t=>{this.data.discussion=t,this.data.discussionID=t,this.renderDiscussionActivity(t)}});e.use(De),e.use(Me),e.mount(this.wrapper)}save(e){const t=this.data.discussion||this.data.discussionID;return t?{discussion:t,discussionID:t}:{}}}const al=["src"],ol={class:"flex items-center space-x-2 shadow rounded-lg p-1 w-1/2"},nl=["max"],rl={class:"text-xs text-ink-gray-9 font-medium"},ll={__name:"AudioBlock",props:{file:{type:String,required:!0}},setup(c){const e=A(!1),t=A(null);let l=A(!1),d=A(0),u=A(0);Ee(()=>{setTimeout(()=>{t.value=document.querySelector("audio"),t.value.onloadedmetadata=()=>{u.value=t.value.duration},t.value.ontimeupdate=()=>{d.value=t.value.currentTime}},0)});const m=()=>{t.value.paused?(t.value.play(),e.value=!0):(t.value.pause(),e.value=!1)},k=()=>{t.value.muted=!t.value.muted,l.value=t.value.muted},v=()=>{t.value.currentTime=d.value},_=()=>{e.value=!1},w=p=>{const q=Math.floor(p/60),g=Math.floor(p%60);return`${q}:${g<10?"0":""}${g}`};return ue(e,p=>{p?t.value.play():t.value.pause()}),(p,q)=>(o(),i("div",null,[s("audio",{onEnded:_,controlsList:"nodownload",class:"mb-4"},[s("source",{src:encodeURI(c.file),type:"audio/mp3"},null,8,al)],32),s("div",ol,[N(a(G),{variant:"ghost",onClick:m},{icon:U(()=>[e.value?(o(),z(a(Mt),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),z(a(Ft),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),$e(s("input",{type:"range",min:"0",max:a(u),step:"0.1","onUpdate:modelValue":q[0]||(q[0]=g=>pt(d)?d.value=g:d=g),onInput:v,class:"duration-slider w-full h-1"},null,40,nl),[[Ne,a(d)]]),s("span",rl,r(w(a(d)))+" / "+r(w(a(u))),1),N(a(G),{variant:"ghost",onClick:k},{icon:U(()=>[a(l)?(o(),z(a(Nt),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),z(a(Et),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1})])]))}},il=["src","type"],ul={class:"flex items-center space-x-2 bg-surface-gray-3 rounded-md p-0.5 absolute bottom-3 w-[98%] left-0 right-0 mx-auto invisible group-hover:visible"},dl=["max"],cl={class:"text-xs font-medium"},ml={__name:"VideoBlock",props:{file:{type:String,required:!0},type:{type:String,default:"video/mp4"}},setup(c){const e=A(null),t=A(null);let l=A(!1),d=A(0),u=A(0),m=A(!1);const k=c;Ee(()=>{setTimeout(()=>{e.value.onloadedmetadata=()=>{u.value=e.value.duration},e.value.ontimeupdate=()=>{d.value=e.value.currentTime}},0)});const v=oe(()=>{if(_){let F=k.file;return F.includes("watch?v=")&&(F=F.replace("watch?v=","embed/")),`${F}?autoplay=0&controls=0&disablekb=1&playsinline=1&cc_load_policy=1&cc_lang_pref=auto`}return k.file}),_=oe(()=>k.type=="video/youtube"),w=()=>{e.value.play(),l.value=!0},p=()=>{e.value.pause(),l.value=!1},q=()=>{l.value?p():w()},g=()=>{l.value=!1},ae=()=>{e.value.muted=!e.value.muted,m.value=e.value.muted},y=()=>{e.value.currentTime=d.value},B=F=>{const $=Math.floor(F/60),V=Math.floor(F%60);return`${$}:${V<10?"0":""}${V}`},P=()=>{document.fullscreenElement?document.exitFullscreen():t.value.requestFullscreen()};return(F,$)=>(o(),i("div",{ref_key:"videoContainer",ref:t,class:"video-block group relative"},[s("video",{onTimeupdate:$[0]||($[0]=(...V)=>F.updateTime&&F.updateTime(...V)),onEnded:g,onClick:q,oncontextmenu:"return false",class:"rounded-lg border border-gray-100 group cursor-pointer",ref_key:"videoRef",ref:e},[s("source",{src:v.value,type:c.type},null,8,il)],544),s("div",ul,[N(a(G),{variant:"ghost"},{icon:U(()=>[a(l)?(o(),z(a(Mt),{key:1,onClick:p,class:"w-4 h-4 text-ink-gray-9"})):(o(),z(a(Ft),{key:0,onClick:w,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),N(a(G),{variant:"ghost",onClick:ae},{icon:U(()=>[a(m)?(o(),z(a(Nt),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),z(a(Et),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),$e(s("input",{type:"range",min:"0",max:a(u),step:"0.1","onUpdate:modelValue":$[1]||($[1]=V=>pt(d)?d.value=V:d=V),onInput:y,class:"duration-slider w-full h-1"},null,40,dl),[[Ne,a(d)]]),s("span",cl,r(B(a(d)))+" / "+r(B(a(u))),1),N(a(G),{variant:"ghost",onClick:P},{icon:U(()=>[N(a(os),{class:"w-4 h-4 text-ink-gray-9"})]),_:1})])],512))}},pl=St(ml,[["__scopeId","data-v-edd7c5f4"]]),fl={__name:"UploadPlugin",props:{onFileUploaded:{type:Function,required:!0}},emits:["fileUploaded"],setup(c,{emit:e}){const t=A(null),l=c;Ee(()=>se(this,null,function*(){yield Ct();const m=t.value.$el.querySelector('input[type="file"]');m&&m.click()}));const d=m=>{l.onFileUploaded({file_url:m.file_url,file_type:m.file_type})},u=m=>{let k=m.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","mp4","mov","mp3","pdf"].includes(k))return"Only image and video files are allowed."};return(m,k)=>(o(),z(a(We),{fileTypes:["image/*","video/*","audio/*",".pdf"],validateFile:u,onSuccess:k[0]||(k[0]=v=>d(v)),ref_key:"fileUploader",ref:t,class:"hide"},null,512))}};class hl{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(ns,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Upload",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.file_url?this.renderFile(this.data):this.renderFileUploader(),this.wrapper}renderFile(e){if(this.isVideo(e.file_type)){fe(pl,{file:e.file_url}).mount(this.wrapper);return}else if(this.isAudio(e.file_type)){fe(ll,{file:e.file_url}).mount(this.wrapper);return}else if(e.file_type=="PDF"){this.wrapper.innerHTML=`<iframe src="https://docs.google.com/viewer?url=${window.location.origin}${encodeURI(e.file_url)}&embedded=true" width='100%' height='700px' class="mb-4" type="application/pdf"></iframe>`;return}else{this.wrapper.innerHTML=`<img class="mb-4" src=${encodeURI(e.file_url)} width='100%'>`;return}}renderFileUploader(){const e=fe(fl,{onFileUploaded:t=>{this.data.file_url=t.file_url,this.data.file_type=t.file_type,this.renderFile(t)}});e.use(De),e.mount(this.wrapper)}validate(e){return!(!e.file_url||!e.file_type)}save(e){return{file_url:this.data.file_url,file_type:this.data.file_type}}isVideo(e){return["mov","mp4","avi","mkv","webm"].includes(e.toLowerCase())}isAudio(e){return["mp3","wav","ogg"].includes(e.toLowerCase())}}class vl{constructor({data:e,api:t,readOnly:l,config:d}){this.api=t,this.data=e||{},this.config=d||{},this.text=e.text||"",this.readOnly=l,this.placeholder=__("Type '/' for commands or select text to format")}static get isReadOnlySupported(){return!0}static get conversionConfig(){return{export:"text",import:"text"}}static get toolbox(){const e=fe({render:()=>Re(rs,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"",icon:t.innerHTML}}onPaste(e){const t={text:e.detail.data.innerHTML};this.data=t,window.requestAnimationFrame(()=>{this.wrapper&&(this.wrapper.innerHTML=this.data.text||"")})}static get pasteConfig(){return{tags:["P"]}}render(){return this.wrapper=document.createElement("div"),this.wrapper.classList.add("cdx-block","ce-paragraph"),this.wrapper.innerHTML=this.text,this.readOnly||(this.wrapper.contentEditable=!0,this.wrapper.innerHTML=this.text,this.wrapper.addEventListener("input",e=>{let t=e.target.textContent;e.keyCode===32&&t.startsWith("#")?this.convertToHeader(e,t):e.keyCode==189?this.convertBlock("list",{style:"unordered"}):/^[a-zA-Z]/.test(e.key)?this.convertBlock("paragraph",{text:t}):(e.keyCode===13||e.keyCode===190)&&this.parseContent(e)})),this.wrapper}_togglePlaceholder(){document.querySelectorAll(".cdx-block.ce-paragraph[data-placeholder]").forEach(t=>{t!==this.wrapper&&delete t.dataset.placeholder}),this.wrapper.innerHTML.trim()===""?this.wrapper.dataset.placeholder=this.placeholder:delete this.wrapper.dataset.placeholder}convertToHeader(e,t){if(e.preventDefault(),["#","##","###","####","#####","######"].includes(t)){let l=t.length;e.target.textContent="",this.convertBlock("header",{level:l})}}parseContent(e){e.preventDefault();let t=this.wrapper.textContent;if(e.keyCode===190&&(t=t+"."),t&&this.hasImage(t))this.wrapper.textContent="",this.convertBlock("image");else if(t&&this.hasLink(t)){const{text:l,url:d}=this.extractLink(t),u=`<a href="${d}" target="_blank">${l}</a>`;this.convertBlock("paragraph",{text:t.replace(/\[.+?\]\(.+?\)/,u)})}else t&&t.startsWith("- ")?this.convertBlock("list",{style:"unordered",items:[{content:t.replace("- ","")}]}):t&&t.startsWith("1.")?this.convertBlock("list",{style:"ordered",items:[{content:t.replace("1.","")}]}):t&&this.canBeEmbed(t)?(this.wrapper.textContent="",this.convertBlock("embed",{source:t})):this.convertBlock("paragraph",{text:t})}convertBlock(e,t,l=null){return se(this,null,function*(){const d=this.api.blocks.getCurrentBlockIndex(),u=this.api.blocks.getBlockByIndex(d);yield this.api.blocks.convert(u.id,e,t),this.api.caret.focus(!0)})}save(e){return{text:e.innerHTML}}hasImage(e){return/!\[.+?\]\(.+?\)/.test(e)}extractImage(e){const t=e.match(/!\[(.+?)\]\((.+?)\)/);return t?{alt:t[1],url:t[2]}:{alt:"",url:""}}hasLink(e){return/\[.+?\]\(.+?\)/.test(e)}extractLink(e){const t=e.match(/\[(.+?)\]\((.+?)\)/);return t?{text:t[1],url:t[2]}:{text:"",url:""}}canBeEmbed(e){return/^https?:\/\/.+/.test(e.trim())}}const gl=["light","dark"],_l={none:"Auto-detect",apache:"Apache",bash:"Bash",cs:"C#",cpp:"C++",css:"CSS",coffeescript:"CoffeeScript",diff:"Diff",go:"Go",html:"HTML, XML",http:"HTTP",json:"JSON",java:"Java",javascript:"JavaScript",kotlin:"Kotlin",less:"Less",lua:"Lua",makefile:"Makefile",markdown:"Markdown",nginx:"Nginx",objectivec:"Objective-C",php:"PHP",perl:"Perl",properties:"Properties",python:"Python",ruby:"Ruby",rust:"Rust",scss:"SCSS",sql:"SQL",shell:"Shell Session",swift:"Swift",toml:"TOML, also INI",typescript:"TypeScript",yaml:"YAML",plaintext:"Plaintext"};class yl{constructor({data:e,api:t,config:l,readOnly:d}){Fe(this,"api");Fe(this,"config");Fe(this,"readOnly");Fe(this,"data");Fe(this,"highlightScriptID");Fe(this,"highlightCSSID");Fe(this,"codeArea");Fe(this,"selectInput");Fe(this,"selectDropIcon");this.api=t,this.readOnly=d,this.config={themeName:l.themeName&&typeof l.themeName=="string"?l.themeName:"",themeURL:l.themeURL&&typeof l.themeURL=="string"?l.themeURL:"",useDefaultTheme:l.useDefaultTheme&&typeof l.useDefaultTheme=="string"&&gl.includes(l.useDefaultTheme.toLowerCase())?l.useDefaultTheme:"dark"},this.data={code:e.code&&typeof e.code=="string"?e.code:"",language:e.language&&typeof e.language=="string"?e.language:"Auto-detect",theme:e.theme&&typeof e.theme=="string"?e.theme:this._getThemeURLFromConfig()},this.highlightScriptID="highlightJSScriptElement",this.highlightCSSID="highlightJSCSSElement",this.codeArea=document.createElement("div"),this.selectInput=document.createElement("input"),this.selectDropIcon=document.createElement("i"),this._injectHighlightJSCSSElement(),this.api.listeners.on(window,"click",this._closeAllLanguageSelects,!0)}static get isReadOnlySupported(){return!0}static get sanitize(){return{code:!0,language:!1,theme:!1}}static get toolbox(){const e=fe({render:()=>Re(ls,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"CodeBox",icon:t.innerHTML}}static get displayInToolbox(){return!0}static get enableLineBreaks(){return!0}render(){const e=document.createElement("pre"),t=this._createLanguageSelectElement();return e.setAttribute("class","codeBoxHolder"),this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),this.codeArea.setAttribute("contenteditable","true"),this.codeArea.innerHTML=this.data.code,this.api.listeners.on(this.codeArea,"blur",l=>this._highlightCodeArea(l),!1),this.api.listeners.on(this.codeArea,"paste",l=>this._handleCodeAreaPaste(l),!1),e.appendChild(this.codeArea),!this.readOnly&&e.appendChild(t),e}save(e){return Object.assign(this.data,{code:this.codeArea.innerHTML,theme:this._getThemeURLFromConfig()})}validate(e){return!!e.code.trim()}destroy(){this.api.listeners.off(window,"click",this._closeAllLanguageSelects,!0),this.api.listeners.off(this.codeArea,"blur",e=>this._highlightCodeArea(e),!1),this.api.listeners.off(this.codeArea,"paste",e=>this._handleCodeAreaPaste(e),!1),this.api.listeners.off(this.selectInput,"click",e=>this._handleSelectInputClick(e),!1)}_createLanguageSelectElement(){const e=document.createElement("div"),t=document.createElement("div"),l=Object.entries(_l);return e.setAttribute("class","codeBoxSelectDiv"),this.selectDropIcon.setAttribute("class",`codeBoxSelectDropIcon ${this.config.useDefaultTheme}`),this.selectDropIcon.innerHTML="&#8595;",this.selectInput.setAttribute("class",`codeBoxSelectInput ${this.config.useDefaultTheme}`),this.selectInput.setAttribute("type","text"),this.selectInput.setAttribute("readonly","true"),this.selectInput.value=this.data.language,this.api.listeners.on(this.selectInput,"click",d=>this._handleSelectInputClick(d),!1),t.setAttribute("class","codeBoxSelectPreview"),l.forEach(d=>{const u=document.createElement("p");u.setAttribute("class",`codeBoxSelectItem ${this.config.useDefaultTheme}`),u.setAttribute("data-key",d[0]),u.textContent=d[1],this.api.listeners.on(u,"click",m=>this._handleSelectItemClick(m,d),!1),t.appendChild(u)}),e.appendChild(this.selectDropIcon),e.appendChild(this.selectInput),e.appendChild(t),e}_highlightCodeArea(e){yt.highlightBlock(this.codeArea)}_handleCodeAreaPaste(e){e.stopPropagation()}_handleSelectInputClick(e){e.target.nextSibling.classList.toggle("codeBoxShow")}_handleSelectItemClick(e,t){e.target.parentNode.parentNode.querySelector(".codeBoxSelectInput").value=t[1],e.target.parentNode.classList.remove("codeBoxShow"),this.codeArea.removeAttribute("class"),this.data.language=t[0],this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),yt.highlightElement(this.codeArea)}_closeAllLanguageSelects(){const e=document.querySelectorAll(".codeBoxSelectPreview");for(let t=0,l=e.length;t<l;t++)e[t].classList.remove("codeBoxShow")}_injectHighlightJSCSSElement(){const e=document.querySelector(`#${this.highlightCSSID}`);let t=this._getThemeURLFromConfig();if(e)e.setAttribute("href",t);else{const l=document.createElement("link"),d=document.querySelector("head");l.setAttribute("rel","stylesheet"),l.setAttribute("href",t),l.setAttribute("id",this.highlightCSSID),d&&d.appendChild(l)}}_getThemeURLFromConfig(){let e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-${this.config.useDefaultTheme}.min.css`;return this.config.themeName&&(e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/${this.config.themeName}.min.css`),this.config.themeURL&&(e=this.config.themeURL),e}}const bl={class:"Folder"},kl={class:"ml-4"},xl={key:0,class:"mt-4 mb-4"},wl={key:1},$l={key:2,class:"block mt-6 space-y-6"},Sl={class:"text-sm font-medium text-ink-gray-9"},Cl={class:"mt-1 flex flex-wrap items-center gap-1 text-sm text-ink-gray-6"},Tl=["onClick"],Al={key:0},Dl={class:"flex flex-wrap items-center gap-2"},Fl=["placeholder"],Ml={class:"mb-2 text-sm font-semibold text-ink-gray-9"},El={key:0,class:"text-sm text-ink-gray-5"},Nl={key:1,class:"space-y-2"},Il=["onClick"],Ll={class:"mb-2 text-sm font-semibold text-ink-gray-9"},zl={key:0,class:"text-sm text-ink-gray-5"},Pl={key:1,class:"space-y-2"},Rl=["href"],ql={class:"font-medium"},Ul={class:"mt-1 text-ink-gray-6"},Ol={__name:"FolderPlugin",props:{onAddition:{type:Function,required:!1},initialFolder:{type:String,default:null}},setup(c){const e=is(),t=A("select"),l=A(null),d=A(""),u=A(""),m=A([]),k=A([]),v=A(null),_=A(null),w=A(""),p=A([]),q=A([]),g=A(!1),ae=A(""),y=A(null),B=()=>{var h,T;return typeof window=="undefined"?null:window.csrf_token||((h=window.frappe)==null?void 0:h.csrf_token)||((T=document.querySelector('meta[name="csrf-token"]'))==null?void 0:T.getAttribute("content"))||null},P=()=>se(this,null,function*(){const h=e.params.courseName;if(console.log("Course Name: ",h),h){const I=yield W({url:"frappe.client.get_value",makeParams(M){return{doctype:"Course Schedule",fieldname:"course",filters:{name:h}}}}).fetch();v.value=I.course,console.log("Fetched Course: ",v.value)}else return console.error("Course name not found in route params"),null}),F=c,$=()=>{if(!d.value)return;const h=d.value;typeof F.onAddition=="function"&&F.onAddition(h)},V=(I,...M)=>se(this,[I,...M],function*(h,{refreshFolders:T=!0}={}){const H=h==null?void 0:h.trim();if(!H)return;(T||!k.value.length)&&(yield O());const _e=k.value.find(be=>be.foldername===H||be.name===H);if(_e){l.value!==_e.name&&(l.value=_e.name);return}d.value=H,w.value=H,p.value=[{id:null,label:H,folderName:H}],yield ee({folderLabel:H}),p.value=[{id:_.value,label:w.value||H,folderName:d.value||H}]}),O=()=>se(this,null,function*(){if(v.value||(yield P()),!v.value)return[];const T=yield W({url:"frappe.client.get_list",makeParams(){return{doctype:"Course Folder",filters:{course:v.value},fields:["name","foldername","file_reference","parent_folder"]}}}).fetch();return k.value=T,k.value}),ne=()=>se(this,null,function*(){if(!u.value){alert("Folder name is required");return}if(v.value||(yield P()),!v.value){alert("Please select a course before creating a folder.");return}try{const T=yield new ut({data:{},readOnly:!1}).createCourseFolder(v.value,u.value);k.value.push({name:T.name,foldername:T.foldername,file_reference:T.file_reference,parent_folder:T.parent_folder}),d.value=T.foldername,_.value=T.file_reference,w.value=T.foldername,l.value=T.name,p.value=[{id:_.value,label:w.value,folderName:T.foldername}],t.value="select",u.value="",yield ee({folderId:_.value,folderLabel:w.value})}catch(h){console.error("Error creating folder:",h),alert(h.message||"Failed to create folder.")}}),ee=(...I)=>se(this,[...I],function*({folderId:h,folderLabel:T}={}){var _e;const M=h!=null?h:_.value,H=(_e=T!=null?T:w.value)!=null?_e:d.value;if(!M&&!H){console.warn("No folder selected for fetching files.");return}try{const me=yield W({url:"seminary.api.folder_upload.get_files_in_folder",params:{folder_id:M,foldername:H},auto:!0}).fetch(),Se=(me==null?void 0:me.entries)||[];q.value=Se.filter(we=>we.is_folder),m.value=Se.filter(we=>!we.is_folder),_.value=(me==null?void 0:me.folder_id)||M,w.value=(me==null?void 0:me.folder_name)||H,d.value=w.value}catch(be){console.error("Error fetching files:",be),q.value=[],m.value=[]}}),re=(h,T=null)=>se(this,null,function*(){var M;const I=T||((M=h==null?void 0:h.target)==null?void 0:M.files);if(!(!I||!I.length)){if(!_.value&&!w.value){alert("Please select a folder first.");return}try{const H=new FormData;for(const me of I)H.append("files",me);_.value&&H.append("folder_id",_.value),w.value&&H.append("foldername",w.value);const _e=B();if(!_e){alert("Session expired. Refresh the page and try again.");return}const be=yield fetch("/api/method/seminary.api.folder_upload.upload_folder",{method:"POST",body:H,headers:{"X-Frappe-CSRF-Token":_e},credentials:"include"});if(!be.ok){const me=yield be.json().catch(()=>({}));console.error("Error uploading files:",me),alert(`Error: ${me.message||"Failed to upload files."}`);return}console.log("Files uploaded successfully."),h!=null&&h.target&&(h.target.value=""),yield ee()}catch(H){console.error("Error uploading files:",H),alert("An error occurred while uploading files.")}finally{g.value=!1}}}),X=h=>se(this,null,function*(){const T=B();if(!T){alert("Session expired. Refresh the page and try again.");return}yield fetch("/api/method/seminary.api.folder_upload.delete_file",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":T},body:JSON.stringify({file_url:h}),credentials:"include"}).then(I=>I.json()),yield ee()}),ve=h=>{h.preventDefault(),h.stopPropagation(),!(!_.value&&!w.value)&&(g.value=!0)},S=h=>{!_.value&&!w.value||(h.preventDefault(),h.stopPropagation(),h.dataTransfer.dropEffect="copy",g.value=!0)},L=h=>{h.preventDefault(),h.stopPropagation(),g.value=!1},Y=h=>se(this,null,function*(){var I;if(h.preventDefault(),h.stopPropagation(),!_.value&&!w.value){alert("Please select a folder before uploading.");return}const T=(I=h.dataTransfer)==null?void 0:I.files;T!=null&&T.length&&(yield re(null,T)),g.value=!1}),C=()=>{var h;if(!_.value&&!w.value){alert("Please select a folder first.");return}(h=y.value)==null||h.click()},R=h=>se(this,null,function*(){h!=null&&h.name&&(p.value=[...p.value,{id:h.name,label:h.file_name,folderName:h.file_name}],_.value=h.name,w.value=h.file_name,yield ee({folderId:h.name,folderLabel:h.file_name}))}),K=h=>se(this,null,function*(){if(h<0||h>=p.value.length)return;const T=p.value[h];p.value=p.value.slice(0,h+1),_.value=T.id,w.value=T.label,d.value=T.folderName||T.label,yield ee({folderId:T.id,folderLabel:T.folderName||T.label})}),ce=()=>se(this,null,function*(){if(!ae.value){alert("Sub-folder name is required.");return}if(!_.value&&!w.value){alert("Please select a folder first.");return}try{yield new ut({data:{},readOnly:!1}).createSubfolder({parentFolderId:_.value,parentFolderName:w.value,subfolderName:ae.value}),ae.value="",yield ee()}catch(h){console.error("Error creating sub-folder:",h),alert(h.message||"Failed to create sub-folder.")}});ue(l,h=>se(this,null,function*(){if(h)try{const I=yield W({url:"frappe.client.get_value",makeParams(){return{doctype:"Course Folder",fieldname:["foldername","file_reference","parent_folder"],filters:{name:h}}}}).fetch();d.value=(I==null?void 0:I.foldername)||"",_.value=(I==null?void 0:I.file_reference)||null,w.value=(I==null?void 0:I.foldername)||"",p.value=[{id:_.value,label:w.value,folderName:d.value}],$(),yield ee({folderId:_.value,folderLabel:w.value})}catch(T){console.error("Error fetching foldername:",T)}else d.value="",_.value=null,w.value="",p.value=[],q.value=[],m.value=[]}));let he=!1;return Ee(()=>se(this,null,function*(){he=!0,yield P(),yield O(),F.initialFolder&&(yield V(F.initialFolder,{refreshFolders:!1}))})),ue(()=>F.initialFolder,(h,T)=>se(this,null,function*(){if(!he)return;const I=h==null?void 0:h.trim(),M=T==null?void 0:T.trim();!I||I===M||(yield V(I))})),(h,T)=>(o(),i("div",bl,[T[8]||(T[8]=s("h3",null,"Manage Course Folders",-1)),s("div",null,[s("label",null,[$e(s("input",{type:"radio","onUpdate:modelValue":T[0]||(T[0]=I=>t.value=I),value:"select"},null,512),[[bt,t.value]]),T[6]||(T[6]=ie(" Select Existing Folder ",-1))]),s("label",kl,[$e(s("input",{type:"radio","onUpdate:modelValue":T[1]||(T[1]=I=>t.value=I),value:"create"},null,512),[[bt,t.value]]),T[7]||(T[7]=ie(" Create New Folder ",-1))])]),t.value==="select"?(o(),i("div",xl,[N(Ve,{modelValue:l.value,"onUpdate:modelValue":T[2]||(T[2]=I=>l.value=I),doctype:"Course Folder",options:"foldername",label:h.__("Select a folder")},null,8,["modelValue","label"])])):D("",!0),t.value==="create"?(o(),i("div",wl,[$e(s("input",{type:"text","onUpdate:modelValue":T[3]||(T[3]=I=>u.value=I),placeholder:"Enter folder name"},null,512),[[Ne,u.value]]),N(Ve,{modelValue:v.value,"onUpdate:modelValue":T[4]||(T[4]=I=>v.value=I),doctype:"Course",label:h.__("Select a course")},null,8,["modelValue","label"]),s("button",{onClick:ne},"Create Folder")])):D("",!0),l.value?(o(),i("div",$l,[s("div",null,[s("div",Sl,r(h.__("Current Folder")),1),s("div",Cl,[(o(!0),i(de,null,pe(p.value,(I,M)=>(o(),i(de,{key:I.id||`${I.label}-${M}`},[s("button",{type:"button",class:"rounded px-1.5 py-0.5 text-ink-gray-7 transition hover:bg-ink-gray-2 hover:text-ink-gray-9",onClick:H=>K(M)},r(I.label),9,Tl),M<p.value.length-1?(o(),i("span",Al,"/")):D("",!0)],64))),128))])]),s("div",Dl,[$e(s("input",{type:"text","onUpdate:modelValue":T[5]||(T[5]=I=>ae.value=I),placeholder:h.__("New sub-folder name"),class:"flex-1 rounded border border-outline-gray-3 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"},null,8,Fl),[[Ne,ae.value]]),N(a(G),{size:"sm",onClick:ce},{default:U(()=>[ie(r(h.__("Create Sub-folder")),1)]),_:1})]),s("div",null,[s("h5",Ml,r(h.__("Sub-folders")),1),q.value.length?(o(),i("ul",Nl,[(o(!0),i(de,null,pe(q.value,I=>(o(),i("li",{key:I.name,class:"flex items-center justify-between rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("button",{type:"button",class:"flex-1 text-left text-sm font-medium text-blue-600 hover:underline",onClick:M=>R(I)},r(I.file_name),9,Il)]))),128))])):(o(),i("div",El,r(h.__("No sub-folders yet.")),1))]),s("div",null,[s("h5",Ll,r(h.__("Files")),1),m.value.length?(o(),i("ul",Pl,[(o(!0),i(de,null,pe(m.value,I=>(o(),i("li",{key:I.file_url||I.name,class:"flex items-center gap-3 rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("a",{href:I.file_url,download:"",class:"flex-1 truncate text-sm text-blue-600 hover:underline"},r(I.file_name),9,Rl),N(a(dt),{text:h.__("Delete File"),placement:"bottom"},{default:U(()=>[N(a(us),{onClick:Qe(M=>X(I.file_url),["prevent"]),class:"h-4 w-4 cursor-pointer text-red-500"},null,8,["onClick"])]),_:2},1032,["text"])]))),128))])):(o(),i("div",zl,r(h.__("No files found in this folder.")),1))]),s("div",{class:Oe(["rounded-md border-2 border-dashed border-outline-gray-3 p-6 text-center text-sm transition-colors duration-200 hover:border-outline-gray-4",{"bg-blue-50 border-blue-500 text-blue-700":g.value}]),onDragenter:Qe(ve,["prevent","stop"]),onDragover:Qe(S,["prevent","stop"]),onDragleave:Qe(L,["prevent","stop"]),onDrop:Qe(Y,["prevent","stop"]),onClick:C},[s("p",ql,r(h.__("Drop files here or click to upload")),1),s("p",Ul,r(h.__("Files will be added to"))+" "+r(w.value),1),s("input",{ref_key:"fileInputRef",ref:y,type:"file",class:"hidden",multiple:"",onChange:re},null,544)],34)])):D("",!0)]))}},Vl=St(Ol,[["__scopeId","data-v-b4e3a9b2"]]),Hl={class:"flex flex-col gap-4 rounded-lg border-2 border-gray-200 p-4 mb-4"},Bl={class:"flex flex-col gap-1"},jl={class:"text-lg font-semibold text-ink-gray-9"},Gl={key:0,class:"text-sm text-ink-gray-6 flex flex-wrap items-center gap-1"},Ql=["onClick"],Jl={key:0},Wl={key:0,class:"rounded border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700"},Yl={key:1,class:"text-sm text-ink-gray-6"},Xl={class:"space-y-2"},Kl={class:"text-sm font-semibold text-ink-gray-9"},Zl={key:0,class:"text-sm text-ink-gray-5"},ei={key:1,class:"space-y-2"},ti=["onClick"],si={class:"text-xs text-ink-gray-5"},ai={class:"space-y-2"},oi={class:"text-sm font-semibold text-ink-gray-9"},ni={key:0,class:"text-sm text-ink-gray-5"},ri={key:1,class:"space-y-2"},li=["href"],ii={class:"text-xs text-ink-gray-5"},ui={__name:"FolderBlock",props:{folder:{type:[Object,String],required:!0}},setup(c){const e=c,t=oe(()=>typeof e.folder=="string"?e.folder:e.folder&&typeof e.folder=="object"&&(e.folder.folder||e.folder.foldername)||""),l=A(!1),d=A(""),u=A([]),m=A([]),k=A(null),v=A(""),_=A([]);let w=!1;const p=P=>{if(!P&&P!==0)return"";const F=Number(P);return Number.isNaN(F)?"":F>=1048576?`${(F/1048576).toFixed(2)} MB`:F>=1024?`${(F/1024).toFixed(2)} KB`:`${F} B`},q=({folderId:P=null,folderLabel:F=null})=>{const $={};P&&($.folder_id=P);const V=F!=null?F:t.value;return!P&&V&&($.foldername=V),$},g=(...$)=>se(this,[...$],function*({folderId:P=null,folderLabel:F=null}={}){const V=q({folderId:P,folderLabel:F});if(!V.folder_id&&!V.foldername)return null;l.value=!0,d.value="";try{const ne=yield W({url:"seminary.api.folder_upload.get_files_in_folder",params:V,auto:!0}).fetch(),ee=(ne==null?void 0:ne.entries)||[];return m.value=ee.filter(re=>re.is_folder),u.value=ee.filter(re=>!re.is_folder),k.value=(ne==null?void 0:ne.folder_id)||P||null,v.value=(ne==null?void 0:ne.folder_name)||F||t.value||"",{id:k.value,label:v.value}}catch(O){return console.error("Error fetching folder contents:",O),d.value=(O==null?void 0:O.message)||__("Unable to load folder contents."),m.value=[],u.value=[],null}finally{l.value=!1}}),ae=()=>se(this,null,function*(){const P=yield g({folderLabel:t.value});P&&(_.value=[P])}),y=P=>se(this,null,function*(){if(!(P!=null&&P.name))return;const F=yield g({folderId:P.name,folderLabel:P.file_name});F&&(_.value=[..._.value,F])}),B=P=>se(this,null,function*(){if(P<0||P>=_.value.length)return;const F=_.value[P],$=yield g({folderId:F.id,folderLabel:F.label});$&&(_.value=[..._.value.slice(0,P),$])});return Ee(()=>se(this,null,function*(){w=!0,yield ae()})),ue(()=>t.value,(P,F)=>se(this,null,function*(){if(!w)return;const $=(P||"").trim(),V=(F||"").trim();!$||$===V||(yield ae())})),(P,F)=>(o(),i("div",Hl,[s("div",Bl,[s("h4",jl,r(v.value||t.value),1),_.value.length?(o(),i("div",Gl,[(o(!0),i(de,null,pe(_.value,($,V)=>(o(),i(de,{key:$.id||`${$.label}-${V}`},[s("button",{type:"button",class:Oe(["rounded px-1.5 py-0.5 transition hover:bg-ink-gray-2 hover:text-ink-gray-9",V===_.value.length-1?"font-medium text-ink-gray-8 cursor-default":"text-ink-gray-7"]),onClick:O=>V===_.value.length-1?null:B(V)},r($.label),11,Ql),V<_.value.length-1?(o(),i("span",Jl,"/")):D("",!0)],64))),128))])):D("",!0)]),d.value?(o(),i("div",Wl,r(d.value),1)):l.value?(o(),i("div",Yl,r(P.__("Loading folder contents")),1)):(o(),i(de,{key:2},[s("section",Xl,[s("h5",Kl,r(P.__("Sub-folders")),1),m.value.length?(o(),i("ul",ei,[(o(!0),i(de,null,pe(m.value,$=>(o(),i("li",{key:$.name,class:"flex items-center justify-between rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("button",{type:"button",class:"text-left text-sm font-medium text-blue-600 hover:underline",onClick:V=>y($)},r($.file_name),9,ti),s("span",si,r(P.__("Folder")),1)]))),128))])):(o(),i("div",Zl,r(P.__("No sub-folders in this location.")),1))]),s("section",ai,[s("h5",oi,r(P.__("Files")),1),u.value.length?(o(),i("ul",ri,[(o(!0),i(de,null,pe(u.value,$=>(o(),i("li",{key:$.file_url||$.name,class:"flex items-center gap-3 rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("a",{href:$.file_url,download:"",class:"flex-1 truncate text-sm text-blue-600 hover:underline"},r($.file_name),9,li),s("span",ii,r(p($.file_size)),1)]))),128))])):(o(),i("div",ni,r(P.__("No files available in this folder.")),1))])],64))]))}},wt=()=>{var c,e;return typeof window=="undefined"?null:window.csrf_token||((c=window.frappe)==null?void 0:c.csrf_token)||((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||null};class ut{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l,this.api=t,this.wrapper=void 0,this.vueApp=null}static get toolbox(){const e=fe({render:()=>Re(ds,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Folder",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.folder?this.renderFolder(this.data.folder):this.renderFolderModal(),this.wrapper}destroyApp(){this.vueApp&&(this.vueApp.unmount(),this.vueApp=null),this.wrapper&&(this.wrapper.innerHTML="")}renderFolder(e){if(this.readOnly){this.destroyApp(),this.vueApp=fe(ui,{folder:e}),this.vueApp.use(De),this.vueApp.use(Me),this.vueApp.mount(this.wrapper);return}this.renderFolderModal(e)}renderFolderModal(e=null){this.readOnly||(this.destroyApp(),this.vueApp=fe(Vl,{initialFolder:e,onAddition:t=>{this.data||(this.data={}),this.data.folder=t}}),this.vueApp.use(De),this.vueApp.use(Me),this.vueApp.mount(this.wrapper))}save(e){var t;return{folder:(t=this.data)==null?void 0:t.folder}}destroy(){this.destroyApp()}createCourseFolder(e,t){return se(this,null,function*(){const l=t==null?void 0:t.trim();if(!l)throw new Error("Folder name is required to create a course folder");if(!e)throw new Error("Course is required to create a course folder");const d=wt();if(!d)throw new Error("CSRF token not found. Please refresh the page and try again.");let u;const m=yield fetch("/api/resource/Course Folder",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":d},credentials:"include",body:JSON.stringify({course:e,foldername:l})});try{u=yield m.json()}catch(v){u=null}if(!m.ok){const v=(u==null?void 0:u.message)||(u==null?void 0:u.exc)||m.statusText;throw new Error(v||"Failed to create course folder")}const k=(u==null?void 0:u.data)||u;return this.data||(this.data={}),this.data.folder=(k==null?void 0:k.foldername)||l,k})}createSubfolder(d){return se(this,arguments,function*({parentFolderId:e,parentFolderName:t,subfolderName:l}){const u=l==null?void 0:l.trim();if(!u)throw new Error("Sub-folder name is required");if(!e&&!t)throw new Error("Parent folder information is required to create a sub-folder");const m=wt();if(!m)throw new Error("CSRF token not found. Please refresh the page and try again.");let k;const v=yield fetch("/api/method/seminary.api.folder_upload.create_subfolder",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":m},credentials:"include",body:JSON.stringify({parent_folder_id:e,parent_foldername:t,subfoldername:u})});try{k=yield v.json()}catch(_){k=null}if(!v.ok){const _=(k==null?void 0:k.message)||(k==null?void 0:k.exc)||v.statusText;throw new Error(_||"Failed to create sub-folder")}return(k==null?void 0:k.message)||(k==null?void 0:k.data)||k})}}function di(c){ke(qe({position:"bottom-right"},c))}function st(c){return _s(c).value}function gi(c){return c>999?(c/1e3).toFixed(1)+"k":c}function Ke(c){let e=parseInt(c);return e>1048576?(e/1048576).toFixed(2)+"M":e>1024?(e/1024).toFixed(2)+"K":e}function _i(c){ue(()=>c,e=>{if(e.value.title){if(e.value.title&&e.value.subtitle){document.title=`${e.value.title} | ${e.value.subtitle}`;return}if(e.value.title){document.title=`${e.value.title}`;return}}},{immediate:!0,deep:!0})}function yi(){return{header:{class:gs,config:{placeholder:"Header"}},assignment:mo,quiz:Fa,exam:zn,discussionActivity:sl,upload:hl,markdown:{class:vl,inlineToolbar:!0},image:vs,table:{class:hs,inlineToolbar:!0},paragraph:{class:fs,inlineToolbar:!0,config:{preserveBlank:!0}},codeBox:{class:yl,config:{themeURL:"https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-dark.min.css",themeName:"atom-one-dark",useDefaultTheme:"dark"}},list:{class:ps,inlineToolbar:!0,config:{defaultStyle:"ordered"}},inlineCode:{class:ms,shortcut:"CMD+SHIFT+M"},embed:{class:cs,inlineToolbar:!0,config:{services:{youtube:{regex:/(?:https?:\/\/)?(?:www\.)?(?:(?:youtu\.be\/)|(?:youtube\.com)\/(?:v\/|u\/\w\/|embed\/|watch))(?:(?:\?v=)?([^#&?=]*))?((?:[?&]\w*=\w*)*)/,embedUrl:"https://www.youtube.com/embed/<%= remote_id %>",html:'<iframe style="width:100%; height: 30rem;" frameborder="0" allowfullscreen></iframe>',height:320,width:580,id:([c,e])=>{if(!e&&c)return c;const t={start:"start",end:"end",t:"start",time_continue:"start",list:"list"};let l=e.slice(1).split("&").map(d=>{const[u,m]=d.split("=");return!c&&u==="v"?(c=m,null):!t[u]||m==="LL"||m.startsWith("RDMM")||m.startsWith("FL")?null:`${t[u]}=${m}`}).filter(d=>!!d);return c+"?"+l.join("&")}},vimeo:!0,codepen:!0,aparat:{regex:/(?:http[s]?:\/\/)?(?:www.)?aparat\.com\/v\/([^\/\?\&]+)\/?/,embedUrl:"https://www.aparat.com/video/video/embed/videohash/<%= remote_id %>/vt/frame",html:'<iframe style="margin: 0 auto; width: 100%; height: 25rem;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>',height:300,width:600},github:!0,slides:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/pub/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0' frameborder='0' allowfullscreen='true'></iframe>"},drive:{regex:/https:\/\/drive\.google\.com\/file\/d\/([A-Za-z0-9_-]+)\/view(\?.+)?/,embedUrl:"https://drive.google.com/file/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 25rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},docsPublic:{regex:/https:\/\/docs\.google\.com\/document\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/document/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},sheetsPublic:{regex:/https:\/\/docs\.google\.com\/spreadsheets\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/spreadsheets/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},slidesPublic:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0;' frameborder='0' allowfullscreen='true'></iframe>"},codesandbox:{regex:/^https:\/\/codesandbox\.io\/(?:embed\/)?([A-Za-z0-9_-]+)(?:\?[^\/]*)?$/,embedUrl:"https://codesandbox.io/embed/<%= remote_id %>?view=editor+%2B+preview&module=%2Findex.html",html:"<iframe style='width: 100%; height: 500px; border: 0; border-radius: 4px; overflow: hidden;' sandbox='allow-mods allow-forms allow-popups allow-scripts allow-same-origin' frameborder='0' allowfullscreen='true'></iframe>"}}}},folder:{class:ut,config:{placeholder:"Add a folder with files",uploadEndpoint:"/api/upload-folder",renderFiles:c=>c.map(e=>`<a href="${e.url}" download>${e.name}</a>`).join("<br>")}}}}function Pt(c){const e={ves:"fe",ies:"y",i:"us",zes:"ze",ses:"s",es:"e",s:""};return c.replace(new RegExp(`(${Object.keys(e).join("|")})$`),t=>e[t])}export{wa as _,Ln as a,tl as b,ui as c,ln as d,Lt as e,gi as f,yi as g,Ke as h,ka as i,io as j,Nn as k,st as t,_i as u};
//# sourceMappingURL=index-DAgtU4uR.js.map
