var T=(w,x,c)=>new Promise((V,_)=>{var r=s=>{try{A(c.next(s))}catch(h){_(h)}},k=s=>{try{A(c.throw(s))}catch(h){_(h)}},A=s=>s.done?V(s.value):Promise.resolve(s.value).then(r,k);A((c=c.apply(w,x)).next())});import{c as P,w as D,D as se,t as U,v as te,u as ae,q as E,b as oe,x as le}from"./frappe-ui-DY2hYblR.js";import{U as H,V as J,F as ee,am as X,I as F,c as N,a as C,b as u,w as z,g as o,e as f,t as g,u as i,D as m,bW as ne,bk as re,r as ie,av as ue,n as de,C as W,H as Z,O as ce,bX as me}from"./vendor-BwXEY6tq.js";import{u as pe}from"./index-CedffXRa.js";import{_ as v}from"./Link-B7-sIXzn.js";import{e as $}from"./exam-CMhV9_mz.js";import{u as _e}from"./settings-CAQVmobO.js";import"./index-C-gjsqqd.js";const fe={class:"course-assessment-dialog space-y-4 text-base max-h-[70vh] overflow-y-auto"},ye={key:4},ge={__name:"CourseAssessmentModal",props:H({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{},modalcriteria:{},modalcriteriaModifiers:{}}),emits:H(["assessment-saved"],["update:modelValue","update:modalcriteria"]),setup(w,{emit:x}){const c=J(w,"modelValue"),V=J(w,"modalcriteria"),_=x,r=ee(),k=w,A=()=>({title:"",assesscriteria_scac:"",type:"",weight_scac:"",quiz:"",exam:"",assignment:"",discussion:"",extracredit_scac:"",fudgepoints_scac:"",parent:k.courseName,parenttype:"Course Schedule",parentfield:"courseassescrit_sc"}),s=X(A()),h=()=>{Object.assign(s,A())},q=()=>{V!=null&&V.value&&Object.assign(V.value,s)};F(()=>s,()=>{q()},{deep:!0});const p=P({url:"seminary.seminary.utils.get_course_details",cache:["course",k.courseName],params:{course:k.courseName},auto:!0}),M=()=>T(null,null,function*(){var n;if(!s.assesscriteria_scac){s.type="";return}try{const t=yield(yield fetch(`/api/resource/Assessment Criteria/${s.assesscriteria_scac}`)).json(),a=((n=t==null?void 0:t.data)==null?void 0:n.type)||"";s.type=a,a!=="Quiz"&&(s.quiz=""),a!=="Exam"&&(s.exam=""),a!=="Assignment"&&(s.assignment="")}catch(e){console.error("Error fetching type:",e)}});F(()=>s.assesscriteria_scac,n=>{if(!n){s.type="",s.quiz="",s.exam="",s.assignment="",s.discussion="";return}M()});const j=(n,e)=>{var t;$.setPrefillData({title:s.title,course:(t=p==null?void 0:p.data)==null?void 0:t.course}),r.push({name:"ExamForm",params:{examID:"new"}}),e()},O=(n,e)=>{var t;$.setPrefillData({title:s.title,course:(t=p==null?void 0:p.data)==null?void 0:t.course}),r.push({name:"QuizForm",params:{quizID:"new"}}),e()},Q=(n,e)=>{var t;$.setPrefillData({title:s.title,course:(t=p==null?void 0:p.data)==null?void 0:t.course}),r.push({name:"AssignmentForm",params:{assignmentID:"new"}}),e()},I=(n,e)=>{var t;$.setPrefillData({title:s.title,course:(t=p==null?void 0:p.data)==null?void 0:t.course}),r.push({name:"DiscussionActivityForm",params:{discussionID:"new"}}),e()},R=n=>{fetch("/api/method/seminary.seminary.api.insert_cs_assessment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({criteria:s})}).then(e=>e.json()).then(()=>{U.success(__("Course Assessment added successfully")),_("assessment-saved"),c.value=!1,h(),n()}).catch(e=>{var t;console.error("Error:",e),U.error(((t=e.messages)==null?void 0:t[0])||e)})},B=n=>{c.value=!1,h(),q(),n==null||n()};F(c,n=>{h(),q()});const L=N(()=>({title:__("Add Course Assessment"),size:"lg",actions:[{label:__("Create"),variant:"solid",onClick:n=>R(n)},{label:__("Cancel"),variant:"text",onClick:n=>B(n)}]}));return(n,e)=>(u(),C(i(se),{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value=t),options:L.value,disableOutsideClickToClose:!0},{"body-content":z(()=>{var t,a,y,l,b,G,K,Y;return[o("div",fe,[f(i(D),{modelValue:s.title,"onUpdate:modelValue":e[0]||(e[0]=d=>s.title=d),label:n.__("Title"),class:"mb-4",required:!0},null,8,["modelValue","label"]),f(v,{modelValue:s.assesscriteria_scac,"onUpdate:modelValue":e[1]||(e[1]=d=>s.assesscriteria_scac=d),label:n.__("Assessment Criteria"),class:"mb-4",doctype:"Assessment Criteria",required:!0},null,8,["modelValue","label"]),o("p",null,m(s.type),1),s.type==="Quiz"?(u(),C(v,{key:0,modelValue:s.quiz,"onUpdate:modelValue":e[2]||(e[2]=d=>s.quiz=d),doctype:"Quiz",label:n.__("Select a Quiz"),filters:{course:(a=(t=i(p))==null?void 0:t.data)==null?void 0:a.course},onCreate:(d,S)=>O(d,S)},null,8,["modelValue","label","filters","onCreate"])):s.type==="Exam"?(u(),C(v,{key:1,modelValue:s.exam,"onUpdate:modelValue":e[3]||(e[3]=d=>s.exam=d),doctype:"Exam Activity",label:n.__("Select an Exam"),filters:{course:(l=(y=i(p))==null?void 0:y.data)==null?void 0:l.course},onCreate:(d,S)=>j(d,S)},null,8,["modelValue","label","filters","onCreate"])):s.type==="Assignment"?(u(),C(v,{key:2,modelValue:s.assignment,"onUpdate:modelValue":e[4]||(e[4]=d=>s.assignment=d),doctype:"Assignment Activity",label:n.__("Select an Assignment"),filters:{course:(G=(b=i(p))==null?void 0:b.data)==null?void 0:G.course},onCreate:(d,S)=>Q(d,S)},null,8,["modelValue","label","filters","onCreate"])):s.type==="Discussion"?(u(),C(v,{key:3,modelValue:s.discussion,"onUpdate:modelValue":e[5]||(e[5]=d=>s.discussion=d),doctype:"Discussion Activity",label:n.__("Select a Discussion Activity"),filters:{course:(Y=(K=i(p))==null?void 0:K.data)==null?void 0:Y.course},onCreate:(d,S)=>I(d,S)},null,8,["modelValue","label","filters","onCreate"])):(u(),g("p",ye,"Offline")),f(i(D),{modelValue:s.weight_scac,"onUpdate:modelValue":e[6]||(e[6]=d=>s.weight_scac=d),label:n.__("Weight"),class:"mb-4",required:!0,maxlength:"10"},null,8,["modelValue","label"])])]}),_:1},8,["modelValue","options"]))}},he={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},be={key:0,class:"flex items-center mt-3 md:mt-0"},ve={key:1,class:"flex items-center mt-3 md:mt-0"},Ve={class:"mt-5 mb-10 w-full px-5"},Ce={class:"container max-w-full mb-5"},we={key:0,class:"text-lg font-semibold mb-4"},xe={key:1,class:"text-lg font-semibold mb-4"},Ae={class:"min-w-full table-auto border-collapse overflow-auto"},ke={class:"p-2 border"},Se={class:"p-2 border"},qe={class:"p-2 border"},ze={class:"p-2 border"},De={class:"p-2 border"},Ue={class:"p-2 border"},Ne={class:"p-2 border"},Te={class:"p-2 border"},Ee={class:"p-2 border"},$e={class:"p-2 border"},Pe={class:"p-2 border"},Fe={key:4},Me={class:"p-2 border text-center"},je={class:"p-2 border",style:{width:"10%"}},Oe={key:0,class:"mb-4 light-blue-bg p-2 rounded"},Qe={key:1,class:"mb-4"},Ie={class:"p-2 border"},Re={class:"p-2 border text-center"},Be={key:0,class:"checkmark"},Le={key:1,class:"text-red-500"},We={class:"p-2 border text-center align-middle"},He={class:"mt-5 mb-10 max-w-full px-15"},Je={__name:"CourseAssessment",props:H({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(w){ne(),ee(),re("$user"),_e();const x=ie(!1);J(w,"modelValue");const c=w,V=X({title:"",assesscriteria_scac:"",type:"",weight_scac:"",quiz:"",exam:"",assignment:"",discussion:"",extracredit_scac:0,fudgepoints_scac:"",parent:c.courseName,parenttype:"Course Schedule",parentfield:"courseassescrit_sc"}),_=P({url:"seminary.seminary.utils.get_course_details",cache:["course",c.courseName],params:{course:c.courseName},auto:!0}),r=P({url:"seminary.seminary.utils.get_assessments",cache:["assessments",c.courseName],params:{course:c.courseName},auto:!0}),k=N(()=>{var t;let e=[{label:__("Courses"),route:{name:"Courses"}}];return e.push({label:(t=_==null?void 0:_.data)==null?void 0:t.course,route:{name:"CourseDetail",params:{courseName:c.courseName}}}),e.push({label:__("Assessment"),route:{name:"CourseAssessment",params:{courseName:c.courseName}}}),e}),A=N(()=>{var e;return{title:(e=_==null?void 0:_.data)==null?void 0:e.title,description:__("Assessment Configuration for the course")}});pe(A);const s=X([]),h=N(()=>s.reduce((e,t)=>t.extracredit_scac===0?e+parseFloat(t.weight_scac||0):e,0)),q=N(()=>s.reduce((e,t)=>t.extracredit_scac?e+parseFloat(t.fudgepoints_scac||0):e,0));ue(()=>{F(()=>r.data,e=>{e&&p()}),r.reload()});function p(){s.length=0,r.data?Array.isArray(r.data)?r.data.forEach(e=>{s.push({name:e.name||"",title:e.title||"",assesscriteria_scac:e.assesscriteria_scac||"",type:e.type||"",weight_scac:e.weight_scac||0,quiz:e.quiz||"",exam:e.exam||"",assignment:e.assignment||"",discussion:e.discussion||"",creator:e.creator||"",extracredit_scac:e.extracredit_scac||0,fudgepoints_scac:e.fudgepoints_scac||"",name:e.name||"",parent:e.parent||"",parenttype:e.parenttype||"",parentfield:e.parentfield||"",due_date:e.due_date||"",lesson:e.lesson||""})}):s.push({name:r.data.name||"",title:r.data.title||"",assesscriteria_scac:r.data.assesscriteria_scac||"",type:r.data.type||"",weight_scac:r.data.weight_scac||0,quiz:r.data.quiz||"",exam:r.data.exam||"",assignment:r.data.assignment||"",discussion:r.data.discussion||"",creator:r.data.creator||"",extracredit_scac:r.data.extracredit_scac||0,fudgepoints_scac:r.data.fudgepoints_scac||"",name:r.data.name||"",parent:r.data.parent||"",parenttype:r.data.parenttype||"",parentfield:r.data.parentfield||"",due_date:r.data.due_date||"",lesson:r.data.lesson||""}):console.log("No assessments data found")}function M(e){return T(this,null,function*(){const t=s[e];if(confirm(__("Are you sure you want to delete this record?"))){if(t.name)try{yield j.reload([t.name]),console.log(`Record with name ${t.name} deleted from backend.`),U.success(__("Assessment criteria deleted successfully"))}catch(a){console.error("Error deleting assessment criteria:",a),U.error(__("Failed to delete assessment criteria"));return}s.splice(e,1),console.log(`Record at index ${e} removed from frontend.`)}})}const j=P({url:"seminary.seminary.api.delete_documents",makeParams(e){return{doctype:"Scheduled Course Assess Criteria",documents:e}},onSuccess(e){console.log("Delete successful:",e)},onError(e){console.error("Error deleting documents:",e)}});function O(){x.value=!0}function Q(){for(const e of s)if(!e.assesscriteria_scac||e.type==="Quiz"&&!e.quiz||e.type==="Exam"&&!e.exam||e.type==="Assignment"&&!e.assignment||e.type==="Discussion"&&!e.discussion||!e.extracredit_scac&&!e.weight_scac||e.extracredit_scac&&!e.fudgepoints_scac)return!1;return!0}function I(){if(!Q()){U.error(__("Please fill in all required fields"));return}fetch("/api/method/seminary.seminary.api.save_course_assessment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course:c.courseName,assessment_data:s})}).then(e=>e.json()).then(e=>{console.log("Success:",e),e.message&&U.success(__("Course updated successfully"))}).catch(e=>{console.error("Error:",e)})}function R(e){return T(this,null,function*(){var t;if(e.assesscriteria_scac)try{const y=yield(yield fetch(`/api/resource/Assessment Criteria/${e.assesscriteria_scac}`)).json(),l=((t=y==null?void 0:y.data)==null?void 0:t.type)||"";e.type=l,l!=="Quiz"&&(e.quiz=""),l!=="Exam"&&(e.exam=""),l!=="Assignment"&&(e.assignment=""),l!=="Discussion"&&(e.discussion="")}catch(a){console.error("Error fetching type:",a)}else e.type="",e.quiz="",e.exam="",e.assignment="",e.discussion=""})}function B(e){if(!e)return"";const t=new Date(e),a=String(t.getMonth()+1).padStart(2,"0"),y=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),b=String(t.getMinutes()).padStart(2,"0");return`${a}/${y} ${l}:${b}`}function L(){r.reload(),x.value=!1}function n(e,t){const a={quiz:"/seminary/quizzes/new",exam:"/seminary/exams/new",assignment:"/seminary/assignments/new",discussion:"/seminary/discussion-activities/new"},y=a==null?void 0:a[String(e||"").toLowerCase()];typeof t=="function"&&t(),y&&window.open(y,"_blank")}return(e,t)=>(u(),g(Z,null,[o("header",he,[f(i(ae),{class:"h-7",items:k.value},null,8,["items"]),h.value!==100?(u(),g("div",be,[f(i(oe),{text:e.__("Save is only allowed when Total Points = 100"),placement:"bottom"},{default:z(()=>[f(i(E),{variant:"subtle",class:"ml-2"},{default:z(()=>[o("span",null,m(e.__("Save only allowed when Total Points = 100")),1)]),_:1})]),_:1},8,["text"])])):(u(),g("div",ve,[f(i(E),{variant:"solid",onClick:t[0]||(t[0]=a=>I()),class:"ml-2"},{default:z(()=>[o("span",null,m(e.__("Save")),1)]),_:1})]))]),o("div",Ve,[o("div",Ce,[i(_).data?(u(),g("div",xe,m(e.__("Assessment Criteria for "+i(_).data.course)),1)):(u(),g("div",we,m(e.__("Assessment Criteria")),1)),o("div",{class:de({"max-w-full flex justify-between mb-4 mt-5 text-xl":!0,"bg-red-400 rounded":h.value!==100})},[o("div",null,[o("strong",null,m(e.__("Total Points"))+":",1),W(" "+m(h.value),1)]),o("div",null,[o("strong",null,m(e.__("Max Fudge Points"))+":",1),W(" "+m(q.value),1)])],2)])]),o("table",Ae,[o("thead",null,[o("tr",null,[o("th",ke,m(e.__("Title")),1),o("th",Se,m(e.__("Assessment Type")),1),o("th",qe,m(e.__("Activity Selection")),1),o("th",ze,m(e.__("Extra Credit?")),1),o("th",De,m(e.__("Points")),1),o("th",Ue,m(e.__("Due Date")),1),o("th",Ne,m(e.__("In Lesson")),1),o("th",Te,m(e.__("Delete")),1)])]),o("tbody",null,[(u(!0),g(Z,null,ce(s,(a,y)=>(u(),g("tr",{key:y},[o("td",Ee,[f(i(D),{modelValue:a.title,"onUpdate:modelValue":l=>a.title=l,class:"mb-4 overflow-visible",required:!1},null,8,["modelValue","onUpdate:modelValue"])]),o("td",$e,[f(v,{modelValue:a.assesscriteria_scac,"onUpdate:modelValue":[l=>a.assesscriteria_scac=l,()=>R(a)],class:"mb-4",doctype:"Assessment Criteria",required:!0},null,8,["modelValue","onUpdate:modelValue"])]),o("td",Pe,[a.type==="Quiz"?(u(),C(v,{key:0,modelValue:a.quiz,"onUpdate:modelValue":l=>a.quiz=l,doctype:"Quiz",label:e.__("Select a Quiz"),required:!0,filters:{course:i(_).data.course},onCreate:(l,b)=>n("quiz",b)},null,8,["modelValue","onUpdate:modelValue","label","filters","onCreate"])):a.type==="Exam"?(u(),C(v,{key:1,modelValue:a.exam,"onUpdate:modelValue":l=>a.exam=l,doctype:"Exam Activity",label:e.__("Select an Exam"),required:!0,filters:{course:i(_).data.course},onCreate:(l,b)=>n("exam",b)},null,8,["modelValue","onUpdate:modelValue","label","filters","onCreate"])):a.type==="Assignment"?(u(),C(v,{key:2,modelValue:a.assignment,"onUpdate:modelValue":l=>a.assignment=l,doctype:"Assignment Activity",label:e.__("Select an Assignment"),required:!0,filters:{course:i(_).data.course},onCreate:(l,b)=>n("assignment",b)},null,8,["modelValue","onUpdate:modelValue","label","filters","onCreate"])):a.type==="Discussion"?(u(),C(v,{key:3,modelValue:a.discussion,"onUpdate:modelValue":l=>a.discussion=l,doctype:"Discussion Activity",label:e.__("Select a Discussion Activity"),required:!0,filters:{course:i(_).data.course},onCreate:(l,b)=>n("discussion",b)},null,8,["modelValue","onUpdate:modelValue","label","filters","onCreate"])):(u(),g("p",Fe,m(e.__("Offline")),1))]),o("td",Me,[f(i(D),{modelValue:a.extracredit_scac,"onUpdate:modelValue":l=>a.extracredit_scac=l,type:"checkbox",required:!1,class:"mb-4 inline-block",default:!1},null,8,["modelValue","onUpdate:modelValue"])]),o("td",je,[a.extracredit_scac?(u(),g("div",Oe,[f(i(D),{modelValue:a.fudgepoints_scac,"onUpdate:modelValue":l=>a.fudgepoints_scac=l,label:e.__("Fudge Points"),type:"float",class:"max-w-14ch",required:!0},null,8,["modelValue","onUpdate:modelValue","label"])])):(u(),g("div",Qe,[f(i(D),{modelValue:a.weight_scac,"onUpdate:modelValue":l=>a.weight_scac=l,label:e.__("Weight"),type:"float",class:"max-w-14ch",required:!0},null,8,["modelValue","onUpdate:modelValue","label"])]))]),o("td",Ie,[f(le,{modelValue:a.due_date,"onUpdate:modelValue":l=>a.due_date=l,variant:"subtle",required:!1,class:"date-column",formatter:B},null,8,["modelValue","onUpdate:modelValue"])]),o("td",Re,[a.lesson?(u(),g("span",Be,[...t[3]||(t[3]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1)])])):(u(),g("span",Le," âœ˜ "))]),o("td",We,[f(i(E),{variant:"ghost",size:"sm",theme:"red",onClick:l=>M(y)},{default:z(()=>[f(i(me),{class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]))),128))])]),o("div",He,[t[4]||(t[4]=o("br",null,null,-1)),f(i(E),{class:"mb-4",size:"sm",onClick:O},{default:z(()=>[W(m(e.__("Add Evaluation")),1)]),_:1}),f(ge,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=a=>x.value=a),modalcriteria:V,"onUpdate:modalcriteria":t[2]||(t[2]=a=>V=a),courseName:c.courseName,onAssessmentSaved:L},null,8,["modelValue","modalcriteria","courseName"])])],64))}},as=te(Je,[["__scopeId","data-v-8e1496af"]]);export{as as default};
//# sourceMappingURL=CourseAssessment-C5DUs1HS.js.map
