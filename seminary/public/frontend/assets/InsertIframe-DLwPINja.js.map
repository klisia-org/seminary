{"version":3,"file":"InsertIframe-DLwPINja.js","sources":["../../../../frontend/node_modules/frappe-ui/src/components/TextEditor/extensions/iframe/InsertIframe.vue"],"sourcesContent":["<template>\n  <div>\n    <slot v-bind=\"{ onClick: openIframeDialog }\"></slot>\n\n    <!-- Iframe URL Input Dialog -->\n    <Dialog v-model=\"showDialog\" :options=\"{ title: 'Insert Embed', size: 'md' }\">\n      <template #body-content>\n        <div class=\"space-y-4\">\n          <div>\n            <label class=\"block text-sm font-medium text-ink-gray-7 mb-2\">\n              URL or Embed Code\n            </label>\n            <Textarea\n              ref=\"urlInput\"\n              v-model=\"embedUrl\"\n              placeholder=\"https://youtube.com/watch?v=... or <iframe src=...>\"\n              @keydown.enter=\"insertIframe\"\n              @input=\"validateUrl\"\n            />\n            <p v-if=\"urlError\" class=\"text-red-500 text-sm mt-1\">{{ urlError }}</p>\n            <p v-else-if=\"embedUrl && isValidUrl\" class=\"text-ink-green-3 text-sm mt-1\">\n              âœ“ Valid {{ platformInfo.platform }} URL\n            </p>\n          </div>\n        </div>\n      </template>\n\n      <template #actions>\n        <div class=\"flex justify-end space-x-2\">\n          <Button variant=\"subtle\" @click=\"showDialog = false\">Cancel</Button>\n          <Button\n            variant=\"solid\"\n            :disabled=\"!embedUrl || !isValidUrl\"\n            @click=\"insertIframe\"\n          >\n            Insert Embed\n          </Button>\n        </div>\n      </template>\n    </Dialog>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, nextTick, onMounted, onUnmounted } from 'vue'\nimport { Editor } from '@tiptap/vue-3'\nimport { Dialog, Button, TextInput, Textarea } from '../../../..'\n\nimport {\n  validateURL,\n  processURL,\n  detectPlatform,\n  calculateAspectRatio,\n  getOptimalDimensions,\n  ALLOWED_DOMAINS\n} from './utils'\n\n\nconst props = defineProps<{\n  editor: Editor\n}>()\n\nconst showDialog = ref(false)\nconst embedUrl = ref('')\nconst urlError = ref('')\nconst title = ref('')\nconst alignment = ref<'left' | 'center' | 'right'>('center')\nconst customWidth = ref<number>(640)\nconst customHeight = ref<number>(360)\n\nconst urlInput = ref<HTMLInputElement>()\n\nconst isValidUrl = computed(() => {\n  if (!embedUrl.value) return false\n\n  try {\n    // Handle iframe embed code\n    if (embedUrl.value.trim().startsWith('<iframe')) {\n      const srcMatch = embedUrl.value.match(/src=[\"']([^\"']+)[\"']/)\n      if (srcMatch?.[1]) {\n        return validateURL(srcMatch[1], {\n          allowedDomains: ALLOWED_DOMAINS,\n          HTMLAttributes: {}\n        })\n      }\n      return false\n    }\n\n    // Handle direct URLs\n    return validateURL(embedUrl.value, {\n      allowedDomains: ALLOWED_DOMAINS,\n      HTMLAttributes: {}\n    })\n  } catch {\n    return false\n  }\n})\n\nconst processedUrl = computed(() => {\n  if (!embedUrl.value) return ''\n\n  // Extract URL from iframe code if needed\n  if (embedUrl.value.trim().startsWith('<iframe')) {\n    const srcMatch = embedUrl.value.match(/src=[\"']([^\"']+)[\"']/)\n    if (srcMatch?.[1]) {\n      return processURL(srcMatch[1])\n    }\n    return embedUrl.value\n  }\n\n  return processURL(embedUrl.value)\n})\n\nconst platformInfo = computed(() => {\n  if (!embedUrl.value || !isValidUrl.value) return { platform: 'Generic', aspectRatio: 9/16 }\n\n  const platform = detectPlatform(processedUrl.value)\n  const aspectInfo = calculateAspectRatio(processedUrl.value)\n\n  return {\n    platform: platform?.name || 'Generic',\n    aspectRatio: aspectInfo.ratio\n  }\n})\n\nconst optimalDimensions = computed(() => {\n  if (!embedUrl.value || !isValidUrl.value) return { width: 640, height: 360 }\n\n  return getOptimalDimensions(processedUrl.value, 800) // Assume 800px editor width\n})\n\nfunction validateUrl() {\n  urlError.value = ''\n\n  if (!embedUrl.value) return\n\n  if (!isValidUrl.value) {\n    urlError.value = 'Please enter a supported URL or iframe embed code'\n  }\n}\n\nfunction openIframeDialog() {\n  showDialog.value = true\n  embedUrl.value = ''\n  urlError.value = ''\n  title.value = ''\n  alignment.value = 'center'\n\n  // Set initial dimensions\n  customWidth.value = 640\n  customHeight.value = 360\n\n  nextTick(() => {\n    urlInput.value?.el?.focus()\n  })\n}\n\n// Update custom dimensions when URL changes\ncomputed(() => {\n  if (embedUrl.value && isValidUrl.value) {\n    const dimensions = optimalDimensions.value\n    customWidth.value = dimensions.width\n    customHeight.value = dimensions.height\n  }\n})\n\nfunction insertIframe() {\n  if (!embedUrl.value || !isValidUrl.value) return\n\n  const success = props.editor.commands.setIframe({\n    src: processedUrl.value,\n    width: customWidth.value,\n    height: customHeight.value,\n    title: title.value,\n    align: alignment.value\n  })\n\n  if (success) {\n    showDialog.value = false\n    props.editor.commands.focus()\n  } else {\n    urlError.value = 'Failed to insert embed. Please check the URL and try again.'\n  }\n}\n\nfunction handleSlashCommandInsert(event: CustomEvent) {\n  if (event.detail?.editor === props.editor) {\n    openIframeDialog()\n  }\n}\n\nonMounted(() => {\n  props.editor.view.dom.addEventListener('iframe:open-dialog', handleSlashCommandInsert as EventListener)\n})\n\nonUnmounted(() => {\n  props.editor.view.dom.removeEventListener('iframe:open-dialog', handleSlashCommandInsert as EventListener)\n})\n</script>\n"],"names":["props","__props","showDialog","ref","embedUrl","urlError","title","alignment","customWidth","customHeight","urlInput","isValidUrl","computed","srcMatch","validateURL","ALLOWED_DOMAINS","processedUrl","processURL","platformInfo","platform","detectPlatform","aspectInfo","calculateAspectRatio","optimalDimensions","getOptimalDimensions","validateUrl","openIframeDialog","nextTick","_b","_a","dimensions","insertIframe","handleSlashCommandInsert","event","onMounted","onUnmounted","_createElementBlock","_renderSlot","_ctx","_createVNode","_unref","Dialog","$event","_createElementVNode","_hoisted_1","_cache","Textarea","_hoisted_2","_toDisplayString","_hoisted_3","_hoisted_4","Button"],"mappings":"2kBA0DA,MAAMA,EAAQC,EAIRC,EAAaC,EAAI,EAAK,EACtBC,EAAWD,EAAI,EAAE,EACjBE,EAAWF,EAAI,EAAE,EACjBG,EAAQH,EAAI,EAAE,EACdI,EAAYJ,EAAiC,QAAQ,EACrDK,EAAcL,EAAY,GAAG,EAC7BM,EAAeN,EAAY,GAAG,EAE9BO,EAAWP,EAAA,EAEXQ,EAAaC,EAAS,IAAM,CAChC,GAAI,CAACR,EAAS,MAAO,MAAO,GAE5B,GAAI,CAEF,GAAIA,EAAS,MAAM,KAAA,EAAO,WAAW,SAAS,EAAG,CAC/C,MAAMS,EAAWT,EAAS,MAAM,MAAM,sBAAsB,EAC5D,OAAIS,GAAA,MAAAA,EAAW,GACNC,EAAYD,EAAS,CAAC,EAAG,CAC9B,eAAgBE,EAChB,eAAgB,CAAA,CAAC,CAClB,EAEI,EACT,CAGA,OAAOD,EAAYV,EAAS,MAAO,CACjC,eAAgBW,EAChB,eAAgB,CAAA,CAAC,CAClB,CACH,OAAQ,GACN,MAAO,EACT,CACF,CAAC,EAEKC,EAAeJ,EAAS,IAAM,CAClC,GAAI,CAACR,EAAS,MAAO,MAAO,GAG5B,GAAIA,EAAS,MAAM,KAAA,EAAO,WAAW,SAAS,EAAG,CAC/C,MAAMS,EAAWT,EAAS,MAAM,MAAM,sBAAsB,EAC5D,OAAIS,GAAA,MAAAA,EAAW,GACNI,EAAWJ,EAAS,CAAC,CAAC,EAExBT,EAAS,KAClB,CAEA,OAAOa,EAAWb,EAAS,KAAK,CAClC,CAAC,EAEKc,EAAeN,EAAS,IAAM,CAClC,GAAI,CAACR,EAAS,OAAS,CAACO,EAAW,MAAO,MAAO,CAAE,SAAU,UAAW,YAAa,EAAE,EAAA,EAEvF,MAAMQ,EAAWC,EAAeJ,EAAa,KAAK,EAC5CK,EAAaC,EAAqBN,EAAa,KAAK,EAE1D,MAAO,CACL,UAAUG,GAAA,YAAAA,EAAU,OAAQ,UAC5B,YAAaE,EAAW,KAAA,CAE5B,CAAC,EAEKE,EAAoBX,EAAS,IAC7B,CAACR,EAAS,OAAS,CAACO,EAAW,MAAc,CAAE,MAAO,IAAK,OAAQ,GAAA,EAEhEa,EAAqBR,EAAa,MAAO,GAAG,CACpD,EAED,SAASS,GAAc,CACrBpB,EAAS,MAAQ,GAEZD,EAAS,QAETO,EAAW,QACdN,EAAS,MAAQ,qDAErB,CAEA,SAASqB,GAAmB,CAC1BxB,EAAW,MAAQ,GACnBE,EAAS,MAAQ,GACjBC,EAAS,MAAQ,GACjBC,EAAM,MAAQ,GACdC,EAAU,MAAQ,SAGlBC,EAAY,MAAQ,IACpBC,EAAa,MAAQ,IAErBkB,EAAS,IAAM,UACbC,GAAAC,EAAAnB,EAAS,QAAT,YAAAmB,EAAgB,KAAhB,MAAAD,EAAoB,OACtB,CAAC,CACH,CAGAhB,EAAS,IAAM,CACb,GAAIR,EAAS,OAASO,EAAW,MAAO,CACtC,MAAMmB,EAAaP,EAAkB,MACrCf,EAAY,MAAQsB,EAAW,MAC/BrB,EAAa,MAAQqB,EAAW,MAClC,CACF,CAAC,EAED,SAASC,GAAe,CACtB,GAAI,CAAC3B,EAAS,OAAS,CAACO,EAAW,MAAO,OAE1BX,EAAM,OAAO,SAAS,UAAU,CAC9C,IAAKgB,EAAa,MAClB,MAAOR,EAAY,MACnB,OAAQC,EAAa,MACrB,MAAOH,EAAM,MACb,MAAOC,EAAU,KAAA,CAClB,GAGCL,EAAW,MAAQ,GACnBF,EAAM,OAAO,SAAS,MAAA,GAEtBK,EAAS,MAAQ,6DAErB,CAEA,SAAS2B,EAAyBC,EAAoB,SAChDJ,EAAAI,EAAM,SAAN,YAAAJ,EAAc,UAAW7B,EAAM,QACjC0B,EAAA,CAEJ,CAEA,OAAAQ,EAAU,IAAM,CACdlC,EAAM,OAAO,KAAK,IAAI,iBAAiB,qBAAsBgC,CAAyC,CACxG,CAAC,EAEDG,EAAY,IAAM,CAChBnC,EAAM,OAAO,KAAK,IAAI,oBAAoB,qBAAsBgC,CAAyC,CAC3G,CAAC,cApMCI,EAuCM,MAAA,KAAA,CAtCJC,EAAoDC,gCAA3BZ,CAAA,CAAgB,CAAA,CAAA,EAGzCa,EAkCSC,EAAAC,CAAA,EAAA,YAlCQvC,EAAA,2CAAAA,EAAU,MAAAwC,GAAG,QAAS,CAAA,MAAA,eAAA,KAAA,IAAA,CAAA,GAC1B,iBACT,IAiBM,CAjBNC,EAiBM,MAjBNC,EAiBM,CAhBJD,EAeM,MAAA,KAAA,CAdJE,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAF,EAEQ,QAAA,CAFD,MAAM,gDAAA,EAAiD,sBAE9D,EAAA,GACAJ,EAMEC,EAAAM,CAAA,EAAA,SALI,WAAJ,IAAIpC,aACKN,EAAA,2CAAAA,EAAQ,MAAAsC,GACjB,YAAY,sDACX,YAAeX,EAAY,CAAA,OAAA,CAAA,EAC3B,QAAON,CAAA,yBAEDpB,EAAA,WAAT+B,EAAuE,IAAvEW,EAAuEC,EAAf3C,EAAA,KAAQ,EAAA,CAAA,GAClDD,EAAA,OAAYO,EAAA,WAA1ByB,EAEI,IAFJa,EAA4E,cAC/D/B,EAAA,MAAa,QAAQ,EAAG,QACrC,CAAA,kBAKK,UACT,IASM,CATNyB,EASM,MATNO,EASM,CARJX,EAAoEC,EAAAW,CAAA,EAAA,CAA5D,QAAQ,SAAU,uBAAOjD,EAAA,MAAU,GAAA,aAAU,IAAM,CAAA,GAAA2C,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAAN,SAAM,EAAA,CAAA,WAC3DN,EAMSC,EAAAW,CAAA,EAAA,CALP,QAAQ,QACP,SAAQ,CAAG/C,EAAA,OAAQ,CAAKO,EAAA,MACxB,QAAOoB,CAAA,aACT,IAED,CAAA,GAAAc,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAFC,iBAED,EAAA,CAAA","x_google_ignoreList":[0]}