var le=Object.defineProperty;var X=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var Y=(b,m,d)=>m in b?le(b,m,{enumerable:!0,configurable:!0,writable:!0,value:d}):b[m]=d,E=(b,m)=>{for(var d in m||(m={}))ie.call(m,d)&&Y(b,d,m[d]);if(X)for(var d of X(m))ue.call(m,d)&&Y(b,d,m[d]);return b};import{y as re,z as Z,r as H,d as O,b as h,n as ae,l as T,f as D,w as _,e as a,o as f,a as l,c as k,p as ee,ak as te,t as x,g as Q,h as r,D as de,m as me,N as ce,ae as pe,F as z,i as _e,x as fe,j as be,A as M,_ as $,k as se}from"./index-flDXq_bA.js";import{_ as xe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-BCDqT5C6.js";import{a as g,P as ve}from"./plus-DlUOwXB2.js";import{a as ye,_ as qe,e as we,c as ke,b as he,f as ge,d as Ve}from"./ListView-BTNGfjAN.js";import{T as oe,s as w,u as Ee,a as De}from"./index-nCb1JY8w.js";import{_ as ne}from"./Link-DjgbRK92.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-DT0r2lvZ.js";import"./Badge.vue_vue_type_script_setup_true_lang-DXoAtOCS.js";import"./pencil-3qaHjsB3.js";import"./FolderPlugin.vue_vue_type_style_index_0_scoped_84b7d54d_lang-BGvM5k8c.js";import"./book-open-check-CFVdhsmI.js";const Qe={class:"space-y-4"},Se={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},$e={class:"flex items-center space-x-2"},Ce={for:"existing",class:"cursor-pointer"},Ue={class:"flex items-center space-x-2"},Pe={for:"new",class:"cursor-pointer"},Ie={key:1,class:"space-y-2"},Me={class:"block text-xs text-ink-gray-5 mb-1"},Te={class:"block text-xs text-ink-gray-5 mb-1"},Oe={key:2,class:"space-y-2"},Ae={__name:"OpenQuestion",props:re({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},exam:{},examModifiers:{}}),emits:["update:modelValue","update:exam"],setup(b){const m=Z(b,"modelValue"),d=Z(b,"exam"),v=H(null),V=H(!1),p=O({question:"",points:0}),s=O({question:"",points:0}),y=b,c=h({url:"frappe.client.get",makeParams(){return{doctype:"Open Question",name:y.questionDetail.question}},auto:!1,onSuccess(n){V.value=!0,s.points=y.questionDetail.points}});ae(m,()=>{m.value&&(V.value=!1,y.questionDetail.question?c.fetch():(s.question="",s.points=0,p.question="",p.points=0,v.value=null),y.questionDetail.points&&(s.points=y.questionDetail.points))});const A=h({url:"frappe.client.insert",makeParams(n){return{doc:E({doctype:"Exam Question",parent:d.value.data.name,parentfield:"questions",parenttype:"Exam Activity",points:n.points},n)}}}),L=h({url:"frappe.client.insert",makeParams(n){return{doc:E({doctype:"Open Question"},s)}}}),C=n=>{var o;(o=y.questionDetail)!=null&&o.question?I(n):N(n)},N=n=>{v.value=="existing"?U({question:p.question,points:p.points},n):L.submit({},{onSuccess(o){U({question:o.name,points:s.points},n)},onError(o){var i;w(__("Error"),__(((i=o.messages)==null?void 0:i[0])||o),"x")}})},U=(n,o)=>{console.log("Submitting Question Row:",n),A.submit(E({},n),{onSuccess(){m.value=!1,w(__("Success"),__("Question added successfully"),"check"),d.value.reload(),o()},onError(i){var e;w(__("Error"),__(((e=i.messages)==null?void 0:e[0])||i),"x"),o()}})},R=h({url:"frappe.client.set_value",auto:!1,makeParams(n){var o;return{doctype:"Open Question",name:(o=c.data)==null?void 0:o.name,fieldname:E({},s)}}}),P=h({url:"frappe.client.set_value",auto:!1,makeParams(n){return{doctype:"Exam Question",name:y.questionDetail.name,fieldname:{points:s.points}}}}),I=n=>{R.submit({},{onSuccess(){P.submit({},{onSuccess(){m.value=!1,w(__("Success"),__("Question updated successfully"),"check"),d.value.reload(),n()}})},onError(o){var i;w(__("Error"),__(((i=o.messages)==null?void 0:i[0])||o),"x")}})},j=T(()=>({title:__(y.title),size:"xl",actions:[{label:__("Submit"),variant:"solid",onClick:n=>{C(n)}}]}));return(n,o)=>(f(),D(a(de),{modelValue:m.value,"onUpdate:modelValue":o[7]||(o[7]=i=>m.value=i),options:j.value},{"body-content":_(()=>[l("div",Qe,[V.value?Q("",!0):(f(),k("div",Se,[l("div",$e,[ee(l("input",{type:"radio",id:"existing",value:"existing","onUpdate:modelValue":o[0]||(o[0]=i=>v.value=i),class:"w-3 h-3 cursor-pointer"},null,512),[[te,v.value]]),l("label",Ce,x(n.__("Add an existing question")),1)]),l("div",Ue,[ee(l("input",{type:"radio",id:"new",value:"new","onUpdate:modelValue":o[1]||(o[1]=i=>v.value=i),class:"w-3 h-3 cursor-pointer"},null,512),[[te,v.value]]),l("label",Pe,x(n.__("Create a new question")),1)])])),v.value=="new"||V.value?(f(),k("div",Ie,[l("div",null,[l("label",Me,x(n.__("Question")),1),r(a(oe),{content:s.question,onChange:o[2]||(o[2]=i=>s.question=i),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),l("div",null,[l("label",Te,x(n.__("Explanation for this Question")),1),r(a(oe),{content:s.explanation,onChange:o[3]||(o[3]=i=>s.explanation=i),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r(a(g),{modelValue:s.points,"onUpdate:modelValue":o[4]||(o[4]=i=>s.points=i),label:n.__("Points"),type:"number"},null,8,["modelValue","label"])])):v.value=="existing"?(f(),k("div",Oe,[r(ne,{modelValue:p.question,"onUpdate:modelValue":o[5]||(o[5]=i=>p.question=i),label:n.__("Select a question"),doctype:"Open Question"},null,8,["modelValue","label"]),r(a(g),{modelValue:p.points,"onUpdate:modelValue":o[6]||(o[6]=i=>p.points=i),label:n.__("Points"),type:"number"},null,8,["modelValue","label"])])):Q("",!0)])]),_:1},8,["modelValue","options"]))}},Le={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ne={class:"space-x-2"},Re={class:"w-3/4 mx-auto py-5"},je={class:"mb-8"},Fe={class:"font-semibold mb-4"},Be={key:0},ze={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},He={class:"mb-8"},Ke={class:"font-semibold mb-4"},Ge={class:"mb-8"},Je={class:"font-semibold mb-4"},We={class:"grid grid-cols-3"},Xe={class:"flex items-center justify-between mb-4"},Ye={class:"font-semibold"},Ze=["innerHTML"],et={key:1,class:"text-xs"},tt={class:"flex gap-2"},_t={__name:"ExamForm",props:{examID:{type:String,required:!0}},setup(b){const m=H(!1),d=O({question:"",points:0,name:""}),v=_e("$user"),V=fe(),p=b,s=O({title:"",course:"",total_points:0,duration:0,qbyquestion:!1,limit_questions_to:0,show_answers:!0,shuffle_questions:!1,questions:[]});me(()=>{var e,t;p.examID=="new"&&!((e=v.data)!=null&&e.is_moderator)&&!((t=v.data)!=null&&t.is_instructor)&&V.push({name:"Courses"}),p.examID!=="new"&&c.reload(),window.addEventListener("keydown",y)});const y=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(C(),e.preventDefault())};ce(()=>{window.removeEventListener("keydown",y)}),ae(()=>p.examID!=="new",e=>{e&&c.reload()});const c=h({url:"frappe.client.get",makeParams(e){return{doctype:"Exam Activity",name:p.examID}},auto:!1,onSuccess(e){Object.keys(e).forEach(q=>{Object.hasOwn(s,q)&&(s[q]=e[q])});let t=["show_answers","show_submission_history","shuffle_questions"];for(let q in t){let S=t[q];s[S]=!!s[S]}}}),A=h({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:E({doctype:"Exam Activity"},s)}}}),L=h({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"Exam Activity",name:e.examID,fieldname:E({total_points:R()},s)}}}),C=()=>{var e;(e=c.data)!=null&&e.name?U():N()},N=()=>{A.submit({},{onSuccess(e){w(__("Success"),__("Exam created successfully"),"check"),V.push({name:"ExamForm",params:{examID:e.name}})},onError(e){var t;w(__("Error"),__(((t=e.messages)==null?void 0:t[0])||e),"x")}})},U=()=>{var e;L.submit({examID:(e=c.data)==null?void 0:e.name},{onSuccess(t){s.total_points=t.total_points,w(__("Success"),__("Exam updated successfully"),"check")},onError(t){var q;w(__("Error"),__(((q=t.messages)==null?void 0:q[0])||t),"x")}})},R=()=>{let e=0;return s.limit_questions_to&&s.questions.length>0?s.questions[0].points*s.limit_questions_to:(s.questions.forEach(t=>{e+=t.points}),e)},P=T(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Points"),key:"points",width:"5rem"}]),I=(e=null)=>{e?(d.question=e.question,d.points=e.points,d.name=e.name):(d.question="",d.points=0,d.name=""),m.value=!0},j=h({url:"seminary.seminary.api.delete_documents",makeParams(e){return{doctype:"Exam Question",documents:e.questions}}}),n=(e,t)=>{j.submit({questions:Array.from(e)},{onSuccess(){w(__("Success"),__("Questions deleted successfully"),"check"),c.reload(),t()}})},o=T(()=>{var t;let e=[{label:__("Exams"),route:{name:"Exams"}}];return e.push({label:p.examID=="new"?__("New Exam"):(t=c.data)==null?void 0:t.title,route:{name:"ExamForm",params:{examID:p.examID}}}),e}),i=T(()=>{var e;return{title:p.examID=="new"?__("New Exam"):(e=c.data)==null?void 0:e.title,description:__("Form to create and edit exams")}});return Ee(i),(e,t)=>{var S,K,G,J;const q=be("router-link");return f(),k(z,null,[l("header",Le,[r(a(xe),{items:o.value},null,8,["items"]),l("div",Ne,[(S=a(c).data)!=null&&S.name?(f(),D(q,{key:0,to:{name:"ExamPage",params:{examID:a(c).data.name}}},{default:_(()=>[r(a($),null,{default:_(()=>[M(x(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):Q("",!0),(K=a(c).data)!=null&&K.name?(f(),D(q,{key:1,to:{name:"ExamSubmissionList",params:{examID:a(c).data.name}}},{default:_(()=>[r(a($),null,{default:_(()=>[M(x(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):Q("",!0),r(a($),{variant:"solid",onClick:t[0]||(t[0]=u=>C())},{default:_(()=>[M(x(e.__("Save")),1)]),_:1})])]),l("div",Re,[l("div",je,[l("div",Fe,x(e.__("Details")),1),r(a(g),{modelValue:s.title,"onUpdate:modelValue":t[1]||(t[1]=u=>s.title=u),label:(G=a(c).data)!=null&&G.name?e.__("Title"):e.__("Enter a title and save the exam to proceed"),required:!0},null,8,["modelValue","label"]),t[11]||(t[11]=l("br",null,null,-1)),r(ne,{modelValue:s.course,"onUpdate:modelValue":t[2]||(t[2]=u=>s.course=u),doctype:"Course",label:e.__("Course where this exam will be used - you may reuse this exam in other scheduled courses"),placeholder:e.__("Select a course"),required:!0},null,8,["modelValue","label","placeholder"]),(J=a(c).data)!=null&&J.name?(f(),k("div",Be,[l("div",ze,[r(a(g),{type:"number",modelValue:s.duration,"onUpdate:modelValue":t[3]||(t[3]=u=>s.duration=u),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),r(a(g),{modelValue:s.total_points,"onUpdate:modelValue":t[4]||(t[4]=u=>s.total_points=u),label:e.__("Total Points"),disabled:""},null,8,["modelValue","label"])]),l("div",He,[l("div",Ke,x(e.__("Settings")),1),r(a(g),{modelValue:s.qbyquestion,"onUpdate:modelValue":t[5]||(t[5]=u=>s.qbyquestion=u),type:"checkbox",label:e.__("Force student to answer a question before moving on? Each question will have its own page and a next button")},null,8,["modelValue","label"])]),l("div",Ge,[l("div",Je,x(e.__("Shuffle Settings")),1),l("div",We,[r(a(g),{modelValue:s.shuffle_questions,"onUpdate:modelValue":t[6]||(t[6]=u=>s.shuffle_questions=u),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),s.shuffle_questions?(f(),D(a(g),{key:0,modelValue:s.limit_questions_to,"onUpdate:modelValue":t[7]||(t[7]=u=>s.limit_questions_to=u),label:e.__("Limit Questions To (on shuffle)")},null,8,["modelValue","label"])):Q("",!0)])]),l("div",null,[l("div",Xe,[l("div",Ye,x(e.__("Questions")),1),r(a($),{onClick:t[8]||(t[8]=u=>I())},{prefix:_(()=>[r(a(ve),{class:"w-4 h-4"})]),default:_(()=>[M(" "+x(e.__("New Question")),1)]),_:1})]),r(a(Ve),{columns:P.value,rows:s.questions,"row-key":"name",options:{showTooltip:!1}},{default:_(()=>[r(a(ye),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:_(()=>[(f(!0),k(z,null,se(P.value,u=>(f(),D(a(qe),{item:u},null,8,["item"]))),256))]),_:1}),r(a(we),null,{default:_(()=>[(f(!0),k(z,null,se(s.questions,u=>(f(),D(a(he),{row:u,onClick:F=>I(u),class:"cursor-pointer"},{default:_(({idx:F,column:W,item:B})=>[r(a(ke),{item:B},{default:_(()=>[W.key=="question_detail"?(f(),k("div",{key:0,class:"text-xs truncate h-4",innerHTML:B},null,8,Ze)):(f(),k("div",et,x(B),1))]),_:2},1032,["item"])]),_:2},1032,["row","onClick"]))),256))]),_:1}),r(a(ge),null,{actions:_(({unselectAll:u,selections:F})=>[l("div",tt,[r(a($),{variant:"ghost",onClick:W=>n(F,u)},{default:_(()=>[r(a(De),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):Q("",!0)])]),r(Ae,{modelValue:m.value,"onUpdate:modelValue":t[9]||(t[9]=u=>m.value=u),questionDetail:d,exam:a(c),"onUpdate:exam":t[10]||(t[10]=u=>pe(c)?c.value=u:null),title:d.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","exam","title"])],64)}}};export{_t as default};
