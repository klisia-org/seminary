{"version":3,"file":"AssignmentForm-Cnh0Q41N.js","sources":["../../../../frontend/src/pages/AssignmentForm.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<div class=\"space-x-2\">\n\t\t\t<router-link\n\t\t\t\tv-if=\"assignment.doc?.name\"\n\t\t\t\t:to=\"{\n\t\t\t\t\tname: 'AssignmentSubmissionList',\n\t\t\t\t\tquery: {\n\t\t\t\t\t\tassignmentID: assignment.doc.name,\n\t\t\t\t\t},\n\t\t\t\t}\"\n\t\t\t>\n\t\t\t\t<Button>\n\t\t\t\t\t{{ __('Submission List') }}\n\t\t\t\t</Button>\n\t\t\t</router-link>\n\t\t\t<Button variant=\"solid\" @click=\"saveAssignment()\">\n\t\t\t\t{{ __('Save') }}\n\t\t\t</Button>\n\t\t</div>\n\t</header>\n\t<div class=\"w-3/4 mx-auto py-5\">\n\t\t<div class=\"font-semibold mb-4\">\n\t\t\t{{ __('Assignment Details') }}\n\t\t</div>\n\t\t<div class=\"grid grid-cols-2 gap-5 mt-4 mb-8\">\n\t\t\t<FormControl\n\t\t\t\tv-model=\"model.title\"\n\t\t\t\t:label=\"__('Title')\"\n\t\t\t\t:required=\"true\"\n\t\t\t/>\n\n\t\t\t<FormControl\n\t\t\t\tv-model=\"model.type\"\n\t\t\t\ttype=\"select\"\n\t\t\t\t:options=\"assignmentOptions\"\n\t\t\t\t:label=\"__('Type')\"\n\t\t\t\t:required=\"true\"\n\t\t\t/>\n\t\t</div>\n\t\t<div class=\"mb-8\">\n\t\t\t<LinkControl\n\t\t\t\tv-model=\"model.course\"\n\t\t\t\tdoctype=\"Course\"\n\t\t\t\t:label=\"__('Course where this assignment will be used. You may reuse this assignment in other course offerings')\"\n\t\t\t\t:required=\"true\"\n\t\t\t/>\n\t\t</div>\n\t\t<div>\n\t\t\t<div class=\"text-xs text-ink-gray-5 mb-2\">\n\t\t\t\t{{ __('Question') }}\n\t\t\t\t<span class=\"text-ink-red-3\">*</span>\n\t\t\t</div>\n\t\t\t<TextEditor\n\t\t\t\tv-if=\"model.question !== undefined\"\n\t\t\t\t:content=\"model.question || ''\"\n\t\t\t\t@change=\"(val) => (model.question = val)\"\n\t\t\t\t:editable=\"true\"\n\t\t\t\t:fixedMenu=\"true\"\n\t\t\t\teditorClass=\"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tButton,\n\tcreateDocumentResource,\n\tcreateResource,\n\tFormControl,\n\tTextEditor,\n\ttoast,\n} from 'frappe-ui'\nimport {\n\tcomputed,\n\tinject,\n\tonMounted,\n\tonBeforeUnmount,\n\treactive,\n\twatch,\n\tref\n} from 'vue'\nimport { useRouter } from 'vue-router'\nimport { examStore } from '@/stores/exam'\nimport LinkControl from '@/components/Controls/Link.vue'\n\nconst user = inject('$user')\nconst router = useRouter()\nconst props = defineProps({\n    assignmentID: {\n        type: String,\n        required: false,\n    },\n})\n\nconst model = reactive({\n    title: '',\n    course: '',\n    type: 'PDF',\n    question: '',\n})\n\nonMounted(() => {\n\tif (\n\t\tprops.assignmentID == 'new' &&\n\t\t!user.data?.is_moderator &&\n\t\t!user.data?.is_instructor\n\t) {\n\t\trouter.push({ name: 'Courses' })\n\t}\n\tif (props.assignmentID === 'new') {\n\t\n\t\tif (examStore.prefillData.title) {\n       \t model.title = examStore.prefillData.title; // Pre-fill the title if provided\n    \t}\n\t\tif (examStore.prefillData.course) {\n        model.course = examStore.prefillData.course; // Pre-fill the course if provided\n    }\n}\n\tif (props.assignmentID !== 'new') {\n\t\tassignment.reload()\n\t}\n\twindow.addEventListener('keydown', keyboardShortcut)\n})\n\nconst keyboardShortcut = (e) => {\n\tif (e.key === 's' && (e.ctrlKey || e.metaKey)) {\n\t\tsaveAssignment()\n\t\te.preventDefault()\n\t}\n}\n\nonBeforeUnmount(() => {\n\twindow.removeEventListener('keydown', keyboardShortcut)\n})\n\nconst assignment = createDocumentResource({\n\tdoctype: 'Assignment Activity',\n\tname: props.assignmentID,\n\tauto: false,\n})\n\nconst newAssignment = createResource({\n\turl: 'frappe.client.insert',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoc: {\n\t\t\t\tdoctype: 'Assignment Activity',\n\t\t\t\t...values,\n\t\t\t},\n\t\t}\n\t},\n\tonSuccess(data) {\n\t\ttoast.success(__('Assignment saved successfully'))\n\t\trouter.push({ name: 'AssignmentForm', params: { assignmentID: data.name } })\n\t},\n\tonError(err) {\n\t\ttoast.error(err.messages?.[0] || err)\n\t},\n})\n\nconst saveAssignment = () => {\n\tif (props.assignmentID == 'new') {\n\t\tnewAssignment.submit({\n\t\t\t...model,\n\t\t})\n\t} else {\n\t\tassignment.setValue.submit(\n\t\t\t{\n\t\t\t\t...model,\n\t\t\t},\n\t\t\t{\n\t\t\t\tonSuccess(data) {\n\t\t\t\t\ttoast.success(__('Assignment saved successfully'))\t\t\t\t\t\n\t\t\t\t\tassignment.reload()\n\t\t\t\t},\n\t\t\t\tonError(err) {\n\t\t\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t\t\t},\n\t\t\t}\n\t\t)\n\t}\n}\n\nwatch(assignment, () => {\n    if (assignment.doc) {\n        Object.keys(assignment.doc).forEach((key) => {\n            model[key] = assignment.doc[key];\n        });\n    }\n});\n\nconst breadcrumbs = computed(() => {\n\tconst items = [\n\t\t{\n\t\t\tlabel: __('Assignments'),\n\t\t\troute: { name: 'Assignments' },\n\t\t},\n\t]\n\n\tif (assignment.doc?.name) {\n\t\titems.push({\n\t\t\tlabel: assignment.doc.title,\n\t\t\troute: {\n\t\t\t\tname: 'AssignmentForm',\n\t\t\t\tparams: { assignmentID: assignment.doc.name },\n\t\t\t},\n\t\t})\n\t} else {\n\t\titems.push({\n\t\t\tlabel: __('New Assignment'),\n\t\t\troute: {\n\t\t\t\tname: 'AssignmentForm',\n\t\t\t\tparams: { assignmentID: props.assignmentID || 'new' },\n\t\t\t},\n\t\t})\n\t}\n\n\treturn items\n})\n\nconst assignmentOptions = computed(() => {\n\treturn [\n\t\t{ label: 'PDF', value: 'PDF' },\n\t\t{ label: 'Image', value: 'Image' },\n\t\t{ label: 'Document', value: 'Document' },\n\t\t{ label: 'Text', value: 'Text' },\n\t\t{ label: 'URL', value: 'URL' },\n\t]\n})\n</script>\n"],"names":["user","inject","router","useRouter","props","__props","model","reactive","onMounted","_a","_b","examStore","assignment","keyboardShortcut","saveAssignment","onBeforeUnmount","createDocumentResource","newAssignment","createResource","values","__spreadValues","data","toast","err","watch","key","breadcrumbs","computed","items","assignmentOptions","_createElementVNode","_hoisted_1","_createVNode","_unref","Breadcrumbs","_hoisted_2","_createBlock","_component_router_link","Button","__","_hoisted_3","_hoisted_4","_toDisplayString","_hoisted_5","FormControl","_cache","$event","_hoisted_6","LinkControl","_hoisted_7","TextEditor","val"],"mappings":"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"}