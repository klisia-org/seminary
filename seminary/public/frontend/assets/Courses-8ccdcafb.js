import{i as z,r as v,u as F,c as D,m as q,n as x,a as S,l as T,d as i,e as o,t as c,b as u,F as f,k as y,h as w,g as h,p as N,v as B,j as E,o as r,f as M,w as P,q as R,B as $}from"./index-aa2d5c8c.js";import{u as L,C as O,P as G}from"./CourseCardToDo-14521de2.js";import"./book-open-check-240c5796.js";import"./file-up-4aa267c8.js";const H={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},J={class:"flex items-center"},K={class:"text-xl font-semibold text-ink-gray-9"},Q={class:"p-5 flex flex-row gap-4 w-full mx-auto"},W={class:"w-1/4 p-4"},X={key:0},Y={class:"text-md font-medium mb-2"},Z={key:0},ee={key:0,class:"text-xl text-center font-semibold text-gray-500 mt-5"},te={key:1,class:"text-xl text-center font-semibold text-gray-500 mt-5"},se={class:"w-3/4"},oe={class:"flex gap-4 mb-5"},ae=["value"],re=["value"],ie={key:0,class:"flex flex-wrap justify-start gap-4"},le={class:"p-4 text-container"},ne={class:"text-2xl font-semibold"},ce={class:"short-introduction text-ink-gray-7 text-sm"},ue={class:"academic-term text-right mt-auto"},me={key:1,class:"flex flex-col items-center justify-center text-sm text-ink-gray-5 italic mt-48"},ve={__name:"Courses",setup(de){var I;const n=z("$user");v(0),F();let _=n.data.is_student;n.data.is_moderator;let A=n.data.is_instructor;n.data.is_system_manager;const m=D({url:"frappe.client.get_value",params:{doctype:"Academic Term",fieldname:"title",filters:{iscurrent_acterm:1}},auto:!0}),k=v("");q(()=>{var t;m.reload(),console.log("Current Academic Term on mount:",m.data),(t=m.data)!=null&&t.title&&(k.value=m.data.title)}),x(()=>m.data,t=>{t!=null&&t.title?k.value=t.title:console.log("Current Academic Term: undefined")},{immediate:!0}),x(()=>k.value,t=>{t&&(l.academic_term=t,console.log("Updated filters.academic_term:",l.academic_term))});const l=S({course:"",academic_term:((I=m.data)==null?void 0:I.title)||""});console.log(l.academic_term);const b=D({url:_?"seminary.seminary.utils.get_courses_for_student":"seminary.seminary.utils.get_courses",params:_?{student:n.data.name}:{},onSuccess:t=>{U.rows=t.sort((e,a)=>e.academic_term<a.academic_term?-1:e.academic_term>a.academic_term?1:e.course<a.course?-1:e.course>a.course?1:0)},auto:!0}),U=S({rows:[],columns:[{label:"Name",key:"name",width:1},{label:"Course",key:"course",width:1},{label:"Academic Term",key:"academic_term",width:1},{label:"Start Date",key:"c_datestart",width:1},{label:"End Date",key:"c_dateend",width:1},{label:"Image",key:"course_image",width:1}]}),j=T(()=>{var t;return[...new Set((t=b.data)==null?void 0:t.map(e=>e.course))]}),V=T(()=>{var t;return[...new Set((t=b.data)==null?void 0:t.map(e=>e.academic_term))]}),g=T(()=>{var t;return((t=b.data)==null?void 0:t.filter(e=>(!l.course||e.course===l.course)&&(!l.academic_term||e.academic_term===l.academic_term)))||[]}),p=v({}),d=v([]);return x(g,t=>{if(!t)return;const e=[];t.forEach(a=>{p.value[a.name]||(p.value[a.name]=L(a.name,n),console.log("Created instance for course:",a.name,p.value[a.name]));const s=p.value[a.name],C=s.countToDoItems;console.log("Starting if statement with count:",C,"for todoInstance:",s),s&&C>0&&e.push({course:a,count:C})}),console.log("List: ",e),d.value=e,console.log("Updated courseToDoList:",d.value)}),x(()=>g,t=>{Array.isArray(t)||(console.error("newFilteredCourses is not an array:",t),t=[]);const e=t.map(a=>{const s=L(a.name,n);return{course:a,count:s.countToDoItems.value,hasItems:s.countToDoItems.value>0}}).filter(a=>a.hasItems);d.value=e,console.log("Updated courseToDoList:",d.value)},{immediate:!0}),(t,e)=>{const a=E("router-link");return r(),i(f,null,[o("header",H,[o("div",J,[o("h1",K,c(u(_)?"My Courses":"All Courses"),1)])]),o("div",Q,[o("div",W,[e[2]||(e[2]=o("h2",{class:"text-lg font-semibold mb-4"},"To Do",-1)),u(_)||u(A)?(r(),i("div",X,[(r(!0),i(f,null,y(d.value,s=>(r(),i("div",{key:s.course.name},[o("h3",Y,c(s.course.name),1),w(O,{course:s.course.name,singleCourse:!1},null,8,["course"])]))),128)),d.value.length===0?(r(),i("div",Z,[w(u(G),{class:"size-20 mx-auto stroke-1 text-gray-500 mt-5"}),u(_)?(r(),i("h3",ee," Congrats! No assessments to do!")):h("",!0),u(A)?(r(),i("h3",te," Congrats! No assessments to grade!")):h("",!0)])):h("",!0)])):h("",!0)]),o("div",se,[o("div",oe,[o("div",null,[e[4]||(e[4]=o("label",{for:"courseFilter",class:"block text-sm font-medium text-gray-700"},"Course",-1)),N(o("select",{id:"courseFilter","onUpdate:modelValue":e[0]||(e[0]=s=>l.course=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[e[3]||(e[3]=o("option",{value:""},"All Courses",-1)),(r(!0),i(f,null,y(j.value,s=>(r(),i("option",{key:s,value:s},c(s),9,ae))),128))],512),[[B,l.course]])]),o("div",null,[e[6]||(e[6]=o("label",{for:"academicTermFilter",class:"block text-sm font-medium text-gray-700"},"Academic Term",-1)),N(o("select",{id:"academicTermFilter","onUpdate:modelValue":e[1]||(e[1]=s=>l.academic_term=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[e[5]||(e[5]=o("option",{value:""},"All Terms",-1)),(r(!0),i(f,null,y(V.value,s=>(r(),i("option",{key:s,value:s},c(s),9,re))),128))],512),[[B,l.academic_term]])])]),g.value.length?(r(),i("div",ie,[(r(!0),i(f,null,y(g.value,s=>(r(),M(a,{to:{name:"CourseDetail",params:{courseName:s.name}},key:s.name,class:"course_card"},{default:P(()=>[o("div",{class:"course-image",style:R({backgroundImage:`url(${encodeURI(s.course_image)})`})},null,4),o("div",le,[o("h3",ne,c(s.course),1),o("div",ce,c(s.short_introduction),1),o("div",ue,c(s.academic_term),1)])]),_:2},1032,["to"]))),128))])):(r(),i("div",me,[w(u($),{class:"size-10 mx-auto stroke-1 text-ink-gray-4"}),e[7]||(e[7]=o("div",{class:"text-2xl font-medium mb-1"},[o("span",null,"No courses found")],-1))]))])])],64)}}};export{ve as default};
//# sourceMappingURL=Courses-8ccdcafb.js.map
