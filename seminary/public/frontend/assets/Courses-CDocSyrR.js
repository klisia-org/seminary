import{bk as M,r as h,c as u,av as P,I as p,am as S,a8 as q,t as l,b as r,g as o,D as c,z as y,H as _,O as x,e as w,u as U,bR as O,L,aR as N,a as $,w as G,m as H,bG as J}from"./vendor-BwXEY6tq.js";import{c as j}from"./frappe-ui-DY2hYblR.js";import{u as K}from"./index-C-gjsqqd.js";import{u as z,C as Q}from"./CourseCardToDo-CNR7mc9v.js";const W={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},X={class:"flex items-center"},Y={class:"text-xl font-semibold text-ink-gray-9"},Z={class:"p-5 flex flex-row gap-4 w-full mx-auto"},ee={class:"w-1/4 p-4"},te={class:"text-lg font-semibold mb-4"},se={key:0},oe={class:"text-md font-medium mb-2"},ae={key:0},re={key:0,class:"text-xl text-center font-semibold text-gray-500 mt-5"},le={key:1,class:"text-xl text-center font-semibold text-gray-500 mt-5"},ce={class:"w-3/4"},ne={class:"flex gap-4 mb-5"},ie=["value"],ue={for:"academicTermFilter",class:"block text-sm font-medium text-gray-700"},me={value:""},de=["value"],_e={key:0,class:"flex flex-wrap justify-start gap-4"},fe={class:"p-4 text-container"},ve={class:"text-2xl font-semibold"},ge={class:"short-introduction text-ink-gray-7 text-sm"},he={class:"academic-term text-right mt-auto"},pe={key:1,class:"flex flex-col items-center justify-center text-sm text-ink-gray-5 italic mt-48"},ye={class:"text-2xl font-medium mb-1"},we={__name:"Courses",setup(xe){var D;const i=M("$user");h(0);const{userResource:I}=K();console.log("User from inject:",i),console.log("User data:",i.data),console.log("User resource:",I),console.log("User resource data:",I.data);const f=u(()=>{var e;return((e=i.data)==null?void 0:e.is_student)||!1});u(()=>{var e;return((e=i.data)==null?void 0:e.is_moderator)||!1});const d=u(()=>{var e;return((e=i.data)==null?void 0:e.is_instructor)||!1});u(()=>{var e;return((e=i.data)==null?void 0:e.is_system_manager)||!1});const k=h(""),b=j({url:"frappe.client.get_value",params:{doctype:"Academic Term",fieldname:"title",filters:{iscurrent_acterm:1}},auto:!0,onSuccess:e=>{e!=null&&e.title?(k.value=e.title,console.log("Current Academic Term on success:",e.title),console.log("isInstructor:",d.value)):console.log("Current Academic Term: undefined")}});P(()=>{b.reload()}),p(()=>b.data,e=>{e!=null&&e.title?k.value=e.title:console.log("Current Academic Term: undefined")},{immediate:!0}),p(()=>k.value,e=>{e&&(n.academic_term=e,console.log("Updated filters.academic_term:",n.academic_term))});const n=S({course:"",academic_term:((D=b.data)==null?void 0:D.title)||""});console.log(n.academic_term);const B=u(()=>d.value?"seminary.seminary.utils.get_courses":"seminary.seminary.utils.get_courses_for_student"),R=u(()=>{var e;return f.value?{student:(e=i.data)==null?void 0:e.name}:{}}),C=j({url:B.value,params:R.value,onSuccess:e=>{console.log("Courses data:",e),V.rows=e.sort((s,a)=>s.academic_term<a.academic_term?-1:s.academic_term>a.academic_term?1:s.course<a.course?-1:s.course>a.course?1:0)},auto:!0}),V=S({rows:[],columns:[{label:__("Name"),key:"name",width:1},{label:__("Course"),key:"course",width:1},{label:__("Academic Term"),key:"academic_term",width:1},{label:__("Start Date"),key:"c_datestart",width:1},{label:__("End Date"),key:"c_dateend",width:1},{label:__("Image"),key:"course_image",width:1}]}),E=u(()=>{var e;return[...new Set((e=C.data)==null?void 0:e.map(s=>s.course))]}),F=u(()=>{var e;return[...new Set((e=C.data)==null?void 0:e.map(s=>s.academic_term))]}),v=u(()=>{var e;return((e=C.data)==null?void 0:e.filter(s=>(!n.course||s.course===n.course)&&(!n.academic_term||s.academic_term===n.academic_term)))||[]}),g=h({}),m=h([]);p(v,e=>{if(!e)return;const s=[];e.forEach(a=>{g.value[a.name]||(g.value[a.name]=z(a.name,i),console.log("Created instance for course:",a.name,g.value[a.name]));const t=g.value[a.name],T=t.countToDoItems;console.log("Starting if statement with count:",T,"for todoInstance:",t),t&&T>0&&s.push({course:a,count:T})}),console.log("List: ",s),m.value=s,console.log("Updated courseToDoList:",m.value)});let A=!0;return p(()=>v,e=>{if(A){A=!1;return}Array.isArray(e)||(console.error("newFilteredCourses is not an array:",e),e=[]);const s=e.map(a=>{const t=z(a.name,i);return{course:a,count:t.countToDoItems.value,hasItems:t.countToDoItems.value>0}}).filter(a=>a.hasItems);m.value=s,console.log("Updated courseToDoList:",m.value)},{immediate:!0}),(e,s)=>{const a=q("router-link");return r(),l(_,null,[o("header",W,[o("div",X,[o("h1",Y,c(f.value?e.__("My Courses"):e.__("All Courses")),1)])]),o("div",Z,[o("div",ee,[o("h2",te,c(e.__("To Do")),1),f.value||d.value?(r(),l("div",se,[(r(!0),l(_,null,x(m.value,t=>(r(),l("div",{key:t.course.name},[o("h3",oe,c(t.course.name),1),w(Q,{course:t.course.name,singleCourse:!1},null,8,["course"])]))),128)),m.value.length===0?(r(),l("div",ae,[w(U(O),{class:"size-20 mx-auto stroke-1 text-gray-500 mt-5"}),f.value&&!d.value?(r(),l("h3",re,c(e.__("Congrats! No assessments to do!")),1)):y("",!0),d.value?(r(),l("h3",le,c(e.__("Congrats! No assessments to grade!")),1)):y("",!0)])):y("",!0)])):y("",!0)]),o("div",ce,[o("div",ne,[o("div",null,[s[3]||(s[3]=o("label",{for:"courseFilter",class:"block text-sm font-medium text-gray-700"},"Course",-1)),L(o("select",{id:"courseFilter","onUpdate:modelValue":s[0]||(s[0]=t=>n.course=t),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[s[2]||(s[2]=o("option",{value:""},"All Courses",-1)),(r(!0),l(_,null,x(E.value,t=>(r(),l("option",{key:t,value:t},c(t),9,ie))),128))],512),[[N,n.course]])]),o("div",null,[o("label",ue,c(e.__("Academic Term")),1),L(o("select",{id:"academicTermFilter","onUpdate:modelValue":s[1]||(s[1]=t=>n.academic_term=t),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[o("option",me,c(e.__("All Terms")),1),(r(!0),l(_,null,x(F.value,t=>(r(),l("option",{key:t,value:t},c(t),9,de))),128))],512),[[N,n.academic_term]])])]),v.value.length?(r(),l("div",_e,[(r(!0),l(_,null,x(v.value,t=>(r(),$(a,{to:{name:"CourseDetail",params:{courseName:t.name}},key:t.name,class:"course_card"},{default:G(()=>[o("div",{class:"course-image",style:H({backgroundImage:`url(${encodeURI(t.course_image)})`})},null,4),o("div",fe,[o("h3",ve,c(t.course),1),o("div",ge,c(t.short_introduction),1),o("div",he,c(t.academic_term),1)])]),_:2},1032,["to"]))),128))])):(r(),l("div",pe,[w(U(J),{class:"size-10 mx-auto stroke-1 text-ink-gray-4"}),o("div",ye,[o("span",null,c(e.__("No courses found")),1)])]))])])],64)}}};export{we as default};
//# sourceMappingURL=Courses-CDocSyrR.js.map
