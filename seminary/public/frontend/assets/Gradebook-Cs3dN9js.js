var Y=Object.defineProperty,O=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var B=(u,l,o)=>l in u?Y(u,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[l]=o,I=(u,l)=>{for(var o in l||(l={}))J.call(l,o)&&B(u,o,l[o]);if(G)for(var o of G(l))K.call(l,o)&&B(u,o,l[o]);return u},E=(u,l)=>O(u,Z(l));var F=(u,l,o)=>new Promise((h,y)=>{var b=m=>{try{x(o.next(m))}catch(k){y(k)}},f=m=>{try{x(o.throw(m))}catch(k){y(k)}},x=m=>m.done?h(m.value):Promise.resolve(m.value).then(b,f);x((o=o.apply(u,l)).next())});import{s as W,Z as X,r as $,c as R,l as T,n as ee,b as te,d as n,o as c,f as d,j as S,e as g,t as _,F as V,k as z,g as D,w as v,A,h as w,$ as q,O as ae,C as M}from"./index-CVWiL_Ou.js";import{_ as re}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-4m6SQeM8.js";import{c as se}from"./call-DjkLykxt.js";import{S as oe}from"./send-C2BpWnyu.js";/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=W("SaveIcon",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),le={class:"gradebook"},ne={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ue={class:"text-2xl font-bold mt-5 mb-4"},ie={key:0,class:"text-gray-500 text-center mt-4"},de={key:1,class:"overflow-auto"},_e={class:"table-auto border-collapse border border-gray-300 w-full"},me={key:0,class:"block text-gray-500 text-sm"},pe={key:0,class:"block text-gray-500 text-sm"},ye={key:0,class:"block text-gray-500 text-sm"},be={key:3},fe={key:0,class:"block text-gray-500 text-sm"},ge={class:"border border-gray-300 px-4 py-2 relative"},he=["href"],xe={key:0},ke=["value","onInput"],ve={key:1},we=["value","onInput"],Ie={__name:"Gradebook",props:{courseName:{type:String,required:!0}},setup(u){const l=X(),o=u,h=$([]),y=$([]),b=$({}),f=R({url:"seminary.seminary.utils.get_course_details",cache:["course",o.courseName],params:{course:o.courseName},auto:!0}),x=R({url:"seminary.seminary.utils.get_gradebook",cache:["gradebook",o.courseName],params:{course:o.courseName},auto:!0,onSuccess(a){var t;h.value=a.map(r=>E(I({},r),{assessments:r.assessments.map(s=>E(I({},s),{rawscore_card:s.rawscore_card||0,actualextrapt_card:s.actualextrapt_card||0}))})),y.value=((t=a[0])==null?void 0:t.assessments)||[]},onError(a){console.error("Error loading gradebook:",a)}}),m=T(()=>[...y.value].sort((a,t)=>{if(!a.due_date&&t.due_date)return 1;if(a.due_date&&!t.due_date)return-1;if(a.due_date&&t.due_date){const r=new Date(a.due_date),s=new Date(t.due_date);if(r<s)return-1;if(r>s)return 1}return a.title.localeCompare(t.title)})),k=(a,t)=>{const r=a.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return r?r.actualextrapt_card:0},j=(a,t)=>{const r=a.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return r?r.rawscore_card:0},H=(a,t,r)=>{const s=a.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);s&&(s.actualextrapt_card=parseFloat(r)||0,b.value[s.name]=!0)},L=(a,t,r)=>{const s=a.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);s&&(s.rawscore_card=parseFloat(r)||0,b.value[s.name]=!0)},P=(a,t)=>{const r=a.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return r&&b.value[r.name]},Q=(a,t)=>F(this,null,function*(){var s;const r=a.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);if(r)try{const i=t.extracredit_scac?"actualextrapt_card":"rawscore_card",e=t.extracredit_scac?r.actualextrapt_card:r.rawscore_card;console.log("Saving cell:",r.name,"with value:",e),yield se("frappe.client.set_value",{doctype:"Course Assess Results Detail",name:r.name,fieldname:i,value:e}),delete b.value[r.name],M.success(__("Grade saved successfully"))}catch(i){console.error("Error saving cell:",i),M.error(((s=err.messages)==null?void 0:s[0])||err)}});ee(()=>l.fullPath,(a,t)=>{x.reload()},{immediate:!0});const C=a=>{if(!a)return"";const t=new Date(a);return isNaN(t)?"":new Intl.DateTimeFormat(void 0,{day:"2-digit",month:"short"}).format(t)},U=T(()=>{var t;let a=[{label:"Courses",route:{name:"Courses"}}];return a.push({label:(t=f==null?void 0:f.data)==null?void 0:t.course,route:{name:"CourseDetail",params:{courseName:o.courseName}}}),a.push({label:"Gradebook",route:{name:"Gradebook",params:{courseName:o.courseName}}}),a});return(a,t)=>{var s,i;const r=te("router-link");return c(),n("div",le,[d("header",ne,[S(g(re),{class:"h-7",items:U.value},null,8,["items"])]),d("h1",ue,"Gradebook for "+_((i=(s=g(f))==null?void 0:s.data)==null?void 0:i.course),1),h.value.length===0?(c(),n("div",ie," There are no students enrolled in this course. ")):(c(),n("div",de,[d("table",_e,[d("thead",null,[d("tr",null,[t[0]||(t[0]=d("th",{class:"border border-gray-300 px-4 py-2 bg-gray-100"},"Student",-1)),(c(!0),n(V,null,z(m.value,e=>(c(),n("th",{key:e.assessment_criteria,class:"border border-gray-300 px-4 py-2 bg-gray-100"},[e.type==="Exam"?(c(),D(r,{key:0,to:{name:"ExamSubmissionCS",params:{courseName:o.courseName,examID:e.exam}},class:"underline"},{default:v(()=>[A(_(e.title)+" ",1),e.due_date?(c(),n("span",me," ("+_(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):e.type==="Assignment"?(c(),D(r,{key:1,to:{name:"AssignmentSubmissionCS",params:{courseName:o.courseName,assignmentID:e.assignment}},class:"underline"},{default:v(()=>[A(_(e.title)+" ",1),e.due_date?(c(),n("span",pe," ("+_(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):e.type==="Quiz"?(c(),D(r,{key:2,to:{name:"QuizSubmissionCS",params:{courseName:o.courseName,quizID:e.quiz}},class:"underline"},{default:v(()=>[A(_(e.title)+" ",1),e.due_date?(c(),n("span",ye," ("+_(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):(c(),n("span",be,[A(_(e.title)+" ",1),e.due_date?(c(),n("span",fe," ("+_(C(e.due_date))+") ",1)):w("",!0)]))]))),128))])]),d("tbody",null,[(c(!0),n(V,null,z(h.value,e=>(c(),n("tr",{key:e.student_card},[d("td",ge,[S(g(q),{text:`Program: ${e.program_std_scr}
Audit: ${e.audit_bool?"Yes":"No"} 
 Active: ${e.active?"Yes":"No"}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:v(()=>[d("span",null,_(e.stuname_roster),1)]),_:2},1032,["text"]),S(g(q),{text:`Send Email to ${e.stuname_roster}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:v(()=>[d("a",{href:`mailto:${e.stuemail_rc}`},[S(g(oe),{class:"absolute right-2 top-2 text-blue-300 cursor-pointer"})],8,he)]),_:2},1032,["text"])]),(c(!0),n(V,null,z(y.value,p=>(c(),n("td",{key:p.assessment_criteria,class:ae([p.extracredit_scac?"bg-blue-100":"","border border-gray-300 px-4 py-2 text-center relative"])},[p.extracredit_scac?(c(),n("div",xe,[d("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:k(e,p),onInput:N=>H(e,p,N.target.value)},null,40,ke)])):(c(),n("div",ve,[d("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:j(e,p),onInput:N=>L(e,p,N.target.value)},null,40,we)])),P(e,p)?(c(),D(g(ce),{key:2,class:"absolute right-12 top-4 text-blue-300",onClick:N=>Q(e,p)},null,8,["onClick"])):w("",!0)],2))),128))]))),128))])])]))])}}};export{Ie as default};
//# sourceMappingURL=Gradebook-Cs3dN9js.js.map
