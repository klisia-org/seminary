{"version":3,"file":"DiscussionActivityForm-Yf_7JwA0.js","sources":["../../../../frontend/src/pages/DiscussionActivityForm.vue"],"sourcesContent":["<template>\n\t<header class=\"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\">\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<div class=\"space-x-2\">\n\n\t\t\t<router-link v-if=\"discussionDetails.data?.name\" :to=\"{\n\t\t\t\tname: 'DiscussionActivitySubmissionList',\n\t\t\t\tparams: {\n\t\t\t\t\tdiscussionID: discussionDetails.data.name,\n\t\t\t\t},\n\t\t\t}\">\n\t\t\t\t<Button>\n\t\t\t\t\t{{ __('Submission List') }}\n\t\t\t\t</Button>\n\t\t\t</router-link>\n\t\t\t<Button variant=\"solid\" @click=\"submitDiscussion()\">\n\t\t\t\t{{ __('Save') }}\n\t\t\t</Button>\n\t\t</div>\n\t</header>\n\t<div class=\"w-3/4 mx-auto py-5\">\n\t\t<!-- Details -->\n\t\t<div class=\"mb-8\">\n\t\t\t<div class=\"font-semibold mb-4\">\n\t\t\t\t{{ __('Details') }}\n\t\t\t</div>\n\t\t\t<FormControl v-model=\"discussion.discussion_name\" :label=\"discussionDetails.data?.discussion_name\n\t\t\t\t\t? __('Title')\n\t\t\t\t\t: __('Enter a title and save the discussion to proceed')\n\t\t\t\t\" :required=\"true\" />\n\t\t\t<br />\n\t\t\t<Link v-model=\"discussion.course\" doctype=\"Course\"\n\t\t\t\t:label=\"__('Course where this discussion will be used - you may reuse this discussion in other scheduled courses')\"\n\t\t\t\t:placeholder=\"__('Select a course')\" :required=\"true\" />\n\n\n\n\t\t\t<!-- Settings -->\n\t\t\t<div class=\"mb-8\">\n\t\t\t\t<div class=\"font-semibold mb-4 mt-4\">\n\t\t\t\t\t{{ __('Settings') }}\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class=\"checkbox-container\">\n\t\t\t\t\t<FormControl v-model=\"discussion.use_studentgroup\" type=\"checkbox\"\n\t\t\t\t\t\t:label=\"__('Check this if you want discussion to be done in student groups. Otherwise, all students will participate in the same thread.')\" />\n\t\t\t\t\t<FormControl v-model=\"discussion.post_before\" type=\"checkbox\"\n\t\t\t\t\t\t:label=\"__('Check this if you want students to post before seeing other posts.')\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<!-- Prompt -->\n\t\t\t<!-- <TextEditor\n\t\t\t\t:content=\"discussion.prompt || ''\"\n\t\t\t\t@change=\"(val) => (discussion.prompt = val)\"\n\t\t\t\t:editable=\"true\"\n\t\t\t\t:fixedMenu=\"true\"\n                :placeholder=\"__('Enter prompt for the discussion activity...')\"\n\t\t\t\teditorClass=\"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]\"\n\t\t\t/> -->\n\t\t\t<label for=\"discussion-prompt\" class=\"block text-lg font-medium text-gray-700 mb-4\">\n\t\t\t\t{{ __('Discussion Prompt') }}\n\t\t\t</label>\n\t\t\t<textarea id=\"discussion-prompt\" v-model=\"discussion.prompt\"\n\t\t\t\t:placeholder=\"__('Enter a prompt for the discussion.')\"\n\t\t\t\tclass=\"w-full border border-gray-300 rounded-md p-2 min-h-[7rem]\"></textarea>\n\n\n\n\n\t\t</div>\n\t</div>\n\n\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tcreateResource,\n\tFormControl,\n\tButton,\n\tTextEditor,\n\ttoast,\n} from 'frappe-ui'\nimport {\n\tcomputed,\n\treactive,\n\tref,\n\tonMounted,\n\tinject,\n\tonBeforeUnmount,\n\twatch,\n} from 'vue'\n\nimport { updateDocumentTitle } from '@/utils'\nimport { useRouter } from 'vue-router'\nimport Link from '@/components/Controls/Link.vue'\n\n\n\n\nconst user = inject('$user')\nconst router = useRouter()\n\nconst props = defineProps({\n\tdiscussionID: {\n\t\ttype: String,\n\t\trequired: false,\n\t},\n})\n\nconst discussion = reactive({\n\tdiscussion_name: '',\n\tcourse: '',\n\tpost_before: false,\n\tuse_studentgroup: false,\n\tprompt: '',\n})\n\n\nonMounted(() => {\n\tif (discussionDetails.data) {\n\t\tdiscussion.discussion_name = discussionDetails.data.discussion_name || '';\n\t\tdiscussion.course = discussionDetails.data.course || '';\n\t\tdiscussion.post_before = discussionDetails.data.post_before || false;\n\t\tdiscussion.use_studentgroup = discussionDetails.data.use_studentgroup || false;\n\t\tdiscussion.prompt = discussionDetails.data.prompt || '';\n\t}\n\n\n\tif (\n\t\tprops.discussionID == 'new' &&\n\t\t!user.data?.is_moderator &&\n\t\t!user.data?.is_instructor\n\t) {\n\t\trouter.push({ name: 'Courses' })\n\t}\n\n\tif (props.discussionID !== 'new') {\n\t\tdiscussionDetails.reload()\n\t}\n\twindow.addEventListener('keydown', keyboardShortcut)\n})\n\nconst keyboardShortcut = (e) => {\n\tif (e.key === 's' && (e.ctrlKey || e.metaKey)) {\n\t\tsubmitExam()\n\t\te.preventDefault()\n\t}\n}\n\nonBeforeUnmount(() => {\n\twindow.removeEventListener('keydown', keyboardShortcut)\n})\n\nwatch(\n\t() => props.discussionID !== 'new',\n\t(newVal) => {\n\t\tif (newVal) {\n\t\t\tdiscussionDetails.reload()\n\n\t\t}\n\t}\n)\n\nconst discussionDetails = createResource({\n\turl: 'frappe.client.get',\n\tmakeParams(values) {\n\t\treturn { doctype: 'Discussion Activity', name: props.discussionID }\n\t},\n\tauto: false,\n\tonSuccess(data) {\n\t\tObject.keys(data).forEach((key) => {\n\t\t\tif (Object.hasOwn(discussion, key)) discussion[key] = data[key]\n\t\t})\n\n\t\tlet checkboxes = [\n\t\t\t'post_before',\n\t\t\t'use_studentgroup',\n\t\t]\n\t\tfor (let idx in checkboxes) {\n\t\t\tlet key = checkboxes[idx]\n\t\t\tdiscussion[key] = discussion[key] ? true : false\n\t\t}\n\t},\n})\n\nconst discussionCreate = createResource({\n\turl: 'frappe.client.insert',\n\tauto: false,\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoc: {\n\t\t\t\tdoctype: 'Discussion Activity',\n\t\t\t\t...discussion,\n\t\t\t},\n\t\t}\n\t},\n})\n\nconst discussionUpdate = createResource({\n\turl: 'frappe.client.set_value',\n\tauto: false,\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoctype: 'Discussion Activity',\n\t\t\tname: values.discussionID,\n\t\t\tfieldname: {\n\n\t\t\t\t...discussion,\n\t\t\t},\n\t\t}\n\t},\n})\n\nconst submitDiscussion = () => {\n\tif (discussionDetails.data?.name) updateDiscussion()\n\telse createDiscussion()\n}\n\nconst createDiscussion = () => {\n\tdiscussionCreate.submit(\n\t\t{},\n\t\t{\n\t\t\tonSuccess(data) {\n\t\t\t\ttoast.success(__('Discussion created successfully'));\n\t\t\t\trouter.push({\n\t\t\t\t\tname: 'DiscussionActivityForm',\n\t\t\t\t\tparams: { discussionID: data.name },\n\t\t\t\t})\n\t\t\t},\n\t\t\tonError(err) {\n\t\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst updateDiscussion = () => {\n\tdiscussionUpdate.submit(\n\t\t{ discussionID: discussionDetails.data?.name },\n\t\t{\n\t\t\tonSuccess(data) {\n\n\t\t\t\ttoast.success(__('Discussion updated successfully'));\n\t\t\t},\n\t\t\tonError(err) {\n\t\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t\t},\n\t\t}\n\t)\n}\n\n\n\nconst breadcrumbs = computed(() => {\n\tlet crumbs = [\n\t\t{\n\t\t\tlabel: __('Discussion Activity'),\n\t\t\troute: {\n\t\t\t\tname: 'DiscussionActivityForm',\n\t\t\t},\n\t\t},\n\t]\n\t/* if (discussionDetails.data) {\n\t\tcrumbs.push({\n\t\t\tlabel: discussion.discussion_name,\n\t\t})\n\t} */\n\tcrumbs.push({\n\t\tlabel: props.discussionID == 'new' ? __('New Discussion') : discussion.discussion_name,\n\t\troute: { name: 'DiscussionActivityForm', params: { discussionID: props.discussionID } },\n\t})\n\treturn crumbs\n})\n\nconst pageMeta = computed(() => {\n\treturn {\n\t\ttitle: props.discussionID == 'new' ? __('New Discussion') : discussion.discussion_name,\n\t\tdescription: __('Form to create and edit discussions'),\n\t}\n})\n\nupdateDocumentTitle(pageMeta)\n</script>\n\n<style scoped>\n.checkbox-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 0.5rem;\n}\n</style>\n"],"names":["user","inject","router","useRouter","props","__props","discussion","reactive","onMounted","discussionDetails","_a","_b","keyboardShortcut","e","onBeforeUnmount","watch","newVal","createResource","values","data","key","checkboxes","idx","discussionCreate","__spreadValues","discussionUpdate","submitDiscussion","updateDiscussion","createDiscussion","toast","err","breadcrumbs","computed","crumbs","pageMeta","updateDocumentTitle","_createElementVNode","_hoisted_1","_createVNode","_unref","Breadcrumbs","_hoisted_2","_createBlock","_component_router_link","Button","__","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","FormControl","_cache","$event","Link","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_vModelText"],"mappings":"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"}