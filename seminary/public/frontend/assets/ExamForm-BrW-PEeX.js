var ie=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var Z=(f,r,u)=>r in f?ie(f,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):f[r]=u,h=(f,r)=>{for(var u in r||(r={}))ue.call(r,u)&&Z(f,u,r[u]);if(Y)for(var u of Y(r))re.call(r,u)&&Z(f,u,r[u]);return f};import{c as w,u as ee,y as g,D as de,v as y,w as me,j as Q,l as pe,m as ce,G as _e,n as fe,o as be,H as ve,t as xe}from"./frappe-ui-BzEkZ7NZ.js";import{U as ye,V as te,r as K,am as O,I as ne,c as P,a as V,b as c,w as p,g as n,t as q,z as D,L as se,cd as ae,D as b,e as i,u as o,bk as qe,F as we,av as ke,bg as ge,a8 as he,C as I,cc as Ve,H,O as oe,bW as De,cb as Ee}from"./vendor-IWZbD1HA.js";import{_ as le}from"./Link-DmVUQNbJ.js";import{u as Ce}from"./index-DYgOoCE_.js";import{e as $}from"./exam-CeEjLNyB.js";import"./index-B0k3CMx6.js";/* empty css                                                                     */const Qe={class:"open-question-dialog space-y-4 max-h-[70vh] overflow-y-auto"},$e={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},Se={class:"flex items-center space-x-2"},Ue={for:"existing",class:"cursor-pointer"},Ie={class:"flex items-center space-x-2"},Pe={for:"new",class:"cursor-pointer"},Oe={key:1,class:"space-y-2"},Me={class:"block text-xs text-ink-gray-5 mb-1"},Te={class:"block text-xs text-ink-gray-5 mb-1"},Le={key:2,class:"space-y-2"},Ae={__name:"OpenQuestion",props:ye({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},exam:{},examModifiers:{}}),emits:["update:modelValue","update:exam"],setup(f){const r=te(f,"modelValue"),u=te(f,"exam"),_=K("new"),v=K(!1),m=O({question:"",points:0}),s=O({question:"",explanation:"",points:0}),x=f,d=w({url:"frappe.client.get",makeParams(){return{doctype:"Open Question",name:x.questionDetail.question}},auto:!1,onSuccess(e){var t,a;v.value=!0,s.question=e.question||"",s.explanation=e.explanation||"",s.points=(a=(t=x.questionDetail.points)!=null?t:e.points)!=null?a:0}});ne(r,e=>{e?M():(E(),v.value=!1,_.value="new")});const M=()=>{var e;x.questionDetail.question?(v.value=!0,_.value="new",s.points=(e=x.questionDetail.points)!=null?e:0,d.fetch()):(v.value=!1,E(),_.value="new")},E=()=>{s.question="",s.explanation="",s.points=0,m.question="",m.points=0},S=w({url:"frappe.client.insert",makeParams(e){return{doc:h({doctype:"Exam Question",parent:u.value.data.name,parentfield:"questions",parenttype:"Exam Activity",points:e.points},e)}}}),T=w({url:"frappe.client.insert",makeParams(e){return{doc:h({doctype:"Open Question"},s)}}}),L=e=>{var t;(t=x.questionDetail)!=null&&t.question?j(e):A(e)},A=e=>{_.value=="existing"?C({question:m.question,points:m.points},e):T.submit({},{onSuccess(t){C({question:t.name,points:s.points},e)},onError(t){var a;y.error(((a=t.messages)==null?void 0:a[0])||t)}})},C=(e,t)=>{S.submit(h({},e),{onSuccess(){r.value=!1,y.success(__("Question added successfully")),u.value.reload(),t()},onError(a){var k;y.error(((k=a.messages)==null?void 0:k[0])||a),t()}})},U=w({url:"frappe.client.set_value",auto:!1,makeParams(e){var t;return{doctype:"Open Question",name:(t=d.data)==null?void 0:t.name,fieldname:h({},s)}}}),F=w({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"Exam Question",name:x.questionDetail.name,fieldname:{points:s.points}}}}),j=e=>{U.submit({},{onSuccess(){F.submit({},{onSuccess(){r.value=!1,y.success(__("Question updated successfully")),u.value.reload(),e()}})},onError(t){var a;y.error(((a=t.messages)==null?void 0:a[0])||t)}})},N=P(()=>({title:__(x.title),size:"xl",actions:[{label:__("Submit"),variant:"solid",onClick:e=>{L(e)}},{label:__("Cancel"),variant:"text",onClick:e=>R(e)}]})),R=e=>{r.value=!1,e==null||e(),E(),v.value=!1,_.value="new"};return(e,t)=>(c(),V(o(de),{modelValue:r.value,"onUpdate:modelValue":t[7]||(t[7]=a=>r.value=a),options:N.value,disableOutsideClickToClose:!0},{"body-content":p(()=>[n("div",Qe,[v.value?D("",!0):(c(),q("div",$e,[n("div",Se,[se(n("input",{type:"radio",id:"existing",value:"existing","onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),class:"w-3 h-3 cursor-pointer"},null,512),[[ae,_.value]]),n("label",Ue,b(e.__("Add an existing question")),1)]),n("div",Ie,[se(n("input",{type:"radio",id:"new",value:"new","onUpdate:modelValue":t[1]||(t[1]=a=>_.value=a),class:"w-3 h-3 cursor-pointer"},null,512),[[ae,_.value]]),n("label",Pe,b(e.__("Create a new question")),1)])])),_.value=="new"||v.value?(c(),q("div",Oe,[n("div",null,[n("label",Me,b(e.__("Question")),1),i(o(ee),{content:s.question,onChange:t[2]||(t[2]=a=>s.question=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),n("div",null,[n("label",Te,b(e.__("Explanation for this Question")),1),i(o(ee),{content:s.explanation,onChange:t[3]||(t[3]=a=>s.explanation=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),i(o(g),{modelValue:s.points,"onUpdate:modelValue":t[4]||(t[4]=a=>s.points=a),label:e.__("Points"),type:"number"},null,8,["modelValue","label"])])):_.value=="existing"?(c(),q("div",Le,[i(le,{modelValue:m.question,"onUpdate:modelValue":t[5]||(t[5]=a=>m.question=a),label:e.__("Select a question"),doctype:"Open Question"},null,8,["modelValue","label"]),i(o(g),{modelValue:m.points,"onUpdate:modelValue":t[6]||(t[6]=a=>m.points=a),label:e.__("Points"),type:"number"},null,8,["modelValue","label"])])):D("",!0)])]),_:1},8,["modelValue","options"]))}},Fe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},je={class:"space-x-2"},Ne={class:"w-3/4 mx-auto py-5"},Re={class:"mb-8"},Be={class:"font-semibold mb-4"},ze={key:0},He={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Ke={class:"mb-8"},Ge={class:"font-semibold mb-4"},We={class:"mb-8"},Je={class:"font-semibold mb-4"},Xe={class:"grid grid-cols-3"},Ye={class:"flex items-center justify-between mb-4"},Ze={class:"font-semibold"},et=["innerHTML"],tt={key:1,class:"text-xs"},st={class:"flex gap-2"},mt={__name:"ExamForm",props:{examID:{type:String,required:!1}},setup(f){const r=K(!1),u=O({question:"",points:0,name:""}),_=qe("$user"),v=we(),m=f,s=O({title:"",course:"",total_points:0,duration:0,qbyquestion:!1,limit_questions_to:0,show_answers:!0,shuffle_questions:!1,questions:[]});ke(()=>{var e,t;m.examID=="new"&&!((e=_.data)!=null&&e.is_moderator)&&!((t=_.data)!=null&&t.is_instructor)&&v.push({name:"Courses"}),m.examID==="new"&&($.prefillData.title&&(s.title=$.prefillData.title),$.prefillData.course&&(s.course=$.prefillData.course)),m.examID!=="new"&&d.reload(),window.addEventListener("keydown",x)});const x=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(S(),e.preventDefault())};ge(()=>{window.removeEventListener("keydown",x)}),ne(()=>m.examID!=="new",e=>{e&&(d.reload(),$.clearPrefillData())});const d=w({url:"frappe.client.get",makeParams(e){return{doctype:"Exam Activity",name:m.examID}},auto:!1,onSuccess(e){Object.keys(e).forEach(a=>{Object.hasOwn(s,a)&&(s[a]=e[a])});let t=["show_answers","show_submission_history","shuffle_questions"];for(let a in t){let k=t[a];s[k]=!!s[k]}}}),M=w({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:h({doctype:"Exam Activity"},s)}}}),E=w({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"Exam Activity",name:e.examID,fieldname:h({total_points:A()},s)}}}),S=()=>{var e;(e=d.data)!=null&&e.name?L():T()},T=()=>{M.submit({},{onSuccess(e){y.success(__("Course created successfully")),v.push({name:"ExamForm",params:{examID:e.name}})},onError(e){var t;y.error(((t=e.messages)==null?void 0:t[0])||e)}})},L=()=>{var e;E.submit({examID:(e=d.data)==null?void 0:e.name},{onSuccess(t){s.total_points=t.total_points,y.success(__("Exam updated successfully"))},onError(t){var a;y.error(((a=t.messages)==null?void 0:a[0])||t)}})},A=()=>{let e=0;return s.limit_questions_to&&s.questions.length>0?s.questions[0].points*s.limit_questions_to:(s.questions.forEach(t=>{e+=t.points}),e)},C=P(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Points"),key:"points",width:"5rem"}]),U=(e=null)=>{e?(u.question=e.question,u.points=e.points,u.name=e.name):(u.question="",u.points=0,u.name=""),r.value=!0},F=w({url:"seminary.seminary.api.delete_documents",makeParams(e){return{doctype:"Exam Question",documents:e.questions}}}),j=(e,t)=>{F.submit({questions:Array.from(e)},{onSuccess(){y.success(__("Questions deleted successfully")),d.reload(),t()}})},N=P(()=>{var t;let e=[{label:__("Exams"),route:{name:"Exams"}}];return e.push({label:m.examID=="new"?__("New Exam"):(t=d.data)==null?void 0:t.title,route:{name:"ExamForm",params:{examID:m.examID}}}),e}),R=P(()=>{var e;return{title:m.examID=="new"?__("New Exam"):(e=d.data)==null?void 0:e.title,description:__("Form to create and edit exams")}});return Ce(R),(e,t)=>{var k,G,W,J;const a=he("router-link");return c(),q(H,null,[n("header",Fe,[i(o(me),{items:N.value},null,8,["items"]),n("div",je,[(k=o(d).data)!=null&&k.name?(c(),V(a,{key:0,to:{name:"ExamPage",params:{examID:o(d).data.name}}},{default:p(()=>[i(o(Q),null,{default:p(()=>[I(b(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):D("",!0),(G=o(d).data)!=null&&G.name?(c(),V(a,{key:1,to:{name:"ExamSubmissionList",params:{examID:o(d).data.name}}},{default:p(()=>[i(o(Q),null,{default:p(()=>[I(b(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):D("",!0),i(o(Q),{variant:"solid",onClick:t[0]||(t[0]=l=>S())},{default:p(()=>[I(b(e.__("Save")),1)]),_:1})])]),n("div",Ne,[n("div",Re,[n("div",Be,b(e.__("Details")),1),i(o(g),{modelValue:s.title,"onUpdate:modelValue":t[1]||(t[1]=l=>s.title=l),label:(W=o(d).data)!=null&&W.name?e.__("Title"):e.__("Enter a title and save the exam to proceed"),required:!0},null,8,["modelValue","label"]),t[11]||(t[11]=n("br",null,null,-1)),i(le,{modelValue:s.course,"onUpdate:modelValue":t[2]||(t[2]=l=>s.course=l),doctype:"Course",label:e.__("Course where this exam will be used - you may reuse this exam in other scheduled courses"),placeholder:e.__("Select a course"),required:!0},null,8,["modelValue","label","placeholder"]),(J=o(d).data)!=null&&J.name?(c(),q("div",ze,[n("div",He,[i(o(g),{type:"number",modelValue:s.duration,"onUpdate:modelValue":t[3]||(t[3]=l=>s.duration=l),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),i(o(g),{modelValue:s.total_points,"onUpdate:modelValue":t[4]||(t[4]=l=>s.total_points=l),label:e.__("Total Points"),disabled:""},null,8,["modelValue","label"])]),n("div",Ke,[n("div",Ge,b(e.__("Settings")),1),i(o(g),{modelValue:s.qbyquestion,"onUpdate:modelValue":t[5]||(t[5]=l=>s.qbyquestion=l),type:"checkbox",label:e.__("Force student to answer a question before moving on? Each question will have its own page and a next button")},null,8,["modelValue","label"])]),n("div",We,[n("div",Je,b(e.__("Shuffle Settings")),1),n("div",Xe,[i(o(g),{modelValue:s.shuffle_questions,"onUpdate:modelValue":t[6]||(t[6]=l=>s.shuffle_questions=l),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),s.shuffle_questions?(c(),V(o(g),{key:0,modelValue:s.limit_questions_to,"onUpdate:modelValue":t[7]||(t[7]=l=>s.limit_questions_to=l),label:e.__("Limit Questions To (on shuffle)")},null,8,["modelValue","label"])):D("",!0)])]),n("div",null,[n("div",Ye,[n("div",Ze,b(e.__("Questions")),1),i(o(Q),{onClick:t[8]||(t[8]=l=>U())},{prefix:p(()=>[i(o(Ve),{class:"w-4 h-4"})]),default:p(()=>[I(" "+b(e.__("New Question")),1)]),_:1})]),i(o(xe),{columns:C.value,rows:s.questions,"row-key":"name",options:{showTooltip:!1}},{default:p(()=>[i(o(pe),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:p(()=>[(c(!0),q(H,null,oe(C.value,l=>(c(),V(o(ce),{item:l},null,8,["item"]))),256))]),_:1}),i(o(_e),null,{default:p(()=>[(c(!0),q(H,null,oe(s.questions,l=>(c(),V(o(fe),{row:l,onClick:B=>U(l),class:"cursor-pointer"},{default:p(({idx:B,column:X,item:z})=>[i(o(be),{item:z},{default:p(()=>[X.key=="question_detail"?(c(),q("div",{key:0,class:"text-xs truncate h-4",innerHTML:z},null,8,et)):(c(),q("div",tt,b(z),1))]),_:2},1032,["item"])]),_:1},8,["row","onClick"]))),256))]),_:1}),i(o(ve),null,{actions:p(({unselectAll:l,selections:B})=>[n("div",st,[i(o(Q),{variant:"ghost",onClick:X=>j(B,l)},{default:p(()=>[i(o(De),{class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):D("",!0)])]),i(Ae,{modelValue:r.value,"onUpdate:modelValue":t[9]||(t[9]=l=>r.value=l),questionDetail:u,exam:o(d),"onUpdate:exam":t[10]||(t[10]=l=>Ee(d)?d.value=l:null),title:u.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","exam","title"])],64)}}};export{mt as default};
//# sourceMappingURL=ExamForm-BrW-PEeX.js.map
