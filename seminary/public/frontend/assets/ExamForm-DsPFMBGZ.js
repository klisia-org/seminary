var ie=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var Z=(b,m,d)=>m in b?ie(b,m,{enumerable:!0,configurable:!0,writable:!0,value:d}):b[m]=d,D=(b,m)=>{for(var d in m||(m={}))ue.call(m,d)&&Z(b,d,m[d]);if(Y)for(var d of Y(m))re.call(m,d)&&Z(b,d,m[d]);return b};import{y as de,z as ee,r as K,a as A,c as k,n as ne,l as T,g as E,o as f,w as _,f as l,d as g,h as Q,p as te,ad as se,t as v,j as r,e as a,D as me,C as w,i as pe,x as ce,m as _e,a0 as fe,b as be,_ as S,A as O,F as H,k as oe,a8 as ve}from"./index-CVWiL_Ou.js";import{_ as xe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-4m6SQeM8.js";import{a as h}from"./FormControl.vue_vue_type_script_setup_true_lang-ClvexRF6.js";import{_ as ye,a as qe,e as we,b as ge,c as ke,f as he,d as Ve}from"./ListView-T6A9B2oi.js";import{_ as ae}from"./TextEditor.vue_vue_type_script_setup_true_lang-DxuhnEcI.js";import{_ as le}from"./Link-D0cze3Hl.js";import{u as De,T as Ee}from"./index-BTqjjO0a.js";import{e as C}from"./exam-BBaWgMBr.js";import{P as Qe}from"./plus-C5d9m71e.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-9SPyKoxA.js";import"./Badge.vue_vue_type_script_setup_true_lang-DMvSTLfT.js";import"./call-DjkLykxt.js";import"./pencil-W75E9_mf.js";import"./FolderPlugin.vue_vue_type_style_index_0_scoped_b4e3a9b2_lang-_2hGWfCr.js";import"./book-open-check-yBkpgSvd.js";const $e={class:"space-y-4"},Se={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},Ce={class:"flex items-center space-x-2"},Ue={for:"existing",class:"cursor-pointer"},Pe={class:"flex items-center space-x-2"},Ie={for:"new",class:"cursor-pointer"},Me={key:1,class:"space-y-2"},Oe={class:"block text-xs text-ink-gray-5 mb-1"},Te={class:"block text-xs text-ink-gray-5 mb-1"},Ae={key:2,class:"space-y-2"},Le={__name:"OpenQuestion",props:de({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},exam:{},examModifiers:{}}),emits:["update:modelValue","update:exam"],setup(b){const m=ee(b,"modelValue"),d=ee(b,"exam"),x=K(null),V=K(!1),c=A({question:"",points:0}),t=A({question:"",points:0}),y=b,p=k({url:"frappe.client.get",makeParams(){return{doctype:"Open Question",name:y.questionDetail.question}},auto:!1,onSuccess(n){V.value=!0,t.points=y.questionDetail.points}});ne(m,()=>{m.value&&(V.value=!1,y.questionDetail.question?p.fetch():(t.question="",t.points=0,c.question="",c.points=0,x.value=null),y.questionDetail.points&&(t.points=y.questionDetail.points))});const L=k({url:"frappe.client.insert",makeParams(n){return{doc:D({doctype:"Exam Question",parent:d.value.data.name,parentfield:"questions",parenttype:"Exam Activity",points:n.points},n)}}}),R=k({url:"frappe.client.insert",makeParams(n){return{doc:D({doctype:"Open Question"},t)}}}),U=n=>{var o;(o=y.questionDetail)!=null&&o.question?M(n):j(n)},j=n=>{x.value=="existing"?P({question:c.question,points:c.points},n):R.submit({},{onSuccess(o){P({question:o.name,points:t.points},n)},onError(o){var i;w.error(((i=o.messages)==null?void 0:i[0])||o)}})},P=(n,o)=>{console.log("Submitting Question Row:",n),L.submit(D({},n),{onSuccess(){m.value=!1,w.success(__("Question added successfully")),d.value.reload(),o()},onError(i){var e;w.error(((e=i.messages)==null?void 0:e[0])||i),o()}})},F=k({url:"frappe.client.set_value",auto:!1,makeParams(n){var o;return{doctype:"Open Question",name:(o=p.data)==null?void 0:o.name,fieldname:D({},t)}}}),I=k({url:"frappe.client.set_value",auto:!1,makeParams(n){return{doctype:"Exam Question",name:y.questionDetail.name,fieldname:{points:t.points}}}}),M=n=>{F.submit({},{onSuccess(){I.submit({},{onSuccess(){m.value=!1,w.success(__("Question updated successfully")),d.value.reload(),n()}})},onError(o){var i;w.error(((i=o.messages)==null?void 0:i[0])||o)}})},N=T(()=>({title:__(y.title),size:"xl",actions:[{label:__("Submit"),variant:"solid",onClick:n=>{U(n)}}]}));return(n,o)=>(f(),E(a(me),{modelValue:m.value,"onUpdate:modelValue":o[7]||(o[7]=i=>m.value=i),options:N.value},{"body-content":_(()=>[l("div",$e,[V.value?Q("",!0):(f(),g("div",Se,[l("div",Ce,[te(l("input",{type:"radio",id:"existing",value:"existing","onUpdate:modelValue":o[0]||(o[0]=i=>x.value=i),class:"w-3 h-3 cursor-pointer"},null,512),[[se,x.value]]),l("label",Ue,v(n.__("Add an existing question")),1)]),l("div",Pe,[te(l("input",{type:"radio",id:"new",value:"new","onUpdate:modelValue":o[1]||(o[1]=i=>x.value=i),class:"w-3 h-3 cursor-pointer"},null,512),[[se,x.value]]),l("label",Ie,v(n.__("Create a new question")),1)])])),x.value=="new"||V.value?(f(),g("div",Me,[l("div",null,[l("label",Oe,v(n.__("Question")),1),r(a(ae),{content:t.question,onChange:o[2]||(o[2]=i=>t.question=i),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),l("div",null,[l("label",Te,v(n.__("Explanation for this Question")),1),r(a(ae),{content:t.explanation,onChange:o[3]||(o[3]=i=>t.explanation=i),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r(a(h),{modelValue:t.points,"onUpdate:modelValue":o[4]||(o[4]=i=>t.points=i),label:n.__("Points"),type:"number"},null,8,["modelValue","label"])])):x.value=="existing"?(f(),g("div",Ae,[r(le,{modelValue:c.question,"onUpdate:modelValue":o[5]||(o[5]=i=>c.question=i),label:n.__("Select a question"),doctype:"Open Question"},null,8,["modelValue","label"]),r(a(h),{modelValue:c.points,"onUpdate:modelValue":o[6]||(o[6]=i=>c.points=i),label:n.__("Points"),type:"number"},null,8,["modelValue","label"])])):Q("",!0)])]),_:1},8,["modelValue","options"]))}},Re={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},je={class:"space-x-2"},Fe={class:"w-3/4 mx-auto py-5"},Ne={class:"mb-8"},Be={class:"font-semibold mb-4"},ze={key:0},He={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Ke={class:"mb-8"},Ge={class:"font-semibold mb-4"},Je={class:"mb-8"},We={class:"font-semibold mb-4"},Xe={class:"grid grid-cols-3"},Ye={class:"flex items-center justify-between mb-4"},Ze={class:"font-semibold"},et=["innerHTML"],tt={key:1,class:"text-xs"},st={class:"flex gap-2"},yt={__name:"ExamForm",props:{examID:{type:String,required:!1}},setup(b){const m=K(!1),d=A({question:"",points:0,name:""}),x=pe("$user"),V=ce(),c=b,t=A({title:"",course:"",total_points:0,duration:0,qbyquestion:!1,limit_questions_to:0,show_answers:!0,shuffle_questions:!1,questions:[]});_e(()=>{var e,s;c.examID=="new"&&!((e=x.data)!=null&&e.is_moderator)&&!((s=x.data)!=null&&s.is_instructor)&&V.push({name:"Courses"}),c.examID==="new"&&(C.prefillData.title&&(t.title=C.prefillData.title),C.prefillData.course&&(t.course=C.prefillData.course)),c.examID!=="new"&&p.reload(),window.addEventListener("keydown",y)});const y=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(U(),e.preventDefault())};fe(()=>{window.removeEventListener("keydown",y)}),ne(()=>c.examID!=="new",e=>{e&&(p.reload(),C.clearPrefillData())});const p=k({url:"frappe.client.get",makeParams(e){return{doctype:"Exam Activity",name:c.examID}},auto:!1,onSuccess(e){Object.keys(e).forEach(q=>{Object.hasOwn(t,q)&&(t[q]=e[q])});let s=["show_answers","show_submission_history","shuffle_questions"];for(let q in s){let $=s[q];t[$]=!!t[$]}}}),L=k({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:D({doctype:"Exam Activity"},t)}}}),R=k({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"Exam Activity",name:e.examID,fieldname:D({total_points:F()},t)}}}),U=()=>{var e;(e=p.data)!=null&&e.name?P():j()},j=()=>{L.submit({},{onSuccess(e){w.success(__("Course created successfully")),V.push({name:"ExamForm",params:{examID:e.name}})},onError(e){var s;w.error(((s=e.messages)==null?void 0:s[0])||e)}})},P=()=>{var e;R.submit({examID:(e=p.data)==null?void 0:e.name},{onSuccess(s){t.total_points=s.total_points,w.success(__("Exam updated successfully"))},onError(s){var q;w.error(((q=s.messages)==null?void 0:q[0])||s)}})},F=()=>{let e=0;return t.limit_questions_to&&t.questions.length>0?t.questions[0].points*t.limit_questions_to:(t.questions.forEach(s=>{e+=s.points}),e)},I=T(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Points"),key:"points",width:"5rem"}]),M=(e=null)=>{e?(d.question=e.question,d.points=e.points,d.name=e.name):(d.question="",d.points=0,d.name=""),m.value=!0},N=k({url:"seminary.seminary.api.delete_documents",makeParams(e){return{doctype:"Exam Question",documents:e.questions}}}),n=(e,s)=>{N.submit({questions:Array.from(e)},{onSuccess(){w.success(__("Questions deleted successfully")),p.reload(),s()}})},o=T(()=>{var s;let e=[{label:__("Exams"),route:{name:"Exams"}}];return e.push({label:c.examID=="new"?__("New Exam"):(s=p.data)==null?void 0:s.title,route:{name:"ExamForm",params:{examID:c.examID}}}),e}),i=T(()=>{var e;return{title:c.examID=="new"?__("New Exam"):(e=p.data)==null?void 0:e.title,description:__("Form to create and edit exams")}});return De(i),(e,s)=>{var $,G,J,W;const q=be("router-link");return f(),g(H,null,[l("header",Re,[r(a(xe),{items:o.value},null,8,["items"]),l("div",je,[($=a(p).data)!=null&&$.name?(f(),E(q,{key:0,to:{name:"ExamPage",params:{examID:a(p).data.name}}},{default:_(()=>[r(a(S),null,{default:_(()=>[O(v(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):Q("",!0),(G=a(p).data)!=null&&G.name?(f(),E(q,{key:1,to:{name:"ExamSubmissionList",params:{examID:a(p).data.name}}},{default:_(()=>[r(a(S),null,{default:_(()=>[O(v(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):Q("",!0),r(a(S),{variant:"solid",onClick:s[0]||(s[0]=u=>U())},{default:_(()=>[O(v(e.__("Save")),1)]),_:1})])]),l("div",Fe,[l("div",Ne,[l("div",Be,v(e.__("Details")),1),r(a(h),{modelValue:t.title,"onUpdate:modelValue":s[1]||(s[1]=u=>t.title=u),label:(J=a(p).data)!=null&&J.name?e.__("Title"):e.__("Enter a title and save the exam to proceed"),required:!0},null,8,["modelValue","label"]),s[11]||(s[11]=l("br",null,null,-1)),r(le,{modelValue:t.course,"onUpdate:modelValue":s[2]||(s[2]=u=>t.course=u),doctype:"Course",label:e.__("Course where this exam will be used - you may reuse this exam in other scheduled courses"),placeholder:e.__("Select a course"),required:!0},null,8,["modelValue","label","placeholder"]),(W=a(p).data)!=null&&W.name?(f(),g("div",ze,[l("div",He,[r(a(h),{type:"number",modelValue:t.duration,"onUpdate:modelValue":s[3]||(s[3]=u=>t.duration=u),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),r(a(h),{modelValue:t.total_points,"onUpdate:modelValue":s[4]||(s[4]=u=>t.total_points=u),label:e.__("Total Points"),disabled:""},null,8,["modelValue","label"])]),l("div",Ke,[l("div",Ge,v(e.__("Settings")),1),r(a(h),{modelValue:t.qbyquestion,"onUpdate:modelValue":s[5]||(s[5]=u=>t.qbyquestion=u),type:"checkbox",label:e.__("Force student to answer a question before moving on? Each question will have its own page and a next button")},null,8,["modelValue","label"])]),l("div",Je,[l("div",We,v(e.__("Shuffle Settings")),1),l("div",Xe,[r(a(h),{modelValue:t.shuffle_questions,"onUpdate:modelValue":s[6]||(s[6]=u=>t.shuffle_questions=u),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),t.shuffle_questions?(f(),E(a(h),{key:0,modelValue:t.limit_questions_to,"onUpdate:modelValue":s[7]||(s[7]=u=>t.limit_questions_to=u),label:e.__("Limit Questions To (on shuffle)")},null,8,["modelValue","label"])):Q("",!0)])]),l("div",null,[l("div",Ye,[l("div",Ze,v(e.__("Questions")),1),r(a(S),{onClick:s[8]||(s[8]=u=>M())},{prefix:_(()=>[r(a(Qe),{class:"w-4 h-4"})]),default:_(()=>[O(" "+v(e.__("New Question")),1)]),_:1})]),r(a(Ve),{columns:I.value,rows:t.questions,"row-key":"name",options:{showTooltip:!1}},{default:_(()=>[r(a(ye),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:_(()=>[(f(!0),g(H,null,oe(I.value,u=>(f(),E(a(qe),{item:u},null,8,["item"]))),256))]),_:1}),r(a(we),null,{default:_(()=>[(f(!0),g(H,null,oe(t.questions,u=>(f(),E(a(ge),{row:u,onClick:B=>M(u),class:"cursor-pointer"},{default:_(({idx:B,column:X,item:z})=>[r(a(ke),{item:z},{default:_(()=>[X.key=="question_detail"?(f(),g("div",{key:0,class:"text-xs truncate h-4",innerHTML:z},null,8,et)):(f(),g("div",tt,v(z),1))]),_:2},1032,["item"])]),_:1},8,["row","onClick"]))),256))]),_:1}),r(a(he),null,{actions:_(({unselectAll:u,selections:B})=>[l("div",st,[r(a(S),{variant:"ghost",onClick:X=>n(B,u)},{default:_(()=>[r(a(Ee),{class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):Q("",!0)])]),r(Le,{modelValue:m.value,"onUpdate:modelValue":s[9]||(s[9]=u=>m.value=u),questionDetail:d,exam:a(p),"onUpdate:exam":s[10]||(s[10]=u=>ve(p)?p.value=u:null),title:d.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","exam","title"])],64)}}};export{yt as default};
//# sourceMappingURL=ExamForm-DsPFMBGZ.js.map
