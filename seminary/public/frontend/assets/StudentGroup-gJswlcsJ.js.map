{"version":3,"file":"StudentGroup-gJswlcsJ.js","sources":["../../../../frontend/src/pages/StudentGroup.vue"],"sourcesContent":["<template>\n    <div v-if=\"course.data && instructors.data\">\n        <header\n\t\t\tclass=\"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t\t>\n\t\t\t<Breadcrumbs class=\"h-7\" :items=\"breadcrumbs\" />\n\t\t</header>\n    <h1 class=\"text-2xl font-bold mb-4 ml-5\">{{ __('Student Group Management for ' + course.data.course) }}</h1>\n    <h2 class=\"text-l mb-12 ml-5\">Student Groups are used to assign students to specific groups within the course, both for assigning grading to specific instructors and for organizing collaborative work.</h2>\n\n        \n  <div v-if=\"hasSavedGroups\" class=\"student-group-page\">\n       <!-- Input for number of groups -->\n    \n    <!-- Table of Students and Groups -->\n    \n      <h2 class=\"text-xl font-bold mb-4 ml-5\">Student Groups</h2>\n\t\t\t\t\t<ListView\n\t\t\t\t\t\t:columns=\"groupColumns\"\n\t\t\t\t\t\t:rows=\"saved_groups.data.student_name\"\n\t\t\t\t\t\trow-key=\"student_name\"\n\t\t\t\t\t\t:options=\"{\n\t\t\t\t\t\t\tshowTooltip: false,\n                            selectable: false,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ListHeader\n\t\t\t\t\t\t\tclass=\"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<ListHeaderItem :item=\"item\" v-for=\"item in groupColumns\" />\n\t\t\t\t\t\t</ListHeader>\n\t\t\t\t\t\t<ListRows>\n\t\t\t\t\t\t\t<ListRow\n\t\t\t\t\t\t\t\t:row=\"row\"\n\t\t\t\t\t\t\t\tv-slot=\"{ idx, column, item }\"\n\t\t\t\t\t\t\t\tv-for=\"row in saved_groups.data\"\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tclass=\"cursor-pointer\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ListRowItem :item=\"item\">\n\t\t\t\t\t\t\t\t\t<div class=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t{{ item }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</ListRowItem>\n\t\t\t\t\t\t\t</ListRow>\n\t\t\t\t\t\t</ListRows>\n\t\t\t\t\t</ListView>\n    </div>\n    <div v-else class=\"mt-8 ml-5\">\n     <div class=\"mb-4\">\n      <label for=\"groupCount\" class=\"block text-lg font-medium text-gray-700 mb-4\">\n        How many student groups should be created?\n      </label>\n      <input\n        id=\"groupCount\"\n        type=\"number\"\n        v-model=\"groupCount\"\n        :min=\"2\"\n        :max=\"course.data.enrollments\"\n        class=\"mt-1 mb-4 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n      />\n    </div>\n\n    <!-- Instructor selection -->\n    <div  v-if=\"hasInstructors\" class=\"mb-4\">\n      <p class=\"text-lg font-medium text-gray-700 mb-2\">\n        Please, select the instructor for each group:\n      </p>\n      <div v-for=\"(group, index) in groupCount\" :key=\"index\" class=\"mb-2\">\n        <label :for=\"`instructor-${index}`\" class=\"block text-sm font-medium text-gray-700\">\n          Group {{ index + 1 }} Instructor\n        </label>\n    \t<FormControl\n\t\t\t\t\t\tv-model=\"selectedInstructors[index]\"\n\t\t\t\t\t\t:label=\"__('Instructor')\"\n\t\t\t\t\t\ttype=\"select\"\n\t\t\t\t\t\t:options=\"instructorOptions\"\n\t\t\t\t\t/>\n      </div>\n    </div>\n    <div v-else class=\"mb-4\">\n      <p class=\"text-lg font-medium text-gray-700 mb-2\">\n        Only one instructor is assigned to this course. Student groups will be created with instructor: {{ instructors.data[0].instructor_name }}\n      </p>\n    </div>\n\n    <!-- Create Groups Button -->\n    <Button\n        :variant=\"'solid'\"\n        theme=\"gray\"\n        size=\"sm\"\n        label=\"Create Groups\"\n        :loading=\"false\"\n        @click=\"createGroups\"\n         :disabled=\"!canCreateGroups\"\n    \n    </Button>\n    </div>   \n    </div>\n \n \n</template>\n\n<script setup>\nimport { ref, computed, inject, watch } from 'vue';\nimport { createResource, Breadcrumbs, ListView, ListHeader, ListHeaderItem, ListRows, ListRow, ListRowItem, FormControl, Button } from 'frappe-ui'\nimport { useRouter, useRoute } from 'vue-router';\nimport Link from '@/components/Controls/Link.vue'\nimport { updateDocumentTitle } from '@/utils'\n\nconst router = useRouter();\nconst route = useRoute();\nconst user = inject('$user')\n\nconst props = defineProps({\n\tcourseName: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n})\n\nconst instructors = createResource({\n  url: 'seminary.seminary.utils.get_instructors',\n  params: {\n    course: props.courseName,\n  },\n  auto: true,\n});\n console.log(\"Instructors fetched:\", instructors);\n\nconsole.log(\"Course Name:\", props.courseName);\n\nconst course = createResource({\n  url: 'seminary.seminary.utils.get_course_details',\n  cache: ['course', props.courseName],\n  params: {\n    course: props.courseName,\n  },\n  auto: true,\n})\n\nconst saved_groups = createResource({\n  url: 'seminary.seminary.utils.get_student_groups',\n  cache: ['saved_groups', props.courseName],\n  params: {\n    course: props.courseName,\n  },\n  auto: true,\n});\n\nconsole.log(\"Course:\", course);\nconsole.log(\"Saved Groups:\", saved_groups);\n\nconst hasInstructors = computed(() => instructors.data && instructors.data.length > 1);\nconst hasSavedGroups = computed(() => saved_groups.data && saved_groups.data.length > 0);\n\nconst breadcrumbs = computed(() => {\n  let items = [{ label: 'Courses', route: { name: 'Courses' } }]\n  items.push({\n    label: course?.data?.course,\n    route: { name: 'CourseDetail', params: { courseName: props.courseName } },\n  })\n  items.push({\n    label: 'Assessment',\n    route: { name: 'CourseAssessment', params: { courseName: props.courseName } }\n  })\n  return items\n})\n\nconst pageMeta = computed(() => {\n  return {\n    title: course?.data?.title,\n    description: \"Configuration of Student Groups for the course\",\n  }\n})\n\nupdateDocumentTitle(pageMeta)\n\nconst groupCount = ref(2);\nconst selectedInstructors = ref([]);\nconst studentGroups = ref([]);\n\nconst groupColumns = computed(() => {\n\treturn [\n\t\t{\n\t\t\tlabel: __('Student'),\n\t\t\tkey: 'student_name',\n\t\t\twidth: 2,\n\t\t},\n\t\t{\n\t\t\tlabel: __('Student Group'),\n\t\t\tkey: 'student_group',\n\t\t\twidth: 2,\n\t\t},\n        {\n\t\t\tlabel: __('Instructor'),\n\t\t\tkey: 'group_instructor',\n\t\t\twidth: 2,\n\t\t},\n\t\n\t]\n})\n\nconst canCreateGroups = computed(() => {\n  return (\n    groupCount.value > 1 &&\n    groupCount.value <= course.data.enrollments &&\n    ((hasInstructors.value &&\n    selectedInstructors.value.length === groupCount.value) || !hasInstructors.value)\n  );\n});\n\nconst instructorOptions = computed(() => {\n  console.log(\"Instructors Data in Computed:\", instructors.data);\n\n  // Transform instructors.data into the expected format for FormControl\n  if (Array.isArray(instructors.data)) {\n    return instructors.data.map((instructor) => ({\n      label: instructor.instructor_name, // Adjust based on actual data structure\n      value: instructor.user, // Adjust based on actual data structure\n    }));\n  }\n\n  return Object.values(instructors.data || {}).map((instructor) => ({\n    label: instructor.instructor_name , // Adjust based on actual data structure\n    value: instructor.user, // Adjust based on actual data structure\n  }));\n});\n\nconsole.log(\"Can Create Groups:\", canCreateGroups.value);\nconsole.log(\"Instructor Options Outside Computed:\", instructorOptions.value);\n\nconst students = createResource({\n\turl: 'seminary.seminary.utils.get_roster',\n\tcache: ['roster', props.courseName],\n\tparams: {\n\t\tcourse: props.courseName,\n\t},\n\tauto: true,\n})\nconsole.log(\"Students fetched:\", students.data);\n\n\nfunction createGroups() {\n  try {\n    console.log(\"Create Groups function called\");\n\n\n    // Ensure students.data is defined\n    if (!students.data || !Array.isArray(students.data)) {\n      throw new Error(\"Students data is not available or not an array.\");\n    }\n\n    // Filter students based on audit_bool and active fields\n    const filteredStudents = students.data.filter(\n      (student) => student.audit_bool === 0 && student.active === 1\n    );\n\n    // Map to extract student id\n    const studentData = filteredStudents.map((student) => ({\n      member: student.student,\n\n    }));\n\n    // Log the resulting array\n    console.log(\"Filtered and Transformed Students:\", studentData);\n\n    // Logic to distribute students evenly among groups\n    const groups = Array.from({ length: groupCount.value }, () => []);\n    studentData.forEach((student, index) => {\n      groups[index % groupCount.value].push(student);\n    });\n\n    // Log the groups for debugging\n    console.log(\"Formed Groups:\", groups);\n\n    // Logic to assign instructors and create groups\n    groups.forEach((group, index) => {\n      const groupName = `${course.data.name} ${selectedInstructors.value[index] || instructors.data[0].instructor_name} Group ${index + 1}`;\n      const mentor = selectedInstructors.value[index] || instructors.data[0].instructor_name;\n      console.log(`Creating group: ${mentor} ${groupName}`, group);\n      // Call API to create group\n      const group_creator = createResource({\n\turl: 'seminary.seminary.utils.create_student_group',\n\tcache: ['student_group', props.courseName],\n\tparams: {\n\t\tcourse: props.courseName,\n\t\tgroup_name: groupName,\n\t\tgroup_instructor: mentor,\n\t\tmembers: group,\n\t},\n\tauto: true,\n})\n    });\n  } catch (error) {\n    console.error(\"Error in createGroups function:\", error);\n  }\n}\n\n// Watch for changes in instructors.data to debug its state\nwatch(\n  () => instructors.data,\n  (newValue) => {\n    console.log(\"Instructors data changed:\", newValue);\n    console.log(\"Instructor Options Updated:\", instructorOptions.value);\n  }\n);\n</script>\n\n<style>\n.student-group-page {\n  max-width: 800px;\n  margin: 0 auto;\n  padding: 20px;\n}\n</style>"],"names":["useRouter","useRoute","inject","props","__props","instructors","createResource","course","saved_groups","hasInstructors","computed","hasSavedGroups","breadcrumbs","items","_a","pageMeta","updateDocumentTitle","groupCount","ref","selectedInstructors","groupColumns","canCreateGroups","instructorOptions","instructor","students","createGroups","studentData","student","groups","index","group","groupName","mentor","group_creator","error","watch","newValue","_unref","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","Breadcrumbs","_hoisted_3","_toDisplayString","__","_cache","_openBlock","_hoisted_4","ListView","ListHeader","_Fragment","_renderList","item","_createBlock","ListHeaderItem","ListRows","row","ListRow","_withCtx","idx","column","ListRowItem","_hoisted_5","_hoisted_6","_hoisted_7","$event","_hoisted_9","_hoisted_10","FormControl","_hoisted_11","_hoisted_12","Button"],"mappings":"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"}