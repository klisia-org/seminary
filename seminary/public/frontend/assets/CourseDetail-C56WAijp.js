import{q as y,c as S,I as M,r as D,D as q,t as z,d as B,u as U}from"./frappe-ui-DY2hYblR.js";import{F as G,bk as E,c as C,a8 as H,t as h,b as c,z as $,g as e,a as x,e as u,w as _,u as s,D as r,bG as I,bS as R,U as F,V as P,am as Y,I as J,C as K,H as L,O,r as Q,bT as W}from"./vendor-BwXEY6tq.js";import{_ as X}from"./CourseOutline-CeQ5zHmd.js";import{f as Z,t as ee,u as se}from"./index-CedffXRa.js";import{_ as te}from"./InstructorAvatar-C2skgsTV.js";import{C as ae}from"./CourseCardToDo-CNR7mc9v.js";import"./index-C-gjsqqd.js";import"./settings-CAQVmobO.js";import"./Link-B7-sIXzn.js";const ne={class:"border-2 rounded-md min-w-80"},oe=["src"],re={class:"p-5"},le={key:0,class:"space-y-2"},ue={class:"space-y-4"},ie={class:"mt-8 font-medium text-ink-gray-9"},ce={class:"flex items-center text-ink-gray-9"},de={class:"ml-2"},me={class:"flex items-center text-ink-gray-9"},_e={class:"ml-2"},pe={__name:"CourseCardOverlay",props:{course:{type:Object,default:null}},setup(i){const p=G(),l=E("$user"),o=i,n=C(()=>o.course.data.video_link?"https://www.youtube.com/embed/"+o.course.data.video_link:null);function g(){l.data?setTimeout(()=>{p.push({name:"Lesson",params:{courseName:o.course.data.name,chapterNumber:1,lessonNumber:1}})},2e3):(toast.success(__("You need to login to access this course")),setTimeout(()=>{window.location.href=`/login?redirect-to=${window.location.pathname}`},2e3))}const f=()=>{let d=!1;return o.course.data.instructors.forEach(k=>{var t;!d&&k.user==((t=l.data)==null?void 0:t.name)&&(d=!0)}),console.log(d),d};return(d,k)=>{var m,a,v,w,N,b,V,T,A,j;const t=H("router-link");return c(),h("div",ne,[i.course.data.video_link?(c(),h("iframe",{key:0,src:n.value,class:"rounded-t-md min-h-56 w-full"},null,8,oe)):$("",!0),e("div",re,[i.course.data.membership?(c(),h("div",le,[u(t,{to:{name:"Lesson",params:{courseName:i.course.name,chapterNumber:i.course.data.current_lesson?i.course.data.current_lesson.split("-")[0]:1,lessonNumber:i.course.data.current_lesson?i.course.data.current_lesson.split("-")[1]:1}}},{default:_(()=>[u(s(y),{variant:"solid",size:"md",class:"w-full"},{default:_(()=>[e("span",null,r(d.__("Continue Learning")),1)]),_:1})]),_:1},8,["to"])])):(c(),x(s(y),{key:1,onClick:k[0]||(k[0]=Xe=>g()),variant:"solid",class:"w-full",size:"md"},{default:_(()=>[e("span",null,r(d.__("Start Learning")),1)]),_:1})),(a=(m=s(l))==null?void 0:m.data)!=null&&a.is_moderator||f()?(c(),x(t,{key:2,to:{name:"CourseForm",params:{courseName:i.course.data.name}}},{default:_(()=>[u(s(y),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:_(()=>[e("span",null,r(d.__("Edit")),1)]),_:1})]),_:1},8,["to"])):$("",!0),u(t,{to:{name:"CourseCalendar",params:{courseName:i.course.data.name}}},{default:_(()=>[u(s(y),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:_(()=>[e("span",null,r(d.__("Subscribe to the course calendar")),1)]),_:1})]),_:1},8,["to"]),(w=(v=s(l))==null?void 0:v.data)!=null&&w.is_moderator||f()?(c(),x(t,{key:3,to:{name:"CourseAssessment",params:{courseName:i.course.data.name}}},{default:_(()=>[u(s(y),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:_(()=>[e("span",null,r(d.__("Configure Assessments")),1)]),_:1})]),_:1},8,["to"])):$("",!0),(b=(N=s(l))==null?void 0:N.data)!=null&&b.is_moderator||f()?(c(),x(t,{key:4,to:{name:"StudentGroup",params:{courseName:i.course.data.name}}},{default:_(()=>[u(s(y),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:_(()=>[e("span",null,r(d.__("Configure Student Groups")),1)]),_:1})]),_:1},8,["to"])):$("",!0),(T=(V=s(l))==null?void 0:V.data)!=null&&T.is_moderator||f()?(c(),x(t,{key:5,to:{name:"Gradebook",params:{courseName:i.course.data.name}}},{default:_(()=>[u(s(y),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:_(()=>[e("span",null,r(d.__("Gradebook")),1)]),_:1})]),_:1},8,["to"])):$("",!0),(j=(A=s(l))==null?void 0:A.data)!=null&&j.is_moderator||f()?(c(),x(t,{key:6,to:{name:"StudentAttendanceCS",params:{courseName:i.course.data.name}}},{default:_(()=>[u(s(y),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:_(()=>[e("span",null,r(d.__("Attendance")),1)]),_:1})]),_:1},8,["to"])):$("",!0),e("div",ue,[e("div",ie,r(d.__("This course has:")),1),e("div",ce,[u(s(I),{class:"h-4 w-4 stroke-1.5"}),e("span",de,r(i.course.data.lessons)+" "+r(d.__("Lessons")),1)]),e("div",me,[u(s(R),{class:"h-4 w-4 stroke-1.5"}),e("span",_e,r(s(Z)(i.course.data.enrollments))+" "+r(d.__("Enrolled Students")),1)])])])])}}},fe={class:"announcement-dialog flex flex-col gap-4 max-h-[70vh] overflow-y-auto"},ve={class:""},he={class:"mb-1.5 text-sm text-ink-gray-5"},be={class:""},ye={class:"mb-1.5 text-sm text-ink-gray-5"},ge={class:"mb-4"},ke={class:"mb-1.5 text-sm text-ink-gray-5"},we={__name:"AnnouncementModal",props:F({cs:{type:String,required:!0},students:{type:Array,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const p=P(i,"modelValue"),l=i,o=Y({subject:"",replyTo:"",announcement:""}),n=()=>{o.subject="",o.replyTo="",o.announcement=""},g=S({url:"frappe.core.doctype.communication.email.make",makeParams(t){return{recipients:l.students.join(", "),cc:o.replyTo,subject:o.subject,content:o.announcement,doctype:"Course Schedule",name:l.cs,send_email:1}}}),f=t=>{g.submit({},{validate(){if(!l.students.length)return __("No students in this course");if(!o.subject)return __("Subject is required")},onSuccess(){p.value=!1,n(),t(),z.success(__("Announcement has been sent successfully"))},onError(m){var a;z.error(((a=m.messages)==null?void 0:a[0])||m)}})},d=t=>{p.value=!1,n(),t==null||t()};J(p,t=>{t||n()});const k=C(()=>({title:__("Make an Announcement"),size:"xl",actions:[{label:__("Submit"),variant:"solid",onClick:t=>f(t)},{label:__("Cancel"),variant:"text",onClick:t=>d(t)}]}));return(t,m)=>(c(),x(s(q),{modelValue:p.value,"onUpdate:modelValue":m[3]||(m[3]=a=>p.value=a),options:k.value,disableOutsideClickToClose:!0},{"body-content":_(()=>[e("div",fe,[e("div",ve,[e("div",he,[K(r(t.__("Subject"))+" ",1),m[4]||(m[4]=e("span",{class:"text-ink-red-3"},"*",-1))]),u(s(M),{type:"text",modelValue:o.subject,"onUpdate:modelValue":m[0]||(m[0]=a=>o.subject=a)},null,8,["modelValue"])]),e("div",be,[e("div",ye,r(t.__("Reply To")),1),u(s(M),{type:"text",modelValue:o.replyTo,"onUpdate:modelValue":m[1]||(m[1]=a=>o.replyTo=a)},null,8,["modelValue"])]),e("div",ge,[e("div",ke,r(t.__("Announcement")),1),u(s(D),{content:o.announcement,fixedMenu:!0,onChange:m[2]||(m[2]=a=>o.announcement=a),editorClass:"prose-sm py-2 px-2 min-h-[200px] border-outline-gray-2 hover:border-outline-gray-3 rounded-b-md bg-surface-gray-3"},null,8,["content"])])])]),_:1},8,["modelValue","options"]))}},$e={class:"border-2 rounded-md min-w-80 p-5"},xe={key:0},Ce={class:"mb-8"},Ne={class:"flex items-center justify-between mb-2"},Se={class:"flex items-center"},Ve={class:"ml-2 text-ink-gray-7"},Te={class:"text-sm"},Ae=["innerHTML"],je={key:1,class:"text-sm italic text-ink-gray-5"},Me={__name:"Announcements",props:{cs:{type:String,required:!0}},setup(i){const p=i,l=S({url:"seminary.seminary.api.get_announcements",makeParams(o){return{cs:p.cs}},auto:!0,cache:["announcement",p.cs]});return(o,n)=>{var g;return c(),h("div",$e,[(g=s(l).data)!=null&&g.length?(c(),h("div",xe,[(c(!0),h(L,null,O(s(l).data,f=>(c(),h("div",null,[e("div",Ce,[e("div",Ne,[e("div",Se,[u(s(B),{label:f.sender_full_name,size:"lg"},null,8,["label"]),e("div",Ve,r(f.sender_full_name),1)]),e("div",Te,r(s(ee)(f.communication_date)),1)]),e("div",{class:"prose prose-sm bg-surface-menu-bar !min-w-full px-4 py-2 rounded-md",innerHTML:f.content},null,8,Ae)])]))),256))])):(c(),h("div",je,r(o.__("No announcements")),1))])}}},ze={key:0},Ee={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Le={class:"m-5"},Oe={class:"flex justify-between w-full"},De={class:"md:w-2/3"},qe={class:"text-3xl font-semibold text-ink-gray-9"},Be={class:"my-3 leading-6 text-ink-gray-7"},Ue=["innerHTML"],Ge={class:"mt-10"},He={key:0,class:"text-lg font-semibold"},Ie={key:1,class:"text-lg font-semibold"},Re={class:"flex flex-wrap gap-4"},Fe={class:"text-center text-sm font-medium"},Pe={class:"mt-10"},Ye={class:"border-0 rounded-md min-w-80"},Je={class:"mt-5"},Ke={class:"mt-5"},Qe={key:0,class:"mt-5 flex justify-center"},We={class:"mt-5"},us={__name:"CourseDetail",props:{courseName:{type:String,required:!0}},setup(i){const p=E("$user"),l=i,o=Q(!1);console.log("CourseName prop:",l.courseName);const n=S({url:"seminary.seminary.utils.get_course_details",cache:["course",l.courseName],params:{course:l.courseName},auto:!0});console.log(n),console.log("Course props:",l.courseName);const g=S({url:"seminary.seminary.utils.get_roster",cache:["roster",l.courseName],params:{course:l.courseName},auto:!0}),f=C(()=>(g.data||[]).map(a=>a.stuemail_rc));console.log("Student Emails:",f.value);const d=()=>{o.value=!0},k=C(()=>{const a=(p==null?void 0:p.data)||{};return!!(a.is_moderator||a.is_instructor||a.is_evaluator)}),t=C(()=>{var v,w;let a=[{label:__("Courses"),route:{name:"Courses"}}];return a.push({label:(v=n==null?void 0:n.data)==null?void 0:v.course,route:{name:"CourseDetail",params:{courseName:(w=n==null?void 0:n.data)==null?void 0:w.name}}}),a}),m=C(()=>{var a,v;return{title:(a=n==null?void 0:n.data)==null?void 0:a.title,description:(v=n==null?void 0:n.data)==null?void 0:v.short_introduction}});return se(m),(a,v)=>{var w,N;return s(n).data?(c(),h("div",ze,[e("header",Ee,[u(s(U),{class:"h-7",items:t.value},null,8,["items"])]),e("div",Le,[e("div",Oe,[e("div",De,[e("div",qe,r(s(n).data.course),1),e("div",Be,r(s(n).data.short_introduction),1),e("div",{innerHTML:s(n).data.course_description_for_lms,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,Ue),e("div",Ge,[s(n).data.instructors.length===1?(c(),h("div",He,r(a.__("Instructor")),1)):(c(),h("div",Ie,r(a.__("Instructors")),1)),v[2]||(v[2]=e("br",null,null,-1)),e("div",Re,[(c(!0),h(L,null,O(s(n).data.instructors,b=>(c(),h("div",{key:b.instructor_name,class:"flex flex-col items-center"},[u(te,{instructor:b,size:"xl",class:"mb-2 w-20 h-20"},null,8,["instructor"]),e("div",Fe,r(b.instructor_name),1)]))),128))])]),e("div",Pe,[u(X,{title:"Course Outline",courseName:s(n).data.name,showOutline:!0,allowEdit:k.value},null,8,["courseName","allowEdit"])])]),e("div",Ye,[u(pe,{course:s(n),class:"mb-4"},null,8,["course"]),e("div",Je,[u(ae,{course:l.courseName},null,8,["course"])]),e("div",Ke,[u(Me,{cs:l.courseName},null,8,["cs"])]),(w=s(p).data)!=null&&w.is_moderator||(N=s(p).data)!=null&&N.is_instructor?(c(),h("div",Qe,[u(s(y),{onClick:v[0]||(v[0]=b=>d())},{suffix:_(()=>[u(s(W),{class:"h-4 stroke-1.5"})]),default:_(()=>[e("span",null,r(a.__("Make an Announcement")),1)]),_:1})])):$("",!0),e("div",We,[u(we,{modelValue:o.value,"onUpdate:modelValue":v[1]||(v[1]=b=>o.value=b),cs:l.courseName,students:f.value},null,8,["modelValue","cs","students"])])])])])])):$("",!0)}}};export{us as default};
//# sourceMappingURL=CourseDetail-C56WAijp.js.map
