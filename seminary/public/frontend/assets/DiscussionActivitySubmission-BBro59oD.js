import{ci as S,cj as J,F as K,bk as Q,r as b,av as W,c as h,I as G,t as l,b as r,g as s,a as H,e as y,u,w as v,C as g,D as o,L as j,aR as X,H as w,O as I,z as P,aw as Y,ck as Z}from"./vendor-BwXEY6tq.js";import{c as m,t as C,u as ee,q as M}from"./frappe-ui-DY2hYblR.js";import{d as se}from"./index-CedffXRa.js";import"./Link-B7-sIXzn.js";import"./index-C-gjsqqd.js";const ae={class:"flex justify-between sticky top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},te={class:"flex items-center justify-between mb-5"},oe={class:"w-1/3"},ie={class:"text-2xl font-bold mt-4 mb-4"},ne={for:"submissionDropdown",class:"block text-sm font-medium text-gray-700 mb-4"},re=["value"],ue={class:"flex space-x-6 overflow-hidden h-[calc(100vh-7.2rem)]"},le={class:"w-2/3 h-[calc(100vh-3.2rem)]"},de={class:"mb-6 border-round border-gray-300 p-4 bg-surface-white shadow-sm mt-4 mb-8"},ce=["innerHTML"],me={class:"post-meta text-sm text-ink-gray-5"},_e=["href"],be={class:"mb-6 border-round border-gray-300 p-4 bg-surface-white shadow-sm mt-4 mb-8"},ve={class:"reply-meta text-sm text-ink-gray-5"},pe=["innerHTML"],fe=["innerHTML"],he={class:"reply-meta text-sm text-ink-gray-5"},ye=["href"],ge={class:"w-1/3 border-l pl-4"},we={class:"text-lg font-semibold mb-4"},ke={for:"gradeInput",class:"block text-sm font-medium text-gray-700 mb-2"},Ne={class:"mt-20"},De={class:"text-center py-10"},Le={__name:"DiscussionActivitySubmission",props:{discussionID:{type:String,required:!0},submissionName:{type:String,required:!0},courseName:{type:String,required:!0}},setup($){const k=typeof S=="function"?S:S.default;k.extend(J);const p=K(),L=Q("$user"),i=$,n=b(i.submissionName),q=b(i.submissionName),R=b([]),T=b([]),N=b(""),B=m({url:"frappe.client.get_value",params:{doctype:"Discussion Activity",fieldname:"discussion_name",filters:{name:i.discussionID}},auto:!0}),V=e=>e&&e.includes(".")?k(e.split(".")[0]).fromNow():k(e).fromNow(),d=m({url:"frappe.client.get_list",params:{doctype:"Discussion Submission",filters:[["disc_activity","=",i.discussionID],["coursesc","=",i.courseName]],fields:["name","student_name","member"],order_by:"student_name asc"},auto:!0});W(()=>{var e,t;!((e=L.data)!=null&&e.is_instructor)&&!((t=L.data)!=null&&t.is_moderator)&&p.push({name:"Courses"})});const f=h(()=>{var e;return(e=d.data)==null?void 0:e.findIndex(t=>t.name===n.value)}),D=h(()=>{var e,t;return(t=(e=d.data)==null?void 0:e.find(c=>c.name===n.value))==null?void 0:t.student_name}),A=h(()=>{var e,t;return(t=(e=d.data)==null?void 0:e.find(c=>c.name===n.value))==null?void 0:t.member}),F=m({url:"seminary.seminary.api.get_user_discussion_submission",makeParams(e){return{course_name:p.currentRoute.value.params.courseName,discussion_id:i.discussionID,owner:A.value}},auto:!1,onSuccess(e){R.value=e}}),z=m({url:"seminary.seminary.api.get_user_discussion_replies",makeParams(e){return{course_name:p.currentRoute.value.params.courseName,discussion_id:i.discussionID,member:A.value}},auto:!1,onSuccess(e){T.value=e}});G(n,e=>{q.value=e,p.push({name:"DiscussionActivitySubmission",params:{discussionID:i.discussionID,courseName:i.courseName,submissionName:e}})}),G(()=>D.value,e=>{e&&(F.reload(),z.reload())});const x=m({url:"seminary.seminary.utils.get_course_details",cache:["course",i.courseName],params:{course:i.courseName},auto:!0}),O=m({url:"seminary.seminary.api.save_discussion_submission_grade",makeParams(e){return{submission_name:n.value,grade:N.value}},onSuccess(e){C.success(__("Grade saved successfully"))}}),U=()=>{O.reload().then(()=>{C.success(__("Grade saved successfully"))}).catch(e=>{C.error(__("Failed to save grade: {0}").format(e.message))})},E=h(()=>{var t;let e=[{label:__("Courses"),route:{name:"Courses"}}];return e.push({label:(t=x==null?void 0:x.data)==null?void 0:t.course,route:{name:"CourseDetail",params:{courseName:i.courseName}}}),e.push({label:__("Gradebook"),route:{name:"Gradebook",params:{courseName:i.courseName}}}),e.push({label:__("Discussion Submissions"),route:{name:"DiscussionActivitySubmission",params:{courseName:i.courseName,discussionID:i.discussionID}}}),e});return(e,t)=>{var c;return r(),l(w,null,[s("header",ae,[y(u(ee),{items:E.value},null,8,["items"])]),s("div",te,[y(u(M),{variant:"subtle",disabled:f.value===0,onClick:t[0]||(t[0]=a=>{var _;return n.value=(_=u(d).data[f.value-1])==null?void 0:_.name})},{default:v(()=>[g(o(e.__("Previous")),1)]),_:1},8,["disabled"]),s("div",oe,[s("h1",ie,o(((c=u(B).data)==null?void 0:c.discussion_name)||e.__("Discussion Activity Submission")),1),s("label",ne,o(e.__("Select Submission")),1),j(s("select",{id:"submissionDropdown","onUpdate:modelValue":t[1]||(t[1]=a=>n.value=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[(r(!0),l(w,null,I(u(d).data,a=>(r(),l("option",{key:a.name,value:a.name},o(a.student_name),9,re))),128))],512),[[X,n.value]])]),y(u(M),{variant:"subtle",disabled:!u(d).data||f.value===u(d).data.length-1,onClick:t[2]||(t[2]=a=>{var _;return n.value=(_=u(d).data[f.value+1])==null?void 0:_.name})},{default:v(()=>[g(o(e.__("Next")),1)]),_:1},8,["disabled"])]),(r(),H(Z,null,{default:v(()=>[s("div",ue,[s("div",le,[s("div",de,[s("h2",null,o(e.__("Original Post(s) by"))+" "+o(D.value),1),(r(!0),l(w,null,I(R.value,a=>(r(),l("div",{key:a.name,class:"m-2 border-round border-gray-300 p-4 bg-surface-white shadow-sm mt-4 mb-4"},[s("div",{class:"post-content",innerHTML:a.original_post},null,8,ce),s("div",me,o(V(a.creation)),1),a.original_attachment?(r(),l("a",{key:0,href:a.original_attachment,target:"_blank",class:"text-blue-500 underline"},o(e.__("View Attachment")),9,_e)):P("",!0)]))),128))]),s("div",be,[s("h2",null,o(e.__("Replies by"))+" "+o(D.value),1),(r(!0),l(w,null,I(T.value,a=>(r(),l("div",{key:a.creation,class:"m-2 border-round border-gray-300 p-4 bg-surface-white shadow-sm mt-4 mb-4"},[s("div",ve,[g(o(e.__("Reply to:"))+" "+o(a.student_name)+" ",1),s("div",{class:"post-content",innerHTML:a.original_post},null,8,pe)]),s("div",{class:"reply-content mt-4",innerHTML:a.reply},null,8,fe),s("div",he,o(V(a.reply_dt)),1),a.reply_attach?(r(),l("a",{key:0,href:a.reply_attach,target:"_blank",class:"text-blue-500 underline"},o(e.__("View Attachment")),9,ye)):P("",!0)]))),128))])]),s("div",ge,[s("h2",we,o(e.__("Grading")),1),s("label",ke,o(e.__("Grade")),1),j(s("input",{id:"gradeInput","onUpdate:modelValue":t[3]||(t[3]=a=>N.value=a),type:"number",class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm mb-4"},null,512),[[Y,N.value]]),y(u(M),{variant:"solid",onClick:U,class:"w-full"},{default:v(()=>[g(o(e.__("Save")),1)]),_:1}),s("div",Ne,[(r(),H(se,{title:"Comments on Discussion Submission",doctype:"Discussion Submission",docname:n.value,key:n.value},null,8,["docname"]))])])])]),fallback:v(()=>[s("div",De,[s("span",null,o(e.__("Loading submission data...")),1)])]),_:1}))],64)}}};export{Le as default};
//# sourceMappingURL=DiscussionActivitySubmission-BBro59oD.js.map
