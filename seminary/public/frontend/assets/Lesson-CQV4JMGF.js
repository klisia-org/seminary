import{c as z,w as G,j as L}from"./frappe-ui-BzEkZ7NZ.js";import{bX as K,t as n,b as r,z as m,g as a,H as E,O as J,u as s,e as _,bk as V,F as W,bV as ee,r as S,av as te,bY as se,c as j,I as re,bg as oe,a8 as ae,D as b,a as N,w as y,bZ as ne,C as R,b_ as ue}from"./vendor-IWZbD1HA.js";import{_ as ie}from"./CourseOutline-rEsnVJrw.js";import{_ as le,a as de,b as ce,g as me,u as pe,c as _e,d as he}from"./index-DYgOoCE_.js";import{_ as fe}from"./InstructorAvatar-B0-MpPT5.js";import"./index-B0k3CMx6.js";import"./settings-D8_73kUS.js";import"./Link-DmVUQNbJ.js";/* empty css                                                                     */const be={key:0},ye=["src"],ge={key:0},ve=["src"],Ne={key:1},we={controls:"",width:"100%",controlsList:"nodownload",oncontextmenu:"return false;"},ke=["src"],xe={key:2},$e=["src"],Se={key:3},Ie={width:"100%",controls:"",controlsList:"nodownload"},qe=["src"],Ce={key:4},Le=["src"],De=["innerHTML"],Pe={key:1},ze={key:2},Ee={key:3},H={__name:"LessonContent",props:{content:{type:String,required:!0},youtube:{type:String,required:!1},quizId:{type:String,required:!1},exam:{type:String,required:!1},folder:{type:String,required:!1}},setup(u){const h=new K({html:!0,linkify:!0}),I=c=>(c.includes("{{")&&(c=f(c)),`https://www.youtube.com/embed/${c}`),q=c=>`${f(c)}#toolbar=0`,f=c=>c.match(/\(["']([^"']+?)["']\)/)[1];return(c,D)=>{var w;return r(),n(E,null,[u.youtube?(r(),n("div",be,[a("iframe",{class:"youtube-video",src:I(u.youtube.split("/").pop()),width:"100%",height:"400",frameborder:"0",allowfullscreen:""},null,8,ye)])):m("",!0),(r(!0),n(E,null,J((w=u.content)==null?void 0:w.split(`

`),l=>(r(),n("div",null,[l.includes("{{ YouTubeVideo")?(r(),n("div",ge,[a("iframe",{class:"youtube-video",src:I(l),width:"100%",height:"400",frameborder:"0",allowfullscreen:""},null,8,ve)])):l.includes("{{ Video")?(r(),n("div",Ne,[a("video",we,[a("source",{src:f(l),type:"video/mp4"},null,8,ke)])])):l.includes("{{ PDF")?(r(),n("div",xe,[a("iframe",{src:q(l),width:"100%",height:"700px",frameborder:"0",allowfullscreen:""},null,8,$e)])):l.includes("{{ Audio")?(r(),n("div",Se,[a("audio",Ie,[a("source",{src:f(l),type:"audio/mp3"},null,8,qe)])])):l.includes("{{ Embed")?(r(),n("div",Ce,[a("iframe",{width:"100%",height:"400",src:f(l),frameborder:"0",allowfullscreen:""},null,8,Le)])):(r(),n("div",{key:5,innerHTML:s(h).render(l)},null,8,De))]))),256)),u.quizId?(r(),n("div",Pe,[_(le,{quiz:u.quizId},null,8,["quiz"])])):m("",!0),u.exam?(r(),n("div",ze,[_(de,{exam:u.exam},null,8,["exam"])])):m("",!0),u.folder?(r(),n("div",Ee,[_(ce,{folder:u.folder},null,8,["folder"])])):m("",!0)],64)}}},Me={key:0,class:""},Te={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Be={class:"grid md:grid-cols-[70%,30%] h-screen"},Fe={class:"border-r container pt-5 pb-10 px-5"},Oe={class:"flex flex-col md:flex-row md:items-center justify-between"},Ve={class:"text-3xl font-semibold text-ink-gray-9"},je={class:"flex items-center mt-2 md:mt-0"},Re={class:"flex items-center"},He={key:0,class:"bg-surface-gray-2 p-3 rounded-md mt-6"},Je={class:"text-ink-gray-5 font-medium"},Ae={key:1,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-6"},Ye={key:2,class:"rounded-md bg-[#E6F7F4] p-2 mt-2"},Ue={key:3,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-5"},Qe={key:4,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-5"},Xe={class:"mt-20"},Ze={class:"sticky top-10"},Ge={class:"bg-surface-menu-bar py-5 px-2 border-b"},Ke={class:"text-lg font-semibold text-ink-gray-9"},We={key:0,class:"text-sm mt-4 mb-2 text-ink-gray-5"},lt={__name:"Lesson",props:{courseName:{type:String,required:!0},chapterNumber:{type:String,required:!0},lessonNumber:{type:String,required:!0}},setup(u){const h=V("$user"),I=W(),q=ee(),f=S(!1),c=S(null),D=S(null),w=S(0),l=S(0);let C;const P=V("$socket");P?console.log("Socket connection available in Lesson.vue:",P):console.error("Socket connection not found in Lesson.vue.");const d=u;te(()=>{T()});const e=z({url:"seminary.seminary.utils.get_lesson",cache:["lesson",d.courseName,d.chapterNumber,d.lessonNumber],makeParams(t){return{course:d.courseName,chapter:t?t.chapter:d.chapterNumber,lesson:t?t.lesson:d.lessonNumber}},auto:!0,onSuccess(t){var o,i,p,g;if(Object.keys(t).length===0){I.push({name:"CourseDetail",params:{courseName:d.courseName}});return}w.value=(o=t.membership)==null?void 0:o.progress,t.content&&(c.value=M("editor",t.content)),t.instructor_content&&((p=(i=JSON.parse(t.instructor_content))==null?void 0:i.blocks)==null?void 0:p.length)>1&&(D.value=M("instructor-content",t.instructor_content)),(g=c.value)==null||g.isReady.then(()=>{Q()})}}),M=(t,o)=>(document.getElementById(t)&&(document.getElementById(t).innerHTML=""),new se({holder:t,tools:me(),data:JSON.parse(o),readOnly:!0,defaultBlock:"embed"}));console.log(e);const A=()=>{h.data&&e.data&&!e.data.progress&&Y.submit()},Y=z({url:"seminary.seminary.doctype.course_lesson.course_lesson.save_progress",makeParams(){return{lesson:e.data.name,course:d.courseName}},onSuccess(t){w.value=t}}),U=j(()=>{var o,i;let t=[{label:"Courses",route:{name:"Courses"}}];return t.push({label:(o=e==null?void 0:e.data)==null?void 0:o.course_title,route:{name:"CourseDetail",params:{courseName:d.courseName}}}),t.push({label:(i=e==null?void 0:e.data)==null?void 0:i.lesson_title,route:{name:"Lesson",params:{courseName:d.courseName,chapterNumber:d.chapterNumber,lessonNumber:d.lessonNumber}}}),t});re([()=>q.params.chapterNumber,()=>q.params.lessonNumber],([t,o],[i,p])=>{(t||o)&&(c.value=null,D.value=null,f.value=!1,e.submit({chapter:t,lesson:o}),clearInterval(C),l.value=0,T())});const T=()=>{C=setInterval(()=>{l.value++,l.value==30&&(clearInterval(C),A())},1e3)};oe(()=>{clearInterval(C)});const B=()=>{var o;let t=!1;return(o=e.data)!=null&&o.instructors&&e.data.instructors.forEach(i=>{var p;!t&&i.user==((p=h.data)==null?void 0:p.name)&&(t=!0)}),t};z({url:"frappe.client.insert",makeParams(){var t;return{doc:{doctype:"Scheduled Course Roster",course:d.courseName,member:(t=h.data)==null?void 0:t.name}}}});const Q=()=>{var o,i,p,g,k;console.log("Lesson Data:",e.data),console.log("allow_discuss:",(o=e.data)==null?void 0:o.allow_discuss);let t=!1;if((i=e.data)!=null&&i.content)try{(p=JSON.parse(e.data.content).blocks)==null||p.forEach(v=>{v.type==="quiz"&&v.data&&Object.keys(v.data).some($=>v.data[$]!==null&&v.data[$]!=="")&&(t=!0)})}catch(x){console.error("Error parsing content:",x)}(((g=e.data)==null?void 0:g.allow_discuss)===!0||((k=e.data)==null?void 0:k.allow_discuss)===1)&&!t?f.value=!0:f.value=!1},X=j(()=>{var t,o;return{title:(t=e.data)==null?void 0:t.lesson_title,description:(o=e.data)==null?void 0:o.course_sc}});return pe(X),(t,o)=>{var p,g,k,x,v,$,F,O;const i=ae("router-link");return s(e).data?(r(),n("div",Me,[a("header",Te,[_(s(G),{class:"h-7",items:U.value},null,8,["items"])]),a("div",Be,[a("div",Fe,[a("div",Oe,[a("div",Ve,b(s(e).data.lesson_title),1),a("div",je,[s(e).data.prev?(r(),N(i,{key:0,to:{name:"Lesson",params:{courseName:u.courseName,chapterNumber:s(e).data.prev.split(".")[0],lessonNumber:s(e).data.prev.split(".")[1]}}},{default:y(()=>[_(s(L),{class:"mr-2"},{prefix:y(()=>[_(s(ne),{class:"w-4 h-4 stroke-1"})]),default:y(()=>[a("span",null,b(t.__("Previous")),1)]),_:1})]),_:1},8,["to"])):m("",!0),(g=(p=s(h))==null?void 0:p.data)!=null&&g.is_moderator||B()?(r(),N(i,{key:1,to:{name:"LessonForm",params:{courseName:u.courseName,chapterNumber:d.chapterNumber,lessonNumber:d.lessonNumber}}},{default:y(()=>[_(s(L),{variant:"solid",class:"mr-2"},{default:y(()=>[R(b(t.__("Edit")),1)]),_:1})]),_:1},8,["to"])):m("",!0),s(e).data.next?(r(),N(i,{key:2,to:{name:"Lesson",params:{courseName:u.courseName,chapterNumber:s(e).data.next.split(".")[0],lessonNumber:s(e).data.next.split(".")[1]}}},{default:y(()=>[_(s(L),null,{suffix:y(()=>[_(s(ue),{class:"w-4 h-4 stroke-1"})]),default:y(()=>[a("span",null,b(t.__("Next")),1)]),_:1})]),_:1},8,["to"])):(r(),N(i,{key:3,to:{name:"CourseDetail",params:{courseName:u.courseName}}},{default:y(()=>[_(s(L),null,{default:y(()=>[R(b(t.__("Back to Course")),1)]),_:1})]),_:1},8,["to"]))])]),(r(!0),n(E,null,J(s(e).data.instructors,Z=>(r(),n("div",Re,[o[0]||(o[0]=a("br",null,null,-1)),_(fe,{instructor:Z,size:"xl"},null,8,["instructor"]),o[1]||(o[1]=a("br",null,null,-1))]))),256)),s(e).data.instructor_content&&((x=(k=JSON.parse(s(e).data.instructor_content))==null?void 0:k.blocks)==null?void 0:x.length)>1&&(($=(v=s(h))==null?void 0:v.data)!=null&&$.is_moderator||B())?(r(),n("div",He,[a("div",Je,b(t.__("Instructor Notes")),1),o[2]||(o[2]=a("div",{id:"instructor-content",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,-1))])):s(e).data.instructor_notes?(r(),n("div",Ae,[_(H,{content:s(e).data.instructor_notes},null,8,["content"])])):m("",!0),s(e).data.due_date?(r(),n("div",Ye,b(t.__("Due: ")+new Intl.DateTimeFormat(s(h).data.language||"en-US",{dateStyle:"medium"}).format(new Date(s(e).data.due_date))),1)):m("",!0),s(e).data.content?(r(),n("div",Ue,[...o[3]||(o[3]=[a("div",{id:"editor"},null,-1)])])):(r(),n("div",Qe,[(F=s(e).data)!=null&&F.body?(r(),N(H,{key:0,content:s(e).data.body,youtube:s(e).data.youtube,quizId:s(e).data.quiz_id,exam:s(e).data.exam,assignmentID:s(e).data.assignment_id,socket:s(P)},null,8,["content","youtube","quizId","exam","assignmentID","socket"])):m("",!0)])),a("div",Xe,[f.value&&((O=s(e).data)!=null&&O.name)?(r(),N(_e,{title:"Questions",doctype:"Course Lesson",docname:s(e).data.name,key:s(e).data.name},null,8,["docname"])):m("",!0)])]),a("div",Ze,[a("div",Ge,[a("div",Ke,b(s(e).data.lesson_title),1),s(h)&&s(e).data.membership?(r(),n("div",We,b(Math.ceil(w.value))+"% "+b("completed"),1)):m("",!0),s(h)&&s(e).data.membership?(r(),N(he,{key:1,progress:w.value},null,8,["progress"])):m("",!0)]),(r(),N(ie,{courseName:u.courseName,key:u.chapterNumber,getProgress:!!s(e).data.membership},null,8,["courseName","getProgress"]))])])])):m("",!0)}}};export{lt as default};
//# sourceMappingURL=Lesson-CQV4JMGF.js.map
