var zt=Object.defineProperty,Rt=Object.defineProperties;var qt=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var ft=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var ot=(c,e,t)=>e in c?zt(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t,qe=(c,e)=>{for(var t in e||(e={}))ft.call(e,t)&&ot(c,t,e[t]);if(Ye)for(var t of Ye(e))ht.call(e,t)&&ot(c,t,e[t]);return c},Ge=(c,e)=>Rt(c,qt(e));var vt=c=>typeof c=="symbol"?c:c+"",gt=(c,e)=>{var t={};for(var l in c)ft.call(c,l)&&e.indexOf(l)<0&&(t[l]=c[l]);if(c!=null&&Ye)for(var l of Ye(c))e.indexOf(l)<0&&ht.call(c,l)&&(t[l]=c[l]);return t};var Fe=(c,e,t)=>ot(c,typeof e!="symbol"?e+"":e,t);var te=(c,e,t)=>new Promise((l,d)=>{var u=h=>{try{b(t.next(h))}catch(x){d(x)}},m=h=>{try{b(t.throw(h))}catch(x){d(x)}},b=h=>h.done?l(h.value):Promise.resolve(h.value).then(u,m);b((t=t.apply(c,e)).next())});import{b as dt,c as J,q as j,w as ze,n as Pe,r as He,H as Ue,t as ke,D as $t,G as ct,z as We,d as Ut,J as Ot,v as St}from"./frappe-ui-BC6vlBMo.js";import{c as oe,a as z,b as o,w as O,g as s,m as Vt,n as Oe,u as a,bk as Ce,r as A,am as Je,F as Ke,I as ue,t as i,z as D,D as r,e as E,H as de,O as pe,L as $e,ck as nt,cl as _t,cm as rt,R as Ht,C as ie,av as Ee,J as Ct,aL as fe,q as Re,c7 as Bt,bg as mt,c2 as Xe,c0 as Tt,ce as jt,s as Gt,U as At,V as it,o as Qt,bZ as Jt,cn as Wt,co as Yt,cb as pt,a8 as Xt,cp as Zt,aw as Ne,cq as Dt,bT as Kt,ch as lt,ci as es,aR as ts,cr as ss,cs as Ft,ct as Mt,cu as Et,cv as Nt,cw as as,cx as os,cy as ns,cz as rs,cA as yt,bV as ls,cd as bt,bW as is,S as Qe,cB as us,cC as ds,cD as cs,cE as ms,cF as ps,cG as fs,cH as hs,cI as vs,cJ as gs}from"./vendor-CA0oFrry.js";import{_ as Ve}from"./Link-Dl_y0tb2.js";import{t as De,r as Me,u as et,i as _s}from"./index-Ck4PZcst.js";/* empty css                                                                     */const ys={class:"w-full bg-surface-gray-3 rounded-full h-1"},It={__name:"ProgressBar",props:{progress:{type:Number,default:0},size:{type:String,default:"sm"}},setup(c){const e=c,t=oe(()=>`${Math.min(Math.ceil(e.progress),100)}%`),l=oe(()=>{if(e.size==="sm")return"h-1";if(e.size==="md")return"h-2";if(e.size==="lg")return"h-3"});return(d,u)=>(o(),z(a(dt),{text:`${e.progress}%`},{default:O(()=>[s("div",ys,[s("div",{class:Oe(["bg-surface-gray-7 rounded-full",l.value]),style:Vt({width:t.value})},null,6)])]),_:1},8,["text"]))}},bs={key:0},ks={class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},xs={class:"leading-5"},ws={key:0,class:"leading-5"},$s={key:1,class:"leading-5"},Ss={key:2,class:"leading-relaxed"},Cs={key:3,class:"leading-relaxed"},Ts={key:0,class:"flex flex-col space-x-1 my-4"},As={class:"mb-2"},Ds={class:"font-semibold"},Fs={key:1},Ms={class:"border text-center p-20 rounded-md"},Es={class:"font-semibold text-lg"},Ns={key:2},Is={key:2},Ls={key:0,class:"border rounded-md p-5"},Ps={class:"flex justify-between"},zs={class:"text-sm text-ink-gray-5"},Rs={class:"mr-2"},qs={class:"text-ink-gray-9 text-sm font-semibold item-left"},Us=["innerHTML"],Os={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Vs=["name","onChange"],Hs=["name","onChange"],Bs={key:0},js=["innerHTML"],Gs={key:1},Qs={key:0},Js={key:2},Ws={class:"flex items-center justify-between mt-4"},Ys={class:"text-sm text-ink-gray-5"},Xs={key:3},Zs={class:"flex justify-between"},Ks={class:"text-sm text-ink-gray-5"},ea={class:"mr-2"},ta={class:"text-ink-gray-9 text-sm font-semibold item-left"},sa=["innerHTML"],aa={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},oa=["name","onChange"],na=["name","onChange"],ra=["innerHTML"],la={key:1},ia={class:"text-center mt-4"},ua={key:4,class:"border rounded-md p-20 text-center space-y-4"},da={class:"text-ink-gray-9"},ca={class:"mt-6"},ma={class:"flex justify-between"},pa={class:"text-lg text-ink-gray-5"},fa={class:"mr-2"},ha=["innerHTML"],va={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ga={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},_a={key:0,class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ya={class:"mt-4"},ba={key:1},ka={__name:"Quiz",props:{quizName:{type:String,required:!0}},setup(c){const e=Ce("$user"),t=A(!1),l=A(0),d=A(""),u=Je([0,0,0,0]),m=Je([]);let b=Je([]);const h=A(null),x=A(0);let w=null;const g=Ke(),U=A(0),v=Je({}),ae=c,_=J({url:"frappe.client.get",makeParams(y){return{doctype:"Quiz",name:ae.quizName}},cache:["quiz",ae.quizName],auto:!0,transform(y){return y?(y.duration=parseInt(y.duration)||0,y):(console.error("Quiz data is null or undefined."),null)},onSuccess(y){y?(R(),k()):console.error("Failed to load quiz data.")},onError(y){console.error("Error loading quiz data:",y)}}),H=oe(()=>!!_.data),R=()=>{let y=_.data;if(y.shuffle_questions){const p=se([...y.questions]);b=y.limit_questions_to?p.slice(0,y.limit_questions_to):p}else b=y.questions},k=()=>{_.data.duration&&(x.value=_.data.duration*60)},I=()=>{w=setInterval(()=>{_.data.duration&&(x.value--,x.value==0&&(clearInterval(w),f())),U.value++},1e3)},L=y=>{const p=Math.floor(y/3600).toString().padStart(2,"0"),B=Math.floor(y%3600/60).toString().padStart(2,"0"),ee=(y%60).toString().padStart(2,"0");return p!="00"?`${p}:${B}:${ee}`:`${B}:${ee}`},K=oe(()=>x.value/(_.data.duration*60)*100),se=y=>{for(let p=y.length-1;p>0;p--){const B=Math.floor(Math.random()*(p+1));[y[p],y[B]]=[y[B],y[p]]}return y},ne=J({url:"frappe.client.get_list",makeParams(y){var p,B;return{doctype:"Quiz Submission",filters:{member:(p=e.data)==null?void 0:p.name,quiz:(B=_.data)==null?void 0:B.name},fields:["name","creation","score","score_out_of","percentage","passing_percentage"],order_by:"creation desc"}},transform(y){y.forEach((p,B)=>{p.creation=st(p.creation),p.idx=B+1})}});ue(()=>_.data,y=>{y&&R(),y&&_.data.max_attempts&&(ne.reload(),F())});const re=J({url:"seminary.seminary.doctype.quiz.quiz.quiz_summary",makeParams(y){if(!_.data)return{};const p=_.data.duration?_.data.duration*60-(x.value||0):U.value||0;return{quiz:_.data.name,course:g.currentRoute.value.params.courseName,results:(y==null?void 0:y.results)||localStorage.getItem(`${_.data.name}_results`),time_taken:p}},onSuccess(y){y.corrected_answers&&(ve.data=y.corrected_answers.map(p=>Ge(qe({},p),{user_answer:p.user_answer||null,correct_answer:p.correct_answer||null})))},onError(y){console.error("Error loading quiz summary:",y)},auto:!0}),Y=J({url:"seminary.seminary.utils.get_question_details",makeParams(y){return{question:d.value}}});ue(l,y=>{y>0&&(d.value=_.data.questions[y-1].question,Y.reload())}),ue(()=>ae.quizName,y=>{y&&_.reload()});const ve=J({url:"seminary.seminary.utils.get_all_questions_details",makeParams(y){return{questions:b.map(p=>p.name)}}}),S=()=>{l.value=1,localStorage.removeItem(_.data.title),I()},P=()=>{localStorage.removeItem(_.data.title),t.value=!0,I(),ve.reload()},W=y=>{Y.data.multiple||u.splice(0,u.length,0,0,0,0),u[y-1]=u[y-1]?0:1},C=()=>{let y=[];return Y.data.type=="Choices"?u.forEach((B,ee)=>{u[ee]&&y.push(Y.data[`option_${ee+1}`])}):y.push(h.value),y},q=()=>{let y=C();if(!y.length){di({title:"Please select an option",icon:"alert-circle",iconClasses:"text-yellow-600 bg-yellow-100 rounded-full",position:"top-center"});return}J({url:"seminary.seminary.doctype.quiz.quiz.check_answer",params:{question:d.value,type:Y.data.type,answers:JSON.stringify(y)},auto:!0,onSuccess(p){Y.data.type==="Choices"?u.forEach((ee,le)=>{ee?m[le]=ee&&p[le]:p[le]===2?m[le]=2:m[le]=void 0}):m.push(p),X(),_.data.show_answers||he()}})},X=()=>{let y=JSON.parse(localStorage.getItem(_.data.title))||[],p={question_name:d.value,answer:C().join(),is_correct:m.filter(ee=>ee!=null)};const B=y.findIndex(ee=>ee.question_name===p.question_name);B!==-1?y[B]=p:y?y.push(p):y=[p],localStorage.setItem(_.data.title,JSON.stringify(y)),localStorage.setItem(`${_.data.name}_results`,JSON.stringify(y))},ce=()=>{_.data.show_answers?(X(),he()):q()},he=()=>{l.value!=_.data.questions.length&&(l.value=l.value+1,u.splice(0,u.length,0,0,0,0),m.length=0,h.value=null)},f=()=>{if(!_.data.show_answers){q(),setTimeout(()=>{N()},500);return}N(),console.log("Quiz submitted with Submit Quiz button and asnwers shown")},T=()=>te(this,null,function*(){var B;const y=[],p=[];for(let ee=0;ee<ve.data.length;ee++){const le=ve.data[ee],xe=((B=v[ee])==null?void 0:B[0])||"",G=yield Ue("seminary.seminary.doctype.quiz.quiz.check_answer",{question:le.question,type:le.type,answers:JSON.stringify([xe])}),ge=Array.isArray(G)?[G.find(n=>n===1)||0]:[G];y.push({question_name:le.question,answer:xe,is_correct:ge}),p.push({question_name:le.question,question_detail:le.question_detail,user_answer:xe,correct_answer:null,explanation:le.explanation||null})}re.submit({results:JSON.stringify(y)},{onSuccess:ee=>te(this,null,function*(){const le=yield Ue("seminary.seminary.doctype.quiz.quiz.get_all_question_results",{questions:b.map(xe=>xe.question)});p.forEach(xe=>{const G=le.find(ge=>ge.name===xe.question_name);G&&(xe.correct_answer=G.correct_option,xe.explanation=G.correct_explanation||xe.explanation)}),localStorage.setItem(`${_.data.name}_questions`,JSON.stringify(p)),localStorage.setItem(`${_.data.name}_results`,JSON.stringify(y)),localStorage.setItem(`${_.data.name}_summary`,JSON.stringify(ee)),re.reload(),t.value=!1}),onError(ee){console.error("Error submitting quiz:",ee)}})}),N=()=>{const y=localStorage.getItem(`${_.data.name}_results`);if(!y){console.error("No results found to submit.");return}re.submit({results:y},{onSuccess(p){_e(),_.data&&_.data.max_attempts&&ne.reload(),_.data.duration&&clearInterval(w)},onError(p){var ee,le;((p==null?void 0:p.message)||"").includes("MaximumAttemptsExceededError")&&((ee=p.messages)!=null&&ee[0],ke.error(((le=p.messages)==null?void 0:le[0])||p),setTimeout(()=>{window.location.reload()},3e3))}})},F=()=>{l.value=0,u.splice(0,u.length,0,0,0,0),m.length=0,re.reset(),R(),k(),U.value=0},V=y=>y.type=="Choices"?y.multiple?"Choose all answers that apply":"Choose one answer":"Type your answer",_e=()=>{g.currentRoute.value.name==="Lesson"&&Ue("seminary.seminary.api.mark_lesson_progress",{course:g.currentRoute.value.params.courseName,chapter_number:g.currentRoute.value.params.chapterNumber,lesson_number:g.currentRoute.value.params.lessonNumber}).then(()=>{t.value&&re.reload()})},be=(y,p)=>{v[y]=[p]},me=(y,p)=>{v[y]||(v[y]=[]);const B=v[y].indexOf(p);B===-1?v[y].push(p):v[y].splice(B,1)};ue(()=>ve.data,y=>{y?console.log("All questions details updated"):console.warn("No data available in all_questions_details.")});const Se=A([]),we=A([]);return ue(()=>re.data,()=>{if(re.data){const y=localStorage.getItem(`${_.data.name}_questions`),p=localStorage.getItem(`${_.data.name}_results`);Se.value=y?JSON.parse(y):[],we.value=p?JSON.parse(p):[]}}),(y,p)=>{var B,ee,le,xe;return H.value?(o(),i("div",bs,[s("div",ks,[s("div",xs,r(`This quiz consists of ${a(b).length} questions.`),1),(B=a(_).data)!=null&&B.duration?(o(),i("div",ws,r(`Please ensure that you complete all the questions in ${a(_).data.duration} minutes.`),1)):D("",!0),(ee=a(_).data)!=null&&ee.duration?(o(),i("div",$s,r("If you fail to do so, the quiz will be automatically submitted when the timer ends."))):D("",!0),a(_).data.passing_percentage?(o(),i("div",Ss,r(`You will have to get ${a(_).data.passing_percentage}% correct answers in order to pass the quiz.`),1)):D("",!0),a(_).data.max_attempts?(o(),i("div",Cs,r(`You can attempt this quiz ${a(_).data.max_attempts===1?"1 time":`${a(_).data.max_attempts} times`}.`),1)):D("",!0)]),a(_).data.duration?(o(),i("div",Ts,[s("div",As,[p[7]||(p[7]=s("span",{class:""},r("Time")+": ",-1)),s("span",Ds,r(L(x.value)),1)]),E(It,{progress:K.value},null,8,["progress"])])):D("",!0),t.value?D("",!0):(o(),i("div",Fs,[s("div",Ms,[s("div",Es,r(a(_).data.title),1),(!a(_).data.max_attempts||((le=a(ne).data)==null?void 0:le.length)<a(_).data.max_attempts)&&a(_).data.qbyquestion?(o(),z(a(j),{key:0,onClick:S,class:"mt-2"},{default:O(()=>[...p[8]||(p[8]=[s("span",null,r("Start"),-1)])]),_:1})):!a(_).data.max_attempts||((xe=a(ne).data)==null?void 0:xe.length)<a(_).data.max_attempts?(o(),z(a(j),{key:1,onClick:P,class:"mt-2"},{default:O(()=>[...p[9]||(p[9]=[s("span",null,r("Start full quiz"),-1)])]),_:1})):(o(),i("div",Ns,r("You have already exceeded the maximum number of attempts allowed for this quiz.")))])])),t.value===!1&&l.value!==0&&!a(re).data&&a(_).data.qbyquestion?(o(),i("div",Is,[(o(!0),i(de,null,pe(a(b),(G,ge)=>(o(),i("div",null,[ge==l.value-1&&a(Y).data?(o(),i("div",Ls,[s("div",Ps,[s("div",zs,[s("span",Rs,r(`Question ${l.value}`)+": ",1),s("span",null,r(V(a(Y).data)),1)]),s("div",qs,r(G.points)+" "+r(G.points==1?"Point":"Points"),1)]),s("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:a(Y).data.question},null,8,Us),a(Y).data.type=="Choices"?(o(),i(de,{key:0},pe(4,n=>s("div",null,[a(Y).data[`option_${n}`]?(o(),i("label",Os,[!m.length&&!a(Y).data.multiple?(o(),i("input",{key:0,type:"radio",name:encodeURIComponent(a(Y).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:$=>W(n)},null,40,Vs)):!m.length&&a(Y).data.multiple?(o(),i("input",{key:1,type:"checkbox",name:encodeURIComponent(a(Y).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:$=>W(n)},null,40,Hs)):a(_).data.show_answers?(o(!0),i(de,{key:2},pe(m,($,Z)=>(o(),i("div",null,[n-1==Z?(o(),i("div",Bs,[$==1?(o(),z(a(nt),{key:0,class:"w-4 h-4 text-green-800"})):$==2?(o(),z(a(_t),{key:1,class:"w-4 h-4 text-ink-green-2"})):$==0?(o(),z(a(rt),{key:2,class:"w-4 h-4 text-red-600"})):(o(),z(a(_t),{key:3,class:"w-4 h-4"}))])):D("",!0)]))),256)):D("",!0),s("span",{class:"ml-2",innerHTML:a(Y).data[`option_${n}`]},null,8,js)])):D("",!0),a(Y).data[`explanation_${n}`]?$e((o(),i("div",{key:1,class:"mt-2 text-xs"},r(a(Y).data[`explanation_${n}`]),513)),[[Ht,m.length]]):D("",!0)])),64)):a(Y).data.type=="User Input"?(o(),i("div",Gs,[E(a(ze),{modelValue:h.value,"onUpdate:modelValue":p[0]||(p[0]=n=>h.value=n),type:"textarea",disabled:!!m.length,class:"my-2"},null,8,["modelValue","disabled"]),m.length?(o(),i("div",Qs,[m[0]?(o(),z(a(Pe),{key:0,label:"Correct",theme:"green"},{prefix:O(()=>[E(a(nt),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(o(),z(a(Pe),{key:1,theme:"red",label:"Incorrect"},{prefix:O(()=>[E(a(rt),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])):D("",!0)])):(o(),i("div",Js,[E(a(He),{class:"mt-4",content:h.value,onChange:p[1]||(p[1]=n=>h.value=n),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),s("div",Ws,[s("div",Ys,r(`Question ${l.value} of ${a(b).length}`),1),a(_).data.show_answers&&!m.length?(o(),z(a(j),{key:0,onClick:p[2]||(p[2]=n=>q())},{default:O(()=>[...p[10]||(p[10]=[s("span",null,r("Check"),-1)])]),_:1})):l.value!=a(b).length?(o(),z(a(j),{key:1,onClick:p[3]||(p[3]=n=>ce())},{default:O(()=>[...p[11]||(p[11]=[s("span",null,r("Next"),-1)])]),_:1})):(o(),z(a(j),{key:2,onClick:p[4]||(p[4]=n=>f())},{default:O(()=>[...p[12]||(p[12]=[s("span",null,r("Submit"),-1)])]),_:1}))])])):D("",!0)]))),256))])):D("",!0),t.value&&a(ve).data&&a(ve).data.length>0?(o(),i("div",Xs,[(o(!0),i(de,null,pe(a(ve).data,(G,ge)=>(o(),i("div",{key:G.name,class:"border rounded-md p-5 mb-4"},[s("div",Zs,[s("div",Ks,[s("span",ea,r(`Question ${ge+1}`)+":",1),s("span",null,r(V(G)),1)]),s("div",ta,r(G.points||0)+" "+r(G.points==1?"Point":"Points"),1)]),s("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:G.question_detail},null,8,sa),G.type=="Choices"?(o(),i(de,{key:0},pe(4,n=>s("div",null,[G[`option_${n}`]?(o(),i("label",aa,[G.multiple?G.multiple?(o(),i("input",{key:1,type:"checkbox",name:`question_${ge}`,class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:$=>me(ge,G[`option_${n}`])},null,40,na)):D("",!0):(o(),i("input",{key:0,type:"radio",name:`question_${ge}`,class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:$=>be(ge,G[`option_${n}`])},null,40,oa)),s("span",{class:"ml-2",innerHTML:G[`option_${n}`]},null,8,ra)])):D("",!0)])),64)):G.type=="User Input"?(o(),i("div",la,[E(a(ze),{modelValue:v[ge],"onUpdate:modelValue":n=>v[ge]=n,type:"textarea",class:"my-2"},null,8,["modelValue","onUpdate:modelValue"])])):D("",!0)]))),128)),s("div",ia,[E(a(j),{onClick:p[5]||(p[5]=G=>T())},{default:O(()=>[...p[13]||(p[13]=[s("span",null,r("Submit Your Quiz"),-1)])]),_:1})])])):a(re).data?(o(),i("div",ua,[p[18]||(p[18]=s("div",{class:"text-lg font-semibold"},r("Quiz Summary"),-1)),s("div",da,r(`You got ${Math.ceil(a(re).data.percentage)}% correct answers with a score of ${a(re).data.score} out of ${a(re).data.score_out_of}`),1),s("div",ca,[(o(!0),i(de,null,pe(Se.value,(G,ge)=>{var n,$;return o(),i("div",{key:G.question_name,class:"border rounded-md p-5 mb-4"},[s("div",ma,[s("div",pa,[s("span",fa,r(`Question ${ge+1}`)+":",1),s("span",{innerHTML:G.question_detail},null,8,ha)])]),s("div",va,[p[14]||(p[14]=s("strong",null,r("Your Answer:"),-1)),ie(" "+r(G.user_answer||"No Answer"),1)]),s("div",ga,[p[15]||(p[15]=s("strong",null,r("Correct Answer:"),-1)),ie(" "+r(G.correct_answer||"No Correct Answer"),1)]),G.explanation?(o(),i("div",_a,[p[16]||(p[16]=s("strong",null,r("Explanation:"),-1)),ie(" "+r(G.explanation),1)])):D("",!0),s("div",ya,[(($=(n=we.value[ge])==null?void 0:n.is_correct)==null?void 0:$[0])===1?(o(),z(a(Pe),{key:0,label:"Correct",theme:"green"},{prefix:O(()=>[E(a(nt),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(o(),z(a(Pe),{key:1,label:"Incorrect",theme:"red"},{prefix:O(()=>[E(a(rt),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])])}),128))]),E(a(j),{onClick:p[6]||(p[6]=G=>F()),class:"mt-4"},{default:O(()=>[...p[17]||(p[17]=[s("span",null,r("Try Again"),-1)])]),_:1})])):D("",!0)])):(o(),i("div",ba,[...p[19]||(p[19]=[s("p",null,"Loading quiz data...",-1)])]))}}},xa={key:1,class:"border rounded-md text-center py-20"},wa={__name:"QuizBlock",props:{quiz:{type:String,required:!0}},setup(c){const e=Ce("$user"),t=()=>{window.location.href="/login"};return(l,d)=>a(e).data?(o(),z(ka,{key:0,quizName:c.quiz},null,8,["quizName"])):(o(),i("div",xa,[s("div",null,r(l.__("Please login to access the quiz.")),1),E(a(j),{onClick:d[0]||(d[0]=u=>t()),class:"mt-2"},{default:O(()=>[s("span",null,r(l.__("Login")),1)]),_:1})]))}},$a={class:"p-5 space-y-4"},Sa={key:0,class:"text-lg font-semibold"},Ca={key:1,class:"text-lg font-semibold"},Ta={key:2,class:"text-lg font-semibold"},Aa={key:3,class:"text-lg font-semibold"},Da={class:"flex justify-end space-x-2"},tt={__name:"AssessmentPlugin",props:{type:{type:String,required:!0},onAddition:{type:Function,required:!0}},setup(c){const e=A(!1),t=A(null),l=A(null),d=A(null),u=A(null),m=c;Ee(()=>te(this,null,function*(){yield Ct(),e.value=!0}));const b=()=>{m.type=="quiz"?m.onAddition(t.value):m.type=="exam"?m.onAddition(d.value):m.type=="discussionactivity"?m.onAddition(u.value):m.onAddition(l.value),e.value=!1},h=()=>{m.type=="quiz"?window.open("/seminary/quizzes/new","_blank"):m.type=="exam"?window.open("/seminary/exams/new","_blank"):m.type=="discussionactivity"?window.open("/seminary/discussion-activity/new","_blank"):window.open("/seminary/assignments/new","_blank")};return(x,w)=>(o(),z(a($t),{modelValue:e.value,"onUpdate:modelValue":w[5]||(w[5]=g=>e.value=g),options:{size:"xl"}},{body:O(()=>[w[6]||(w[6]=s("button",{style:{opacity:"0",position:"absolute"}},"Fallback Focus",-1)),s("div",$a,[c.type=="quiz"?(o(),i("div",Sa,r(x.__("Add a quiz to your lesson")),1)):c.type=="exam"?(o(),i("div",Ca,r(x.__("Add an exam to your lesson")),1)):c.type=="discussionactivity"?(o(),i("div",Ta,r(x.__("Add a discussion activity to your lesson")),1)):(o(),i("div",Aa,r(x.__("Add an assignment to your lesson")),1)),s("div",null,[c.type=="quiz"?(o(),z(Ve,{key:0,modelValue:t.value,"onUpdate:modelValue":w[0]||(w[0]=g=>t.value=g),doctype:"Quiz",label:x.__("Select a quiz"),onCreate:(g,U)=>h()},null,8,["modelValue","label","onCreate"])):c.type=="exam"?(o(),z(Ve,{key:1,modelValue:d.value,"onUpdate:modelValue":w[1]||(w[1]=g=>d.value=g),doctype:"Exam Activity",label:x.__("Select an exam"),onCreate:(g,U)=>h()},null,8,["modelValue","label","onCreate"])):c.type=="discussionactivity"?(o(),z(Ve,{key:2,modelValue:u.value,"onUpdate:modelValue":w[2]||(w[2]=g=>u.value=g),doctype:"Discussion Activity",label:x.__("Select a discussion activity"),onCreate:(g,U)=>h()},null,8,["modelValue","label","onCreate"])):(o(),z(Ve,{key:3,modelValue:l.value,"onUpdate:modelValue":w[3]||(w[3]=g=>l.value=g),doctype:"Assignment Activity",label:x.__("Select an assignment"),onCreate:(g,U)=>h()},null,8,["modelValue","label","onCreate"]))]),s("div",Da,[E(a(j),{variant:"solid",onClick:w[4]||(w[4]=g=>b())},{default:O(()=>[ie(r(x.__("Save")),1)]),_:1})])])]),_:1},8,["modelValue"]))}};class Fa{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(Bt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Quiz"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderQuiz(this.data.quiz):this.renderQuizModal(),this.wrapper}renderQuiz(e){if(this.readOnly){const t=fe(wa,{quiz:e});t.use(De),t.use(Me);const{userResource:l}=et();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Quiz: ${e}
            </span>
        </div>`}renderQuizModal(){if(this.readOnly)return;const e=fe(tt,{type:"quiz",onAddition:t=>{this.data.quiz=t,this.renderQuiz(t)}});e.use(De),e.use(Me),e.mount(this.wrapper)}save(e){return{quiz:this.data.quiz}}}const Ma={class:"border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},Ea={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},Na={key:0},Ia={key:1},La={class:"text-sm text-ink-gray-7 font-medium mb-2"},Pa=["innerHTML"],za={class:"flex flex-col"},Ra={class:"p-5"},qa={class:"flex items-center justify-between mb-4"},Ua={class:"font-semibold text-ink-gray-9"},Oa={class:"flex items-center space-x-2"},Va={key:0,class:"bg-blue-200 p-3 rounded-md leading-5 text-sm mb-4"},Ha={key:1},Ba={class:"text-xs text-ink-gray-5 mt-1 mb-2"},ja={key:1},Ga={class:"flex text-ink-gray-7"},Qa={class:"border self-start rounded-md p-2 mr-2"},Ja=["href"],Wa={class:"text-sm leading-5"},Ya={class:"text-sm text-ink-gray-5 mt-1"},Xa={key:2},Za={class:"text-xs text-ink-gray-5 mb-1"},Ka={key:3},eo={class:"text-sm mb-4"},to={key:4,class:"mt-8 p-3 bg-blue-200 rounded-md"},so={class:"text-sm text-ink-gray-5 font-medium mb-2"},ao={class:"leading-5"},oo=["innerHTML"],no={key:5,class:"mt-8 space-y-4"},ro={class:"font-semibold mb-2 text-ink-gray-9"},lo={class:"text-sm text-ink-gray-5 mb-1"},io={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(c){var ve;const e=A(null),t=A(null),l=A(null),d=Ke(),u=Ce("$user"),m=d.currentRoute.value.name=="AssignmentSubmission",b=A(!1),h=c;Ee(()=>{window.addEventListener("keydown",x),console.log("User: ",u.data)});const x=S=>{S.key==="s"&&(S.ctrlKey||S.metaKey)&&(ae(),S.preventDefault())};mt(()=>{window.removeEventListener("keydown",x)});const w=J({url:"frappe.client.get",params:{doctype:"Assignment Activity",name:h.assignmentID},auto:!0,onSuccess(S){h.submissionName!="new"&&v.reload()}}),g=J({url:"frappe.client.insert",makeParams(S){var W;let P={doctype:"Assignment Submission",assignment:h.assignmentID,member:(W=u.data)==null?void 0:W.name,course:d.currentRoute.value.params.courseName};return Y()?P.assignment_attachment=e.value.file_url:P.answer=t.value,{doc:P}}}),U=J({url:"seminary.seminary.api.get_file_info",makeParams(S){return{file_url:S.image}},auto:!1,onSuccess(S){e.value=S}}),v=ct({doctype:"Assignment Submission",name:h.submissionName,onError(S){var P;ke.error(((P=S.messages)==null?void 0:P[0])||S)},auto:!1,cache:[(ve=u.data)==null?void 0:ve.name,h.assignmentID]});ue(v,()=>{v.doc&&(v.doc.assignment_attachment&&U.reload({image:v.doc.assignment_attachment}),v.doc.answer&&(t.value=v.doc.answer),v.doc.comments&&(l.value=v.doc.comments),v.isDirty||Y()&&!e.value||!Y()&&!t.value?b.value=!0:b.value=!1)}),ue(e,()=>{h.submissionName=="new"&&e.value&&(b.value=!0)}),ue(()=>{var S;return(S=v.doc)==null?void 0:S.grade},(S,P)=>{S!==P&&v.doc&&(v.doc.status="Graded",b.value=!0)});const ae=()=>{var S,P,W;if(h.submissionName!="new"){let C=v.doc&&v.doc.owner!=((S=u.data)==null?void 0:S.name)?(P=u.data)==null?void 0:P.name:null;v.setValue.submit(Ge(qe({},v.doc),{assignment_attachment:(W=e.value)==null?void 0:W.file_url,evaluator:C,comments:l.value,answer:t.value}),{onSuccess(q){ke.success(__("Changed successfully")),b.value=!1}})}else _()},_=()=>{g.submit({},{onSuccess(S){ke.success(__("Assignment submitted successfully")),d.currentRoute.value.name=="AssignmentSubmission"?d.push({name:"AssignmentSubmission",params:{assignmentID:h.assignmentID,submissionName:S.name}}):(R(),d.go()),v.name=S.name,b.value=!1,v.reload()},onError(S){var P;ke.error(((P=S.messages)==null?void 0:P[0])||S)}})},H=S=>{b.value=!0,e.value=S},R=()=>{if(d.currentRoute.value.name=="Lesson"){let S=d.currentRoute.value.params.courseName,P=d.currentRoute.value.params.chapterNumber,W=d.currentRoute.value.params.lessonNumber;console.log("Chapter Number: ",P),console.log("Lesson Number: ",W),Ue("seminary.seminary.api.mark_lesson_progress",{course:S,chapter_number:P,lesson_number:W})}},k=()=>{var P;const S=(P=w.data)==null?void 0:P.type;if(S=="Image")return["image/*"];if(S=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(S=="PDF")return[".pdf"]},I=S=>{var C;let P=(C=w.data)==null?void 0:C.type,W=S.name.split(".").pop().toLowerCase();if(P=="Image"&&!["jpg","jpeg","png"].includes(W))return"Only image file is allowed.";if(P=="Document"&&!["doc","docx","xml"].includes(W))return"Only document file is allowed.";if(P=="PDF"&&!["pdf"].includes(W))return"Only PDF file is allowed."},L=()=>{b.value=!0,e.value=null},K=oe(()=>{var S,P,W;return(((S=u.data)==null?void 0:S.is_moderator)||((P=u.data)==null?void 0:P.is_evaluator)||((W=u.data)==null?void 0:W.is_instructor))&&h.submissionName!="new"&&d.currentRoute.value.name=="AssignmentSubmission"}),se=oe(()=>{var S,P,W;return!v.doc||((S=v.doc)==null?void 0:S.owner)==((P=u.data)==null?void 0:P.name)&&((W=v.doc)==null?void 0:W.status)=="Not Graded"}),ne=oe(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),re=oe(()=>v.doc?v.doc.status=="Pass"||v.doc.status=="Graded"?"green":v.doc.status=="Not Graded"?"blue":"red":"orange"),Y=()=>{var S;return["PDF","Image","Document"].includes((S=w.data)==null?void 0:S.type)};return(S,P)=>{var W,C,q,X,ce,he,f,T,N,F;return a(w).data?(o(),i("div",{key:0,class:Oe(["grid grid-cols-[65%,35%] h-full",{"border rounded-lg":!m}])},[s("div",Ma,[m?(o(),i("div",Ea,[c.submissionName==="new"?(o(),i("div",Na,r(S.__("Submission by"))+" "+r((W=a(u).data)==null?void 0:W.full_name),1)):(o(),i("div",Ia,r(S.__("Submission by"))+" "+r((C=a(v).doc)==null?void 0:C.member_name),1))])):D("",!0),s("div",La,r(S.__("Question"))+": ",1),s("div",{innerHTML:a(w).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,Pa)]),s("div",za,[s("div",Ra,[s("div",qa,[s("div",Ua,r(S.__("Submission")),1),s("div",Oa,[b.value?(o(),z(a(Pe),{key:0,theme:"orange"},{default:O(()=>[ie(r(S.__("Not Saved")),1)]),_:1})):(q=a(v).doc)!=null&&q.status?(o(),z(a(Pe),{key:1,theme:re.value,size:"lg"},{default:O(()=>{var V;return[ie(r((V=a(v).doc)==null?void 0:V.status),1)]}),_:1},8,["theme"])):D("",!0),E(a(j),{variant:"solid",onClick:P[0]||(P[0]=V=>ae())},{default:O(()=>[ie(r(S.__("Save")),1)]),_:1})])]),c.submissionName!="new"&&!["Pass","Fail","Graded"].includes((X=a(v).doc)==null?void 0:X.status)&&((ce=a(v).doc)==null?void 0:ce.owner)==((he=a(u).data)==null?void 0:he.name)?(o(),i("div",Va,r(S.__("You've successfully submitted the assignment."))+" "+r(S.__("Once the moderator grades your submission, you'll find the details here."))+" "+r(S.__("Feel free to make edits to your submission if needed, until it is graded.")),1)):D("",!0),Y()?(o(),i("div",Ha,[s("div",Ba,r(S.__("Add your assignment as {0}").format(a(w).data.type)),1),e.value?(o(),i("div",ja,[s("div",Ga,[s("div",Qa,[E(a(Xe),{class:"h-5 w-5 stroke-1.5"})]),s("a",{href:e.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[s("span",Wa,r(e.value.file_name),1),s("span",Ya,r(a(Ze)(e.value.file_size)),1)],8,Ja),se.value?(o(),z(a(Tt),{key:0,onClick:P[2]||(P[2]=V=>L()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):D("",!0)])])):(o(),z(a(We),{key:0,fileTypes:k(),validateFile:I,onSuccess:P[1]||(P[1]=V=>H(V))},{default:O(({uploading:V,progress:_e,openFileSelector:be})=>[E(a(j),{onClick:be,loading:V},{default:O(()=>[ie(r(V?S.__("Uploading {0}%").format(_e):S.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(w).data.type=="URL"?(o(),i("div",Xa,[s("div",Za,r(S.__("Enter a URL")),1),E(a(ze),{modelValue:t.value,"onUpdate:modelValue":P[3]||(P[3]=V=>t.value=V),type:"text",readonly:!se.value},null,8,["modelValue","readonly"])])):(o(),i("div",Ka,[s("div",eo,r(S.__("Write your answer here")),1),E(a(He),{content:t.value,onChange:P[4]||(P[4]=V=>t.value=V),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((f=a(u).data)==null?void 0:f.name)==((T=a(v).doc)==null?void 0:T.owner)&&((N=a(v).doc)!=null&&N.comments)?(o(),i("div",to,[s("div",so,r(S.__("Comments by"))+": "+r(((F=a(v).doc)==null?void 0:F.evaluator)||S.__("Evaluator")),1),s("div",ao,[s("div",{innerHTML:a(v).doc.comments},null,8,oo)])])):D("",!0),K.value?(o(),i("div",no,[s("div",ro,r(S.__("Grading")),1),a(v).doc?(o(),z(a(ze),{key:0,modelValue:a(v).doc.status,"onUpdate:modelValue":P[5]||(P[5]=V=>a(v).doc.status=V),label:S.__("Grading Status"),type:"select",options:ne.value},null,8,["modelValue","label","options"])):D("",!0),a(v).doc?(o(),z(a(ze),{key:1,modelValue:a(v).doc.grade,"onUpdate:modelValue":P[6]||(P[6]=V=>a(v).doc.grade=V),label:S.__("Score"),type:"number"},null,8,["modelValue","label"])):D("",!0),s("div",null,[s("div",lo,r(S.__("Comments")),1),E(a(He),{content:l.value,onChange:P[7]||(P[7]=V=>{l.value=V,b.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):D("",!0)])])],2)):D("",!0)}}},uo={key:1,class:"border rounded-md text-center py-20"},co={__name:"AssignmentBlock",props:{assignmentID:{type:String,required:!0}},setup(c){const e=Ce("$user"),t=c,l=J({url:"frappe.client.get_value",makeParams(d){var u;return{doctype:"Assignment Submission",fieldname:"name",filters:{assignment:t.assignmentID,member:(u=e.data)==null?void 0:u.name}}},auto:!0});return(d,u)=>{var m;return a(e).data&&a(l).data?(o(),z(io,{key:0,assignmentID:c.assignmentID,submissionName:((m=a(l).data)==null?void 0:m.name)||"new"},null,8,["assignmentID","submissionName"])):(o(),i("div",uo,[s("div",null,r(d.__("Please login to access the assignment.")),1),E(a(j),{onClick:u[0]||(u[0]=b=>d.redirectToLogin()),class:"mt-2"},{default:O(()=>[s("span",null,r(d.__("Login")),1)]),_:1})]))}}};class mo{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(jt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Assignment"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderAssignment(this.data.assignment):this.renderAssignmentModal(),this.wrapper}renderAssignment(e){if(this.readOnly){const t=fe(co,{assignmentID:e});t.use(De),t.use(Me);const{userResource:l}=et();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Assignment: ${e}
            </span>
        </div>`}renderAssignmentModal(){if(this.readOnly)return;const e=fe(tt,{type:"assignment",onAddition:t=>{this.data.assignment=t,this.renderAssignment(t)}});e.use(De),e.use(Me),e.mount(this.wrapper)}save(e){return{assignment:this.data.assignment}}}const po={key:0,class:"text-center py-5"},fo={key:1,class:"space-y-5"},ho={class:"grid grid-cols-3 gap-3"},vo={class:"col-span-3 space-y-4"},go={class:"space-y-4 border p-2 rounded-md"},_o={class:"flex items-center justify-between py-4"},yo={class:"text-center ml-5"},bo={class:"text-3xl font-bold text-ink-gray-9"},ko={class:"text-center"},xo={class:"text-3xl font-semibold text-ink-gray-9"},wo={class:"text-sm text-ink-gray-5"},$o={class:"text-center mr-5"},So={class:"text-3xl font-semibold text-ink-gray-9 mt-2"},Co={class:"space-y-1"},To={class:"font-semibold text-ink-gray-9 text-left"},Ao=["innerHTML"],Do={class:"leading-5 text-ink-gray-7 space-x-1 text-left"},Fo=["innerHTML"],Mo={class:"flex justify-end items-center space-x-2"},Eo={class:"text-sm text-ink-gray-7 text-xl"},No={key:0,class:"leading-5 text-ink-gray-7 text-xl space-x-1 text-left"},Io=["innerHTML"],Lo={key:2},Po={__name:"ExamGraded",props:{submission:{type:Object,required:!0}},setup(c){const e=c;console.log("ExamGraded received submission:",e.submission);const t=ct({doctype:"Exam Submission",name:e.submission,auto:!0});console.log("ExamGraded submisisonDetails:",t),ue(()=>t.doc,d=>{t.loading=!1,console.log("ExamGraded updated with new submission details:",d)});const l=d=>{if(!d)return"00:00:00";const u=Math.floor(d/3600).toString().padStart(2,"0"),m=Math.floor(d%3600/60).toString().padStart(2,"0"),b=(d%60).toString().padStart(2,"0");return`${u}:${m}:${b}`};return(d,u)=>a(t).loading?(o(),i("div",po,[...u[0]||(u[0]=[s("p",null,"Loading submission details...",-1)])])):a(t).doc?(o(),i("div",fo,[s("div",ho,[s("div",vo,[s("div",go,[s("div",_o,[s("div",yo,[s("div",bo,r(a(t).doc.percentage||0)+"% ",1),u[1]||(u[1]=s("div",{class:"text-sm text-ink-gray-5"},"Score",-1))]),s("div",ko,[s("div",xo,r(a(t).doc.score),1),s("div",wo," Out of "+r(a(t).doc.score_out_of)+" Points ",1)]),s("div",$o,[s("div",So,r(l(a(t).doc.time_taken)),1),u[2]||(u[2]=s("div",{class:"text-sm text-ink-gray-5"},"Time taken",-1))])])]),(o(!0),i(de,null,pe(a(t).doc.result,(m,b)=>(o(),i("div",{key:b,class:"border p-5 rounded-md space-y-4"},[s("div",Co,[s("div",To,r(d.__("Question"))+" "+r(b+1)+": ",1),s("div",{class:"leading-5 text-ink-gray-9 text-left",innerHTML:m.question_name},null,8,Ao)]),s("div",Do,[s("span",null,r(d.__("Your Answer"))+": ",1),s("span",{innerHTML:m.answer},null,8,Fo)]),s("div",Mo,[s("span",Eo,r(m.points)+" / "+r(parseInt(m.points_out_of,10))+" "+r(d.__("Points")),1)]),m.comments?(o(),i("div",No,[s("span",null,r(d.__("Comments"))+": ",1),s("span",{innerHTML:m.comments},null,8,Io)])):D("",!0)]))),128))])])])):(o(),i("div",Lo,[...u[3]||(u[3]=[s("p",null,"Debug: No submission details found.",-1)])]))}},Lt={__name:"UserAvatar",props:{user:{type:Object,default:null},size:{type:String}},setup(c){return(e,t)=>(o(),z(a(dt),{text:c.user.full_name},{default:O(()=>[c.user?(o(),z(a(Ut),Gt({key:0,class:"avatar border border-outline-gray-2 cursor-auto",label:c.user.full_name,image:c.user.user_image,size:c.size},e.$attrs),null,16,["label","image","size"])):D("",!0)]),_:1},8,["text"]))}},zo={class:"mt-6"},Ro={key:0,class:"flex items-center mb-5"},qo={class:"text-lg font-semibold ml-2 text-ink-gray-9"},Uo={class:"flex items-center justify-between mb-2"},Oo={class:"flex items-center text-ink-gray-5"},Vo={class:"text-sm ml-2"},Ho={key:1},Bo={key:2,class:"flex justify-between mt-2"},kt={__name:"DiscussionReplies",props:At({topic:{type:Object,required:!0},singleThread:{type:Boolean,default:!1}},{showTopics:{},showTopicsModifiers:{}}),emits:["update:showTopics"],setup(c){const e=it(c,"showTopics"),t=A(""),l=Ce("$socket"),d=Ce("$user"),u=Ce("$allUsers"),m=A([]),b=A(!1),h=window.read_only_mode,x=c;Ee(()=>{l.on("publish_message",k=>{w.reload()}),l.on("update_message",k=>{w.reload()}),l.on("delete_message",k=>{w.reload()}),U()});const w=J({url:"seminary.seminary.utils.get_discussion_replies",cache:["replies",x.topic],makeParams(k){return{topic:x.topic.name}},auto:!0}),g=J({url:"frappe.client.insert",makeParams(k){return{doc:{doctype:"Discussion Reply",reply:t.value,topic:x.topic.name}}}}),U=()=>{var k;(k=d.data)!=null&&k.is_student?b.value=!0:u.reload({},{onSuccess(I){m.value=Object.values(I).map(L=>({value:L.name,label:L.full_name})),b.value=!0}})},v=()=>{g.submit({},{validate(){if(!t.value)return"Reply cannot be empty"},onSuccess(){t.value="",w.reload()},onError(k){var I;ke.error(((I=k.messages)==null?void 0:I[0])||k)}})},ae=J({url:"frappe.client.set_value",makeParams(k){return{doctype:"Discussion Reply",name:k.name,fieldname:"reply",value:k.reply}}}),_=k=>{ae.submit({name:k.name,reply:k.reply},{validate(){if(!k.reply)return"Reply cannot be empty"},onSuccess(){k.editable=!1,w.reload()}})},H=J({url:"frappe.client.delete",makeParams(k){return{doctype:"Discussion Reply",name:k.name}}}),R=k=>{H.submit({name:k.name},{onSuccess(){w.reload()}})};return Qt(()=>{l.off("publish_message"),l.off("update_message"),l.off("delete_message")}),(k,I)=>(o(),i("div",zo,[c.singleThread?D("",!0):(o(),i("div",Ro,[E(a(j),{variant:"outline",onClick:I[0]||(I[0]=L=>e.value=!0)},{icon:O(()=>[E(a(Jt),{class:"w-5 h-5 stroke-1.5 text-ink-gray-7"})]),_:1}),s("span",qo,r(c.topic.title),1)])),(o(!0),i(de,null,pe(a(w).data,(L,K)=>(o(),i("div",null,[s("div",{class:Oe(["py-3",{"border-b":K+1!=a(w).data.length}])},[s("div",Uo,[s("div",Oo,[E(Lt,{user:L.user,class:"mr-2"},null,8,["user"]),s("span",null,r(L.user.full_name),1),s("span",Vo,r(a(st)(L.creation)),1)]),a(d).data.name==L.owner&&!L.editable&&!a(h)?(o(),z(a(Ot),{key:0,options:[{label:k.__("Edit"),onClick(){L.editable=!0}},{label:k.__("Delete"),onClick(){R(L)}}]},{default:O(({open:se})=>[E(a(Wt),{class:"w-4 h-4 stroke-1.5 cursor-pointer"})]),_:1},8,["options"])):D("",!0),L.editable?(o(),i("div",Ho,[E(a(j),{variant:"ghost",onClick:se=>_(L)},{default:O(()=>[ie(r(k.__("Post")),1)]),_:1},8,["onClick"]),E(a(j),{variant:"ghost",onClick:se=>L.editable=!1},{default:O(()=>[ie(r(k.__("Discard")),1)]),_:1},8,["onClick"])])):D("",!0)]),E(a(He),{content:L.reply,onChange:se=>L.reply=se,editable:L.editable||!1,fixedMenu:L.editable||!1,editorClass:L.editable?"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none":"prose-sm"},null,8,["content","onChange","editable","fixedMenu","editorClass"])],2)]))),256)),b.value&&!a(h)?(o(),z(a(He),{key:1,class:"mt-5",content:t.value,mentions:m.value,onChange:I[1]||(I[1]=L=>t.value=L),placeholder:"Type your reply here...",fixedMenu:!0,editorClass:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none border border-outline-gray-2 rounded-b-md min-h-[7rem] py-1 px-2"},null,8,["content","mentions"])):D("",!0),a(h)?D("",!0):(o(),i("div",Bo,[I[3]||(I[3]=s("span",null,null,-1)),E(a(j),{onClick:I[2]||(I[2]=L=>v())},{default:O(()=>[s("span",null,r(k.__("Post")),1)]),_:1})]))]))}},jo={class:"discussion-dialog flex flex-col gap-4 max-h-[70vh] overflow-y-auto"},Go={class:"mb-1.5 text-sm text-ink-gray-5"},xt={__name:"DiscussionModal",props:At({title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0}},{modelValue:{},modelModifiers:{},reloadTopics:{},reloadTopicsModifiers:{}}),emits:["update:modelValue","update:reloadTopics"],setup(c){const e=it(c,"modelValue"),t=it(c,"reloadTopics"),l=c,d=Je({title:"",reply:""}),u=()=>{d.title="",d.reply=""},m=J({url:"frappe.client.insert",makeParams(g){return{doc:{doctype:"Discussion Topic",reference_doctype:l.doctype,reference_docname:l.docname,title:d.title}}}}),b=J({url:"frappe.client.insert",makeParams(g){return{doc:{doctype:"Discussion Reply",topic:g.topic,reply:d.reply}}}}),h=g=>{m.submit({},{validate(){if(!d.title)return"Title cannot be empty.";if(!d.reply)return"Reply cannot be empty."},onSuccess(U){b.submit({topic:U.name},{onSuccess(){e.value=!1,t.value.reload(),u(),g()}})},onError(U){var v;ke.error(((v=U.messages)==null?void 0:v[0])||U)}})},x=g=>{e.value=!1,u(),g==null||g()};ue(e,g=>{g||u()});const w=oe(()=>({title:Pt(l.title),size:"2xl",actions:[{label:__("Post"),variant:"solid",onClick:g=>h(g)},{label:__("Cancel"),variant:"text",onClick:g=>x(g)}]}));return(g,U)=>(o(),z(a($t),{modelValue:e.value,"onUpdate:modelValue":U[2]||(U[2]=v=>e.value=v),disableOutsideClickToClose:!0,options:w.value},{"body-content":O(()=>[s("div",jo,[s("div",null,[E(a(ze),{modelValue:d.title,"onUpdate:modelValue":U[0]||(U[0]=v=>d.title=v),label:g.__("Title"),type:"text"},null,8,["modelValue","label"])]),s("div",null,[s("div",Go,r(g.__("Details")),1),E(a(He),{content:d.reply,onChange:U[1]||(U[1]=v=>d.reply=v),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])]),_:1},8,["modelValue","options"]))}};function Qo(){return window.scrollContainer}const Jo={class:"text-xl font-semibold text-ink-gray-9"},Wo={key:0},Yo={key:1},Xo={key:2},Zo=["onClick"],Ko={class:"text-lg font-semibold mb-1 text-ink-gray-7"},en={class:"flex items-center text-ink-gray-5"},tn={class:"text-sm ml-3"},sn={key:1},an={key:3,class:"flex flex-col items-center justify-center border-2 border-dashed mt-5 py-8 rounded-md"},on={class:""},nn={key:0,class:"font-medium mb-2"},rn={class:"text-ink-gray-5"},ln={__name:"Discussions",props:{title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0},emptyStateTitle:{type:String,default:""},emptyStateText:{type:String,default:"Start a discussion"},singleThread:{type:Boolean,default:!1},scrollToBottom:{type:Boolean,default:!1},type:{type:String,default:"multi"}},setup(c){console.log("Discussions.vue script setup executed");const e=A(!0),t=A(null),l=Ce("$user"),d=A(!1),u=A(!0),m=A(!1),b=_s();b?(console.log("Socket connection initialized in Discussions.vue:",b),b.on("connect",()=>{console.log("Socket connected:",b.id),m.value=!0}),b.on("connect_error",_=>{console.error("Socket connection error:",_)}),b.on("disconnect",_=>{console.warn("Socket disconnected:",_),m.value=!1})):console.error("Socket connection not initialized in Discussions.vue.");const h=c;ue(m,_=>{_&&(console.log("Socket is connected, proceeding with onMounted logic."),x())});const x=()=>{console.log("onMounted logic executed"),console.log("Props:",h),l.data&&(h.type==="single"?(console.log("Single-topic mode detected"),g.reload(),console.log("Topic",t.value)):u.value=!1,U.reload()),b.on("new_discussion_topic",_=>{U.refresh()}),h.scrollToBottom&&setTimeout(()=>{w()},100)},w=()=>{let _=Qo();_.scrollTop=_.scrollHeight},g=J({url:"seminary.seminary.utils.ensure_single_topic",cache:!1,makeParams(){return{doctype:h.doctype,docname:h.docname,title:h.title}},onSuccess(_){console.log("Ensure single topic response:",_),_&&(t.value=_,console.log("Current topic set:",t.value),e.value=!1,u.value=!1),console.log("Changed loading to:",u.value)},onError(_){console.error("Error ensuring single topic:",_),u.value=!1}}),U=J({url:"seminary.seminary.utils.get_discussion_topics",cache:["topics",h.doctype,h.docname],makeParams(){return{doctype:h.doctype,docname:h.docname,single_thread:h.singleThread}}}),v=_=>{e.value=!1,t.value=_},ae=()=>{d.value=!0};return(_,H)=>{var R;return o(),i(de,null,[s("div",null,[!c.singleThread&&h.type==="multi"?(o(),z(a(j),{key:0,class:"float-right",onClick:H[0]||(H[0]=k=>ae())},{default:O(()=>[ie(r(_.__("New {0}").format(a(Pt)(c.title))),1)]),_:1})):D("",!0),s("div",Jo,r(_.__(c.title)),1)]),u.value&&h.type==="single"?(o(),i("div",Wo,[...H[6]||(H[6]=[s("div",{class:"text-center py-10"},[s("span",null,"Loading discussion...")],-1)])])):D("",!0),h.type==="single"&&!u.value?(o(),i("div",Yo,[H[7]||(H[7]=s("div",{class:"flex flex-col items-center justify-center"},null,-1)),E(xt,{modelValue:d.value,"onUpdate:modelValue":H[1]||(H[1]=k=>d.value=k),title:c.title,doctype:h.doctype,docname:h.docname},null,8,["modelValue","title","doctype","docname"]),t.value.value?(o(),z(kt,{key:0,topic:t.value.value,singleThread:!0,showTopics:e.value,"onUpdate:showTopics":H[2]||(H[2]=k=>e.value=k)},null,8,["topic","showTopics"])):D("",!0)])):D("",!0),(R=a(U).data)!=null&&R.length&&!c.singleThread?(o(),i("div",Xo,[e.value?(o(!0),i(de,{key:0},pe(a(U).data,(k,I)=>(o(),i("div",{key:I},[s("div",{onClick:L=>v(k),class:Oe(["flex items-center cursor-pointer py-5 w-full",{"border-b":I+1!=a(U).data.length}])},[E(Lt,{user:k.user,size:"2xl",class:"mr-4"},null,8,["user"]),s("div",null,[s("div",Ko,r(k.title),1),s("div",en,[s("span",null,r(k.user.full_name),1),s("span",tn,r(a(st)(k.creation)),1)])])],10,Zo)]))),128)):(o(),i("div",sn,[E(kt,{topic:t.value,showTopics:e.value,"onUpdate:showTopics":H[3]||(H[3]=k=>e.value=k)},null,8,["topic","showTopics"])]))])):(o(),i("div",an,[E(a(Yt),{class:"w-7 h-7 text-ink-gray-4 stroke-1.5 mr-2"}),s("div",on,[c.emptyStateTitle?(o(),i("div",nn,r(_.__(c.emptyStateTitle)),1)):D("",!0),s("div",rn,r(_.__(c.emptyStateText)),1)])])),E(xt,{modelValue:d.value,"onUpdate:modelValue":H[4]||(H[4]=k=>d.value=k),title:_.__("New {0}").format(c.title),doctype:h.doctype,docname:h.docname,reloadTopics:a(U),"onUpdate:reloadTopics":H[5]||(H[5]=k=>pt(U)?U.value=k:null)},null,8,["modelValue","title","doctype","docname","reloadTopics"])],64)}}},un={key:0},dn={key:0,class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},cn={class:"leading-5"},mn={key:0,class:"leading-5"},pn={key:1,class:"leading-5"},fn={key:1,class:"space-y-4 border p-5 rounded-md"},hn={key:2,class:"flex flex-col space-x-1 my-4"},vn={class:"mb-2"},gn={class:"font-semibold"},_n={key:3},yn={class:"border text-center p-20 rounded-md"},bn={class:"font-semibold text-lg"},kn={key:2,class:"w-full max-w-4xl mx-auto py-5"},xn={key:3},wn={key:4},$n={class:"border text-center p-20 rounded-md"},Sn={class:"font-semibold text-lg text-ink-gray-9 mt-3 mb-3"},Cn={class:"absolute -top-3 -left-3 bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm"},Tn={class:"text-ink-gray-9 text-sm font-semibold text-right"},An={class:"text-ink-gray-9 text-left font-semibold mt-2 leading-5"},Dn=["innerHTML"],Fn={class:"mt-4"},Mn=["onUpdate:modelValue","onInput"],En={class:"text-center mt-4"},Nn={__name:"Exam",props:{examName:{type:String,required:!0}},setup(c){var P,W;const e=Ce("$user"),t=A(0);let l=null;const d=A(0);A("");const u=A({});A([]);const m=A(!1),b=Ke();let h=!1;const x=(C=[])=>{const q=qe({},u.value),X={};C.forEach(ce=>{const he=q[ce.name];X[ce.name]=typeof he=="string"?he:""}),u.value=X},w=c;console.log("Exam Name (PROPS):",w.examName);const g=J({url:"frappe.client.get",makeParams(C){return{doctype:"Exam Activity",name:w.examName}},cache:["exam",w.examName],auto:!0,transform(C){return C?(C.duration=parseInt(C.duration)||0,C):(console.error("Exam data is null or undefined."),null)},onSuccess(C){C?(C.questions=C.questions||[],x(C.questions)):console.error("Failed to load exam data.")},onError(C){console.error("Error loading exam data:",C)}}),U=oe(()=>!!g.data),v=oe(()=>{var C;return((C=se.data)==null?void 0:C.length)>0}),ae=J({url:"seminary.seminary.utils.get_instructors",makeParams(C){const q=b.currentRoute.value.params.courseName;return q?{course:q}:(console.error("Course name is undefined in route parameters."),{})},auto:!0});ue(()=>ae.data,C=>{var X,ce;if(!Array.isArray(C))return;const q=h;h=C.some(he=>{var f;return he.user===((f=e.data)==null?void 0:f.name)}),!q&&h&&((ce=(X=g.data)==null?void 0:X.questions)!=null&&ce.length)&&x(g.data.questions)});const _=()=>(ae.data&&ae.data.forEach(C=>{var q;C.user===((q=e.data)==null?void 0:q.name)&&(h=!0)}),h);let H=null;const R=()=>{if(g.data.duration){t.value=g.data.duration*60,H=Date.now();const C=H+t.value*1e3;l=setInterval(()=>{const q=Date.now(),X=Math.max(0,Math.floor((C-q)/1e3));t.value=X,d.value=g.data.duration*60-X,X<=0&&(clearInterval(l),ne())},1e3)}else H=Date.now(),l=setInterval(()=>{const C=Date.now();d.value=Math.floor((C-H)/1e3)},1e3)},k=C=>{const q=Math.floor(C/60).toString().padStart(2,"0"),X=(C%60).toString().padStart(2,"0");return`${q}:${X}`},I=oe(()=>t.value/(g.data.duration*60)*100);ue(u,C=>{},{deep:!0});const L=()=>{const C=Dt(u.value);return Object.entries(C).map(([q,X])=>({question:q,answer:X}))},K=(C,q)=>{u.value[C]=q},se=J({url:"frappe.client.get_list",makeParams(C){var q;return{doctype:"Exam Submission",filters:{member:(q=e.data)==null?void 0:q.name,exam:w.examName},fields:["name","creation"],order_by:"creation desc"}},auto:!0,transform(C){C.forEach((q,X)=>{q.creation=st(q.creation),q.idx=X+1})}});ue(()=>se.data,C=>{console.log("Attempts data updated:",C)});const ne=()=>te(this,null,function*(){var C,q;try{const X=L(),ce=g.data.duration?g.data.duration*60-(t.value||0):d.value||0;yield Ue("seminary.seminary.doctype.exam_submission.exam_submission.create_exam_submission",{exam:w.examName,course:b.currentRoute.value.params.courseName,member:(C=e.data)==null?void 0:C.name,answers:X,time_taken:ce}),ke.success(__("Your exam was submitted successfully.")),clearInterval(l)}catch(X){console.error("Error during exam submission:",X),ke.error(((q=err.messages)==null?void 0:q[0])||err)}}),re=()=>{var C;activeQuestion.value=1,localStorage.removeItem(g.data.title),R(),x(((C=g.data)==null?void 0:C.questions)||[])},Y=()=>{var C;localStorage.removeItem(g.data.title),m.value=!0,R(),x(((C=g.data)==null?void 0:C.questions)||[])},ve=J({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:w.examName,member:(P=e.data)==null?void 0:P.name,status:"Graded"}},auto:!1,transform(C){return console.log("Fetched submission data:",C),C},onError(C){console.error("Error fetching submission:",C)}}),S=J({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:w.examName,member:(W=e.data)==null?void 0:W.name}},auto:!1,transform(C){return console.log("Fetched submission AnyStatus:",C.name),C},onError(C){console.error("Error fetching submission:",C)}});return Ee(()=>{ve.reload(),S.reload()}),mt(()=>{l&&clearInterval(l)}),(C,q)=>{var ce,he,f,T,N,F,V,_e,be,me,Se,we,y,p;const X=Xt("router-link");return U.value?(o(),i("div",un,[v.value?D("",!0):(o(),i("div",dn,[s("div",cn,r(`This exam consists of ${a(g).data.questions.length}`)+" "+r(a(g).data.questions.length===1?"question":"questions")+". ",1),(ce=a(g).data)!=null&&ce.duration?(o(),i("div",mn,r(`Please ensure that you complete all the questions in ${a(g).data.duration} minutes.`),1)):D("",!0),(he=a(g).data)!=null&&he.duration?(o(),i("div",pn,r("If you fail to do so, the exam will be automatically submitted when the timer ends."))):D("",!0)])),v.value&&((f=a(S))!=null&&f.data||(T=a(se).data)!=null&&T[0])?(o(),i("div",fn,[(o(),z(ln,{title:"Exam Comments",doctype:"Exam Submission",docname:((F=(N=a(S))==null?void 0:N.data)==null?void 0:F.name)||((_e=(V=a(se).data)==null?void 0:V[0])==null?void 0:_e.name),key:((me=(be=a(S))==null?void 0:be.data)==null?void 0:me.name)||((we=(Se=a(se).data)==null?void 0:Se[0])==null?void 0:we.name),type:"single"},null,8,["docname"]))])):D("",!0),a(g).data.duration&&!v.value?(o(),i("div",hn,[s("div",vn,[q[0]||(q[0]=s("span",{class:""},r("Time")+": ",-1)),s("span",gn,r(k(t.value)),1)]),E(It,{progress:I.value},null,8,["progress"])])):D("",!0),!m.value&&!_()?(o(),i("div",_n,[s("div",yn,[s("div",bn,r(a(g).data.title),1),a(g).data.qbyquestion&&!v.value?(o(),z(a(j),{key:0,onClick:re,class:"mt-2"},{default:O(()=>[...q[1]||(q[1]=[s("span",null,r("Start"),-1)])]),_:1})):v.value?v.value&&((p=(y=a(ve))==null?void 0:y.data)!=null&&p.name)?(o(),i("div",kn,[E(Po,{submission:a(ve).data.name},null,8,["submission"])])):(o(),i("div",xn,r("You have already submitted this exam. As soon as it is graded, you will see the feedback here."))):(o(),z(a(j),{key:1,onClick:Y,class:"mt-2"},{default:O(()=>[...q[2]||(q[2]=[s("span",null,r("Start Exam"),-1)])]),_:1}))])])):D("",!0),m.value||_()?(o(),i("div",wn,[s("div",$n,[s("div",Sn,r(a(g).data.title),1),_()?(o(),z(X,{key:0,to:{name:"ExamForm",params:{examID:a(g).data.name}},class:"flex items-center text-gray-400 mb-3 mr-4 hover:text-gray-600"},{default:O(()=>[E(a(Zt),{class:"w-5 h-5 mr-2"}),q[3]||(q[3]=s("span",{class:"tooltip","data-tooltip":"Edit this exam"},"Edit",-1))]),_:1},8,["to"])):D("",!0),(o(!0),i(de,null,pe(a(g).data.questions,(B,ee)=>(o(),i("div",{key:B.name,class:"relative border rounded-md p-5 mb-4"},[s("div",Cn,r(ee+1),1),s("div",Tn,r(B.points)+" "+r(B.points===1?"Point":"Points"),1),s("div",An,[s("div",{innerHTML:B.question_detail||"No question detail provided."},null,8,Dn)]),s("div",Fn,[u.value&&u.value[B.name]!==void 0?$e((o(),i("textarea",{key:0,"onUpdate:modelValue":le=>u.value[B.name]=le,rows:"7",class:"border rounded-md p-2 w-full resize-y",placeholder:"Type your answer here",onInput:le=>K(B.name,le.target.value)},null,40,Mn)),[[Ne,u.value[B.name]]]):D("",!0)])]))),128)),s("div",En,[E(a(j),{onClick:ne},{default:O(()=>[...q[4]||(q[4]=[s("span",null,r("Submit Your Exam"),-1)])]),_:1})])])])):D("",!0)])):D("",!0)}}},In={key:1,class:"border rounded-md text-center py-20"},Ln={__name:"ExamBlock",props:{exam:{type:String,required:!0}},setup(c){const e=Ce("$user"),t=()=>{window.location.href="/login"};return(l,d)=>a(e).data?(o(),z(Nn,{key:0,examName:c.exam},null,8,["examName"])):(o(),i("div",In,[s("div",null,r(l.__("Please login to access the exam.")),1),E(a(j),{onClick:d[0]||(d[0]=u=>t()),class:"mt-2"},{default:O(()=>[s("span",null,r(l.__("Login")),1)]),_:1})]))}};class Pn{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(Kt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Exam"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderExam(this.data.exam):this.renderExamModal(),this.wrapper}renderExam(e){if(this.readOnly){const t=fe(Ln,{exam:e});t.use(De),t.use(Me);const{userResource:l}=et();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Exam: ${e}
            </span>
        </div>`}renderExamModal(){if(this.readOnly)return;const e=fe(tt,{type:"exam",onAddition:t=>{this.data.exam=t,this.renderExam(t)}});e.use(De),e.use(Me),e.mount(this.wrapper)}save(e){return{exam:this.data.exam}}}const zn={class:"border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},Rn={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},qn={key:0},Un={key:1},On={class:"text-lg text-ink-gray-7 font-medium mb-2"},Vn=["innerHTML"],Hn={key:1,class:"flex-1 border-l p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},Bn={key:0,class:"mb-4 mt-4"},jn={for:"groupFilter",class:"block text-sm font-medium text-gray-700"},Gn={value:"all"},Qn=["value"],Jn={class:"original-post mb-4"},Wn={class:"font-semibold"},Yn=["innerHTML"],Xn={class:"text-sm text-ink-gray-5 mt-1 mb-2"},Zn=["href"],Kn={class:"replies pl-4 border-l border-gray-300"},er={class:"font-semibold"},tr={class:"text-sm text-ink-gray-5 mt-1 mb-2"},sr=["innerHTML"],ar=["href"],or={class:"new-reply mt-4 space-y-2"},nr=["onUpdate:modelValue","placeholder"],rr={class:"flex items-center justify-between"},lr={class:"flex items-center space-x-3"},ir={key:1,class:"flex items-center space-x-2 text-ink-gray-7"},ur={class:"border rounded-md p-2"},dr={class:"flex flex-col leading-5"},cr={class:"text-sm"},mr={class:"text-xs text-ink-gray-5"},pr={key:2,class:"text-ink-gray-5 mt-5"},fr={key:3,class:"text-ink-gray-5 mt-5"},hr={key:0,class:"mt-8 space-y-4"},vr={class:"font-semibold mb-2 text-ink-gray-9"},gr={class:"text-sm text-ink-gray-5 mb-1"},_r={key:1,class:"text-md mb-4"},yr={class:"flex flex-col"},br={class:"p-5"},kr={class:"flex items-center justify-between mb-4"},xr={class:"flex items-center space-x-2"},wr={key:0,class:"text-md mb-4"},$r={class:"text-md text-ink-gray-5 mt-1 mb-2"},Sr={key:1},Cr={class:"flex text-ink-gray-7"},Tr={class:"border self-start rounded-md p-2 mr-2"},Ar=["href"],Dr={class:"text-sm leading-5"},Fr={class:"text-sm text-ink-gray-5 mt-1"},Mr={key:2,class:"text-md mb-4 ml-2"},Er={class:"text-sm text-ink-gray-5 font-medium mb-2 mt-4"},Nr={class:"font-semibold mb-1"},Ir=["href"],Lr={class:"replies pl-4 border-l border-gray-300"},Pr={class:"font-semibold"},zr={class:"text-sm text-ink-gray-5 mt-1 mb-2"},Rr=["innerHTML"],qr=["href"],Ur={class:"new-reply mt-4 space-y-2"},Or=["onUpdate:modelValue","placeholder"],Vr={class:"flex items-center justify-between"},Hr={class:"flex items-center space-x-3"},Br={key:1,class:"flex items-center space-x-2 text-ink-gray-7"},jr={class:"border rounded-md p-2"},Gr={class:"flex flex-col leading-5"},Qr={class:"text-sm"},Jr={class:"text-xs text-ink-gray-5"},Wr={key:3,class:"mt-8 p-3 bg-blue-200 rounded-md"},Yr={class:"text-sm text-ink-gray-5 font-medium mb-2"},Xr={class:"leading-5"},Zr=["innerHTML"],Kr={__name:"DiscussionActivity",props:{discussionID:{type:String,required:!0},submissionName:{type:String,default:"new"},canGradeSubmission:{type:Boolean,default:!1,required:!1}},setup(c){var ge;const e=typeof lt=="function"?lt:lt.default;e.extend(es);const t=A(null),l=A(""),d=A(""),u=Ke(),m=Ce("$user"),b=u.currentRoute.value.name=="DiscussionActivitySubmission",h=A(!1),x=A({}),w=oe(()=>{var n;return((n=m.data)==null?void 0:n.is_student)||!1}),g=A([]),U=A("all"),v=A(""),ae=oe(()=>u.currentRoute.value.params.courseName),_=oe(()=>K.discussionID),H=oe(()=>{var n;return(n=m.data)==null?void 0:n.name}),R=(n,$)=>{x.value=Ge(qe({},x.value),{[n]:$})},k=oe(()=>{ae.value&&_.value&&H.value}),I=n=>{const ye=x.value,{[n]:$}=ye,Z=gt(ye,[vt(n)]);x.value=Z},L=n=>!!(n!=null&&n.new_reply&&n.new_reply.toString().trim().length),K=c;Ee(()=>{var n;window.addEventListener("keydown",se),console.log("User: ",(n=m.data)==null?void 0:n.name),console.log("Discussion ID: ",K.discussionID),console.log("Course Name: ",u.currentRoute.value.params.courseName),X(),W.reload().then(()=>{var $;console.log("Student data after reload:",v.value),console.log("Student group:",($=v.value)==null?void 0:$.student_group)}),console.log("Saved Submission Data on Mount:",C.data),console.log("hasSavedSubmission:",q.value),xe(),ce.value});const se=n=>{n.key==="s"&&(n.ctrlKey||n.metaKey)&&(V(),n.preventDefault())};mt(()=>{window.removeEventListener("keydown",se)});const ne=J({url:"frappe.client.get",params:{doctype:"Discussion Activity",name:K.discussionID},auto:!0,onSuccess(n){K.submissionName!="new"&&F.reload()}});console.log("Submission Name: ",K.submissionName);const re=oe(()=>{var n;return(n=ne.data)==null?void 0:n.post_before}),Y=n=>n&&n.includes(".")?e(n.split(".")[0]).fromNow():e(n).fromNow();function ve(){const n=new Date,$=Math.floor(n.getMilliseconds()*1e3);return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}.${String($).padStart(6,"0")}`}const S=n=>{var Ae,Ie,Le;if(!L(n))return;const $=x.value[n.name],Z=((Ae=v.value)==null?void 0:Ae.student)||null,ye=((Ie=v.value)==null?void 0:Ie.student_name)||((Le=m.data)==null?void 0:Le.full_name),Te=ve();T.submit({name:n.name,reply:n.new_reply,reply_attach:$,student:Z,member_name:ye,parent:n.name,reply_dt:Te,parentfield:"replies",parenttype:"Discussion Submission"},{onSuccess(){ke.success(__("Reply posted successfully")),n.new_reply="",$&&I(n.name),he()},onError(Be){var M;ke.error(((M=Be.messages)==null?void 0:M[0])||Be)}})},P=J({url:"seminary.seminary.api.get_discussion_submissions",makeParams(n){return{course_name:u.currentRoute.value.params.courseName,discussion_id:K.discussionID}},auto:!1,onSuccess(n){n==null||n.forEach($=>{$&&typeof $.new_reply=="undefined"&&($.new_reply="")}),console.log("All Discussions Data Fetched: ",n)}}),W=J({url:"seminary.seminary.api.get_student_group",makeParams(n){var $;return{course_name:u.currentRoute.value.params.courseName,user:($=m.data)==null?void 0:$.name}},auto:!1,onSuccess(n){v.value=n,console.log("Student fetched:",v.value)}}),C=J({url:"seminary.seminary.api.get_user_discussion_submission",makeParams(n){var $;return{course_name:u.currentRoute.value.params.courseName,discussion_id:K.discussionID,owner:($=m.data)==null?void 0:$.name}},auto:!1,onSuccess(n){console.log("Saved submission fetched:",n)}}),q=oe(()=>Array.isArray(C.data)&&C.data.length>0);ue(k,n=>te(this,null,function*(){n&&(yield X())}));const X=()=>te(this,null,function*(){try{yield P.reload({course_name:ae.value,discussion_id:_.value}),yield C.reload({course_name:ae.value,discussion_id:_.value,owner:H.value})}catch(n){console.error("Error reloading discussion lists:",n)}}),ce=oe(()=>{var $;let n=Dt(P.data);if(console.log("Discussions before filtering: ",n),w.value)if(($=ne.data)!=null&&$.use_studentgroup){let Z=G;return n.filter(ye=>ye.student_group===Z.value)}else return n;else return!w.value&&U.value!=="all"?n.filter(Z=>Z.student_group===U.value):n}),he=()=>{X()},f=J({url:"frappe.client.insert",makeParams(n){var Z,ye,Te,Ae,Ie,Le;return{doc:{doctype:"Discussion Submission",disc_activity:K.discussionID,disc_title:(Z=ne.data)==null?void 0:Z.discussion_name,member:(ye=m.data)==null?void 0:ye.name,coursesc:u.currentRoute.value.params.courseName,original_post:l.value,original_attachment:((Te=t.value)==null?void 0:Te.file_url)||null,student_name:((Ae=v.value)==null?void 0:Ae.student_name)||((Ie=m.data)==null?void 0:Ie.full_name),student:((Le=v.value)==null?void 0:Le.student)||null}}}}),T=J({url:"frappe.client.insert",makeParams(n){var Z,ye;const $=n.reply_attach;return{doc:{doctype:"Discussion Submission Replies",member:(Z=m.data)==null?void 0:Z.name,reply:n.reply,student:n.student,member_name:n.member_name||((ye=m.data)==null?void 0:ye.full_name),reply_dt:n.reply_dt,parent:n.name,parentfield:"replies",parenttype:"Discussion Submission",reply_attach:($==null?void 0:$.file_url)||null}}},auto:!1}),N=J({url:"seminary.seminary.api.get_file_info",makeParams(n){return{file_url:n.image}},auto:!1,onSuccess(n){t.value=n}}),F=ct({doctype:"Discussion Submission",name:K.submissionName,onError(n){var $;ke.error((($=n.messages)==null?void 0:$[0])||n)},auto:!1,cache:[(ge=m.data)==null?void 0:ge.name,K.discussionID]});ue(F,()=>{if(F.doc){F.doc.original_attachment&&N.reload({image:F.doc.original_attachment}),l.value=F.doc.original_post||"",console.log("Original Post: ",l.value),d.value=F.doc.comments||"";const n=!!t.value,$=!!l.value;F.isDirty||!n&&!$?h.value=!0:h.value=!1}}),ue(t,()=>{K.submissionName=="new"&&t.value&&(h.value=!0)}),ue(()=>{var n;return(n=F.doc)==null?void 0:n.grade},(n,$)=>{n!==$&&F.doc&&(F.doc.status="Graded",h.value=!0)});const V=()=>{var n,$,Z;if(K.submissionName!="new"){let ye=F.doc&&F.doc.owner!=((n=m.data)==null?void 0:n.name)?($=m.data)==null?void 0:$.name:null;F.setValue.submit(Ge(qe({},F.doc),{original_attachment:(Z=t.value)==null?void 0:Z.file_url,evaluator:ye,comments:d.value,original_post:l.value}),{onSuccess(Te){ke.success(__("Changed successfully")),h.value=!1,he()}})}else _e()},_e=()=>{f.submit({},{onSuccess(n){ke.success(__("Discussion submitted successfully")),u.currentRoute.value.name=="DiscussionSubmission"?u.push({name:"DiscussionSubmission",params:{discussionID:K.discussionID,submissionName:n.name}}):(me(),u.go()),F.name=n.name,h.value=!1,F.reload(),he()},onError(n){var $;ke.error((($=n.messages)==null?void 0:$[0])||n)}})},be=n=>{h.value=!0,t.value=n},me=()=>{if(u.currentRoute.value.name=="Lesson"){let n=u.currentRoute.value.params.courseName,$=u.currentRoute.value.params.chapterNumber,Z=u.currentRoute.value.params.lessonNumber;console.log("Chapter Number: ",$),console.log("Lesson Number: ",Z),Ue("seminary.seminary.api.mark_lesson_progress",{course:n,chapter_number:$,lesson_number:Z})}},Se=()=>["image/*",".pdf",".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],we=n=>{var Te,Ae;const $=(Te=n.name.split(".").pop())==null?void 0:Te.toLowerCase(),Z=["jpg","jpeg","png","gif","pdf","doc","docx","xml"];if(!((Ae=n.type)!=null&&Ae.startsWith("image/"))&&(!$||!Z.includes($)))return"Only images, PDF, or Word documents are allowed."},y=()=>{h.value=!0,t.value=null},p=oe(()=>{var n,$,Z;return(((n=m.data)==null?void 0:n.is_moderator)||(($=m.data)==null?void 0:$.is_evaluator)||((Z=m.data)==null?void 0:Z.is_instructor))&&K.submissionName!="new"&&u.currentRoute.value.name=="DiscussionActivitySubmission"}),B=oe(()=>{var n,$,Z;return!F.doc||((n=F.doc)==null?void 0:n.owner)==(($=m.data)==null?void 0:$.name)&&((Z=F.doc)==null?void 0:Z.status)=="Not Graded"}),ee=oe(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),le=oe(()=>F.doc?F.doc.status=="Pass"||F.doc.status=="Graded"?"green":F.doc.status=="Not Graded"?"blue":"red":"orange"),xe=()=>{if(!u.currentRoute.value.params.courseName){console.warn("Cannot fetch student groups: Missing course name.");return}Ue("seminary.seminary.api.get_student_groups_simple",{course_name:u.currentRoute.value.params.courseName}).then(n=>{g.value=n||[],console.log("Student groups fetched:",g.value)}).catch(n=>{console.error("Error fetching student groups:",n)})},G=oe(()=>{var n;return W.loading?__("Loading..."):((n=v.value)==null?void 0:n.student_group)||__("No group assigned")});return ue(()=>W.loading,n=>{n||console.log("Student data loaded on watch:",W.data)}),ue(()=>U.value,n=>{console.log("Selected group changed to:",n),ce.value}),(n,$)=>{var Z,ye,Te,Ae,Ie,Le,Be;return a(ne).data?(o(),i("div",{key:0,class:Oe(["grid grid-cols-[65%,35%] h-full",{"border rounded-lg":!b}])},[s("div",zn,[b?(o(),i("div",Rn,[c.submissionName==="new"?(o(),i("div",qn,r(n.__("Submission by"))+" "+r((Z=a(m).data)==null?void 0:Z.full_name),1)):(o(),i("div",Un,r(n.__("Submission by"))+" "+r((ye=a(F).doc)==null?void 0:ye.member_name),1))])):D("",!0),s("div",On,r(n.__("Discussion Prompt"))+": ",1),s("div",{innerHTML:a(ne).data.prompt,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,Vn),a(P).data&&(q.value||!q.value&&!re.value||!w.value)?(o(),i("div",Hn,[w.value?D("",!0):(o(),i("div",Bn,[s("label",jn,r(n.__("Filter by Group")),1),$e(s("select",{id:"groupFilter","onUpdate:modelValue":$[0]||($[0]=M=>U.value=M),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[s("option",Gn,r(n.__("All Groups")),1),(o(!0),i(de,null,pe(g.value,M=>(o(),i("option",{key:M.student_group,value:M.student_group},r(M.student_group||"No group"),9,Qn))),128))],512),[[ts,U.value]])])),(o(!0),i(de,null,pe(ce.value,M=>(o(),i("div",{key:M.name,class:"mb-6 border-round border-gray-300 p-4 bg-surface-white shadow-sm"},[s("div",Jn,[s("div",Wn,r(M.student_name),1),s("div",{innerHTML:M.original_post,class:"text-sm"},null,8,Yn),s("div",Xn,r(Y(M.creation)),1),M.original_attachment?(o(),i("a",{key:0,href:M.original_attachment,target:"_blank",class:"text-blue-500 underline"},r(n.__("View Attachment")),9,Zn)):D("",!0)]),s("div",Kn,[(o(!0),i(de,null,pe(M.replies,Q=>(o(),i("div",{key:Q.creation,class:"mb-2"},[s("div",er,r(Q.member_name||Q.owner),1),s("div",tr,r(Y(Q.reply_dt)),1),s("div",{innerHTML:Q.reply,class:"text-sm"},null,8,sr),Q.reply_attach?(o(),i("a",{key:0,href:Q.reply_attach,target:"_blank",class:"text-blue-500 underline"},r(n.__("View Attachment")),9,ar)):D("",!0)]))),128))]),s("div",or,[$e(s("textarea",{"onUpdate:modelValue":Q=>M.new_reply=Q,placeholder:n.__("Write a reply..."),class:"prose-sm max-w-none border border-outline-gray-3 bg-surface-gray-2 rounded-md py-2 px-3 min-h-[6rem] w-full focus:outline-none"},null,8,nr),[[Ne,M.new_reply]]),s("div",rr,[s("div",lr,[x.value[M.name]?(o(),i("div",ir,[s("div",ur,[E(a(Xe),{class:"h-4 w-4"})]),s("div",dr,[s("span",cr,r(x.value[M.name].file_name),1),s("span",mr,r(a(Ze)(x.value[M.name].file_size)),1)]),E(a(j),{variant:"subtle",size:"sm",onClick:Q=>I(M.name)},{default:O(()=>[ie(r(n.__("Remove")),1)]),_:1},8,["onClick"])])):(o(),z(a(We),{key:0,fileTypes:Se(),validateFile:we,onSuccess:Q=>R(M.name,Q)},{default:O(({uploading:Q,progress:je,openFileSelector:at})=>[E(a(j),{onClick:at,loading:Q,variant:"outline"},{default:O(()=>[ie(r(Q?n.__("Uploading {0}%").format(je):n.__("Attach File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes","onSuccess"]))]),E(a(j),{variant:"solid",disabled:!L(M),onClick:Q=>S(M)},{default:O(()=>[ie(r(n.__("Post Reply")),1)]),_:1},8,["disabled","onClick"])])])]))),128))])):!q.value&&re.value&&w.value?(o(),i("div",pr,r(n.__("You have to make your original post before seeing other posts.")),1)):(o(),i("div",fr,r(n.__("No discussions available yet."))+" "+r("All discussions",a(P).data)+" "+r("hasSavedSubmission",q.value),1))]),p.value?(o(),i("div",hr,[s("div",vr,r(n.__("Grading")),1),a(F).doc?(o(),z(a(ze),{key:0,modelValue:a(F).doc.status,"onUpdate:modelValue":$[1]||($[1]=M=>a(F).doc.status=M),label:n.__("Grading Status"),type:"select",options:ee.value},null,8,["modelValue","label","options"])):D("",!0),a(F).doc?(o(),z(a(ze),{key:1,modelValue:a(F).doc.grade,"onUpdate:modelValue":$[2]||($[2]=M=>a(F).doc.grade=M),label:n.__("Score"),type:"number"},null,8,["modelValue","label"])):D("",!0),s("div",null,[s("div",gr,r(n.__("Comments")),1),$e(s("textarea",{"onUpdate:modelValue":$[3]||($[3]=M=>d.value=M),onInput:$[4]||($[4]=M=>h.value=!0),class:"prose-sm max-w-none border border-outline-gray-3 bg-surface-gray-2 rounded-md py-2 px-3 min-h-[7rem] w-full focus:outline-none"},null,544),[[Ne,d.value]])])])):D("",!0),q.value?(o(),i("div",Mr,[s("div",Er,r(n.__("Your submission has been saved:")),1),(o(!0),i(de,null,pe(a(C).data,M=>(o(),i("div",{key:M.name||M.creation},[s("div",Nr,r(Y(M.creation)),1),s("div",null,r(M.original_post),1),M.original_attachment?(o(),i("a",{key:0,href:M.original_attachment,target:"_blank",class:"text-blue-500 underline"},r(n.__("View Attachment")),9,Ir)):D("",!0),s("div",Lr,[(o(!0),i(de,null,pe(M.replies,Q=>(o(),i("div",{key:Q.creation,class:"mb-2"},[s("div",Pr,r(Q.member_name||Q.owner),1),s("div",zr,r(Y(Q.reply_dt)),1),s("div",{innerHTML:Q.reply,class:"text-sm"},null,8,Rr),Q.reply_attach?(o(),i("a",{key:0,href:Q.reply_attach,target:"_blank",class:"text-blue-500 underline"},r(n.__("View Attachment")),9,qr)):D("",!0)]))),128))]),s("div",Ur,[$e(s("textarea",{"onUpdate:modelValue":Q=>M.new_reply=Q,placeholder:n.__("Write a reply..."),class:"prose-sm max-w-none border border-outline-gray-3 bg-surface-gray-2 rounded-md py-2 px-3 min-h-[6rem] w-full focus:outline-none"},null,8,Or),[[Ne,M.new_reply]]),s("div",Vr,[s("div",Hr,[x.value[M.name]?(o(),i("div",Br,[s("div",jr,[E(a(Xe),{class:"h-4 w-4"})]),s("div",Gr,[s("span",Qr,r(x.value[M.name].file_name),1),s("span",Jr,r(a(Ze)(x.value[M.name].file_size)),1)]),E(a(j),{variant:"subtle",size:"sm",onClick:Q=>I(M.name)},{default:O(()=>[ie(r(n.__("Remove")),1)]),_:1},8,["onClick"])])):(o(),z(a(We),{key:0,fileTypes:Se(),validateFile:we,onSuccess:Q=>R(M.name,Q)},{default:O(({uploading:Q,progress:je,openFileSelector:at})=>[E(a(j),{onClick:at,loading:Q,variant:"outline"},{default:O(()=>[ie(r(Q?n.__("Uploading {0}%").format(je):n.__("Attach File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes","onSuccess"]))]),E(a(j),{variant:"solid",disabled:!L(M),onClick:Q=>S(M)},{default:O(()=>[ie(r(n.__("Post Reply")),1)]),_:1},8,["disabled","onClick"])])])]))),128))])):(o(),i("div",_r,[s("div",yr,[s("div",br,[s("div",kr,[s("div",xr,[h.value?(o(),z(a(Pe),{key:0,theme:"orange"},{default:O(()=>[ie(r(n.__("Not Saved")),1)]),_:1})):(Te=a(F).doc)!=null&&Te.status?(o(),z(a(Pe),{key:1,theme:le.value,size:"lg"},{default:O(()=>{var M;return[ie(r((M=a(F).doc)==null?void 0:M.status),1)]}),_:1},8,["theme"])):D("",!0),E(a(j),{variant:"solid",onClick:$[5]||($[5]=M=>V())},{default:O(()=>[ie(r(n.__("Save")),1)]),_:1})])]),q.value?D("",!0):(o(),i("div",wr,[ie(r(n.__("Write your main post here"))+" ",1),$e(s("textarea",{"onUpdate:modelValue":$[6]||($[6]=M=>l.value=M),onInput:$[7]||($[7]=M=>h.value=!0),class:"prose-sm max-w-none border border-outline-gray-3 bg-surface-gray-2 rounded-md py-2 px-3 min-h-[7rem] w-full focus:outline-none"},null,544),[[Ne,l.value]]),s("div",$r,r(n.__("You may also add an attachment")),1),t.value?(o(),i("div",Sr,[s("div",Cr,[s("div",Tr,[E(a(Xe),{class:"h-5 w-5 stroke-1.5"})]),s("a",{href:t.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[s("span",Dr,r(t.value.file_name),1),s("span",Fr,r(a(Ze)(t.value.file_size)),1)],8,Ar),B.value?(o(),z(a(Tt),{key:0,onClick:$[9]||($[9]=M=>y()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):D("",!0)])])):(o(),z(a(We),{key:0,fileTypes:Se(),validateFile:we,onSuccess:$[8]||($[8]=M=>be(M))},{default:O(({uploading:M,progress:Q,openFileSelector:je})=>[E(a(j),{onClick:je,loading:M},{default:O(()=>[ie(r(M?n.__("Uploading {0}%").format(Q):n.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))]))])])])),((Ae=a(m).data)==null?void 0:Ae.name)==((Ie=a(F).doc)==null?void 0:Ie.owner)&&((Le=a(F).doc)!=null&&Le.comments)?(o(),i("div",Wr,[s("div",Yr,r(n.__("Comments by"))+": "+r(((Be=a(F).doc)==null?void 0:Be.evaluator)||n.__("Evaluator")),1),s("div",Xr,[s("div",{innerHTML:a(F).doc.comments},null,8,Zr)])])):D("",!0)],2)):D("",!0)}}},el={key:1,class:"border rounded-md text-center py-20"},tl={__name:"DiscussionActivityBlock",props:{discussionID:{type:String,required:!0}},setup(c){const e=Ce("$user");return console.log("Discussion ID in Block: ",c.discussionID),(l,d)=>a(e).data?(o(),z(Kr,{key:0,discussionID:c.discussionID},null,8,["discussionID"])):(o(),i("div",el,[s("div",null,r(l.__("Please login to access the Discussion Activity.")),1),E(a(j),{onClick:d[0]||(d[0]=u=>l.redirectToLogin()),class:"mt-2"},{default:O(()=>[s("span",null,r(l.__("Login")),1)]),_:1})]))}};class sl{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(ss,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Discussion Activity"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){this.wrapper=document.createElement("div");const e=this.data.discussion||this.data.discussionID;return e?this.renderDiscussionActivity(e):this.renderDiscussionActivityModal(),this.wrapper}renderDiscussionActivity(e){if(!e){console.warn("[DiscussionActivity] Missing discussion id; falling back to selector"),this.renderDiscussionActivityModal();return}if(this.readOnly){const t=fe(tl,{discussionID:e});t.use(De),t.use(Me);const{userResource:l}=et();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Discussion Activity: ${e}
            </span>
        </div>`}renderDiscussionActivityModal(){if(this.readOnly)return;const e=fe(tt,{type:"discussionactivity",onAddition:t=>{this.data.discussion=t,this.data.discussionID=t,this.renderDiscussionActivity(t)}});e.use(De),e.use(Me),e.mount(this.wrapper)}save(e){const t=this.data.discussion||this.data.discussionID;return t?{discussion:t,discussionID:t}:{}}}const al=["src"],ol={class:"flex items-center space-x-2 shadow rounded-lg p-1 w-1/2"},nl=["max"],rl={class:"text-xs text-ink-gray-9 font-medium"},ll={__name:"AudioBlock",props:{file:{type:String,required:!0}},setup(c){const e=A(!1),t=A(null);let l=A(!1),d=A(0),u=A(0);Ee(()=>{setTimeout(()=>{t.value=document.querySelector("audio"),t.value.onloadedmetadata=()=>{u.value=t.value.duration},t.value.ontimeupdate=()=>{d.value=t.value.currentTime}},0)});const m=()=>{t.value.paused?(t.value.play(),e.value=!0):(t.value.pause(),e.value=!1)},b=()=>{t.value.muted=!t.value.muted,l.value=t.value.muted},h=()=>{t.value.currentTime=d.value},x=()=>{e.value=!1},w=g=>{const U=Math.floor(g/60),v=Math.floor(g%60);return`${U}:${v<10?"0":""}${v}`};return ue(e,g=>{g?t.value.play():t.value.pause()}),(g,U)=>(o(),i("div",null,[s("audio",{onEnded:x,controlsList:"nodownload",class:"mb-4"},[s("source",{src:encodeURI(c.file),type:"audio/mp3"},null,8,al)],32),s("div",ol,[E(a(j),{variant:"ghost",onClick:m},{icon:O(()=>[e.value?(o(),z(a(Mt),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),z(a(Ft),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),$e(s("input",{type:"range",min:"0",max:a(u),step:"0.1","onUpdate:modelValue":U[0]||(U[0]=v=>pt(d)?d.value=v:d=v),onInput:h,class:"duration-slider w-full h-1"},null,40,nl),[[Ne,a(d)]]),s("span",rl,r(w(a(d)))+" / "+r(w(a(u))),1),E(a(j),{variant:"ghost",onClick:b},{icon:O(()=>[a(l)?(o(),z(a(Nt),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),z(a(Et),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1})])]))}},il=["src","type"],ul={class:"flex items-center space-x-2 bg-surface-gray-3 rounded-md p-0.5 absolute bottom-3 w-[98%] left-0 right-0 mx-auto invisible group-hover:visible"},dl=["max"],cl={class:"text-xs font-medium"},ml={__name:"VideoBlock",props:{file:{type:String,required:!0},type:{type:String,default:"video/mp4"}},setup(c){const e=A(null),t=A(null);let l=A(!1),d=A(0),u=A(0),m=A(!1);const b=c;Ee(()=>{setTimeout(()=>{e.value.onloadedmetadata=()=>{u.value=e.value.duration},e.value.ontimeupdate=()=>{d.value=e.value.currentTime}},0)});const h=oe(()=>{if(x){let k=b.file;return k.includes("watch?v=")&&(k=k.replace("watch?v=","embed/")),`${k}?autoplay=0&controls=0&disablekb=1&playsinline=1&cc_load_policy=1&cc_lang_pref=auto`}return b.file}),x=oe(()=>b.type=="video/youtube"),w=()=>{e.value.play(),l.value=!0},g=()=>{e.value.pause(),l.value=!1},U=()=>{l.value?g():w()},v=()=>{l.value=!1},ae=()=>{e.value.muted=!e.value.muted,m.value=e.value.muted},_=()=>{e.value.currentTime=d.value},H=k=>{const I=Math.floor(k/60),L=Math.floor(k%60);return`${I}:${L<10?"0":""}${L}`},R=()=>{document.fullscreenElement?document.exitFullscreen():t.value.requestFullscreen()};return(k,I)=>(o(),i("div",{ref_key:"videoContainer",ref:t,class:"video-block group relative"},[s("video",{onTimeupdate:I[0]||(I[0]=(...L)=>k.updateTime&&k.updateTime(...L)),onEnded:v,onClick:U,oncontextmenu:"return false",class:"rounded-lg border border-gray-100 group cursor-pointer",ref_key:"videoRef",ref:e},[s("source",{src:h.value,type:c.type},null,8,il)],544),s("div",ul,[E(a(j),{variant:"ghost"},{icon:O(()=>[a(l)?(o(),z(a(Mt),{key:1,onClick:g,class:"w-4 h-4 text-ink-gray-9"})):(o(),z(a(Ft),{key:0,onClick:w,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),E(a(j),{variant:"ghost",onClick:ae},{icon:O(()=>[a(m)?(o(),z(a(Nt),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),z(a(Et),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),$e(s("input",{type:"range",min:"0",max:a(u),step:"0.1","onUpdate:modelValue":I[1]||(I[1]=L=>pt(d)?d.value=L:d=L),onInput:_,class:"duration-slider w-full h-1"},null,40,dl),[[Ne,a(d)]]),s("span",cl,r(H(a(d)))+" / "+r(H(a(u))),1),E(a(j),{variant:"ghost",onClick:R},{icon:O(()=>[E(a(as),{class:"w-4 h-4 text-ink-gray-9"})]),_:1})])],512))}},pl=St(ml,[["__scopeId","data-v-edd7c5f4"]]),fl={__name:"UploadPlugin",props:{onFileUploaded:{type:Function,required:!0}},emits:["fileUploaded"],setup(c,{emit:e}){const t=A(null),l=c;Ee(()=>te(this,null,function*(){yield Ct();const m=t.value.$el.querySelector('input[type="file"]');m&&m.click()}));const d=m=>{l.onFileUploaded({file_url:m.file_url,file_type:m.file_type})},u=m=>{let b=m.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","mp4","mov","mp3","pdf"].includes(b))return"Only image and video files are allowed."};return(m,b)=>(o(),z(a(We),{fileTypes:["image/*","video/*","audio/*",".pdf"],validateFile:u,onSuccess:b[0]||(b[0]=h=>d(h)),ref_key:"fileUploader",ref:t,class:"hide"},null,512))}};class hl{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=fe({render:()=>Re(os,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Upload",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.file_url?this.renderFile(this.data):this.renderFileUploader(),this.wrapper}renderFile(e){if(this.isVideo(e.file_type)){fe(pl,{file:e.file_url}).mount(this.wrapper);return}else if(this.isAudio(e.file_type)){fe(ll,{file:e.file_url}).mount(this.wrapper);return}else if(e.file_type=="PDF"){this.wrapper.innerHTML=`<iframe src="https://docs.google.com/viewer?url=${window.location.origin}${encodeURI(e.file_url)}&embedded=true" width='100%' height='700px' class="mb-4" type="application/pdf"></iframe>`;return}else{this.wrapper.innerHTML=`<img class="mb-4" src=${encodeURI(e.file_url)} width='100%'>`;return}}renderFileUploader(){const e=fe(fl,{onFileUploaded:t=>{this.data.file_url=t.file_url,this.data.file_type=t.file_type,this.renderFile(t)}});e.use(De),e.mount(this.wrapper)}validate(e){return!(!e.file_url||!e.file_type)}save(e){return{file_url:this.data.file_url,file_type:this.data.file_type}}isVideo(e){return["mov","mp4","avi","mkv","webm"].includes(e.toLowerCase())}isAudio(e){return["mp3","wav","ogg"].includes(e.toLowerCase())}}class vl{constructor({data:e,api:t,readOnly:l,config:d}){this.api=t,this.data=e||{},this.config=d||{},this.text=e.text||"",this.readOnly=l,this.placeholder=__("Type '/' for commands or select text to format")}static get isReadOnlySupported(){return!0}static get conversionConfig(){return{export:"text",import:"text"}}static get toolbox(){const e=fe({render:()=>Re(ns,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"",icon:t.innerHTML}}onPaste(e){const t={text:e.detail.data.innerHTML};this.data=t,window.requestAnimationFrame(()=>{this.wrapper&&(this.wrapper.innerHTML=this.data.text||"")})}static get pasteConfig(){return{tags:["P"]}}render(){return this.wrapper=document.createElement("div"),this.wrapper.classList.add("cdx-block","ce-paragraph"),this.wrapper.innerHTML=this.text,this.readOnly||(this.wrapper.contentEditable=!0,this.wrapper.innerHTML=this.text,this.wrapper.addEventListener("input",e=>{let t=e.target.textContent;e.keyCode===32&&t.startsWith("#")?this.convertToHeader(e,t):e.keyCode==189?this.convertBlock("list",{style:"unordered"}):/^[a-zA-Z]/.test(e.key)?this.convertBlock("paragraph",{text:t}):(e.keyCode===13||e.keyCode===190)&&this.parseContent(e)})),this.wrapper}_togglePlaceholder(){document.querySelectorAll(".cdx-block.ce-paragraph[data-placeholder]").forEach(t=>{t!==this.wrapper&&delete t.dataset.placeholder}),this.wrapper.innerHTML.trim()===""?this.wrapper.dataset.placeholder=this.placeholder:delete this.wrapper.dataset.placeholder}convertToHeader(e,t){if(e.preventDefault(),["#","##","###","####","#####","######"].includes(t)){let l=t.length;e.target.textContent="",this.convertBlock("header",{level:l})}}parseContent(e){e.preventDefault();let t=this.wrapper.textContent;if(e.keyCode===190&&(t=t+"."),t&&this.hasImage(t))this.wrapper.textContent="",this.convertBlock("image");else if(t&&this.hasLink(t)){const{text:l,url:d}=this.extractLink(t),u=`<a href="${d}" target="_blank">${l}</a>`;this.convertBlock("paragraph",{text:t.replace(/\[.+?\]\(.+?\)/,u)})}else t&&t.startsWith("- ")?this.convertBlock("list",{style:"unordered",items:[{content:t.replace("- ","")}]}):t&&t.startsWith("1.")?this.convertBlock("list",{style:"ordered",items:[{content:t.replace("1.","")}]}):t&&this.canBeEmbed(t)?(this.wrapper.textContent="",this.convertBlock("embed",{source:t})):this.convertBlock("paragraph",{text:t})}convertBlock(e,t,l=null){return te(this,null,function*(){const d=this.api.blocks.getCurrentBlockIndex(),u=this.api.blocks.getBlockByIndex(d);yield this.api.blocks.convert(u.id,e,t),this.api.caret.focus(!0)})}save(e){return{text:e.innerHTML}}hasImage(e){return/!\[.+?\]\(.+?\)/.test(e)}extractImage(e){const t=e.match(/!\[(.+?)\]\((.+?)\)/);return t?{alt:t[1],url:t[2]}:{alt:"",url:""}}hasLink(e){return/\[.+?\]\(.+?\)/.test(e)}extractLink(e){const t=e.match(/\[(.+?)\]\((.+?)\)/);return t?{text:t[1],url:t[2]}:{text:"",url:""}}canBeEmbed(e){return/^https?:\/\/.+/.test(e.trim())}}const gl=["light","dark"],_l={none:"Auto-detect",apache:"Apache",bash:"Bash",cs:"C#",cpp:"C++",css:"CSS",coffeescript:"CoffeeScript",diff:"Diff",go:"Go",html:"HTML, XML",http:"HTTP",json:"JSON",java:"Java",javascript:"JavaScript",kotlin:"Kotlin",less:"Less",lua:"Lua",makefile:"Makefile",markdown:"Markdown",nginx:"Nginx",objectivec:"Objective-C",php:"PHP",perl:"Perl",properties:"Properties",python:"Python",ruby:"Ruby",rust:"Rust",scss:"SCSS",sql:"SQL",shell:"Shell Session",swift:"Swift",toml:"TOML, also INI",typescript:"TypeScript",yaml:"YAML",plaintext:"Plaintext"};class yl{constructor({data:e,api:t,config:l,readOnly:d}){Fe(this,"api");Fe(this,"config");Fe(this,"readOnly");Fe(this,"data");Fe(this,"highlightScriptID");Fe(this,"highlightCSSID");Fe(this,"codeArea");Fe(this,"selectInput");Fe(this,"selectDropIcon");this.api=t,this.readOnly=d,this.config={themeName:l.themeName&&typeof l.themeName=="string"?l.themeName:"",themeURL:l.themeURL&&typeof l.themeURL=="string"?l.themeURL:"",useDefaultTheme:l.useDefaultTheme&&typeof l.useDefaultTheme=="string"&&gl.includes(l.useDefaultTheme.toLowerCase())?l.useDefaultTheme:"dark"},this.data={code:e.code&&typeof e.code=="string"?e.code:"",language:e.language&&typeof e.language=="string"?e.language:"Auto-detect",theme:e.theme&&typeof e.theme=="string"?e.theme:this._getThemeURLFromConfig()},this.highlightScriptID="highlightJSScriptElement",this.highlightCSSID="highlightJSCSSElement",this.codeArea=document.createElement("div"),this.selectInput=document.createElement("input"),this.selectDropIcon=document.createElement("i"),this._injectHighlightJSCSSElement(),this.api.listeners.on(window,"click",this._closeAllLanguageSelects,!0)}static get isReadOnlySupported(){return!0}static get sanitize(){return{code:!0,language:!1,theme:!1}}static get toolbox(){const e=fe({render:()=>Re(rs,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"CodeBox",icon:t.innerHTML}}static get displayInToolbox(){return!0}static get enableLineBreaks(){return!0}render(){const e=document.createElement("pre"),t=this._createLanguageSelectElement();return e.setAttribute("class","codeBoxHolder"),this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),this.codeArea.setAttribute("contenteditable","true"),this.codeArea.innerHTML=this.data.code,this.api.listeners.on(this.codeArea,"blur",l=>this._highlightCodeArea(l),!1),this.api.listeners.on(this.codeArea,"paste",l=>this._handleCodeAreaPaste(l),!1),e.appendChild(this.codeArea),!this.readOnly&&e.appendChild(t),e}save(e){return Object.assign(this.data,{code:this.codeArea.innerHTML,theme:this._getThemeURLFromConfig()})}validate(e){return!!e.code.trim()}destroy(){this.api.listeners.off(window,"click",this._closeAllLanguageSelects,!0),this.api.listeners.off(this.codeArea,"blur",e=>this._highlightCodeArea(e),!1),this.api.listeners.off(this.codeArea,"paste",e=>this._handleCodeAreaPaste(e),!1),this.api.listeners.off(this.selectInput,"click",e=>this._handleSelectInputClick(e),!1)}_createLanguageSelectElement(){const e=document.createElement("div"),t=document.createElement("div"),l=Object.entries(_l);return e.setAttribute("class","codeBoxSelectDiv"),this.selectDropIcon.setAttribute("class",`codeBoxSelectDropIcon ${this.config.useDefaultTheme}`),this.selectDropIcon.innerHTML="&#8595;",this.selectInput.setAttribute("class",`codeBoxSelectInput ${this.config.useDefaultTheme}`),this.selectInput.setAttribute("type","text"),this.selectInput.setAttribute("readonly","true"),this.selectInput.value=this.data.language,this.api.listeners.on(this.selectInput,"click",d=>this._handleSelectInputClick(d),!1),t.setAttribute("class","codeBoxSelectPreview"),l.forEach(d=>{const u=document.createElement("p");u.setAttribute("class",`codeBoxSelectItem ${this.config.useDefaultTheme}`),u.setAttribute("data-key",d[0]),u.textContent=d[1],this.api.listeners.on(u,"click",m=>this._handleSelectItemClick(m,d),!1),t.appendChild(u)}),e.appendChild(this.selectDropIcon),e.appendChild(this.selectInput),e.appendChild(t),e}_highlightCodeArea(e){yt.highlightBlock(this.codeArea)}_handleCodeAreaPaste(e){e.stopPropagation()}_handleSelectInputClick(e){e.target.nextSibling.classList.toggle("codeBoxShow")}_handleSelectItemClick(e,t){e.target.parentNode.parentNode.querySelector(".codeBoxSelectInput").value=t[1],e.target.parentNode.classList.remove("codeBoxShow"),this.codeArea.removeAttribute("class"),this.data.language=t[0],this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),yt.highlightElement(this.codeArea)}_closeAllLanguageSelects(){const e=document.querySelectorAll(".codeBoxSelectPreview");for(let t=0,l=e.length;t<l;t++)e[t].classList.remove("codeBoxShow")}_injectHighlightJSCSSElement(){const e=document.querySelector(`#${this.highlightCSSID}`);let t=this._getThemeURLFromConfig();if(e)e.setAttribute("href",t);else{const l=document.createElement("link"),d=document.querySelector("head");l.setAttribute("rel","stylesheet"),l.setAttribute("href",t),l.setAttribute("id",this.highlightCSSID),d&&d.appendChild(l)}}_getThemeURLFromConfig(){let e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-${this.config.useDefaultTheme}.min.css`;return this.config.themeName&&(e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/${this.config.themeName}.min.css`),this.config.themeURL&&(e=this.config.themeURL),e}}const bl={class:"Folder"},kl={class:"ml-4"},xl={key:0,class:"mt-4 mb-4"},wl={key:1},$l={key:2,class:"block mt-6 space-y-6"},Sl={class:"text-sm font-medium text-ink-gray-9"},Cl={class:"mt-1 flex flex-wrap items-center gap-1 text-sm text-ink-gray-6"},Tl=["onClick"],Al={key:0},Dl={class:"flex flex-wrap items-center gap-2"},Fl=["placeholder"],Ml={class:"mb-2 text-sm font-semibold text-ink-gray-9"},El={key:0,class:"text-sm text-ink-gray-5"},Nl={key:1,class:"space-y-2"},Il=["onClick"],Ll={class:"mb-2 text-sm font-semibold text-ink-gray-9"},Pl={key:0,class:"text-sm text-ink-gray-5"},zl={key:1,class:"space-y-2"},Rl=["href"],ql={class:"font-medium"},Ul={class:"mt-1 text-ink-gray-6"},Ol={__name:"FolderPlugin",props:{onAddition:{type:Function,required:!1},initialFolder:{type:String,default:null}},setup(c){const e=ls(),t=A("select"),l=A(null),d=A(""),u=A(""),m=A([]),b=A([]),h=A(null),x=A(null),w=A(""),g=A([]),U=A([]),v=A(!1),ae=A(""),_=A(null),H=()=>{var f,T;return typeof window=="undefined"?null:window.csrf_token||((f=window.frappe)==null?void 0:f.csrf_token)||((T=document.querySelector('meta[name="csrf-token"]'))==null?void 0:T.getAttribute("content"))||null},R=()=>te(this,null,function*(){const f=e.params.courseName;if(console.log("Course Name: ",f),f){const N=yield J({url:"frappe.client.get_value",makeParams(F){return{doctype:"Course Schedule",fieldname:"course",filters:{name:f}}}}).fetch();h.value=N.course,console.log("Fetched Course: ",h.value)}else return console.error("Course name not found in route params"),null}),k=c,I=()=>{if(!d.value)return;const f=d.value;typeof k.onAddition=="function"&&k.onAddition(f)},L=(N,...F)=>te(this,[N,...F],function*(f,{refreshFolders:T=!0}={}){const V=f==null?void 0:f.trim();if(!V)return;(T||!b.value.length)&&(yield K());const _e=b.value.find(be=>be.foldername===V||be.name===V);if(_e){l.value!==_e.name&&(l.value=_e.name);return}d.value=V,w.value=V,g.value=[{id:null,label:V,folderName:V}],yield ne({folderLabel:V}),g.value=[{id:x.value,label:w.value||V,folderName:d.value||V}]}),K=()=>te(this,null,function*(){if(h.value||(yield R()),!h.value)return[];const T=yield J({url:"frappe.client.get_list",makeParams(){return{doctype:"Course Folder",filters:{course:h.value},fields:["name","foldername","file_reference","parent_folder"]}}}).fetch();return b.value=T,b.value}),se=()=>te(this,null,function*(){if(!u.value){alert("Folder name is required");return}if(h.value||(yield R()),!h.value){alert("Please select a course before creating a folder.");return}try{const T=yield new ut({data:{},readOnly:!1}).createCourseFolder(h.value,u.value);b.value.push({name:T.name,foldername:T.foldername,file_reference:T.file_reference,parent_folder:T.parent_folder}),d.value=T.foldername,x.value=T.file_reference,w.value=T.foldername,l.value=T.name,g.value=[{id:x.value,label:w.value,folderName:T.foldername}],t.value="select",u.value="",yield ne({folderId:x.value,folderLabel:w.value})}catch(f){console.error("Error creating folder:",f),alert(f.message||"Failed to create folder.")}}),ne=(...N)=>te(this,[...N],function*({folderId:f,folderLabel:T}={}){var _e;const F=f!=null?f:x.value,V=(_e=T!=null?T:w.value)!=null?_e:d.value;if(!F&&!V){console.warn("No folder selected for fetching files.");return}try{const me=yield J({url:"seminary.api.folder_upload.get_files_in_folder",params:{folder_id:F,foldername:V},auto:!0}).fetch(),Se=(me==null?void 0:me.entries)||[];U.value=Se.filter(we=>we.is_folder),m.value=Se.filter(we=>!we.is_folder),x.value=(me==null?void 0:me.folder_id)||F,w.value=(me==null?void 0:me.folder_name)||V,d.value=w.value}catch(be){console.error("Error fetching files:",be),U.value=[],m.value=[]}}),re=(f,T=null)=>te(this,null,function*(){var F;const N=T||((F=f==null?void 0:f.target)==null?void 0:F.files);if(!(!N||!N.length)){if(!x.value&&!w.value){alert("Please select a folder first.");return}try{const V=new FormData;for(const me of N)V.append("files",me);x.value&&V.append("folder_id",x.value),w.value&&V.append("foldername",w.value);const _e=H();if(!_e){alert("Session expired. Refresh the page and try again.");return}const be=yield fetch("/api/method/seminary.api.folder_upload.upload_folder",{method:"POST",body:V,headers:{"X-Frappe-CSRF-Token":_e},credentials:"include"});if(!be.ok){const me=yield be.json().catch(()=>({}));console.error("Error uploading files:",me),alert(`Error: ${me.message||"Failed to upload files."}`);return}console.log("Files uploaded successfully."),f!=null&&f.target&&(f.target.value=""),yield ne()}catch(V){console.error("Error uploading files:",V),alert("An error occurred while uploading files.")}finally{v.value=!1}}}),Y=f=>te(this,null,function*(){const T=H();if(!T){alert("Session expired. Refresh the page and try again.");return}yield fetch("/api/method/seminary.api.folder_upload.delete_file",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":T},body:JSON.stringify({file_url:f}),credentials:"include"}).then(N=>N.json()),yield ne()}),ve=f=>{f.preventDefault(),f.stopPropagation(),!(!x.value&&!w.value)&&(v.value=!0)},S=f=>{!x.value&&!w.value||(f.preventDefault(),f.stopPropagation(),f.dataTransfer.dropEffect="copy",v.value=!0)},P=f=>{f.preventDefault(),f.stopPropagation(),v.value=!1},W=f=>te(this,null,function*(){var N;if(f.preventDefault(),f.stopPropagation(),!x.value&&!w.value){alert("Please select a folder before uploading.");return}const T=(N=f.dataTransfer)==null?void 0:N.files;T!=null&&T.length&&(yield re(null,T)),v.value=!1}),C=()=>{var f;if(!x.value&&!w.value){alert("Please select a folder first.");return}(f=_.value)==null||f.click()},q=f=>te(this,null,function*(){f!=null&&f.name&&(g.value=[...g.value,{id:f.name,label:f.file_name,folderName:f.file_name}],x.value=f.name,w.value=f.file_name,yield ne({folderId:f.name,folderLabel:f.file_name}))}),X=f=>te(this,null,function*(){if(f<0||f>=g.value.length)return;const T=g.value[f];g.value=g.value.slice(0,f+1),x.value=T.id,w.value=T.label,d.value=T.folderName||T.label,yield ne({folderId:T.id,folderLabel:T.folderName||T.label})}),ce=()=>te(this,null,function*(){if(!ae.value){alert("Sub-folder name is required.");return}if(!x.value&&!w.value){alert("Please select a folder first.");return}try{yield new ut({data:{},readOnly:!1}).createSubfolder({parentFolderId:x.value,parentFolderName:w.value,subfolderName:ae.value}),ae.value="",yield ne()}catch(f){console.error("Error creating sub-folder:",f),alert(f.message||"Failed to create sub-folder.")}});ue(l,f=>te(this,null,function*(){if(f)try{const N=yield J({url:"frappe.client.get_value",makeParams(){return{doctype:"Course Folder",fieldname:["foldername","file_reference","parent_folder"],filters:{name:f}}}}).fetch();d.value=(N==null?void 0:N.foldername)||"",x.value=(N==null?void 0:N.file_reference)||null,w.value=(N==null?void 0:N.foldername)||"",g.value=[{id:x.value,label:w.value,folderName:d.value}],I(),yield ne({folderId:x.value,folderLabel:w.value})}catch(T){console.error("Error fetching foldername:",T)}else d.value="",x.value=null,w.value="",g.value=[],U.value=[],m.value=[]}));let he=!1;return Ee(()=>te(this,null,function*(){he=!0,yield R(),yield K(),k.initialFolder&&(yield L(k.initialFolder,{refreshFolders:!1}))})),ue(()=>k.initialFolder,(f,T)=>te(this,null,function*(){if(!he)return;const N=f==null?void 0:f.trim(),F=T==null?void 0:T.trim();!N||N===F||(yield L(N))})),(f,T)=>(o(),i("div",bl,[T[8]||(T[8]=s("h3",null,"Manage Course Folders",-1)),s("div",null,[s("label",null,[$e(s("input",{type:"radio","onUpdate:modelValue":T[0]||(T[0]=N=>t.value=N),value:"select"},null,512),[[bt,t.value]]),T[6]||(T[6]=ie(" Select Existing Folder ",-1))]),s("label",kl,[$e(s("input",{type:"radio","onUpdate:modelValue":T[1]||(T[1]=N=>t.value=N),value:"create"},null,512),[[bt,t.value]]),T[7]||(T[7]=ie(" Create New Folder ",-1))])]),t.value==="select"?(o(),i("div",xl,[E(Ve,{modelValue:l.value,"onUpdate:modelValue":T[2]||(T[2]=N=>l.value=N),doctype:"Course Folder",options:"foldername",label:f.__("Select a folder")},null,8,["modelValue","label"])])):D("",!0),t.value==="create"?(o(),i("div",wl,[$e(s("input",{type:"text","onUpdate:modelValue":T[3]||(T[3]=N=>u.value=N),placeholder:"Enter folder name"},null,512),[[Ne,u.value]]),E(Ve,{modelValue:h.value,"onUpdate:modelValue":T[4]||(T[4]=N=>h.value=N),doctype:"Course",label:f.__("Select a course")},null,8,["modelValue","label"]),s("button",{onClick:se},"Create Folder")])):D("",!0),l.value?(o(),i("div",$l,[s("div",null,[s("div",Sl,r(f.__("Current Folder")),1),s("div",Cl,[(o(!0),i(de,null,pe(g.value,(N,F)=>(o(),i(de,{key:N.id||`${N.label}-${F}`},[s("button",{type:"button",class:"rounded px-1.5 py-0.5 text-ink-gray-7 transition hover:bg-ink-gray-2 hover:text-ink-gray-9",onClick:V=>X(F)},r(N.label),9,Tl),F<g.value.length-1?(o(),i("span",Al,"/")):D("",!0)],64))),128))])]),s("div",Dl,[$e(s("input",{type:"text","onUpdate:modelValue":T[5]||(T[5]=N=>ae.value=N),placeholder:f.__("New sub-folder name"),class:"flex-1 rounded border border-outline-gray-3 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"},null,8,Fl),[[Ne,ae.value]]),E(a(j),{size:"sm",onClick:ce},{default:O(()=>[ie(r(f.__("Create Sub-folder")),1)]),_:1})]),s("div",null,[s("h5",Ml,r(f.__("Sub-folders")),1),U.value.length?(o(),i("ul",Nl,[(o(!0),i(de,null,pe(U.value,N=>(o(),i("li",{key:N.name,class:"flex items-center justify-between rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("button",{type:"button",class:"flex-1 text-left text-sm font-medium text-blue-600 hover:underline",onClick:F=>q(N)},r(N.file_name),9,Il)]))),128))])):(o(),i("div",El,r(f.__("No sub-folders yet.")),1))]),s("div",null,[s("h5",Ll,r(f.__("Files")),1),m.value.length?(o(),i("ul",zl,[(o(!0),i(de,null,pe(m.value,N=>(o(),i("li",{key:N.file_url||N.name,class:"flex items-center gap-3 rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("a",{href:N.file_url,download:"",class:"flex-1 truncate text-sm text-blue-600 hover:underline"},r(N.file_name),9,Rl),E(a(dt),{text:f.__("Delete File"),placement:"bottom"},{default:O(()=>[E(a(is),{onClick:Qe(F=>Y(N.file_url),["prevent"]),class:"h-4 w-4 cursor-pointer text-red-500"},null,8,["onClick"])]),_:2},1032,["text"])]))),128))])):(o(),i("div",Pl,r(f.__("No files found in this folder.")),1))]),s("div",{class:Oe(["rounded-md border-2 border-dashed border-outline-gray-3 p-6 text-center text-sm transition-colors duration-200 hover:border-outline-gray-4",{"bg-blue-50 border-blue-500 text-blue-700":v.value}]),onDragenter:Qe(ve,["prevent","stop"]),onDragover:Qe(S,["prevent","stop"]),onDragleave:Qe(P,["prevent","stop"]),onDrop:Qe(W,["prevent","stop"]),onClick:C},[s("p",ql,r(f.__("Drop files here or click to upload")),1),s("p",Ul,r(f.__("Files will be added to"))+" "+r(w.value),1),s("input",{ref_key:"fileInputRef",ref:_,type:"file",class:"hidden",multiple:"",onChange:re},null,544)],34)])):D("",!0)]))}},Vl=St(Ol,[["__scopeId","data-v-b4e3a9b2"]]),Hl={class:"flex flex-col gap-4 rounded-lg border-2 border-gray-200 p-4 mb-4"},Bl={class:"flex flex-col gap-1"},jl={class:"text-lg font-semibold text-ink-gray-9"},Gl={key:0,class:"text-sm text-ink-gray-6 flex flex-wrap items-center gap-1"},Ql=["onClick"],Jl={key:0},Wl={key:0,class:"rounded border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700"},Yl={key:1,class:"text-sm text-ink-gray-6"},Xl={class:"space-y-2"},Zl={class:"text-sm font-semibold text-ink-gray-9"},Kl={key:0,class:"text-sm text-ink-gray-5"},ei={key:1,class:"space-y-2"},ti=["onClick"],si={class:"text-xs text-ink-gray-5"},ai={class:"space-y-2"},oi={class:"text-sm font-semibold text-ink-gray-9"},ni={key:0,class:"text-sm text-ink-gray-5"},ri={key:1,class:"space-y-2"},li=["href"],ii={class:"text-xs text-ink-gray-5"},ui={__name:"FolderBlock",props:{folder:{type:[Object,String],required:!0}},setup(c){const e=c,t=oe(()=>typeof e.folder=="string"?e.folder:e.folder&&typeof e.folder=="object"&&(e.folder.folder||e.folder.foldername)||""),l=A(!1),d=A(""),u=A([]),m=A([]),b=A(null),h=A(""),x=A([]);let w=!1;const g=R=>{if(!R&&R!==0)return"";const k=Number(R);return Number.isNaN(k)?"":k>=1048576?`${(k/1048576).toFixed(2)} MB`:k>=1024?`${(k/1024).toFixed(2)} KB`:`${k} B`},U=({folderId:R=null,folderLabel:k=null})=>{const I={};R&&(I.folder_id=R);const L=k!=null?k:t.value;return!R&&L&&(I.foldername=L),I},v=(...I)=>te(this,[...I],function*({folderId:R=null,folderLabel:k=null}={}){const L=U({folderId:R,folderLabel:k});if(!L.folder_id&&!L.foldername)return null;l.value=!0,d.value="";try{const se=yield J({url:"seminary.api.folder_upload.get_files_in_folder",params:L,auto:!0}).fetch(),ne=(se==null?void 0:se.entries)||[];return m.value=ne.filter(re=>re.is_folder),u.value=ne.filter(re=>!re.is_folder),b.value=(se==null?void 0:se.folder_id)||R||null,h.value=(se==null?void 0:se.folder_name)||k||t.value||"",{id:b.value,label:h.value}}catch(K){return console.error("Error fetching folder contents:",K),d.value=(K==null?void 0:K.message)||__("Unable to load folder contents."),m.value=[],u.value=[],null}finally{l.value=!1}}),ae=()=>te(this,null,function*(){const R=yield v({folderLabel:t.value});R&&(x.value=[R])}),_=R=>te(this,null,function*(){if(!(R!=null&&R.name))return;const k=yield v({folderId:R.name,folderLabel:R.file_name});k&&(x.value=[...x.value,k])}),H=R=>te(this,null,function*(){if(R<0||R>=x.value.length)return;const k=x.value[R],I=yield v({folderId:k.id,folderLabel:k.label});I&&(x.value=[...x.value.slice(0,R),I])});return Ee(()=>te(this,null,function*(){w=!0,yield ae()})),ue(()=>t.value,(R,k)=>te(this,null,function*(){if(!w)return;const I=(R||"").trim(),L=(k||"").trim();!I||I===L||(yield ae())})),(R,k)=>(o(),i("div",Hl,[s("div",Bl,[s("h4",jl,r(h.value||t.value),1),x.value.length?(o(),i("div",Gl,[(o(!0),i(de,null,pe(x.value,(I,L)=>(o(),i(de,{key:I.id||`${I.label}-${L}`},[s("button",{type:"button",class:Oe(["rounded px-1.5 py-0.5 transition hover:bg-ink-gray-2 hover:text-ink-gray-9",L===x.value.length-1?"font-medium text-ink-gray-8 cursor-default":"text-ink-gray-7"]),onClick:K=>L===x.value.length-1?null:H(L)},r(I.label),11,Ql),L<x.value.length-1?(o(),i("span",Jl,"/")):D("",!0)],64))),128))])):D("",!0)]),d.value?(o(),i("div",Wl,r(d.value),1)):l.value?(o(),i("div",Yl,r(R.__("Loading folder contents")),1)):(o(),i(de,{key:2},[s("section",Xl,[s("h5",Zl,r(R.__("Sub-folders")),1),m.value.length?(o(),i("ul",ei,[(o(!0),i(de,null,pe(m.value,I=>(o(),i("li",{key:I.name,class:"flex items-center justify-between rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("button",{type:"button",class:"text-left text-sm font-medium text-blue-600 hover:underline",onClick:L=>_(I)},r(I.file_name),9,ti),s("span",si,r(R.__("Folder")),1)]))),128))])):(o(),i("div",Kl,r(R.__("No sub-folders in this location.")),1))]),s("section",ai,[s("h5",oi,r(R.__("Files")),1),u.value.length?(o(),i("ul",ri,[(o(!0),i(de,null,pe(u.value,I=>(o(),i("li",{key:I.file_url||I.name,class:"flex items-center gap-3 rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("a",{href:I.file_url,download:"",class:"flex-1 truncate text-sm text-blue-600 hover:underline"},r(I.file_name),9,li),s("span",ii,r(g(I.file_size)),1)]))),128))])):(o(),i("div",ni,r(R.__("No files available in this folder.")),1))])],64))]))}},wt=()=>{var c,e;return typeof window=="undefined"?null:window.csrf_token||((c=window.frappe)==null?void 0:c.csrf_token)||((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||null};class ut{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l,this.api=t,this.wrapper=void 0,this.vueApp=null}static get toolbox(){const e=fe({render:()=>Re(us,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Folder",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.folder?this.renderFolder(this.data.folder):this.renderFolderModal(),this.wrapper}destroyApp(){this.vueApp&&(this.vueApp.unmount(),this.vueApp=null),this.wrapper&&(this.wrapper.innerHTML="")}renderFolder(e){if(this.readOnly){this.destroyApp(),this.vueApp=fe(ui,{folder:e}),this.vueApp.use(De),this.vueApp.use(Me),this.vueApp.mount(this.wrapper);return}this.renderFolderModal(e)}renderFolderModal(e=null){this.readOnly||(this.destroyApp(),this.vueApp=fe(Vl,{initialFolder:e,onAddition:t=>{this.data||(this.data={}),this.data.folder=t}}),this.vueApp.use(De),this.vueApp.use(Me),this.vueApp.mount(this.wrapper))}save(e){var t;return{folder:(t=this.data)==null?void 0:t.folder}}destroy(){this.destroyApp()}createCourseFolder(e,t){return te(this,null,function*(){const l=t==null?void 0:t.trim();if(!l)throw new Error("Folder name is required to create a course folder");if(!e)throw new Error("Course is required to create a course folder");const d=wt();if(!d)throw new Error("CSRF token not found. Please refresh the page and try again.");let u;const m=yield fetch("/api/resource/Course Folder",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":d},credentials:"include",body:JSON.stringify({course:e,foldername:l})});try{u=yield m.json()}catch(h){u=null}if(!m.ok){const h=(u==null?void 0:u.message)||(u==null?void 0:u.exc)||m.statusText;throw new Error(h||"Failed to create course folder")}const b=(u==null?void 0:u.data)||u;return this.data||(this.data={}),this.data.folder=(b==null?void 0:b.foldername)||l,b})}createSubfolder(d){return te(this,arguments,function*({parentFolderId:e,parentFolderName:t,subfolderName:l}){const u=l==null?void 0:l.trim();if(!u)throw new Error("Sub-folder name is required");if(!e&&!t)throw new Error("Parent folder information is required to create a sub-folder");const m=wt();if(!m)throw new Error("CSRF token not found. Please refresh the page and try again.");let b;const h=yield fetch("/api/method/seminary.api.folder_upload.create_subfolder",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":m},credentials:"include",body:JSON.stringify({parent_folder_id:e,parent_foldername:t,subfoldername:u})});try{b=yield h.json()}catch(x){b=null}if(!h.ok){const x=(b==null?void 0:b.message)||(b==null?void 0:b.exc)||h.statusText;throw new Error(x||"Failed to create sub-folder")}return(b==null?void 0:b.message)||(b==null?void 0:b.data)||b})}}function di(c){ke(qe({position:"bottom-right"},c))}function st(c){return gs(c).value}function gi(c){return c>999?(c/1e3).toFixed(1)+"k":c}function Ze(c){let e=parseInt(c);return e>1048576?(e/1048576).toFixed(2)+"M":e>1024?(e/1024).toFixed(2)+"K":e}function _i(c){ue(()=>c,e=>{if(e.value.title){if(e.value.title&&e.value.subtitle){document.title=`${e.value.title} | ${e.value.subtitle}`;return}if(e.value.title){document.title=`${e.value.title}`;return}}},{immediate:!0,deep:!0})}function yi(){return{header:{class:vs,config:{placeholder:"Header"}},assignment:mo,quiz:Fa,exam:Pn,discussionActivity:sl,upload:hl,markdown:{class:vl,inlineToolbar:!0},image:hs,table:{class:fs,inlineToolbar:!0},paragraph:{class:ps,inlineToolbar:!0,config:{preserveBlank:!0}},codeBox:{class:yl,config:{themeURL:"https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-dark.min.css",themeName:"atom-one-dark",useDefaultTheme:"dark"}},list:{class:ms,inlineToolbar:!0,config:{defaultStyle:"ordered"}},inlineCode:{class:cs,shortcut:"CMD+SHIFT+M"},embed:{class:ds,inlineToolbar:!0,config:{services:{youtube:{regex:/(?:https?:\/\/)?(?:www\.)?(?:(?:youtu\.be\/)|(?:youtube\.com)\/(?:v\/|u\/\w\/|embed\/|watch))(?:(?:\?v=)?([^#&?=]*))?((?:[?&]\w*=\w*)*)/,embedUrl:"https://www.youtube.com/embed/<%= remote_id %>",html:'<iframe style="width:100%; height: 30rem;" frameborder="0" allowfullscreen></iframe>',height:320,width:580,id:([c,e])=>{if(!e&&c)return c;const t={start:"start",end:"end",t:"start",time_continue:"start",list:"list"};let l=e.slice(1).split("&").map(d=>{const[u,m]=d.split("=");return!c&&u==="v"?(c=m,null):!t[u]||m==="LL"||m.startsWith("RDMM")||m.startsWith("FL")?null:`${t[u]}=${m}`}).filter(d=>!!d);return c+"?"+l.join("&")}},vimeo:!0,codepen:!0,aparat:{regex:/(?:http[s]?:\/\/)?(?:www.)?aparat\.com\/v\/([^\/\?\&]+)\/?/,embedUrl:"https://www.aparat.com/video/video/embed/videohash/<%= remote_id %>/vt/frame",html:'<iframe style="margin: 0 auto; width: 100%; height: 25rem;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>',height:300,width:600},github:!0,slides:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/pub/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0' frameborder='0' allowfullscreen='true'></iframe>"},drive:{regex:/https:\/\/drive\.google\.com\/file\/d\/([A-Za-z0-9_-]+)\/view(\?.+)?/,embedUrl:"https://drive.google.com/file/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 25rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},docsPublic:{regex:/https:\/\/docs\.google\.com\/document\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/document/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},sheetsPublic:{regex:/https:\/\/docs\.google\.com\/spreadsheets\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/spreadsheets/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},slidesPublic:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0;' frameborder='0' allowfullscreen='true'></iframe>"},codesandbox:{regex:/^https:\/\/codesandbox\.io\/(?:embed\/)?([A-Za-z0-9_-]+)(?:\?[^\/]*)?$/,embedUrl:"https://codesandbox.io/embed/<%= remote_id %>?view=editor+%2B+preview&module=%2Findex.html",html:"<iframe style='width: 100%; height: 500px; border: 0; border-radius: 4px; overflow: hidden;' sandbox='allow-mods allow-forms allow-popups allow-scripts allow-same-origin' frameborder='0' allowfullscreen='true'></iframe>"}}}},folder:{class:ut,config:{placeholder:"Add a folder with files",uploadEndpoint:"/api/upload-folder",renderFiles:c=>c.map(e=>`<a href="${e.url}" download>${e.name}</a>`).join("<br>")}}}}function Pt(c){const e={ves:"fe",ies:"y",i:"us",zes:"ze",ses:"s",es:"e",s:""};return c.replace(new RegExp(`(${Object.keys(e).join("|")})$`),t=>e[t])}export{wa as _,Ln as a,tl as b,ui as c,ln as d,It as e,gi as f,yi as g,Ze as h,ka as i,io as j,Nn as k,st as t,_i as u};
//# sourceMappingURL=index-BpRfBm6C.js.map
