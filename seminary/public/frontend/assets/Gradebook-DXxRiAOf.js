var O=Object.defineProperty,W=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var V=(i,u,s)=>u in i?O(i,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[u]=s,A=(i,u)=>{for(var s in u||(u={}))K.call(u,s)&&V(i,s,u[s]);if(T)for(var s of T(u))M.call(u,s)&&V(i,s,u[s]);return i},I=(i,u)=>W(i,J(u));var B=(i,u,s)=>new Promise((v,b)=>{var y=m=>{try{x(s.next(m))}catch(w){b(w)}},g=m=>{try{x(s.throw(m))}catch(w){b(w)}},x=m=>m.done?v(m.value):Promise.resolve(m.value).then(y,g);x((s=s.apply(i,u)).next())});import{c as R,u as X,b as F,H as Z,t as q}from"./frappe-ui-CI8g03ZE.js";import{bW as ee,r as E,c as H,I as te,a8 as ae,t as l,b as c,g as _,e as $,u as f,D as n,H as z,O as G,a as C,w as h,C as D,z as k,bT as re,n as se,cg as oe}from"./vendor-DaZfNO8R.js";const ce={class:"gradebook"},le={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ue={class:"text-2xl font-bold mt-5 mb-4"},ne={key:0,class:"text-gray-500 text-center mt-4"},ie={key:1,class:"overflow-auto"},de={class:"table-auto border-collapse border border-gray-300 w-full"},_e={class:"border border-gray-300 px-4 py-2 bg-gray-100"},me={key:0,class:"block text-gray-500 text-sm"},pe={key:0,class:"block text-gray-500 text-sm"},be={key:0,class:"block text-gray-500 text-sm"},ye={key:0,class:"block text-gray-500 text-sm"},ge={key:4},fe={key:0,class:"block text-gray-500 text-sm"},he={class:"border border-gray-300 px-4 py-2 relative"},ke=["href"],ve={key:0},xe=["value","onInput"],we={key:1},Ne=["value","onInput"],$e={__name:"Gradebook",props:{courseName:{type:String,required:!0}},setup(i){const u=ee(),s=i,v=E([]),b=E([]),y=E({}),g=R({url:"seminary.seminary.utils.get_course_details",cache:["course",s.courseName],params:{course:s.courseName},auto:!0}),x=R({url:"seminary.seminary.utils.get_gradebook",cache:["gradebook",s.courseName],params:{course:s.courseName},auto:!0,onSuccess(e){var a;v.value=e.map(r=>I(A({},r),{assessments:r.assessments.map(o=>I(A({},o),{rawscore_card:o.rawscore_card||0,actualextrapt_card:o.actualextrapt_card||0}))})),b.value=((a=e[0])==null?void 0:a.assessments)||[]},onError(e){console.error("Error loading gradebook:",e)}}),m=H(()=>[...b.value].sort((e,a)=>{if(!e.due_date&&a.due_date)return 1;if(e.due_date&&!a.due_date)return-1;if(e.due_date&&a.due_date){const r=new Date(e.due_date),o=new Date(a.due_date);if(r<o)return-1;if(r>o)return 1}return e.title.localeCompare(a.title)})),w=(e,a)=>{const r=e.assessments.find(o=>o.assessment_criteria===a.assessment_criteria);return r?r.actualextrapt_card:0},P=(e,a)=>{const r=e.assessments.find(o=>o.assessment_criteria===a.assessment_criteria);return r?r.rawscore_card:0},Q=(e,a,r)=>{const o=e.assessments.find(d=>d.assessment_criteria===a.assessment_criteria);o&&(o.actualextrapt_card=parseFloat(r)||0,y.value[o.name]=!0)},U=(e,a,r)=>{const o=e.assessments.find(d=>d.assessment_criteria===a.assessment_criteria);o&&(o.rawscore_card=parseFloat(r)||0,y.value[o.name]=!0)},Y=(e,a)=>{const r=e.assessments.find(o=>o.assessment_criteria===a.assessment_criteria);return r&&y.value[r.name]},j=(e,a)=>B(null,null,function*(){var o;const r=e.assessments.find(d=>d.assessment_criteria===a.assessment_criteria);if(r)try{const d=a.extracredit_scac?"actualextrapt_card":"rawscore_card",t=a.extracredit_scac?r.actualextrapt_card:r.rawscore_card;console.log("Saving cell:",r.name,"with value:",t),yield Z("frappe.client.set_value",{doctype:"Course Assess Results Detail",name:r.name,fieldname:d,value:t}),delete y.value[r.name],q.success(__("Grade saved successfully"))}catch(d){console.error("Error saving cell:",d),q.error(((o=err.messages)==null?void 0:o[0])||err)}});te(()=>u.fullPath,(e,a)=>{x.reload()},{immediate:!0});const N=e=>{if(!e)return"";const a=new Date(e);return isNaN(a)?"":new Intl.DateTimeFormat(void 0,{day:"2-digit",month:"short"}).format(a)},L=H(()=>{var a;let e=[{label:__("Courses"),route:{name:"Courses"}}];return e.push({label:(a=g==null?void 0:g.data)==null?void 0:a.course,route:{name:"CourseDetail",params:{courseName:s.courseName}}}),e.push({label:__("Gradebook"),route:{name:"Gradebook",params:{courseName:s.courseName}}}),e});return(e,a)=>{var o,d;const r=ae("router-link");return c(),l("div",ce,[_("header",le,[$(f(X),{class:"h-7",items:L.value},null,8,["items"])]),_("h1",ue,n(e.__("Gradebook for"))+" "+n((d=(o=f(g))==null?void 0:o.data)==null?void 0:d.course),1),v.value.length===0?(c(),l("div",ne,n(e.__("There are no students enrolled in this course.")),1)):(c(),l("div",ie,[_("table",de,[_("thead",null,[_("tr",null,[_("th",_e,n(e.__("Student")),1),(c(!0),l(z,null,G(m.value,t=>(c(),l("th",{key:t.assessment_criteria,class:"border border-gray-300 px-4 py-2 bg-gray-100"},[t.type==="Exam"?(c(),C(r,{key:0,to:{name:"ExamSubmissionCS",params:{courseName:s.courseName,examID:t.exam}},class:"underline"},{default:h(()=>[D(n(t.title)+" ",1),t.due_date?(c(),l("span",me," ("+n(N(t.due_date))+") ",1)):k("",!0)]),_:2},1032,["to"])):t.type==="Assignment"?(c(),C(r,{key:1,to:{name:"AssignmentSubmissionCS",params:{courseName:s.courseName,assignmentID:t.assignment}},class:"underline"},{default:h(()=>[D(n(t.title)+" ",1),t.due_date?(c(),l("span",pe," ("+n(N(t.due_date))+") ",1)):k("",!0)]),_:2},1032,["to"])):t.type==="Quiz"?(c(),C(r,{key:2,to:{name:"QuizSubmissionCS",params:{courseName:s.courseName,quizID:t.quiz}},class:"underline"},{default:h(()=>[D(n(t.title)+" ",1),t.due_date?(c(),l("span",be," ("+n(N(t.due_date))+") ",1)):k("",!0)]),_:2},1032,["to"])):t.type==="Discussion"?(c(),C(r,{key:3,to:{name:"DiscussionActivitySubmissionCS",params:{courseName:s.courseName,discussionID:t.discussion}},class:"underline"},{default:h(()=>[D(n(t.title)+" ",1),t.due_date?(c(),l("span",ye," ("+n(N(t.due_date))+") ",1)):k("",!0)]),_:2},1032,["to"])):(c(),l("span",ge,[D(n(t.title)+" ",1),t.due_date?(c(),l("span",fe," ("+n(N(t.due_date))+") ",1)):k("",!0)]))]))),128))])]),_("tbody",null,[(c(!0),l(z,null,G(v.value,t=>(c(),l("tr",{key:t.student_card},[_("td",he,[$(f(F),{text:`${e.__("Program")}: ${t.program_std_scr}
${e.__("Audit")}: ${t.audit_bool?e.__("Yes"):e.__("No")}
${e.__("Active")}: ${t.active?e.__("Yes"):e.__("No")}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:h(()=>[_("span",null,n(t.stuname_roster),1)]),_:2},1032,["text"]),$(f(F),{text:`${e.__("Send Email to")} ${t.stuname_roster}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:h(()=>[_("a",{href:`mailto:${t.stuemail_rc}`},[$(f(re),{class:"absolute right-2 top-2 text-blue-300 cursor-pointer"})],8,ke)]),_:2},1032,["text"])]),(c(!0),l(z,null,G(b.value,p=>(c(),l("td",{key:p.assessment_criteria,class:se([p.extracredit_scac?"bg-blue-100":"","border border-gray-300 px-4 py-2 text-center relative"])},[p.extracredit_scac?(c(),l("div",ve,[_("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:w(t,p),onInput:S=>Q(t,p,S.target.value)},null,40,xe)])):(c(),l("div",we,[_("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:P(t,p),onInput:S=>U(t,p,S.target.value)},null,40,Ne)])),Y(t,p)?(c(),C(f(oe),{key:2,class:"absolute right-12 top-4 text-blue-300",onClick:S=>j(t,p)},null,8,["onClick"])):k("",!0)],2))),128))]))),128))])])]))])}}};export{$e as default};
//# sourceMappingURL=Gradebook-DXxRiAOf.js.map
