var N=(_,f,l)=>new Promise((g,i)=>{var d=p=>{try{u(l.next(p))}catch(h){i(h)}},t=p=>{try{u(l.throw(p))}catch(h){i(h)}},u=p=>p.done?g(p.value):Promise.resolve(p.value).then(d,t);u((l=l.apply(_,f)).next())});import{r as U,I as j,a as D,b as m,u as n,F as R,bk as A,av as X,bg as Y,c as w,bE as T,t as y,g as a,z as E,e as c,w as k,C as $,D as r,L as J,aR as W,H as I,O as F,c8 as Z,c0 as ee}from"./vendor-CA0oFrry.js";import{r as se,c as G,G as te,t as B,u as oe,n as ae,q as S,w as V}from"./frappe-ui-BC6vlBMo.js";import{d as ne}from"./index-BpRfBm6C.js";import"./Link-Dl_y0tb2.js";import"./index-Ck4PZcst.js";/* empty css                                                                     */const ie={__name:"ExamQuestionEditor",props:{questionId:{type:String,required:!0},content:{type:String,default:""},editable:{type:Boolean,default:!0}},emits:["change"],setup(_,{emit:f}){const l=_,g=f;console.log("Props:",l);const i=U(l.content);j(()=>l.content,(t,u)=>{t!==u&&(i.value=t)});const d=t=>{i.value=t,g("change",t)};return(t,u)=>(m(),D(n(se),{content:i.value,key:_.questionId,editable:_.editable,fixedMenu:!0,label:`Comment for Question ${_.questionId}`,editorClass:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none",onChange:d},null,8,["content","editable","label"]))}},re={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},de={class:"space-x-2"},le={class:"flex items-center justify-between mb-5"},ce={class:"w-1/3"},ue={for:"submissionDropdown",class:"block text-sm font-medium text-gray-700"},me=["value"],pe={key:0,class:"w-2/3 mx-auto py-5 space-y-5"},_e={class:"grid grid-cols-3 gap-5"},be={class:"col-span-2 space-y-4"},fe={class:"text-xl font-semibold text-ink-gray-9"},ge={class:"space-y-4 border p-5 rounded-md"},ve={class:"flex items-center justify-between py-4"},ye={class:"text-center ml-5"},he={class:"text-3xl font-bold text-ink-gray-9"},xe={class:"text-center"},ke={class:"text-3xl font-semibold text-ink-gray-9"},Se={class:"text-sm text-ink-gray-5"},Ce={class:"text-center mr-5"},Ne={class:"text-3xl font-semibold text-ink-gray-9 mt-2"},$e={class:"space-y-1"},De={class:"font-semibold text-ink-gray-9"},we=["innerHTML"],Ee={class:"leading-5 text-ink-gray-7 space-x-1"},Ie=["innerHTML"],Ve={class:"flex items-center justify-end space-x-5"},qe={class:"flex items-center space-x-2"},Pe={class:"flex items-center space-x-2"},Me={class:"text-sm text-ink-gray-7"},Le={class:"col-span-1 space-y-4"},Te={class:"space-y-4 border p-5 rounded-md"},Fe={class:"space-y-4 border p-5 rounded-md"},Ke={__name:"ExamSubmission",props:{submission:{type:String,required:!0},courseName:{type:String,required:!0},examID:{type:String,required:!0}},setup(_){const f=R(),l=A("$user");X(()=>{var e,s;!((e=l.data)!=null&&e.is_instructor)&&!((s=l.data)!=null&&s.is_moderator)&&f.push({name:"Courses"}),window.addEventListener("keydown",g),console.log("Keyboard shortcut listener added")}),Y(()=>{window.removeEventListener("keydown",g),console.log("Keyboard shortcut listener removed")});const g=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(M(),e.preventDefault())},i=_,d=G({url:"frappe.client.get_list",params:{doctype:"Exam Submission",filters:[["exam","=",i.examID],["course","=",i.courseName]],fields:["name","member_name"],order_by:"member_name asc"},auto:!0});console.log("Submission List:",d);const t=te({doctype:"Exam Submission",name:i.submission,auto:!0}),u=G({url:"seminary.seminary.utils.get_course_details",cache:["course",i.courseName],params:{course:i.courseName},auto:!0}),p=w(()=>{var s;let e=[{label:"Courses",route:{name:"Courses"}}];return e.push({label:(s=u==null?void 0:u.data)==null?void 0:s.course,route:{name:"CourseDetail",params:{courseName:i.courseName}}}),e.push({label:"Gradebook",route:{name:"Gradebook",params:{courseName:i.courseName}}}),e.push({label:"Exam Submissions",route:{name:"ExamSubmissionCS",params:{courseName:i.courseName,examID:i.examID}}}),e}),h=e=>{if(!e)return"00:00:00";const s=Math.floor(e/3600).toString().padStart(2,"0"),o=Math.floor(e%3600/60).toString().padStart(2,"0"),v=(e%60).toString().padStart(2,"0");return`${s}:${o}:${v}`},q=(e,s)=>{e.points=s,e.graded=!0},P=()=>{const e=(t.doc.result||[]).reduce((b,O)=>b+Number(O.points||0),0);t.doc.score=e;const s=parseFloat(t.doc.score_out_of)||1,o=parseFloat(t.doc.fudge_points)||0,v=e/s*100+o;t.doc.percentage=parseFloat(v.toFixed(2))};w(()=>t.doc.result?t.doc.result.map(e=>e.points):[]),T(()=>{t.doc&&t.doc.result&&P()}),T(()=>{t.doc&&typeof t.doc.fudge_points!="undefined"&&P()});const Q=(e,s)=>{e.comments=s},H=()=>N(this,null,function*(){const e=t.doc.result.map((s,o)=>s.graded?null:`Question ${o+1}`).filter(s=>s!==null);if(e.length>0){if(!confirm(`The following questions need grading: ${e.join(", ")}. Do you want to save anyway?`))return}else t.doc.status="Graded";yield M()}),z=(e,s)=>{e.graded=!0,console.log(`Updated Points for Question: ${e.points}`)},M=()=>N(this,null,function*(){var e;try{console.log("Saving submission:",t.doc),yield t.save.submit(),B.success(__("Submission saved successfully"))}catch(s){console.error("Error saving submission:",s),B.error(((e=s.messages)==null?void 0:e[0])||s)}}),x=U(i.submission),C=w(()=>{var e;return(e=d.data)==null?void 0:e.findIndex(s=>s.name===x.value)}),L=e=>{if(e>=0&&e<d.data.length){const s=d.data[e];f.push({name:"ExamSubmission",params:{submission:s.name,courseName:i.courseName,examID:i.examID}})}},K=e=>{const s=d.data.find(o=>o.name===e);s&&f.push({name:"ExamSubmission",params:{submission:s.name,courseName:i.courseName,examID:i.examID}})};return j(x,e=>N(this,null,function*(){e&&(console.log("Navigating to submission:",e),t.name=e,yield t.reload())})),(e,s)=>(m(),y(I,null,[a("header",re,[n(t).doc?(m(),D(n(oe),{key:0,items:p.value},null,8,["items"])):E("",!0),a("div",de,[n(t).isDirty?(m(),D(n(ae),{key:0,label:e.__("Not Saved"),variant:"subtle",theme:"orange"},null,8,["label"])):E("",!0),c(n(S),{variant:"solid",onClick:s[0]||(s[0]=o=>H())},{default:k(()=>[$(r(e.__("Save")),1)]),_:1})])]),a("div",le,[c(n(S),{variant:"subtle",disabled:C.value===0,onClick:s[1]||(s[1]=o=>L(C.value-1))},{default:k(()=>[$(r(e.__("Previous")),1)]),_:1},8,["disabled"]),a("div",ce,[a("label",ue,r(e.__("Select Submission")),1),J(a("select",{id:"submissionDropdown","onUpdate:modelValue":s[2]||(s[2]=o=>x.value=o),onChange:s[3]||(s[3]=o=>K(x.value)),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[(m(!0),y(I,null,F(n(d).data,o=>(m(),y("option",{key:o.name,value:o.name},r(o.member_name),9,me))),128))],544),[[W,x.value]])]),c(n(S),{variant:"subtle",disabled:!n(d).data||C.value===n(d).data.length-1,onClick:s[4]||(s[4]=o=>L(C.value+1))},{default:k(()=>[$(r(e.__("Next")),1)]),_:1},8,["disabled"])]),n(t).doc?(m(),y("div",pe,[a("div",_e,[a("div",be,[a("div",fe,r(n(t).doc.member_name),1),a("div",ge,[a("div",ve,[a("div",ye,[a("div",he,r(n(t).doc.percentage||0)+"% ",1),s[7]||(s[7]=a("div",{class:"text-sm text-ink-gray-5"}," Score ",-1))]),a("div",xe,[a("div",ke,r(n(t).doc.score),1),a("div",Se," Out of "+r(n(t).doc.score_out_of)+" Points ",1)]),a("div",Ce,[a("div",Ne,r(h(n(t).doc.time_taken)),1),s[8]||(s[8]=a("div",{class:"text-sm text-ink-gray-5"}," Time taken ",-1))])])]),(m(!0),y(I,null,F(n(t).doc.result,(o,v)=>(m(),y("div",{key:v,class:"border p-5 rounded-md space-y-4"},[$(r(console.log(o))+" ",1),a("div",$e,[a("div",De,r(e.__("Question"))+" "+r(v+1)+": ",1),a("div",{class:"leading-5 text-ink-gray-9",innerHTML:o.question_name},null,8,we)]),a("div",Ee,[a("span",null,r(e.__("Your Answer"))+": ",1),a("span",{innerHTML:o.answer},null,8,Ie)]),a("div",Ve,[a("div",qe,[c(n(S),{variant:"solid",theme:"green",size:"sm",onClick:b=>q(o,o.points_out_of)},{default:k(()=>[c(n(Z),{class:"w-4 h-4"})]),_:1},8,["onClick"]),c(n(S),{variant:"solid",theme:"red",size:"sm",onClick:b=>q(o,0)},{default:k(()=>[c(n(ee),{class:"w-4 h-4"})]),_:1},8,["onClick"])]),a("div",Pe,[c(n(V),{modelValue:o.points,"onUpdate:modelValue":b=>o.points=b,type:"number",class:"w-20 text-right",onChange:b=>z(o)},null,8,["modelValue","onUpdate:modelValue","onChange"]),a("span",Me," / "+r(parseInt(o.points_out_of,10))+" "+r(e.__("Points")),1)])]),c(ie,{questionId:o.name,content:o.comments,editable:!0,onChange:b=>Q(o,b),"<!--":"",Pass:"",the:"",updated:"",value:"","--":""},null,8,["questionId","content","onChange"])]))),128))]),a("div",Le,[a("div",Te,[c(n(V),{modelValue:n(t).doc.fudge_points,"onUpdate:modelValue":s[5]||(s[5]=o=>n(t).doc.fudge_points=o),label:e.__("Fudge Points"),disabled:!1},null,8,["modelValue","label"]),c(n(V),{modelValue:n(t).doc.status,"onUpdate:modelValue":s[6]||(s[6]=o=>n(t).doc.status=o),label:e.__("Status"),type:"select",options:[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"}],disabled:!1},null,8,["modelValue","label"])]),a("div",Fe,[(m(),D(ne,{title:"Exam Comments",doctype:"Exam Submission",docname:n(t).doc.name,key:n(t).doc.name,type:"single"},null,8,["docname"]))])])])])):E("",!0)],64))}};export{Ke as default};
//# sourceMappingURL=ExamSubmission-9CNOTFYc.js.map
