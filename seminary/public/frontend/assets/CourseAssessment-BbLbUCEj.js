var $=(C,w,u)=>new Promise((v,f)=>{var l=s=>{try{x(u.next(s))}catch(h){f(h)}},k=s=>{try{x(u.throw(s))}catch(h){f(h)}},x=s=>s.done?v(s.value):Promise.resolve(s.value).then(l,k);x((u=u.apply(C,w)).next())});import{c as P,y as U,D as Y,v as N,x as Z,w as ee,j as D,b as se,z as te}from"./frappe-ui-BzEkZ7NZ.js";import{U as H,V as J,F as X,am as G,I as j,c as T,a as S,b as c,w as q,g as o,e as _,t as g,u as d,D as m,bV as ae,bk as oe,r as re,av as le,n as ne,C as L,H as K,O as ie,bW as de}from"./vendor-IWZbD1HA.js";import{u as ue}from"./index-DYgOoCE_.js";import{_ as A}from"./Link-DmVUQNbJ.js";import{e as W}from"./exam-CeEjLNyB.js";import{u as ce}from"./settings-D8_73kUS.js";import"./index-B0k3CMx6.js";/* empty css                                                                     */const me={class:"course-assessment-dialog space-y-4 text-base max-h-[70vh] overflow-y-auto"},pe={key:3},_e={__name:"CourseAssessmentModal",props:H({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{},modalcriteria:{},modalcriteriaModifiers:{}}),emits:H(["assessment-saved"],["update:modelValue","update:modalcriteria"]),setup(C,{emit:w}){const u=J(C,"modelValue"),v=J(C,"modalcriteria"),f=w,l=X(),k=C,x=()=>({title:"",assesscriteria_scac:"",type:"",weight_scac:"",quiz:"",exam:"",assignment:"",extracredit_scac:"",fudgepoints_scac:"",parent:k.courseName,parenttype:"Course Schedule",parentfield:"courseassescrit_sc"}),s=G(x()),h=()=>{Object.assign(s,x())},z=()=>{v!=null&&v.value&&Object.assign(v.value,s)};j(()=>s,()=>{z()},{deep:!0});const y=P({url:"seminary.seminary.utils.get_course_details",cache:["course",k.courseName],params:{course:k.courseName},auto:!0}),M=()=>$(this,null,function*(){if(s.assesscriteria_scac)try{const r=yield(yield fetch(`/api/resource/Assessment Criteria/${s.assesscriteria_scac}`)).json();s.type=r.data.type}catch(n){console.error("Error fetching type:",n)}});j(()=>s.assesscriteria_scac,n=>{if(!n){s.type="",s.quiz="",s.exam="",s.assignment="";return}M()});const F=(n,r)=>{var e;W.setPrefillData({title:s.title,course:(e=y==null?void 0:y.data)==null?void 0:e.course}),l.push({name:"ExamForm",params:{examID:"new"}}),r()},O=(n,r)=>{var e;W.setPrefillData({title:s.title,course:(e=y==null?void 0:y.data)==null?void 0:e.course}),l.push({name:"QuizForm",params:{quizID:"new"}}),r()},Q=(n,r)=>{var e;W.setPrefillData({title:s.title,course:(e=y==null?void 0:y.data)==null?void 0:e.course}),l.push({name:"AssignmentForm",params:{assignmentID:"new"}}),r()},I=n=>{fetch("/api/method/seminary.seminary.api.insert_cs_assessment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({criteria:s})}).then(r=>r.json()).then(()=>{N.success(__("Course Assessment added successfully")),f("assessment-saved"),u.value=!1,h(),n()}).catch(r=>{var e;console.error("Error:",r),N.error(((e=r.messages)==null?void 0:e[0])||r)})},R=n=>{u.value=!1,h(),z(),n==null||n()};j(u,n=>{h(),z()});const B=T(()=>({title:__("Add Course Assessment"),size:"lg",actions:[{label:__("Create"),variant:"solid",onClick:n=>I(n)},{label:__("Cancel"),variant:"text",onClick:n=>R(n)}]}));return(n,r)=>(c(),S(d(Y),{modelValue:u.value,"onUpdate:modelValue":r[6]||(r[6]=e=>u.value=e),options:B.value,disableOutsideClickToClose:!0},{"body-content":q(()=>{var e,a,t,b,i,V;return[o("div",me,[_(d(U),{modelValue:s.title,"onUpdate:modelValue":r[0]||(r[0]=p=>s.title=p),label:n.__("Title"),class:"mb-4",required:!0},null,8,["modelValue","label"]),_(A,{modelValue:s.assesscriteria_scac,"onUpdate:modelValue":r[1]||(r[1]=p=>s.assesscriteria_scac=p),label:n.__("Assessment Criteria"),class:"mb-4",doctype:"Assessment Criteria",required:!0},null,8,["modelValue","label"]),o("p",null,m(s.type),1),s.type==="Quiz"?(c(),S(A,{key:0,modelValue:s.quiz,"onUpdate:modelValue":r[2]||(r[2]=p=>s.quiz=p),doctype:"Quiz",label:n.__("Select a Quiz"),filters:{course:(a=(e=d(y))==null?void 0:e.data)==null?void 0:a.course},onCreate:(p,E)=>O(p,E)},null,8,["modelValue","label","filters","onCreate"])):s.type==="Exam"?(c(),S(A,{key:1,modelValue:s.exam,"onUpdate:modelValue":r[3]||(r[3]=p=>s.exam=p),doctype:"Exam Activity",label:n.__("Select an Exam"),filters:{course:(b=(t=d(y))==null?void 0:t.data)==null?void 0:b.course},onCreate:(p,E)=>F(p,E)},null,8,["modelValue","label","filters","onCreate"])):s.type==="Assignment"?(c(),S(A,{key:2,modelValue:s.assignment,"onUpdate:modelValue":r[4]||(r[4]=p=>s.assignment=p),doctype:"Assignment Activity",label:n.__("Select an Assignment"),filters:{course:(V=(i=d(y))==null?void 0:i.data)==null?void 0:V.course},onCreate:(p,E)=>Q(p,E)},null,8,["modelValue","label","filters","onCreate"])):(c(),g("p",pe,"Offline")),_(d(U),{modelValue:s.weight_scac,"onUpdate:modelValue":r[5]||(r[5]=p=>s.weight_scac=p),label:n.__("Weight"),class:"mb-4",required:!0,maxlength:"10"},null,8,["modelValue","label"])])]}),_:1},8,["modelValue","options"]))}},fe={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ye={key:0,class:"flex items-center mt-3 md:mt-0"},ge={key:1,class:"flex items-center mt-3 md:mt-0"},he={class:"mt-5 mb-10 w-full px-5"},be={class:"container max-w-full mb-5"},Ve={key:0,class:"text-lg font-semibold mb-4"},ve={key:1,class:"text-lg font-semibold mb-4"},Ce={class:"min-w-full table-auto border-collapse overflow-auto"},we={class:"p-2 border"},xe={class:"p-2 border"},Ae={class:"p-2 border"},ke={class:"p-2 border"},Se={class:"p-2 border"},ze={class:"p-2 border"},qe={class:"p-2 border"},Ue={class:"p-2 border"},Ne={class:"p-2 border"},Ee={class:"p-2 border"},Te={class:"p-2 border"},$e={key:3},De={class:"p-2 border text-center"},Pe={class:"p-2 border",style:{width:"10%"}},je={key:0,class:"mb-4 light-blue-bg p-2 rounded"},Me={key:1,class:"mb-4"},Fe={class:"p-2 border"},Oe={class:"p-2 border text-center"},Qe={key:0,class:"checkmark"},Ie={key:1,class:"text-red-500"},Re={class:"p-2 border text-center align-middle"},Be={__name:"CourseAssessment",props:H({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(C){ae(),X(),oe("$user"),ce();const w=re(!1);J(C,"modelValue");const u=C,v=G({title:"",assesscriteria_scac:"",type:"",weight_scac:"",quiz:"",exam:"",assignment:"",extracredit_scac:0,fudgepoints_scac:"",parent:u.courseName,parenttype:"Course Schedule",parentfield:"courseassescrit_sc"}),f=P({url:"seminary.seminary.utils.get_course_details",cache:["course",u.courseName],params:{course:u.courseName},auto:!0}),l=P({url:"seminary.seminary.utils.get_assessments",cache:["assessments",u.courseName],params:{course:u.courseName},auto:!0}),k=T(()=>{var a;let e=[{label:"Courses",route:{name:"Courses"}}];return e.push({label:(a=f==null?void 0:f.data)==null?void 0:a.course,route:{name:"CourseDetail",params:{courseName:u.courseName}}}),e.push({label:"Assessment",route:{name:"CourseAssessment",params:{courseName:u.courseName}}}),e}),x=T(()=>{var e;return{title:(e=f==null?void 0:f.data)==null?void 0:e.title,description:"Assessment Configuration for the course"}});ue(x);const s=G([]),h=T(()=>s.reduce((e,a)=>a.extracredit_scac===0?e+parseFloat(a.weight_scac||0):e,0)),z=T(()=>s.reduce((e,a)=>a.extracredit_scac?e+parseFloat(a.fudgepoints_scac||0):e,0));le(()=>{j(()=>l.data,e=>{e&&y()}),l.reload()});function y(){s.length=0,l.data?Array.isArray(l.data)?l.data.forEach(e=>{s.push({name:e.name||"",title:e.title||"",assesscriteria_scac:e.assesscriteria_scac||"",type:e.type||"",weight_scac:e.weight_scac||0,quiz:e.quiz||"",exam:e.exam||"",assignment:e.assignment||"",creator:e.creator||"",extracredit_scac:e.extracredit_scac||0,fudgepoints_scac:e.fudgepoints_scac||"",name:e.name||"",parent:e.parent||"",parenttype:e.parenttype||"",parentfield:e.parentfield||"",due_date:e.due_date||"",lesson:e.lesson||""})}):s.push({name:l.data.name||"",title:l.data.title||"",assesscriteria_scac:l.data.assesscriteria_scac||"",type:l.data.type||"",weight_scac:l.data.weight_scac||0,quiz:l.data.quiz||"",exam:l.data.exam||"",assignment:l.data.assignment||"",creator:l.data.creator||"",extracredit_scac:l.data.extracredit_scac||0,fudgepoints_scac:l.data.fudgepoints_scac||"",name:l.data.name||"",parent:l.data.parent||"",parenttype:l.data.parenttype||"",parentfield:l.data.parentfield||"",due_date:l.data.due_date||"",lesson:l.data.lesson||""}):console.log("No assessments data found")}function M(e){return $(this,null,function*(){const a=s[e];if(confirm(__("Are you sure you want to delete this record?"))){if(a.name)try{yield F.reload([a.name]),console.log(`Record with name ${a.name} deleted from backend.`),N.success(__("Assessment criteria deleted successfully"))}catch(t){console.error("Error deleting assessment criteria:",t),N.error(__("Failed to delete assessment criteria"));return}s.splice(e,1),console.log(`Record at index ${e} removed from frontend.`)}})}const F=P({url:"seminary.seminary.api.delete_documents",makeParams(e){return{doctype:"Scheduled Course Assess Criteria",documents:e}},onSuccess(e){console.log("Delete successful:",e)},onError(e){console.error("Error deleting documents:",e)}});function O(){w.value=!0}function Q(){for(const e of s)if(!e.assesscriteria_scac||e.type==="Quiz"&&!e.quiz||e.type==="Exam"&&!e.exam||e.type==="Assignment"&&!e.assignment||!e.extracredit_scac&&!e.weight_scac||e.extracredit_scac&&!e.fudgepoints_scac)return!1;return!0}function I(){if(!Q()){N.error(__("Please fill in all required fields"));return}fetch("/api/method/seminary.seminary.api.save_course_assessment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course:u.courseName,assessment_data:s})}).then(e=>e.json()).then(e=>{console.log("Success:",e),e.message&&N.success(__("Course updated successfully"))}).catch(e=>{console.error("Error:",e)})}function R(e){return $(this,null,function*(){if(e.assesscriteria_scac)try{const t=yield(yield fetch(`/api/resource/Assessment Criteria/${e.assesscriteria_scac}`)).json();e.type=t.data.type}catch(a){console.error("Error fetching type:",a)}})}function B(e){if(!e)return"";const a=new Date(e),t=String(a.getMonth()+1).padStart(2,"0"),b=String(a.getDate()).padStart(2,"0"),i=String(a.getHours()).padStart(2,"0"),V=String(a.getMinutes()).padStart(2,"0");return`${t}/${b} ${i}:${V}`}function n(){l.reload(),w.value=!1}function r(e,a){const t={quiz:"/seminary/quizzes/new",exam:"/seminary/exams/new",assignment:"/seminary/assignments/new"},b=t==null?void 0:t[String(e||"").toLowerCase()];typeof a=="function"&&a(),b&&window.open(b,"_blank")}return(e,a)=>(c(),g(K,null,[o("header",fe,[_(d(ee),{class:"h-7",items:k.value},null,8,["items"]),h.value!==100?(c(),g("div",ye,[_(d(se),{text:e.__("Save is only allowed when Total Points = 100"),placement:"bottom"},{default:q(()=>[_(d(D),{variant:"subtle",class:"ml-2"},{default:q(()=>[o("span",null,m(e.__("Adjust totals to save")),1)]),_:1})]),_:1},8,["text"])])):(c(),g("div",ge,[_(d(D),{variant:"solid",onClick:a[0]||(a[0]=t=>I()),class:"ml-2"},{default:q(()=>[o("span",null,m(e.__("Save")),1)]),_:1})]))]),o("div",he,[o("div",be,[d(f).data?(c(),g("div",ve,m(e.__("Assessment Criteria for "+d(f).data.course)),1)):(c(),g("div",Ve,m(e.__("Assessment Criteria")),1)),o("div",{class:ne({"flex justify-between mb-4 p-3 text-xl":!0,"bg-red-400 rounded":h.value!==100})},[o("div",null,[o("strong",null,m(e.__("Total Points"))+":",1),L(" "+m(h.value),1)]),o("div",null,[o("strong",null,m(e.__("Max Fudge Points"))+":",1),L(" "+m(z.value),1)])],2)])]),o("table",Ce,[o("thead",null,[o("tr",null,[o("th",we,m(e.__("Title")),1),o("th",xe,m(e.__("Assessment Type")),1),o("th",Ae,m(e.__("Activity Selection")),1),o("th",ke,m(e.__("Extra Credit?")),1),o("th",Se,m(e.__("Points")),1),o("th",ze,m(e.__("Due Date")),1),o("th",qe,m(e.__("In Lesson")),1),o("th",Ue,m(e.__("Delete")),1)])]),o("tbody",null,[(c(!0),g(K,null,ie(s,(t,b)=>(c(),g("tr",{key:b},[o("td",Ne,[_(d(U),{modelValue:t.title,"onUpdate:modelValue":i=>t.title=i,class:"mb-4 overflow-visible",required:!1},null,8,["modelValue","onUpdate:modelValue"])]),o("td",Ee,[_(A,{modelValue:t.assesscriteria_scac,"onUpdate:modelValue":[i=>t.assesscriteria_scac=i,i=>{console.log("update:modelValue triggered:",i),R(t)}],class:"mb-4",doctype:"Assessment Criteria",required:!0},null,8,["modelValue","onUpdate:modelValue"])]),o("td",Te,[t.type==="Quiz"?(c(),S(A,{key:0,modelValue:t.quiz,"onUpdate:modelValue":i=>t.quiz=i,doctype:"Quiz",label:e.__("Select a Quiz"),required:!0,filters:{course:d(f).data.course},onCreate:(i,V)=>r("quiz",V)},null,8,["modelValue","onUpdate:modelValue","label","filters","onCreate"])):t.type==="Exam"?(c(),S(A,{key:1,modelValue:t.exam,"onUpdate:modelValue":i=>t.exam=i,doctype:"Exam Activity",label:e.__("Select an Exam"),required:!0,filters:{course:d(f).data.course},onCreate:(i,V)=>r("exam",V)},null,8,["modelValue","onUpdate:modelValue","label","filters","onCreate"])):t.type==="Assignment"?(c(),S(A,{key:2,modelValue:t.assignment,"onUpdate:modelValue":i=>t.assignment=i,doctype:"Assignment Activity",label:e.__("Select an Assignment"),required:!0,filters:{course:d(f).data.course},onCreate:(i,V)=>r("assignment",V)},null,8,["modelValue","onUpdate:modelValue","label","filters","onCreate"])):(c(),g("p",$e,"Offline"))]),o("td",De,[_(d(U),{modelValue:t.extracredit_scac,"onUpdate:modelValue":i=>t.extracredit_scac=i,type:"checkbox",required:!1,class:"mb-4 inline-block",default:!1},null,8,["modelValue","onUpdate:modelValue"])]),o("td",Pe,[t.extracredit_scac?(c(),g("div",je,[_(d(U),{modelValue:t.fudgepoints_scac,"onUpdate:modelValue":i=>t.fudgepoints_scac=i,label:e.__("Fudge Points"),type:"float",class:"max-w-14ch",required:!0},null,8,["modelValue","onUpdate:modelValue","label"])])):(c(),g("div",Me,[_(d(U),{modelValue:t.weight_scac,"onUpdate:modelValue":i=>t.weight_scac=i,label:e.__("Weight"),type:"float",class:"max-w-14ch",required:!0},null,8,["modelValue","onUpdate:modelValue","label"])]))]),o("td",Fe,[_(te,{modelValue:t.due_date,"onUpdate:modelValue":i=>t.due_date=i,variant:"subtle",required:!1,class:"date-column",formatter:B},null,8,["modelValue","onUpdate:modelValue"])]),o("td",Oe,[t.lesson?(c(),g("span",Qe,[...a[3]||(a[3]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1)])])):(c(),g("span",Ie," âœ˜ "))]),o("td",Re,[_(d(D),{variant:"ghost",size:"sm",theme:"red",onClick:i=>M(b)},{default:q(()=>[_(d(de),{class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]))),128))])]),a[4]||(a[4]=o("br",null,null,-1)),_(d(D),{size:"sm",onClick:O},{default:q(()=>[L(m(e.__("Add Evaluation")),1)]),_:1}),_(_e,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=t=>w.value=t),modalcriteria:v,"onUpdate:modalcriteria":a[2]||(a[2]=t=>v=t),courseName:u.courseName,onAssessmentSaved:n},null,8,["modelValue","modalcriteria","courseName"])],64))}},es=Z(Be,[["__scopeId","data-v-2110b2b6"]]);export{es as default};
//# sourceMappingURL=CourseAssessment-BbLbUCEj.js.map
