import{c as L,q as F,y as J,t as D,u as X,w as I,r as H,z as Q}from"./frappe-ui-DItCq3tW.js";import{U as G,V as W,r as b,c as C,c0 as Y,t as p,b as u,z as S,g as o,n as q,C as V,D as c,H as R,O as z,a as M,w as v,e as i,u as n,c1 as Z,X as P,S as B,L as ee,M as se,Q as te,R as oe,N as re,K as ae,J as le,bk as ne,F as ie,am as ue,av as ce,bg as de,c2 as me}from"./vendor-HNRiXHBS.js";import{u as pe}from"./index-zqmVXotY.js";import{_ as fe}from"./CourseOutline-agG91JAR.js";import"./index-DYiOfYjK.js";import{u as _e}from"./settings-ocK7QO_r.js";import"./Link-CDfjKa6y.js";/* empty css                                                                     */const ve={key:0,class:"text-ink-red-3"},he={class:"grid grid-cols-3 gap-1"},ge={class:""},be={class:"mt-1 rounded-lg bg-surface-white py-1 text-base shadow-2xl"},ye={class:"flex flex-col gap-1 p-1"},ke={class:"text-base font-medium"},xe={class:"text-sm text-ink-gray-5"},we={__name:"MultiSelect",props:G({label:{type:String},size:{type:String,default:"sm"},doctype:{type:String,required:!0},filters:{type:Object,default:()=>({})},validate:{type:Function,default:null},errorMessage:{type:Function,default:h=>`${h} is an Invalid value`},required:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h,{expose:k}){const g=h,d=W(h,"modelValue"),f=b([]),x=b(null),r=b(null),_=b(""),y=b(""),m=b(!1),$=C({get:()=>_.value||"",set:s=>{_.value="",s&&(m.value=!1),s!=null&&s.value&&j(s.value)}});Y(_,s=>{s=s||"",y.value!==s&&(y.value=s,T(s))},{debounce:300,immediate:!0});const w=L({url:"frappe.desk.search.search_link",method:"POST",cache:[y.value,g.doctype],auto:!0,params:{txt:y.value,doctype:g.doctype}}),O=C(()=>w.data||[]);function T(s){w.update({params:{txt:s,doctype:g.doctype}}),w.reload()}const j=s=>{r.value=null,s&&(s.split(",").forEach(t=>{var a;if(t=t.trim(),t&&!((a=d.value)!=null&&a.includes(t))){if(t&&g.validate&&!g.validate(t)){r.value=g.errorMessage(t);return}d.value?d.value.push(t):d.value=[t],t=t.replace(t,"")}}),!r.value&&(s=""))},U=s=>{d.value=d.value.filter(l=>l!==s)},E=()=>{var l;if(_.value)return;let s=(l=f.value[f.value.length-1])==null?void 0:l.$el;document.activeElement===s?(d.value.pop(),le(()=>{d.value.length?(s=f.value[f.value.length-1].$el,s==null||s.focus()):N()})):s==null||s.focus()};function N(){x.value.$el.focus()}k({setFocus:N});const e=C(()=>[{sm:"text-xs",md:"text-base"}[g.size||"sm"],"text-ink-gray-5"]);return(s,l)=>(u(),p("div",null,[h.label?(u(),p("label",{key:0,class:q(["block mb-1",e.value])},[V(c(h.label)+" ",1),h.required?(u(),p("span",ve,"*")):S("",!0)],2)):S("",!0),o("div",he,[(u(!0),p(R,null,z(d.value,t=>(u(),M(n(F),{ref_for:!0,ref_key:"emails",ref:f,key:t,label:t,theme:"gray",variant:"subtle",class:"rounded-md",onKeydownCapture:P(B(E,["stop"]),["delete"])},{suffix:v(()=>[i(n(Z),{onClick:a=>U(t),class:"h-4 w-4 stroke-1.5"},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),o("div",ge,[i(n(ae),{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=t=>$.value=t),nullable:""},{default:v(()=>[i(n(J),{class:"w-full",show:m.value,"onUpdate:show":l[1]||(l[1]=t=>m.value=t)},{target:v(({togglePopover:t})=>[i(n(re),{ref_key:"search",ref:x,class:"search-input form-input w-full focus-visible:!ring-0",type:"text",value:_.value,onChange:l[0]||(l[0]=a=>{_.value=a.target.value,m.value=!0}),autocomplete:"off",onFocus:()=>t(),onKeydownCapture:P(B(E,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:v(({isOpen:t})=>[ee(o("div",null,[o("div",be,[i(n(se),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:v(()=>[(u(!0),p(R,null,z(O.value,a=>(u(),M(n(te),{key:a.value,value:a},{default:v(({active:K})=>[o("li",{class:q(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-2":K}])},[o("div",ye,[o("div",ke,c(a.description),1),o("div",xe,c(a.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[oe,t]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])])]))}},Ce={class:""},Ve={class:"grid md:grid-cols-[70%,30%] h-full"},Se={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},$e={class:"flex items-center mt-3 md:mt-0"},Ee={class:"mt-5 mb-10"},Ne={class:"container mb-5"},Fe={class:"text-lg font-semibold mb-4"},Me={key:0},Oe={key:1},Te={class:"mb-4"},je={class:"mb-1.5 mt-4 text-sm text-ink-gray-5"},Ue={class:"mb-4"},De={class:"text-xs text-ink-gray-5 mb-2"},Ie={class:"flex items-center"},Le={class:"border rounded-md w-fit py-5 px-20"},qe={class:"ml-4"},Ke={class:"mt-2 text-ink-gray-5 text-sm"},Re={key:1,class:"mb-4"},ze={class:"flex items-center"},Pe=["src"],Be={class:"ml-4"},Ae={class:"mt-2 text-ink-gray-5 text-sm"},Je={class:"mb-4"},Xe={class:"container border-t"},He={key:0,class:"text-lg font-semibold mt-5 mb-4"},Qe={class:"grid grid-cols-2 gap-10 mb-4"},Ge={key:0,class:"flex flex-col space-y-4"},We={class:"border-l pt-5"},Ye=55,is={__name:"CourseForm",props:{courseName:{type:String}},setup(h){const k=ne("$user");b("");const g=ie(),d=b([]),f=b([]);_e();const x=h,r=ue({course:"",short_introduction:"",course_description_for_lms:"",course_image:null,published:!1}),_=C(()=>{const e=r.short_introduction.length||0;return Ye-e});ce(()=>{m.reload(),window.addEventListener("keydown",y)});const y=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(w(),e.preventDefault())};de(()=>{window.removeEventListener("keydown",y)});const m=L({url:"frappe.client.get",makeParams(e){return{doctype:"Course Schedule",name:x.courseName}},auto:!1,onSuccess(e){if(!e){console.error("No data received from courseResource");return}Object.keys(e).forEach(l=>{l=="instructor1"?(d.value=[],f.value=[],e.instructor1.forEach(t=>{d.value.push(t),f.value.push(t.instructor)})):Object.hasOwn(r,l)&&(r[l]=e[l])});let s=["published"];for(let l in s){let t=s[l];r[t]=!!r[t]}e.course_image&&$.reload({image:e.course_image}),U()},onError(e){console.error("courseResource onError:",e)}}),$=L({url:"seminary.seminary.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){r.course_image=e},onError(e){console.error("imageResource onError:",e)}}),w=()=>{m.data&&fetch("/api/method/seminary.seminary.api.save_course",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({course:m.data.name,course_data:r})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>{var s;e.message&&e.message.success?D.success(__("Course updated successfully")):D.error(((s=err.messages)==null?void 0:s[0])||err)}).catch(e=>{console.error("Fetch error:",e);const s=typeof e=="object"?JSON.stringify(e):e.toString();D.error(s||__("An error occurred"))})},O=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return __("Only image file is allowed.")},T=e=>{r.course_image=e},j=()=>{r.course_image=null},U=()=>{var s;let e=!1;(s=k.data)!=null&&s.is_moderator||(d.value.forEach(l=>{var t;!e&&l.user==((t=k.data)==null?void 0:t.name)&&(e=!0)}),e||(console.log("Redirecting to Courses due to insufficient permissions"),g.push({name:"Courses"})))},E=C(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return m.data&&e.push({label:r.course,route:{name:"CourseDetail",params:{courseName:x.courseName}}}),e.push({label:"Edit Course",route:{name:"CourseForm",params:{courseName:x.courseName}}}),e}),N=C(()=>({title:"Edit Course",description:"Edit a course for your learning system."}));return pe(N),(e,s)=>{var l,t;return u(),p("div",Ce,[o("div",Ve,[o("div",null,[o("header",Se,[i(n(X),{class:"h-7",items:E.value},null,8,["items"]),o("div",$e,[i(n(F),{variant:"solid",onClick:s[0]||(s[0]=a=>w()),class:"ml-2"},{default:v(()=>[o("span",null,c(e.__("Save")),1)]),_:1})])]),o("div",Ee,[o("div",Ne,[o("div",Fe,c(e.__("Details")),1),i(n(I),{modelValue:r.course,"onUpdate:modelValue":s[1]||(s[1]=a=>r.course=a),label:e.__("Title"),class:"mb-4",required:!0},null,8,["modelValue","label"]),i(n(I),{modelValue:r.short_introduction,"onUpdate:modelValue":s[2]||(s[2]=a=>r.short_introduction=a),label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card (less than 55 characters)"),class:"mb-2",required:!0},null,8,["modelValue","label","placeholder"]),o("div",{class:q(["text-sm mt-1",_.value<0?"text-red-500":"text-ink-gray-5"])},[_.value>=0?(u(),p("span",Me,c(`${_.value} characters available`),1)):(u(),p("span",Oe,c(e.__("This introduction may be truncated on the course card.")),1))],2),o("div",Te,[o("div",je,[V(c(e.__("Course Description"))+" ",1),s[8]||(s[8]=o("span",{class:"text-ink-red-3"},"*",-1))]),i(n(H),{content:r.course_description_for_lms,onChange:s[3]||(s[3]=a=>r.course_description_for_lms=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),o("div",Ue,[o("div",De,[V(c(e.__("Course Image"))+" ",1),s[9]||(s[9]=o("span",{class:"text-ink-red-3"},"*",-1))]),r.course_image?(u(),p("div",Re,[o("div",ze,[o("img",{src:r.course_image.file_url,class:"border rounded-md w-40"},null,8,Pe),o("div",Be,[i(n(F),{onClick:s[5]||(s[5]=a=>j())},{default:v(()=>[V(c(e.__("Remove")),1)]),_:1}),o("div",Ae,c(e.__("Appears on the course card in the course list")),1)])])])):(u(),M(n(Q),{key:0,fileTypes:["image/*"],validateFile:O,onSuccess:s[4]||(s[4]=a=>T(a))},{default:v(({file:a,progress:K,uploading:Ze,openFileSelector:A})=>[o("div",Ie,[o("div",Le,[i(n(me),{class:"size-5 stroke-1 text-ink-gray-7"})]),o("div",qe,[i(n(F),{onClick:A},{default:v(()=>[V(c(e.__("Upload")),1)]),_:1},8,["onClick"]),o("div",Ke,c(e.__("Appears on the course card in the course list")),1)])])]),_:1}))]),o("div",Je,[i(we,{modelValue:f.value,"onUpdate:modelValue":s[6]||(s[6]=a=>f.value=a),doctype:"Instructor",label:e.__("Instructors"),filters:{Status:"Active"},required:!0},null,8,["modelValue","label"])])]),o("div",Xe,[(l=n(k).data)!=null&&l.is_moderator?(u(),p("div",He,c(e.__("Settings")),1)):S("",!0),o("div",Qe,[(t=n(k).data)!=null&&t.is_moderator?(u(),p("div",Ge,[i(n(I),{type:"checkbox",modelValue:r.published,"onUpdate:modelValue":s[7]||(s[7]=a=>r.published=a),label:e.__("Published")},null,8,["modelValue","label"])])):S("",!0)])])])]),o("div",We,[n(m).data?(u(),M(fe,{key:0,courseName:n(m).data.name,title:r.course,allowEdit:!0},null,8,["courseName","title"])):S("",!0)])])])}}};export{is as default};
//# sourceMappingURL=CourseForm-DhvmJdv6.js.map
