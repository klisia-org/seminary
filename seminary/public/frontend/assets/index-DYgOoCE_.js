var bt=Object.defineProperty,xt=Object.defineProperties;var kt=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var wt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var Re=(d,e,t)=>e in d?bt(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t,Ie=(d,e)=>{for(var t in e||(e={}))wt.call(e,t)&&Re(d,t,e[t]);if(Ye)for(var t of Ye(e))$t.call(e,t)&&Re(d,t,e[t]);return d},Ue=(d,e)=>xt(d,kt(e));var ve=(d,e,t)=>Re(d,typeof e!="symbol"?e+"":e,t);var j=(d,e,t)=>new Promise((l,r)=>{var i=v=>{try{p(t.next(v))}catch(x){r(x)}},_=v=>{try{p(t.throw(v))}catch(x){r(x)}},p=v=>v.done?l(v.value):Promise.resolve(v.value).then(i,_);p((t=t.apply(d,e)).next())});import{b as He,c as H,j as G,y as Ee,q as Ae,u as Ne,K as ze,v as be,D as at,J as ot,F as nt,d as St,f as Ct,x as rt}from"./frappe-ui-BzEkZ7NZ.js";import{c as ce,a as I,b as o,w as R,g as s,m as Tt,n as Fe,u as a,bk as Ce,r as C,am as Le,F as Qe,I as te,t as u,z as M,D as n,e as q,H as ae,O as ue,L as xe,cf as Oe,cg as Xe,ch as Be,R as lt,C as me,av as we,J as it,aL as re,q as Te,c7 as At,bg as Et,c2 as Ft,c0 as Mt,ce as Lt,s as zt,U as ut,V as Ve,bZ as qt,ci as Nt,cj as Pt,cb as Je,a8 as It,ck as Dt,aw as Pe,cl as Rt,bT as Ut,cm as dt,cn as ct,co as mt,cp as pt,cq as Ot,cr as Bt,cs as Vt,ct as jt,cu as Ze,bV as Ht,cd as Ke,bW as Qt,S as Me,cv as Jt,cw as Gt,cx as Wt,cy as Yt,cz as Xt,cA as Zt,cB as Kt,cC as es,cD as ts}from"./vendor-IWZbD1HA.js";import{_ as qe}from"./Link-DmVUQNbJ.js";import{t as ke,r as Se,u as Ge,i as ft}from"./index-B0k3CMx6.js";/* empty css                                                                     */const ss={class:"w-full bg-surface-gray-3 rounded-full h-1"},ht={__name:"ProgressBar",props:{progress:{type:Number,default:0},size:{type:String,default:"sm"}},setup(d){const e=d,t=ce(()=>`${Math.min(Math.ceil(e.progress),100)}%`),l=ce(()=>{if(e.size==="sm")return"h-1";if(e.size==="md")return"h-2";if(e.size==="lg")return"h-3"});return(r,i)=>(o(),I(a(He),{text:`${e.progress}%`},{default:R(()=>[s("div",ss,[s("div",{class:Fe(["bg-surface-gray-7 rounded-full",l.value]),style:Tt({width:t.value})},null,6)])]),_:1},8,["text"]))}},as={key:0},os={class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},ns={class:"leading-5"},rs={key:0,class:"leading-5"},ls={key:1,class:"leading-5"},is={key:2,class:"leading-relaxed"},us={key:3,class:"leading-relaxed"},ds={key:0,class:"flex flex-col space-x-1 my-4"},cs={class:"mb-2"},ms={class:"font-semibold"},ps={key:1},fs={class:"border text-center p-20 rounded-md"},hs={class:"font-semibold text-lg"},gs={key:2},vs={key:2},ys={key:0,class:"border rounded-md p-5"},_s={class:"flex justify-between"},bs={class:"text-sm text-ink-gray-5"},xs={class:"mr-2"},ks={class:"text-ink-gray-9 text-sm font-semibold item-left"},ws=["innerHTML"],$s={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Ss=["name","onChange"],Cs=["name","onChange"],Ts={key:0},As=["innerHTML"],Es={key:1},Fs={key:0},Ms={key:2},Ls={class:"flex items-center justify-between mt-4"},zs={class:"text-sm text-ink-gray-5"},qs={key:3},Ns={class:"flex justify-between"},Ps={class:"text-sm text-ink-gray-5"},Is={class:"mr-2"},Ds={class:"text-ink-gray-9 text-sm font-semibold item-left"},Rs=["innerHTML"],Us={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Os=["name","onChange"],Bs=["name","onChange"],Vs=["innerHTML"],js={key:1},Hs={class:"text-center mt-4"},Qs={key:4,class:"border rounded-md p-20 text-center space-y-4"},Js={class:"text-ink-gray-9"},Gs={class:"mt-6"},Ws={class:"flex justify-between"},Ys={class:"text-lg text-ink-gray-5"},Xs={class:"mr-2"},Zs=["innerHTML"],Ks={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ea={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ta={key:0,class:"bg-surface-gray-3 rounded-md p-3 mt-4"},sa={class:"mt-4"},aa={key:1},oa={__name:"Quiz",props:{quizName:{type:String,required:!0}},setup(d){const e=Ce("$user"),t=C(!1),l=C(0),r=C(""),i=Le([0,0,0,0]),_=Le([]);let p=Le([]);const v=C(null),x=C(0);let h=null;const T=Qe(),z=C(0),b=Le({}),Y=d,g=H({url:"frappe.client.get",makeParams(f){return{doctype:"Quiz",name:Y.quizName}},cache:["quiz",Y.quizName],auto:!0,transform(f){return f?(f.duration=parseInt(f.duration)||0,f):(console.error("Quiz data is null or undefined."),null)},onSuccess(f){f?(F(),S()):console.error("Failed to load quiz data.")},onError(f){console.error("Error loading quiz data:",f)}}),U=ce(()=>!!g.data),F=()=>{let f=g.data;if(f.shuffle_questions){const c=ee([...f.questions]);p=f.limit_questions_to?c.slice(0,f.limit_questions_to):c}else p=f.questions},S=()=>{g.data.duration&&(x.value=g.data.duration*60)},y=()=>{h=setInterval(()=>{g.data.duration&&(x.value--,x.value==0&&(clearInterval(h),m())),z.value++},1e3)},L=f=>{const c=Math.floor(f/3600).toString().padStart(2,"0"),J=Math.floor(f%3600/60).toString().padStart(2,"0"),B=(f%60).toString().padStart(2,"0");return c!="00"?`${c}:${J}:${B}`:`${J}:${B}`},D=ce(()=>x.value/(g.data.duration*60)*100),ee=f=>{for(let c=f.length-1;c>0;c--){const J=Math.floor(Math.random()*(c+1));[f[c],f[J]]=[f[J],f[c]]}return f},K=H({url:"frappe.client.get_list",makeParams(f){var c,J;return{doctype:"Quiz Submission",filters:{member:(c=e.data)==null?void 0:c.name,quiz:(J=g.data)==null?void 0:J.name},fields:["name","creation","score","score_out_of","percentage","passing_percentage"],order_by:"creation desc"}},transform(f){f.forEach((c,J)=>{c.creation=De(c.creation),c.idx=J+1})}});te(()=>g.data,f=>{f&&F(),f&&g.data.max_attempts&&(K.reload(),Z())});const Q=H({url:"seminary.seminary.doctype.quiz.quiz.quiz_summary",makeParams(f){if(!g.data)return{};const c=g.data.duration?g.data.duration*60-(x.value||0):z.value||0;return{quiz:g.data.name,course:T.currentRoute.value.params.courseName,results:(f==null?void 0:f.results)||localStorage.getItem(`${g.data.name}_results`),time_taken:c}},onSuccess(f){f.corrected_answers&&(ne.data=f.corrected_answers.map(c=>Ue(Ie({},c),{user_answer:c.user_answer||null,correct_answer:c.correct_answer||null})))},onError(f){console.error("Error loading quiz summary:",f)},auto:!0}),V=H({url:"seminary.seminary.utils.get_question_details",makeParams(f){return{question:r.value}}});te(l,f=>{f>0&&(r.value=g.data.questions[f-1].question,V.reload())}),te(()=>Y.quizName,f=>{f&&g.reload()});const ne=H({url:"seminary.seminary.utils.get_all_questions_details",makeParams(f){return{questions:p.map(c=>c.name)}}}),w=()=>{l.value=1,localStorage.removeItem(g.data.title),y()},E=()=>{localStorage.removeItem(g.data.title),t.value=!0,y(),ne.reload()},k=f=>{V.data.multiple||i.splice(0,i.length,0,0,0,0),i[f-1]=i[f-1]?0:1},P=()=>{let f=[];return V.data.type=="Choices"?i.forEach((J,B)=>{i[B]&&f.push(V.data[`option_${B+1}`])}):f.push(v.value),f},X=()=>{let f=P();if(!f.length){vt({title:"Please select an option",icon:"alert-circle",iconClasses:"text-yellow-600 bg-yellow-100 rounded-full",position:"top-center"});return}H({url:"seminary.seminary.doctype.quiz.quiz.check_answer",params:{question:r.value,type:V.data.type,answers:JSON.stringify(f)},auto:!0,onSuccess(c){V.data.type==="Choices"?i.forEach((B,se)=>{B?_[se]=B&&c[se]:c[se]===2?_[se]=2:_[se]=void 0}):_.push(c),fe(),g.data.show_answers||he()}})},fe=()=>{let f=JSON.parse(localStorage.getItem(g.data.title))||[],c={question_name:r.value,answer:P().join(),is_correct:_.filter(B=>B!=null)};const J=f.findIndex(B=>B.question_name===c.question_name);J!==-1?f[J]=c:f?f.push(c):f=[c],localStorage.setItem(g.data.title,JSON.stringify(f)),localStorage.setItem(`${g.data.name}_results`,JSON.stringify(f))},ye=()=>{g.data.show_answers?(fe(),he()):X()},he=()=>{l.value!=g.data.questions.length&&(l.value=l.value+1,i.splice(0,i.length,0,0,0,0),_.length=0,v.value=null)},m=()=>{if(!g.data.show_answers){X(),setTimeout(()=>{A()},500);return}A(),console.log("Quiz submitted with Submit Quiz button and asnwers shown")},$=()=>j(this,null,function*(){var J;const f=[],c=[];for(let B=0;B<ne.data.length;B++){const se=ne.data[B],pe=((J=b[B])==null?void 0:J[0])||"",O=yield ze("seminary.seminary.doctype.quiz.quiz.check_answer",{question:se.question,type:se.type,answers:JSON.stringify([pe])}),ie=Array.isArray(O)?[O.find(W=>W===1)||0]:[O];f.push({question_name:se.question,answer:pe,is_correct:ie}),c.push({question_name:se.question,question_detail:se.question_detail,user_answer:pe,correct_answer:null,explanation:se.explanation||null})}Q.submit({results:JSON.stringify(f)},{onSuccess:B=>j(this,null,function*(){const se=yield ze("seminary.seminary.doctype.quiz.quiz.get_all_question_results",{questions:p.map(pe=>pe.question)});c.forEach(pe=>{const O=se.find(ie=>ie.name===pe.question_name);O&&(pe.correct_answer=O.correct_option,pe.explanation=O.correct_explanation||pe.explanation)}),localStorage.setItem(`${g.data.name}_questions`,JSON.stringify(c)),localStorage.setItem(`${g.data.name}_results`,JSON.stringify(f)),localStorage.setItem(`${g.data.name}_summary`,JSON.stringify(B)),Q.reload(),t.value=!1}),onError(B){console.error("Error submitting quiz:",B)}})}),A=()=>{const f=localStorage.getItem(`${g.data.name}_results`);if(!f){console.error("No results found to submit.");return}Q.submit({results:f},{onSuccess(c){le(),g.data&&g.data.max_attempts&&K.reload(),g.data.duration&&clearInterval(h)},onError(c){var B,se;((c==null?void 0:c.message)||"").includes("MaximumAttemptsExceededError")&&((B=c.messages)!=null&&B[0],be.error(((se=c.messages)==null?void 0:se[0])||c),setTimeout(()=>{window.location.reload()},3e3))}})},Z=()=>{l.value=0,i.splice(0,i.length,0,0,0,0),_.length=0,Q.reset(),F(),S(),z.value=0},N=f=>f.type=="Choices"?f.multiple?"Choose all answers that apply":"Choose one answer":"Type your answer",le=()=>{T.currentRoute.value.name==="Lesson"&&ze("seminary.seminary.api.mark_lesson_progress",{course:T.currentRoute.value.params.courseName,chapter_number:T.currentRoute.value.params.chapterNumber,lesson_number:T.currentRoute.value.params.lessonNumber}).then(()=>{t.value&&Q.reload()})},de=(f,c)=>{b[f]=[c]},oe=(f,c)=>{b[f]||(b[f]=[]);const J=b[f].indexOf(c);J===-1?b[f].push(c):b[f].splice(J,1)};te(()=>ne.data,f=>{f?console.log("All questions details updated"):console.warn("No data available in all_questions_details.")});const $e=C([]),_e=C([]);return te(()=>Q.data,()=>{if(Q.data){const f=localStorage.getItem(`${g.data.name}_questions`),c=localStorage.getItem(`${g.data.name}_results`);$e.value=f?JSON.parse(f):[],_e.value=c?JSON.parse(c):[]}}),(f,c)=>{var J,B,se,pe;return U.value?(o(),u("div",as,[s("div",os,[s("div",ns,n(`This quiz consists of ${a(p).length} questions.`),1),(J=a(g).data)!=null&&J.duration?(o(),u("div",rs,n(`Please ensure that you complete all the questions in ${a(g).data.duration} minutes.`),1)):M("",!0),(B=a(g).data)!=null&&B.duration?(o(),u("div",ls,n("If you fail to do so, the quiz will be automatically submitted when the timer ends."))):M("",!0),a(g).data.passing_percentage?(o(),u("div",is,n(`You will have to get ${a(g).data.passing_percentage}% correct answers in order to pass the quiz.`),1)):M("",!0),a(g).data.max_attempts?(o(),u("div",us,n(`You can attempt this quiz ${a(g).data.max_attempts===1?"1 time":`${a(g).data.max_attempts} times`}.`),1)):M("",!0)]),a(g).data.duration?(o(),u("div",ds,[s("div",cs,[c[7]||(c[7]=s("span",{class:""},n("Time")+": ",-1)),s("span",ms,n(L(x.value)),1)]),q(ht,{progress:D.value},null,8,["progress"])])):M("",!0),t.value?M("",!0):(o(),u("div",ps,[s("div",fs,[s("div",hs,n(a(g).data.title),1),(!a(g).data.max_attempts||((se=a(K).data)==null?void 0:se.length)<a(g).data.max_attempts)&&a(g).data.qbyquestion?(o(),I(a(G),{key:0,onClick:w,class:"mt-2"},{default:R(()=>[...c[8]||(c[8]=[s("span",null,n("Start"),-1)])]),_:1})):!a(g).data.max_attempts||((pe=a(K).data)==null?void 0:pe.length)<a(g).data.max_attempts?(o(),I(a(G),{key:1,onClick:E,class:"mt-2"},{default:R(()=>[...c[9]||(c[9]=[s("span",null,n("Start full quiz"),-1)])]),_:1})):(o(),u("div",gs,n("You have already exceeded the maximum number of attempts allowed for this quiz.")))])])),t.value===!1&&l.value!==0&&!a(Q).data&&a(g).data.qbyquestion?(o(),u("div",vs,[(o(!0),u(ae,null,ue(a(p),(O,ie)=>(o(),u("div",null,[ie==l.value-1&&a(V).data?(o(),u("div",ys,[s("div",_s,[s("div",bs,[s("span",xs,n(`Question ${l.value}`)+": ",1),s("span",null,n(N(a(V).data)),1)]),s("div",ks,n(O.points)+" "+n(O.points==1?"Point":"Points"),1)]),s("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:a(V).data.question},null,8,ws),a(V).data.type=="Choices"?(o(),u(ae,{key:0},ue(4,W=>s("div",null,[a(V).data[`option_${W}`]?(o(),u("label",$s,[!_.length&&!a(V).data.multiple?(o(),u("input",{key:0,type:"radio",name:encodeURIComponent(a(V).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:ge=>k(W)},null,40,Ss)):!_.length&&a(V).data.multiple?(o(),u("input",{key:1,type:"checkbox",name:encodeURIComponent(a(V).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:ge=>k(W)},null,40,Cs)):a(g).data.show_answers?(o(!0),u(ae,{key:2},ue(_,(ge,_t)=>(o(),u("div",null,[W-1==_t?(o(),u("div",Ts,[ge==1?(o(),I(a(Oe),{key:0,class:"w-4 h-4 text-green-800"})):ge==2?(o(),I(a(Xe),{key:1,class:"w-4 h-4 text-ink-green-2"})):ge==0?(o(),I(a(Be),{key:2,class:"w-4 h-4 text-red-600"})):(o(),I(a(Xe),{key:3,class:"w-4 h-4"}))])):M("",!0)]))),256)):M("",!0),s("span",{class:"ml-2",innerHTML:a(V).data[`option_${W}`]},null,8,As)])):M("",!0),a(V).data[`explanation_${W}`]?xe((o(),u("div",{key:1,class:"mt-2 text-xs"},n(a(V).data[`explanation_${W}`]),513)),[[lt,_.length]]):M("",!0)])),64)):a(V).data.type=="User Input"?(o(),u("div",Es,[q(a(Ee),{modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=W=>v.value=W),type:"textarea",disabled:!!_.length,class:"my-2"},null,8,["modelValue","disabled"]),_.length?(o(),u("div",Fs,[_[0]?(o(),I(a(Ae),{key:0,label:"Correct",theme:"green"},{prefix:R(()=>[q(a(Oe),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(o(),I(a(Ae),{key:1,theme:"red",label:"Incorrect"},{prefix:R(()=>[q(a(Be),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])):M("",!0)])):(o(),u("div",Ms,[q(a(Ne),{class:"mt-4",content:v.value,onChange:c[1]||(c[1]=W=>v.value=W),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),s("div",Ls,[s("div",zs,n(`Question ${l.value} of ${a(p).length}`),1),a(g).data.show_answers&&!_.length?(o(),I(a(G),{key:0,onClick:c[2]||(c[2]=W=>X())},{default:R(()=>[...c[10]||(c[10]=[s("span",null,n("Check"),-1)])]),_:1})):l.value!=a(p).length?(o(),I(a(G),{key:1,onClick:c[3]||(c[3]=W=>ye())},{default:R(()=>[...c[11]||(c[11]=[s("span",null,n("Next"),-1)])]),_:1})):(o(),I(a(G),{key:2,onClick:c[4]||(c[4]=W=>m())},{default:R(()=>[...c[12]||(c[12]=[s("span",null,n("Submit"),-1)])]),_:1}))])])):M("",!0)]))),256))])):M("",!0),t.value&&a(ne).data&&a(ne).data.length>0?(o(),u("div",qs,[(o(!0),u(ae,null,ue(a(ne).data,(O,ie)=>(o(),u("div",{key:O.name,class:"border rounded-md p-5 mb-4"},[s("div",Ns,[s("div",Ps,[s("span",Is,n(`Question ${ie+1}`)+":",1),s("span",null,n(N(O)),1)]),s("div",Ds,n(O.points||0)+" "+n(O.points==1?"Point":"Points"),1)]),s("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:O.question_detail},null,8,Rs),O.type=="Choices"?(o(),u(ae,{key:0},ue(4,W=>s("div",null,[O[`option_${W}`]?(o(),u("label",Us,[O.multiple?O.multiple?(o(),u("input",{key:1,type:"checkbox",name:`question_${ie}`,class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:ge=>oe(ie,O[`option_${W}`])},null,40,Bs)):M("",!0):(o(),u("input",{key:0,type:"radio",name:`question_${ie}`,class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:ge=>de(ie,O[`option_${W}`])},null,40,Os)),s("span",{class:"ml-2",innerHTML:O[`option_${W}`]},null,8,Vs)])):M("",!0)])),64)):O.type=="User Input"?(o(),u("div",js,[q(a(Ee),{modelValue:b[ie],"onUpdate:modelValue":W=>b[ie]=W,type:"textarea",class:"my-2"},null,8,["modelValue","onUpdate:modelValue"])])):M("",!0)]))),128)),s("div",Hs,[q(a(G),{onClick:c[5]||(c[5]=O=>$())},{default:R(()=>[...c[13]||(c[13]=[s("span",null,n("Submit Your Quiz"),-1)])]),_:1})])])):a(Q).data?(o(),u("div",Qs,[c[18]||(c[18]=s("div",{class:"text-lg font-semibold"},n("Quiz Summary"),-1)),s("div",Js,n(`You got ${Math.ceil(a(Q).data.percentage)}% correct answers with a score of ${a(Q).data.score} out of ${a(Q).data.score_out_of}`),1),s("div",Gs,[(o(!0),u(ae,null,ue($e.value,(O,ie)=>{var W,ge;return o(),u("div",{key:O.question_name,class:"border rounded-md p-5 mb-4"},[s("div",Ws,[s("div",Ys,[s("span",Xs,n(`Question ${ie+1}`)+":",1),s("span",{innerHTML:O.question_detail},null,8,Zs)])]),s("div",Ks,[c[14]||(c[14]=s("strong",null,n("Your Answer:"),-1)),me(" "+n(O.user_answer||"No Answer"),1)]),s("div",ea,[c[15]||(c[15]=s("strong",null,n("Correct Answer:"),-1)),me(" "+n(O.correct_answer||"No Correct Answer"),1)]),O.explanation?(o(),u("div",ta,[c[16]||(c[16]=s("strong",null,n("Explanation:"),-1)),me(" "+n(O.explanation),1)])):M("",!0),s("div",sa,[((ge=(W=_e.value[ie])==null?void 0:W.is_correct)==null?void 0:ge[0])===1?(o(),I(a(Ae),{key:0,label:"Correct",theme:"green"},{prefix:R(()=>[q(a(Oe),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(o(),I(a(Ae),{key:1,label:"Incorrect",theme:"red"},{prefix:R(()=>[q(a(Be),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])])}),128))]),q(a(G),{onClick:c[6]||(c[6]=O=>Z()),class:"mt-4"},{default:R(()=>[...c[17]||(c[17]=[s("span",null,n("Try Again"),-1)])]),_:1})])):M("",!0)])):(o(),u("div",aa,[...c[19]||(c[19]=[s("p",null,"Loading quiz data...",-1)])]))}}},na={key:1,class:"border rounded-md text-center py-20"},ra={__name:"QuizBlock",props:{quiz:{type:String,required:!0}},setup(d){const e=Ce("$user"),t=()=>{window.location.href="/login"};return(l,r)=>a(e).data?(o(),I(oa,{key:0,quizName:d.quiz},null,8,["quizName"])):(o(),u("div",na,[s("div",null,n(l.__("Please login to access the quiz.")),1),q(a(G),{onClick:r[0]||(r[0]=i=>t()),class:"mt-2"},{default:R(()=>[s("span",null,n(l.__("Login")),1)]),_:1})]))}},la={class:"p-5 space-y-4"},ia={key:0,class:"text-lg font-semibold"},ua={key:1,class:"text-lg font-semibold"},da={key:2,class:"text-lg font-semibold"},ca={class:"flex justify-end space-x-2"},We={__name:"AssessmentPlugin",props:{type:{type:String,required:!0},onAddition:{type:Function,required:!0}},setup(d){const e=C(!1),t=C(null),l=C(null),r=C(null),i=d;we(()=>j(this,null,function*(){yield it(),e.value=!0}));const _=()=>{i.type=="quiz"?i.onAddition(t.value):i.type=="exam"?i.onAddition(r.value):i.onAddition(l.value),e.value=!1},p=()=>{i.type=="quiz"?window.open("/seminary/quizzes/new","_blank"):i.type=="exam"?window.open("/seminary/exams/new","_blank"):window.open("/seminary/assignments/new","_blank")};return(v,x)=>(o(),I(a(at),{modelValue:e.value,"onUpdate:modelValue":x[4]||(x[4]=h=>e.value=h),options:{size:"xl"}},{body:R(()=>[x[5]||(x[5]=s("button",{style:{opacity:"0",position:"absolute"}},"Fallback Focus",-1)),s("div",la,[d.type=="quiz"?(o(),u("div",ia,n(v.__("Add a quiz to your lesson")),1)):d.type=="exam"?(o(),u("div",ua,n(v.__("Add an exam to your lesson")),1)):(o(),u("div",da,n(v.__("Add an assignment to your lesson")),1)),s("div",null,[d.type=="quiz"?(o(),I(qe,{key:0,modelValue:t.value,"onUpdate:modelValue":x[0]||(x[0]=h=>t.value=h),doctype:"Quiz",label:v.__("Select a quiz"),onCreate:(h,T)=>p()},null,8,["modelValue","label","onCreate"])):d.type=="exam"?(o(),I(qe,{key:1,modelValue:r.value,"onUpdate:modelValue":x[1]||(x[1]=h=>r.value=h),doctype:"Exam Activity",label:v.__("Select an exam"),onCreate:(h,T)=>p()},null,8,["modelValue","label","onCreate"])):(o(),I(qe,{key:2,modelValue:l.value,"onUpdate:modelValue":x[2]||(x[2]=h=>l.value=h),doctype:"Assignment Activity",label:v.__("Select an assignment"),onCreate:(h,T)=>p()},null,8,["modelValue","label","onCreate"]))]),s("div",ca,[q(a(G),{variant:"solid",onClick:x[3]||(x[3]=h=>_())},{default:R(()=>[me(n(v.__("Save")),1)]),_:1})])])]),_:1},8,["modelValue"]))}};class ma{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=re({render:()=>Te(At,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Quiz"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderQuiz(this.data.quiz):this.renderQuizModal(),this.wrapper}renderQuiz(e){if(this.readOnly){const t=re(ra,{quiz:e});t.use(ke),t.use(Se);const{userResource:l}=Ge();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Quiz: ${e}
            </span>
        </div>`}renderQuizModal(){if(this.readOnly)return;const e=re(We,{type:"quiz",onAddition:t=>{this.data.quiz=t,this.renderQuiz(t)}});e.use(ke),e.use(Se),e.mount(this.wrapper)}save(e){return{quiz:this.data.quiz}}}const pa={class:"border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},fa={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},ha={key:0},ga={key:1},va={class:"text-sm text-ink-gray-7 font-medium mb-2"},ya=["innerHTML"],_a={class:"flex flex-col"},ba={class:"p-5"},xa={class:"flex items-center justify-between mb-4"},ka={class:"font-semibold text-ink-gray-9"},wa={class:"flex items-center space-x-2"},$a={key:0,class:"bg-blue-200 p-3 rounded-md leading-5 text-sm mb-4"},Sa={key:1},Ca={class:"text-xs text-ink-gray-5 mt-1 mb-2"},Ta={key:1},Aa={class:"flex text-ink-gray-7"},Ea={class:"border self-start rounded-md p-2 mr-2"},Fa=["href"],Ma={class:"text-sm leading-5"},La={class:"text-sm text-ink-gray-5 mt-1"},za={key:2},qa={class:"text-xs text-ink-gray-5 mb-1"},Na={key:3},Pa={class:"text-sm mb-4"},Ia={key:4,class:"mt-8 p-3 bg-blue-200 rounded-md"},Da={class:"text-sm text-ink-gray-5 font-medium mb-2"},Ra={class:"leading-5"},Ua=["innerHTML"],Oa={key:5,class:"mt-8 space-y-4"},Ba={class:"font-semibold mb-2 text-ink-gray-9"},Va={class:"text-sm text-ink-gray-5 mb-1"},ja={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(d){var ne;const e=C(null),t=C(null),l=C(null),r=Qe(),i=Ce("$user"),_=r.currentRoute.value.name=="AssignmentSubmission",p=C(!1),v=d;we(()=>{window.addEventListener("keydown",x),console.log("User: ",i.data)});const x=w=>{w.key==="s"&&(w.ctrlKey||w.metaKey)&&(Y(),w.preventDefault())};Et(()=>{window.removeEventListener("keydown",x)});const h=H({url:"frappe.client.get",params:{doctype:"Assignment Activity",name:v.assignmentID},auto:!0,onSuccess(w){v.submissionName!="new"&&b.reload()}}),T=H({url:"frappe.client.insert",makeParams(w){var k;let E={doctype:"Assignment Submission",assignment:v.assignmentID,member:(k=i.data)==null?void 0:k.name,course:r.currentRoute.value.params.courseName};return V()?E.assignment_attachment=e.value.file_url:E.answer=t.value,{doc:E}}}),z=H({url:"seminary.seminary.api.get_file_info",makeParams(w){return{file_url:w.image}},auto:!1,onSuccess(w){e.value=w}}),b=ot({doctype:"Assignment Submission",name:v.submissionName,onError(w){var E;be.error(((E=w.messages)==null?void 0:E[0])||w)},auto:!1,cache:[(ne=i.data)==null?void 0:ne.name,v.assignmentID]});te(b,()=>{b.doc&&(b.doc.assignment_attachment&&z.reload({image:b.doc.assignment_attachment}),b.doc.answer&&(t.value=b.doc.answer),b.doc.comments&&(l.value=b.doc.comments),b.isDirty||V()&&!e.value||!V()&&!t.value?p.value=!0:p.value=!1)}),te(e,()=>{v.submissionName=="new"&&e.value&&(p.value=!0)}),te(()=>{var w;return(w=b.doc)==null?void 0:w.grade},(w,E)=>{w!==E&&b.doc&&(b.doc.status="Graded",p.value=!0)});const Y=()=>{var w,E,k;if(v.submissionName!="new"){let P=b.doc&&b.doc.owner!=((w=i.data)==null?void 0:w.name)?(E=i.data)==null?void 0:E.name:null;b.setValue.submit(Ue(Ie({},b.doc),{assignment_attachment:(k=e.value)==null?void 0:k.file_url,evaluator:P,comments:l.value,answer:t.value}),{onSuccess(X){be.success(__("Changed successfully")),p.value=!1}})}else g()},g=()=>{T.submit({},{onSuccess(w){be.success(__("Assignment submitted successfully")),r.currentRoute.value.name=="AssignmentSubmission"?r.push({name:"AssignmentSubmission",params:{assignmentID:v.assignmentID,submissionName:w.name}}):(F(),r.go()),b.name=w.name,p.value=!1,b.reload()},onError(w){var E;be.error(((E=w.messages)==null?void 0:E[0])||w)}})},U=w=>{p.value=!0,e.value=w},F=()=>{if(r.currentRoute.value.name=="Lesson"){let w=r.currentRoute.value.params.courseName,E=r.currentRoute.value.params.chapterNumber,k=r.currentRoute.value.params.lessonNumber;console.log("Chapter Number: ",E),console.log("Lesson Number: ",k),ze("seminary.seminary.api.mark_lesson_progress",{course:w,chapter_number:E,lesson_number:k})}},S=()=>{var E;const w=(E=h.data)==null?void 0:E.type;if(w=="Image")return["image/*"];if(w=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(w=="PDF")return[".pdf"]},y=w=>{var P;let E=(P=h.data)==null?void 0:P.type,k=w.name.split(".").pop().toLowerCase();if(E=="Image"&&!["jpg","jpeg","png"].includes(k))return"Only image file is allowed.";if(E=="Document"&&!["doc","docx","xml"].includes(k))return"Only document file is allowed.";if(E=="PDF"&&!["pdf"].includes(k))return"Only PDF file is allowed."},L=()=>{p.value=!0,e.value=null},D=ce(()=>{var w,E,k;return(((w=i.data)==null?void 0:w.is_moderator)||((E=i.data)==null?void 0:E.is_evaluator)||((k=i.data)==null?void 0:k.is_instructor))&&v.submissionName!="new"&&r.currentRoute.value.name=="AssignmentSubmission"}),ee=ce(()=>{var w,E,k;return!b.doc||((w=b.doc)==null?void 0:w.owner)==((E=i.data)==null?void 0:E.name)&&((k=b.doc)==null?void 0:k.status)=="Not Graded"}),K=ce(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),Q=ce(()=>b.doc?b.doc.status=="Pass"||b.doc.status=="Graded"?"green":b.doc.status=="Not Graded"?"blue":"red":"orange"),V=()=>{var w;return["PDF","Image","Document"].includes((w=h.data)==null?void 0:w.type)};return(w,E)=>{var k,P,X,fe,ye,he,m,$,A,Z;return a(h).data?(o(),u("div",{key:0,class:Fe(["grid grid-cols-[65%,35%] h-full",{"border rounded-lg":!_}])},[s("div",pa,[_?(o(),u("div",fa,[d.submissionName==="new"?(o(),u("div",ha,n(w.__("Submission by"))+" "+n((k=a(i).data)==null?void 0:k.full_name),1)):(o(),u("div",ga,n(w.__("Submission by"))+" "+n((P=a(b).doc)==null?void 0:P.member_name),1))])):M("",!0),s("div",va,n(w.__("Question"))+": ",1),s("div",{innerHTML:a(h).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,ya)]),s("div",_a,[s("div",ba,[s("div",xa,[s("div",ka,n(w.__("Submission")),1),s("div",wa,[p.value?(o(),I(a(Ae),{key:0,theme:"orange"},{default:R(()=>[me(n(w.__("Not Saved")),1)]),_:1})):(X=a(b).doc)!=null&&X.status?(o(),I(a(Ae),{key:1,theme:Q.value,size:"lg"},{default:R(()=>{var N;return[me(n((N=a(b).doc)==null?void 0:N.status),1)]}),_:1},8,["theme"])):M("",!0),q(a(G),{variant:"solid",onClick:E[0]||(E[0]=N=>Y())},{default:R(()=>[me(n(w.__("Save")),1)]),_:1})])]),d.submissionName!="new"&&!["Pass","Fail","Graded"].includes((fe=a(b).doc)==null?void 0:fe.status)&&((ye=a(b).doc)==null?void 0:ye.owner)==((he=a(i).data)==null?void 0:he.name)?(o(),u("div",$a,n(w.__("You've successfully submitted the assignment."))+" "+n(w.__("Once the moderator grades your submission, you'll find the details here."))+" "+n(w.__("Feel free to make edits to your submission if needed, until it is graded.")),1)):M("",!0),V()?(o(),u("div",Sa,[s("div",Ca,n(w.__("Add your assignment as {0}").format(a(h).data.type)),1),e.value?(o(),u("div",Ta,[s("div",Aa,[s("div",Ea,[q(a(Ft),{class:"h-5 w-5 stroke-1.5"})]),s("a",{href:e.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[s("span",Ma,n(e.value.file_name),1),s("span",La,n(a(Fr)(e.value.file_size)),1)],8,Fa),ee.value?(o(),I(a(Mt),{key:0,onClick:E[2]||(E[2]=N=>L()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):M("",!0)])])):(o(),I(a(nt),{key:0,fileTypes:S(),validateFile:y,onSuccess:E[1]||(E[1]=N=>U(N))},{default:R(({uploading:N,progress:le,openFileSelector:de})=>[q(a(G),{onClick:de,loading:N},{default:R(()=>[me(n(N?w.__("Uploading {0}%").format(le):w.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(h).data.type=="URL"?(o(),u("div",za,[s("div",qa,n(w.__("Enter a URL")),1),q(a(Ee),{modelValue:t.value,"onUpdate:modelValue":E[3]||(E[3]=N=>t.value=N),type:"text",readonly:!ee.value},null,8,["modelValue","readonly"])])):(o(),u("div",Na,[s("div",Pa,n(w.__("Write your answer here")),1),q(a(Ne),{content:t.value,onChange:E[4]||(E[4]=N=>t.value=N),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((m=a(i).data)==null?void 0:m.name)==(($=a(b).doc)==null?void 0:$.owner)&&((A=a(b).doc)!=null&&A.comments)?(o(),u("div",Ia,[s("div",Da,n(w.__("Comments by"))+": "+n(((Z=a(b).doc)==null?void 0:Z.evaluator)||w.__("Evaluator")),1),s("div",Ra,[s("div",{innerHTML:a(b).doc.comments},null,8,Ua)])])):M("",!0),D.value?(o(),u("div",Oa,[s("div",Ba,n(w.__("Grading")),1),a(b).doc?(o(),I(a(Ee),{key:0,modelValue:a(b).doc.status,"onUpdate:modelValue":E[5]||(E[5]=N=>a(b).doc.status=N),label:w.__("Grading Status"),type:"select",options:K.value},null,8,["modelValue","label","options"])):M("",!0),a(b).doc?(o(),I(a(Ee),{key:1,modelValue:a(b).doc.grade,"onUpdate:modelValue":E[6]||(E[6]=N=>a(b).doc.grade=N),label:w.__("Score"),type:"number"},null,8,["modelValue","label"])):M("",!0),s("div",null,[s("div",Va,n(w.__("Comments")),1),q(a(Ne),{content:l.value,onChange:E[7]||(E[7]=N=>{l.value=N,p.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):M("",!0)])])],2)):M("",!0)}}},Ha={key:1,class:"border rounded-md text-center py-20"},Qa={__name:"AssignmentBlock",props:{assignmentID:{type:String,required:!0}},setup(d){const e=Ce("$user"),t=d,l=H({url:"frappe.client.get_value",makeParams(r){var i;return{doctype:"Assignment Submission",fieldname:"name",filters:{assignment:t.assignmentID,member:(i=e.data)==null?void 0:i.name}}},auto:!0});return(r,i)=>{var _;return a(e).data&&a(l).data?(o(),I(ja,{key:0,assignmentID:d.assignmentID,submissionName:((_=a(l).data)==null?void 0:_.name)||"new"},null,8,["assignmentID","submissionName"])):(o(),u("div",Ha,[s("div",null,n(r.__("Please login to access the assignment.")),1),q(a(G),{onClick:i[0]||(i[0]=p=>r.redirectToLogin()),class:"mt-2"},{default:R(()=>[s("span",null,n(r.__("Login")),1)]),_:1})]))}}};class Ja{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=re({render:()=>Te(Lt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Assignment"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderAssignment(this.data.assignment):this.renderAssignmentModal(),this.wrapper}renderAssignment(e){if(this.readOnly){const t=re(Qa,{assignmentID:e});t.use(ke),t.use(Se);const{userResource:l}=Ge();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Assignment: ${e}
            </span>
        </div>`}renderAssignmentModal(){if(this.readOnly)return;const e=re(We,{type:"assignment",onAddition:t=>{this.data.assignment=t,this.renderAssignment(t)}});e.use(ke),e.use(Se),e.mount(this.wrapper)}save(e){return{assignment:this.data.assignment}}}const Ga={key:0,class:"text-center py-5"},Wa={key:1,class:"space-y-5"},Ya={class:"grid grid-cols-3 gap-3"},Xa={class:"col-span-3 space-y-4"},Za={class:"space-y-4 border p-2 rounded-md"},Ka={class:"flex items-center justify-between py-4"},eo={class:"text-center ml-5"},to={class:"text-3xl font-bold text-ink-gray-9"},so={class:"text-center"},ao={class:"text-3xl font-semibold text-ink-gray-9"},oo={class:"text-sm text-ink-gray-5"},no={class:"text-center mr-5"},ro={class:"text-3xl font-semibold text-ink-gray-9 mt-2"},lo={class:"space-y-1"},io={class:"font-semibold text-ink-gray-9 text-left"},uo=["innerHTML"],co={class:"leading-5 text-ink-gray-7 space-x-1 text-left"},mo=["innerHTML"],po={class:"flex justify-end items-center space-x-2"},fo={class:"text-sm text-ink-gray-7 text-xl"},ho={key:0,class:"leading-5 text-ink-gray-7 text-xl space-x-1 text-left"},go=["innerHTML"],vo={key:2},yo={__name:"ExamGraded",props:{submission:{type:Object,required:!0}},setup(d){const e=d;console.log("ExamGraded received submission:",e.submission);const t=ot({doctype:"Exam Submission",name:e.submission,auto:!0});console.log("ExamGraded submisisonDetails:",t),te(()=>t.doc,r=>{t.loading=!1,console.log("ExamGraded updated with new submission details:",r)});const l=r=>{if(!r)return"00:00:00";const i=Math.floor(r/3600).toString().padStart(2,"0"),_=Math.floor(r%3600/60).toString().padStart(2,"0"),p=(r%60).toString().padStart(2,"0");return`${i}:${_}:${p}`};return(r,i)=>a(t).loading?(o(),u("div",Ga,[...i[0]||(i[0]=[s("p",null,"Loading submission details...",-1)])])):a(t).doc?(o(),u("div",Wa,[s("div",Ya,[s("div",Xa,[s("div",Za,[s("div",Ka,[s("div",eo,[s("div",to,n(a(t).doc.percentage||0)+"% ",1),i[1]||(i[1]=s("div",{class:"text-sm text-ink-gray-5"},"Score",-1))]),s("div",so,[s("div",ao,n(a(t).doc.score),1),s("div",oo," Out of "+n(a(t).doc.score_out_of)+" Points ",1)]),s("div",no,[s("div",ro,n(l(a(t).doc.time_taken)),1),i[2]||(i[2]=s("div",{class:"text-sm text-ink-gray-5"},"Time taken",-1))])])]),(o(!0),u(ae,null,ue(a(t).doc.result,(_,p)=>(o(),u("div",{key:p,class:"border p-5 rounded-md space-y-4"},[s("div",lo,[s("div",io,n(r.__("Question"))+" "+n(p+1)+": ",1),s("div",{class:"leading-5 text-ink-gray-9 text-left",innerHTML:_.question_name},null,8,uo)]),s("div",co,[s("span",null,n(r.__("Your Answer"))+": ",1),s("span",{innerHTML:_.answer},null,8,mo)]),s("div",po,[s("span",fo,n(_.points)+" / "+n(parseInt(_.points_out_of,10))+" "+n(r.__("Points")),1)]),_.comments?(o(),u("div",ho,[s("span",null,n(r.__("Comments"))+": ",1),s("span",{innerHTML:_.comments},null,8,go)])):M("",!0)]))),128))])])])):(o(),u("div",vo,[...i[3]||(i[3]=[s("p",null,"Debug: No submission details found.",-1)])]))}},gt={__name:"UserAvatar",props:{user:{type:Object,default:null},size:{type:String}},setup(d){return(e,t)=>(o(),I(a(He),{text:d.user.full_name},{default:R(()=>[d.user?(o(),I(a(St),zt({key:0,class:"avatar border border-outline-gray-2 cursor-auto",label:d.user.full_name,image:d.user.user_image,size:d.size},e.$attrs),null,16,["label","image","size"])):M("",!0)]),_:1},8,["text"]))}},_o={class:"mt-6"},bo={key:0,class:"flex items-center mb-5"},xo={class:"text-lg font-semibold ml-2 text-ink-gray-9"},ko={class:"flex items-center justify-between mb-2"},wo={class:"flex items-center text-ink-gray-5"},$o={class:"text-sm ml-2"},So={key:1},Co={key:0},To={key:1,class:"formatted-reply"},Ao=["innerHTML"],Eo=["value"],Fo={class:"flex justify-between mt-2"},et={__name:"DiscussionReplies",props:ut({topic:{type:Object,required:!0},singleThread:{type:Boolean,default:!1}},{showTopics:{},showTopicsModifiers:{}}),emits:["update:showTopics"],setup(d){const e=ft(),t=C(!1),l=Ve(d,"showTopics"),r=C(""),i=Ce("$user");console.log("User data:",i.data.is_student);const _=C([]),p=C(!1),v=d,x=`editor-${v.topic.name}`;we(()=>{console.log("DiscussionReplies mounted. Registering socket listeners."),console.log("Topic received:",v.topic.name),z(),h.reload({},{onSuccess(y){console.log("Replies fetched successfully:",y)},onError(y){console.error("Error fetching replies:",y)}}),e.on("publish_message",y=>{h.reload()}),e.on("update_message",y=>{h.reload()}),e.on("delete_message",y=>{h.reload()}),p.value=!0,console.log("TextEditor renderEditor set to true."),console.log("Editor key:",x)}),te(v.topic,(y,L)=>{y.name!==L.name&&(x.value=`editor-${y.name}`,console.log("Editor key updated:",x.value))}),te(r,y=>{console.log("New reply value:",y),y||console.warn("Reply is empty. Ensure the input is being updated correctly.")}),te(p,y=>{y&&console.log("TextEditor is now visible and ready for initialization.")});const h=H({url:"seminary.seminary.utils.get_discussion_replies",auto:!1,makeParams(){return{topic:v.topic.name}},onSuccess(y){console.log("Replies fetched successfully:",y)},onError(y){console.error("Error fetching replies:",y)}}),T=H({url:"seminary.seminary.utils.insert_discussion_reply",makeParams(y){return{reply:r.value,topic:v.topic.name}},onSuccess(y){console.log("Discussion saved successfully:",y)},onError(y){console.error("Error inserting replies:",y)}}),z=()=>{var y;console.log("User data in fetchMentionUsers:",i.data),(y=i.data)!=null&&y.is_student?p.value=!0:(t.value=!0,S.reload({},{onSuccess(L){_.value=Object.values(L).map(D=>({value:D.name,label:D.full_name})),p.value=!0,t.value=!1},onError(L){console.error("Error fetching mention users:",L),t.value=!1}}))},b=()=>{T.submit({},{onSuccess(){r.value="",h.reload()},onError(y){var L;vt({title:"Error",text:((L=y.messages)==null?void 0:L[0])||y,icon:"x",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:10})}})},Y=H({url:"frappe.client.set_value",makeParams(y){return{doctype:"Discussion Reply",name:y.name,fieldname:"reply",value:y.reply}}}),g=y=>{Y.submit({name:y.name,reply:y.reply},{validate(){if(!y.reply)return"Reply cannot be empty"},onSuccess(){y.editable=!1,h.reload()}})},U=H({url:"frappe.client.delete",makeParams(y){return{doctype:"Discussion Reply",name:y.name}}}),F=y=>{U.submit({name:y.name},{onSuccess(){h.reload()}})},S=H({url:"seminary.seminary.utils.get_all_users"});return console.log("All Users:",S),(y,L)=>(o(),u("div",_o,[d.singleThread?M("",!0):(o(),u("div",bo,[q(a(G),{variant:"outline",onClick:L[0]||(L[0]=D=>l.value=!0)},{icon:R(()=>[q(a(qt),{class:"w-5 h-5 stroke-1.5 text-ink-gray-7"})]),_:1}),s("span",xo,n(d.topic.title),1)])),(o(!0),u(ae,null,ue(a(h).data,(D,ee)=>{var K;return o(),u("div",{key:D.name},[s("div",{class:Fe(["py-3",{"border-b":ee+1!=a(h).data.length}])},[s("div",ko,[s("div",wo,[q(gt,{user:D.user,class:"mr-2"},null,8,["user"]),s("span",null,n(((K=D.user)==null?void 0:K.full_name)||D.owner),1),s("span",$o,n(a(De)(D.creation)),1)]),a(i).data.name==D.owner&&!D.editable?(o(),I(a(Ct),{key:0,options:[{label:"Edit",onClick(){D.editable=!0}},{label:"Delete",onClick(){F(D)}}]},{default:R(({open:Q})=>[q(a(Nt),{class:"w-4 h-4 stroke-1.5 cursor-pointer"})]),_:1},8,["options"])):M("",!0),D.editable?(o(),u("div",So,[q(a(G),{variant:"ghost",onClick:Q=>g(D)},{default:R(()=>[me(n(y.__("Post")),1)]),_:1},8,["onClick"]),q(a(G),{variant:"ghost",onClick:Q=>D.editable=!1},{default:R(()=>[me(n(y.__("Discard")),1)]),_:1},8,["onClick"])])):M("",!0)]),D.editable?(o(),u("div",Co,[q(a(Ne),{content:D.reply,onChange:Q=>D.reply=Q,editable:!0,fixedMenu:!0,editorClass:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none"},null,8,["content","onChange"])])):(o(),u("div",To,[s("div",{innerHTML:D.reply,class:"p-2"},null,8,Ao)]))],2)])}),128)),xe(s("textarea",{class:"mt-5",value:r.value,onInput:L[1]||(L[1]=D=>r.value=D),placeholder:"Type your reply here...",fixedMenu:!0},null,40,Eo),[[lt,p.value]]),s("div",Fo,[L[3]||(L[3]=s("span",null,null,-1)),q(a(G),{onClick:L[2]||(L[2]=D=>b())},{default:R(()=>[s("span",null,n(y.__("Post")),1)]),_:1})])]))}},Mo={class:"discussion-dialog flex flex-col gap-4 max-h-[70vh] overflow-y-auto"},Lo={class:"mb-1.5 text-sm text-ink-gray-5"},tt={__name:"DiscussionModal",props:ut({title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0}},{modelValue:{},modelModifiers:{},reloadTopics:{},reloadTopicsModifiers:{}}),emits:["update:modelValue","update:reloadTopics"],setup(d){const e=Ve(d,"modelValue"),t=Ve(d,"reloadTopics"),l=d,r=Le({title:"",reply:""}),i=()=>{r.title="",r.reply=""},_=H({url:"frappe.client.insert",makeParams(T){return{doc:{doctype:"Discussion Topic",reference_doctype:l.doctype,reference_docname:l.docname,title:r.title}}}}),p=H({url:"frappe.client.insert",makeParams(T){return{doc:{doctype:"Discussion Reply",topic:T.topic,reply:r.reply}}}}),v=T=>{_.submit({},{validate(){if(!r.title)return"Title cannot be empty.";if(!r.reply)return"Reply cannot be empty."},onSuccess(z){p.submit({topic:z.name},{onSuccess(){e.value=!1,t.value.reload(),i(),T()}})},onError(z){var b;be.error(((b=z.messages)==null?void 0:b[0])||z)}})},x=T=>{e.value=!1,i(),T==null||T()};te(e,T=>{T||i()});const h=ce(()=>({title:yt(l.title),size:"2xl",actions:[{label:__("Post"),variant:"solid",onClick:T=>v(T)},{label:__("Cancel"),variant:"text",onClick:T=>x(T)}]}));return(T,z)=>(o(),I(a(at),{modelValue:e.value,"onUpdate:modelValue":z[2]||(z[2]=b=>e.value=b),disableOutsideClickToClose:!0,options:h.value},{"body-content":R(()=>[s("div",Mo,[s("div",null,[q(a(Ee),{modelValue:r.title,"onUpdate:modelValue":z[0]||(z[0]=b=>r.title=b),label:T.__("Title"),type:"text"},null,8,["modelValue","label"])]),s("div",null,[s("div",Lo,n(T.__("Details")),1),q(a(Ne),{content:r.reply,onChange:z[1]||(z[1]=b=>r.reply=b),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])]),_:1},8,["modelValue","options"]))}};function zo(){return window.scrollContainer}const qo={class:"text-xl font-semibold text-ink-gray-9"},No={key:0},Po={key:1},Io={key:2},Do=["onClick"],Ro={class:"text-lg font-semibold mb-1 text-ink-gray-7"},Uo={class:"flex items-center text-ink-gray-5"},Oo={class:"text-sm ml-3"},Bo={key:1},Vo={key:3,class:"flex flex-col items-center justify-center border-2 border-dashed mt-5 py-8 rounded-md"},jo={class:""},Ho={key:0,class:"font-medium mb-2"},Qo={class:"text-ink-gray-5"},Jo={__name:"Discussions",props:{title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0},emptyStateTitle:{type:String,default:""},emptyStateText:{type:String,default:"Start a discussion"},singleThread:{type:Boolean,default:!1},scrollToBottom:{type:Boolean,default:!1},type:{type:String,default:"multi"}},setup(d){console.log("Discussions.vue script setup executed");const e=C(!0),t=C(null),l=Ce("$user"),r=C(!1),i=C(!0),_=C(!1),p=ft();p?(console.log("Socket connection initialized in Discussions.vue:",p),p.on("connect",()=>{console.log("Socket connected:",p.id),_.value=!0}),p.on("connect_error",g=>{console.error("Socket connection error:",g)}),p.on("disconnect",g=>{console.warn("Socket disconnected:",g),_.value=!1})):console.error("Socket connection not initialized in Discussions.vue.");const v=d;te(_,g=>{g&&(console.log("Socket is connected, proceeding with onMounted logic."),x())});const x=()=>{console.log("onMounted logic executed"),console.log("Props:",v),l.data&&(v.type==="single"?(console.log("Single-topic mode detected"),T.reload(),console.log("Topic",t.value)):i.value=!1,z.reload()),p.on("new_discussion_topic",g=>{z.refresh()}),v.scrollToBottom&&setTimeout(()=>{h()},100)},h=()=>{let g=zo();g.scrollTop=g.scrollHeight},T=H({url:"seminary.seminary.utils.ensure_single_topic",cache:!1,makeParams(){return{doctype:v.doctype,docname:v.docname,title:v.title}},onSuccess(g){console.log("Ensure single topic response:",g),g&&(t.value=g,console.log("Current topic set:",t.value),e.value=!1,i.value=!1),console.log("Changed loading to:",i.value)},onError(g){console.error("Error ensuring single topic:",g),i.value=!1}}),z=H({url:"seminary.seminary.utils.get_discussion_topics",cache:["topics",v.doctype,v.docname],makeParams(){return{doctype:v.doctype,docname:v.docname,single_thread:v.singleThread}}}),b=g=>{e.value=!1,t.value=g},Y=()=>{r.value=!0};return(g,U)=>{var F;return o(),u(ae,null,[s("div",null,[!d.singleThread&&v.type==="multi"?(o(),I(a(G),{key:0,class:"float-right",onClick:U[0]||(U[0]=S=>Y())},{default:R(()=>[me(n(g.__("New {0}").format(a(yt)(d.title))),1)]),_:1})):M("",!0),s("div",qo,n(g.__(d.title)),1)]),i.value&&v.type==="single"?(o(),u("div",No,[...U[6]||(U[6]=[s("div",{class:"text-center py-10"},[s("span",null,"Loading discussion...")],-1)])])):M("",!0),v.type==="single"&&!i.value?(o(),u("div",Po,[U[7]||(U[7]=s("div",{class:"flex flex-col items-center justify-center"},null,-1)),q(tt,{modelValue:r.value,"onUpdate:modelValue":U[1]||(U[1]=S=>r.value=S),title:d.title,doctype:v.doctype,docname:v.docname},null,8,["modelValue","title","doctype","docname"]),t.value.value?(o(),I(et,{key:0,topic:t.value.value,singleThread:!0,showTopics:e.value,"onUpdate:showTopics":U[2]||(U[2]=S=>e.value=S)},null,8,["topic","showTopics"])):M("",!0)])):M("",!0),(F=a(z).data)!=null&&F.length&&!d.singleThread?(o(),u("div",Io,[e.value?(o(!0),u(ae,{key:0},ue(a(z).data,(S,y)=>(o(),u("div",{key:y},[s("div",{onClick:L=>b(S),class:Fe(["flex items-center cursor-pointer py-5 w-full",{"border-b":y+1!=a(z).data.length}])},[q(gt,{user:S.user,size:"2xl",class:"mr-4"},null,8,["user"]),s("div",null,[s("div",Ro,n(S.title),1),s("div",Uo,[s("span",null,n(S.user.full_name),1),s("span",Oo,n(a(De)(S.creation)),1)])])],10,Do)]))),128)):(o(),u("div",Bo,[q(et,{topic:t.value,showTopics:e.value,"onUpdate:showTopics":U[3]||(U[3]=S=>e.value=S)},null,8,["topic","showTopics"])]))])):(o(),u("div",Vo,[q(a(Pt),{class:"w-7 h-7 text-ink-gray-4 stroke-1.5 mr-2"}),s("div",jo,[d.emptyStateTitle?(o(),u("div",Ho,n(g.__(d.emptyStateTitle)),1)):M("",!0),s("div",Qo,n(g.__(d.emptyStateText)),1)])])),q(tt,{modelValue:r.value,"onUpdate:modelValue":U[4]||(U[4]=S=>r.value=S),title:g.__("New {0}").format(d.title),doctype:v.doctype,docname:v.docname,reloadTopics:a(z),"onUpdate:reloadTopics":U[5]||(U[5]=S=>Je(z)?z.value=S:null)},null,8,["modelValue","title","doctype","docname","reloadTopics"])],64)}}},Go={key:0},Wo={key:0,class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},Yo={class:"leading-5"},Xo={key:0,class:"leading-5"},Zo={key:1,class:"leading-5"},Ko={key:1,class:"space-y-4 border p-5 rounded-md"},en={key:2,class:"flex flex-col space-x-1 my-4"},tn={class:"mb-2"},sn={class:"font-semibold"},an={key:3},on={class:"border text-center p-20 rounded-md"},nn={class:"font-semibold text-lg"},rn={key:2,class:"w-full max-w-4xl mx-auto py-5"},ln={key:3},un={key:4},dn={class:"border text-center p-20 rounded-md"},cn={class:"font-semibold text-lg text-ink-gray-9 mt-3 mb-3"},mn={class:"absolute -top-3 -left-3 bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm"},pn={class:"text-ink-gray-9 text-sm font-semibold text-right"},fn={class:"text-ink-gray-9 text-left font-semibold mt-2 leading-5"},hn=["innerHTML"],gn={class:"mt-4"},vn=["onUpdate:modelValue","onChange"],yn={class:"text-center mt-4"},_n={__name:"Exam",props:{examName:{type:String,required:!0}},setup(d){var w,E;const e=Ce("$user"),t=C(0);let l=null;const r=C(0);C("");const i=C({});C([]);const _=C(!1),p=Qe();let v=!1;const x=d;console.log("Exam Name (PROPS):",x.examName);const h=H({url:"frappe.client.get",makeParams(k){return{doctype:"Exam Activity",name:x.examName}},cache:["exam",x.examName],auto:!0,transform(k){return k?(k.duration=parseInt(k.duration)||0,k):(console.error("Exam data is null or undefined."),null)},onSuccess(k){k?k.questions=k.questions||[]:console.error("Failed to load exam data.")},onError(k){console.error("Error loading exam data:",k)}}),T=ce(()=>!!h.data),z=ce(()=>{var k;return((k=D.data)==null?void 0:k.length)>0}),b=H({url:"seminary.seminary.utils.get_instructors",makeParams(k){const P=p.currentRoute.value.params.courseName;return P?{course:P}:(console.error("Course name is undefined in route parameters."),{})},auto:!0}),Y=()=>(b.data&&b.data.forEach(k=>{var P;k.user===((P=e.data)==null?void 0:P.name)&&(v=!0)}),v);let g=null;const U=()=>{if(h.data.duration){t.value=h.data.duration*60,g=Date.now();const k=g+t.value*1e3;l=setInterval(()=>{const P=Date.now(),X=Math.max(0,Math.floor((k-P)/1e3));t.value=X,r.value=h.data.duration*60-X,X<=0&&(clearInterval(l),ee())},1e3)}else g=Date.now(),l=setInterval(()=>{const k=Date.now();r.value=Math.floor((k-g)/1e3)},1e3)},F=k=>{const P=Math.floor(k/60).toString().padStart(2,"0"),X=(k%60).toString().padStart(2,"0");return`${P}:${X}`},S=ce(()=>t.value/(h.data.duration*60)*100);te(i,k=>{},{deep:!0});const y=()=>{const k=Rt(i.value);return Object.entries(k).map(([P,X])=>({question:P,answer:X}))},L=(k,P)=>{i[k]=P},D=H({url:"frappe.client.get_list",makeParams(k){var P;return{doctype:"Exam Submission",filters:{member:(P=e.data)==null?void 0:P.name,exam:x.examName},fields:["name","creation"],order_by:"creation desc"}},auto:!0,transform(k){k.forEach((P,X)=>{P.creation=De(P.creation),P.idx=X+1})}});te(()=>D.data,k=>{console.log("Attempts data updated:",k)});const ee=()=>j(this,null,function*(){var k,P;try{const X=y(),fe=h.data.duration?h.data.duration*60-(t.value||0):r.value||0;yield ze("seminary.seminary.doctype.exam_submission.exam_submission.create_exam_submission",{exam:x.examName,course:p.currentRoute.value.params.courseName,member:(k=e.data)==null?void 0:k.name,answers:X,time_taken:fe}),be.success(__("Your exam was submitted successfully.")),clearInterval(l)}catch(X){console.error("Error during exam submission:",X),be.error(((P=err.messages)==null?void 0:P[0])||err)}}),K=()=>{activeQuestion.value=1,localStorage.removeItem(h.data.title),U()},Q=()=>{localStorage.removeItem(h.data.title),_.value=!0,U()},V=H({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:x.examName,member:(w=e.data)==null?void 0:w.name,status:"Graded"}},auto:!1,transform(k){return console.log("Fetched submission data:",k),k},onError(k){console.error("Error fetching submission:",k)}}),ne=H({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:x.examName,member:(E=e.data)==null?void 0:E.name}},auto:!1,transform(k){return console.log("Fetched submission AnyStatus:",k.name),k},onError(k){console.error("Error fetching submission:",k)}});return we(()=>{V.reload(),ne.reload()}),(k,P)=>{var fe,ye,he,m,$,A,Z,N,le,de,oe,$e,_e,f;const X=It("router-link");return T.value?(o(),u("div",Go,[z.value?M("",!0):(o(),u("div",Wo,[s("div",Yo,n(`This exam consists of ${a(h).data.questions.length}`)+" "+n(a(h).data.questions.length===1?"question":"questions")+". ",1),(fe=a(h).data)!=null&&fe.duration?(o(),u("div",Xo,n(`Please ensure that you complete all the questions in ${a(h).data.duration} minutes.`),1)):M("",!0),(ye=a(h).data)!=null&&ye.duration?(o(),u("div",Zo,n("If you fail to do so, the exam will be automatically submitted when the timer ends."))):M("",!0)])),z.value&&((he=a(ne))!=null&&he.data||(m=a(D).data)!=null&&m[0])?(o(),u("div",Ko,[(o(),I(Jo,{title:"Exam Comments",doctype:"Exam Submission",docname:((A=($=a(ne))==null?void 0:$.data)==null?void 0:A.name)||((N=(Z=a(D).data)==null?void 0:Z[0])==null?void 0:N.name),key:((de=(le=a(ne))==null?void 0:le.data)==null?void 0:de.name)||(($e=(oe=a(D).data)==null?void 0:oe[0])==null?void 0:$e.name),type:"single"},null,8,["docname"]))])):M("",!0),a(h).data.duration&&!z.value?(o(),u("div",en,[s("div",tn,[P[0]||(P[0]=s("span",{class:""},n("Time")+": ",-1)),s("span",sn,n(F(t.value)),1)]),q(ht,{progress:S.value},null,8,["progress"])])):M("",!0),!_.value&&!Y()?(o(),u("div",an,[s("div",on,[s("div",nn,n(a(h).data.title),1),a(h).data.qbyquestion&&!z.value?(o(),I(a(G),{key:0,onClick:K,class:"mt-2"},{default:R(()=>[...P[1]||(P[1]=[s("span",null,n("Start"),-1)])]),_:1})):z.value?z.value&&((f=(_e=a(V))==null?void 0:_e.data)!=null&&f.name)?(o(),u("div",rn,[q(yo,{submission:a(V).data.name},null,8,["submission"])])):(o(),u("div",ln,n("You have already submitted this exam. As soon as it is graded, you will see the feedback here."))):(o(),I(a(G),{key:1,onClick:Q,class:"mt-2"},{default:R(()=>[...P[2]||(P[2]=[s("span",null,n("Start Exam"),-1)])]),_:1}))])])):M("",!0),_.value||Y()?(o(),u("div",un,[s("div",dn,[s("div",cn,n(a(h).data.title),1),Y()?(o(),I(X,{key:0,to:{name:"ExamForm",params:{examID:a(h).data.name}},class:"flex items-center text-gray-400 mb-3 mr-4 hover:text-gray-600"},{default:R(()=>[q(a(Dt),{class:"w-5 h-5 mr-2"}),P[3]||(P[3]=s("span",{class:"tooltip","data-tooltip":"Edit this exam"},"Edit",-1))]),_:1},8,["to"])):M("",!0),(o(!0),u(ae,null,ue(a(h).data.questions,(c,J)=>(o(),u("div",{key:c.name,class:"relative border rounded-md p-5 mb-4"},[s("div",mn,n(J+1),1),s("div",pn,n(c.points)+" "+n(c.points===1?"Point":"Points"),1),s("div",fn,[s("div",{innerHTML:c.question_detail||"No question detail provided."},null,8,hn)]),s("div",gn,[xe(s("textarea",{"onUpdate:modelValue":B=>i.value[c.name]=B,class:"border rounded-md p-2 w-full",placeholder:"Type your answer here",onChange:B=>L(c.name,B)},null,40,vn),[[Pe,i.value[c.name]]])])]))),128)),s("div",yn,[q(a(G),{onClick:ee},{default:R(()=>[...P[4]||(P[4]=[s("span",null,n("Submit Your Exam"),-1)])]),_:1})])])])):M("",!0)])):M("",!0)}}},bn={key:1,class:"border rounded-md text-center py-20"},xn={__name:"ExamBlock",props:{exam:{type:String,required:!0}},setup(d){const e=Ce("$user"),t=()=>{window.location.href="/login"};return(l,r)=>a(e).data?(o(),I(_n,{key:0,examName:d.exam},null,8,["examName"])):(o(),u("div",bn,[s("div",null,n(l.__("Please login to access the exam.")),1),q(a(G),{onClick:r[0]||(r[0]=i=>t()),class:"mt-2"},{default:R(()=>[s("span",null,n(l.__("Login")),1)]),_:1})]))}};class kn{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=re({render:()=>Te(Ut,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Exam"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderExam(this.data.exam):this.renderExamModal(),this.wrapper}renderExam(e){if(this.readOnly){const t=re(xn,{exam:e});t.use(ke),t.use(Se);const{userResource:l}=Ge();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Exam: ${e}
            </span>
        </div>`}renderExamModal(){if(this.readOnly)return;const e=re(We,{type:"exam",onAddition:t=>{this.data.exam=t,this.renderExam(t)}});e.use(ke),e.use(Se),e.mount(this.wrapper)}save(e){return{exam:this.data.exam}}}const wn=["src"],$n={class:"flex items-center space-x-2 shadow rounded-lg p-1 w-1/2"},Sn=["max"],Cn={class:"text-xs text-ink-gray-9 font-medium"},Tn={__name:"AudioBlock",props:{file:{type:String,required:!0}},setup(d){const e=C(!1),t=C(null);let l=C(!1),r=C(0),i=C(0);we(()=>{setTimeout(()=>{t.value=document.querySelector("audio"),t.value.onloadedmetadata=()=>{i.value=t.value.duration},t.value.ontimeupdate=()=>{r.value=t.value.currentTime}},0)});const _=()=>{t.value.paused?(t.value.play(),e.value=!0):(t.value.pause(),e.value=!1)},p=()=>{t.value.muted=!t.value.muted,l.value=t.value.muted},v=()=>{t.value.currentTime=r.value},x=()=>{e.value=!1},h=T=>{const z=Math.floor(T/60),b=Math.floor(T%60);return`${z}:${b<10?"0":""}${b}`};return te(e,T=>{T?t.value.play():t.value.pause()}),(T,z)=>(o(),u("div",null,[s("audio",{onEnded:x,controlsList:"nodownload",class:"mb-4"},[s("source",{src:encodeURI(d.file),type:"audio/mp3"},null,8,wn)],32),s("div",$n,[q(a(G),{variant:"ghost",onClick:_},{icon:R(()=>[e.value?(o(),I(a(ct),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),I(a(dt),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),xe(s("input",{type:"range",min:"0",max:a(i),step:"0.1","onUpdate:modelValue":z[0]||(z[0]=b=>Je(r)?r.value=b:r=b),onInput:v,class:"duration-slider w-full h-1"},null,40,Sn),[[Pe,a(r)]]),s("span",Cn,n(h(a(r)))+" / "+n(h(a(i))),1),q(a(G),{variant:"ghost",onClick:p},{icon:R(()=>[a(l)?(o(),I(a(pt),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),I(a(mt),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1})])]))}},An=["src","type"],En={class:"flex items-center space-x-2 bg-surface-gray-3 rounded-md p-0.5 absolute bottom-3 w-[98%] left-0 right-0 mx-auto invisible group-hover:visible"},Fn=["max"],Mn={class:"text-xs font-medium"},Ln={__name:"VideoBlock",props:{file:{type:String,required:!0},type:{type:String,default:"video/mp4"}},setup(d){const e=C(null),t=C(null);let l=C(!1),r=C(0),i=C(0),_=C(!1);const p=d;we(()=>{setTimeout(()=>{e.value.onloadedmetadata=()=>{i.value=e.value.duration},e.value.ontimeupdate=()=>{r.value=e.value.currentTime}},0)});const v=ce(()=>{if(x){let S=p.file;return S.includes("watch?v=")&&(S=S.replace("watch?v=","embed/")),`${S}?autoplay=0&controls=0&disablekb=1&playsinline=1&cc_load_policy=1&cc_lang_pref=auto`}return p.file}),x=ce(()=>p.type=="video/youtube"),h=()=>{e.value.play(),l.value=!0},T=()=>{e.value.pause(),l.value=!1},z=()=>{l.value?T():h()},b=()=>{l.value=!1},Y=()=>{e.value.muted=!e.value.muted,_.value=e.value.muted},g=()=>{e.value.currentTime=r.value},U=S=>{const y=Math.floor(S/60),L=Math.floor(S%60);return`${y}:${L<10?"0":""}${L}`},F=()=>{document.fullscreenElement?document.exitFullscreen():t.value.requestFullscreen()};return(S,y)=>(o(),u("div",{ref_key:"videoContainer",ref:t,class:"video-block group relative"},[s("video",{onTimeupdate:y[0]||(y[0]=(...L)=>S.updateTime&&S.updateTime(...L)),onEnded:b,onClick:z,oncontextmenu:"return false",class:"rounded-lg border border-gray-100 group cursor-pointer",ref_key:"videoRef",ref:e},[s("source",{src:v.value,type:d.type},null,8,An)],544),s("div",En,[q(a(G),{variant:"ghost"},{icon:R(()=>[a(l)?(o(),I(a(ct),{key:1,onClick:T,class:"w-4 h-4 text-ink-gray-9"})):(o(),I(a(dt),{key:0,onClick:h,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),q(a(G),{variant:"ghost",onClick:Y},{icon:R(()=>[a(_)?(o(),I(a(pt),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),I(a(mt),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),xe(s("input",{type:"range",min:"0",max:a(i),step:"0.1","onUpdate:modelValue":y[1]||(y[1]=L=>Je(r)?r.value=L:r=L),onInput:g,class:"duration-slider w-full h-1"},null,40,Fn),[[Pe,a(r)]]),s("span",Mn,n(U(a(r)))+" / "+n(U(a(i))),1),q(a(G),{variant:"ghost",onClick:F},{icon:R(()=>[q(a(Ot),{class:"w-4 h-4 text-ink-gray-9"})]),_:1})])],512))}},zn=rt(Ln,[["__scopeId","data-v-edd7c5f4"]]),qn={__name:"UploadPlugin",props:{onFileUploaded:{type:Function,required:!0}},emits:["fileUploaded"],setup(d,{emit:e}){const t=C(null),l=d;we(()=>j(this,null,function*(){yield it();const _=t.value.$el.querySelector('input[type="file"]');_&&_.click()}));const r=_=>{l.onFileUploaded({file_url:_.file_url,file_type:_.file_type})},i=_=>{let p=_.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","mp4","mov","mp3","pdf"].includes(p))return"Only image and video files are allowed."};return(_,p)=>(o(),I(a(nt),{fileTypes:["image/*","video/*","audio/*",".pdf"],validateFile:i,onSuccess:p[0]||(p[0]=v=>r(v)),ref_key:"fileUploader",ref:t,class:"hide"},null,512))}};class Nn{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=re({render:()=>Te(Bt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Upload",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.file_url?this.renderFile(this.data):this.renderFileUploader(),this.wrapper}renderFile(e){if(this.isVideo(e.file_type)){re(zn,{file:e.file_url}).mount(this.wrapper);return}else if(this.isAudio(e.file_type)){re(Tn,{file:e.file_url}).mount(this.wrapper);return}else if(e.file_type=="PDF"){this.wrapper.innerHTML=`<iframe src="https://docs.google.com/viewer?url=${window.location.origin}${encodeURI(e.file_url)}&embedded=true" width='100%' height='700px' class="mb-4" type="application/pdf"></iframe>`;return}else{this.wrapper.innerHTML=`<img class="mb-4" src=${encodeURI(e.file_url)} width='100%'>`;return}}renderFileUploader(){const e=re(qn,{onFileUploaded:t=>{this.data.file_url=t.file_url,this.data.file_type=t.file_type,this.renderFile(t)}});e.use(ke),e.mount(this.wrapper)}validate(e){return!(!e.file_url||!e.file_type)}save(e){return{file_url:this.data.file_url,file_type:this.data.file_type}}isVideo(e){return["mov","mp4","avi","mkv","webm"].includes(e.toLowerCase())}isAudio(e){return["mp3","wav","ogg"].includes(e.toLowerCase())}}class Pn{constructor({data:e,api:t,readOnly:l,config:r}){this.api=t,this.data=e||{},this.config=r||{},this.text=e.text||"",this.readOnly=l,this.placeholder=__("Type '/' for commands or select text to format")}static get isReadOnlySupported(){return!0}static get conversionConfig(){return{export:"text",import:"text"}}static get toolbox(){const e=re({render:()=>Te(Vt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"",icon:t.innerHTML}}onPaste(e){const t={text:e.detail.data.innerHTML};this.data=t,window.requestAnimationFrame(()=>{this.wrapper&&(this.wrapper.innerHTML=this.data.text||"")})}static get pasteConfig(){return{tags:["P"]}}render(){return this.wrapper=document.createElement("div"),this.wrapper.classList.add("cdx-block","ce-paragraph"),this.wrapper.innerHTML=this.text,this.readOnly||(this.wrapper.contentEditable=!0,this.wrapper.innerHTML=this.text,this.wrapper.addEventListener("input",e=>{let t=e.target.textContent;e.keyCode===32&&t.startsWith("#")?this.convertToHeader(e,t):e.keyCode==189?this.convertBlock("list",{style:"unordered"}):/^[a-zA-Z]/.test(e.key)?this.convertBlock("paragraph",{text:t}):(e.keyCode===13||e.keyCode===190)&&this.parseContent(e)})),this.wrapper}_togglePlaceholder(){document.querySelectorAll(".cdx-block.ce-paragraph[data-placeholder]").forEach(t=>{t!==this.wrapper&&delete t.dataset.placeholder}),this.wrapper.innerHTML.trim()===""?this.wrapper.dataset.placeholder=this.placeholder:delete this.wrapper.dataset.placeholder}convertToHeader(e,t){if(e.preventDefault(),["#","##","###","####","#####","######"].includes(t)){let l=t.length;e.target.textContent="",this.convertBlock("header",{level:l})}}parseContent(e){e.preventDefault();let t=this.wrapper.textContent;if(e.keyCode===190&&(t=t+"."),t&&this.hasImage(t))this.wrapper.textContent="",this.convertBlock("image");else if(t&&this.hasLink(t)){const{text:l,url:r}=this.extractLink(t),i=`<a href="${r}" target="_blank">${l}</a>`;this.convertBlock("paragraph",{text:t.replace(/\[.+?\]\(.+?\)/,i)})}else t&&t.startsWith("- ")?this.convertBlock("list",{style:"unordered",items:[{content:t.replace("- ","")}]}):t&&t.startsWith("1.")?this.convertBlock("list",{style:"ordered",items:[{content:t.replace("1.","")}]}):t&&this.canBeEmbed(t)?(this.wrapper.textContent="",this.convertBlock("embed",{source:t})):this.convertBlock("paragraph",{text:t})}convertBlock(e,t,l=null){return j(this,null,function*(){const r=this.api.blocks.getCurrentBlockIndex(),i=this.api.blocks.getBlockByIndex(r);yield this.api.blocks.convert(i.id,e,t),this.api.caret.focus(!0)})}save(e){return{text:e.innerHTML}}hasImage(e){return/!\[.+?\]\(.+?\)/.test(e)}extractImage(e){const t=e.match(/!\[(.+?)\]\((.+?)\)/);return t?{alt:t[1],url:t[2]}:{alt:"",url:""}}hasLink(e){return/\[.+?\]\(.+?\)/.test(e)}extractLink(e){const t=e.match(/\[(.+?)\]\((.+?)\)/);return t?{text:t[1],url:t[2]}:{text:"",url:""}}canBeEmbed(e){return/^https?:\/\/.+/.test(e.trim())}}const In=["light","dark"],Dn={none:"Auto-detect",apache:"Apache",bash:"Bash",cs:"C#",cpp:"C++",css:"CSS",coffeescript:"CoffeeScript",diff:"Diff",go:"Go",html:"HTML, XML",http:"HTTP",json:"JSON",java:"Java",javascript:"JavaScript",kotlin:"Kotlin",less:"Less",lua:"Lua",makefile:"Makefile",markdown:"Markdown",nginx:"Nginx",objectivec:"Objective-C",php:"PHP",perl:"Perl",properties:"Properties",python:"Python",ruby:"Ruby",rust:"Rust",scss:"SCSS",sql:"SQL",shell:"Shell Session",swift:"Swift",toml:"TOML, also INI",typescript:"TypeScript",yaml:"YAML",plaintext:"Plaintext"};class Rn{constructor({data:e,api:t,config:l,readOnly:r}){ve(this,"api");ve(this,"config");ve(this,"readOnly");ve(this,"data");ve(this,"highlightScriptID");ve(this,"highlightCSSID");ve(this,"codeArea");ve(this,"selectInput");ve(this,"selectDropIcon");this.api=t,this.readOnly=r,this.config={themeName:l.themeName&&typeof l.themeName=="string"?l.themeName:"",themeURL:l.themeURL&&typeof l.themeURL=="string"?l.themeURL:"",useDefaultTheme:l.useDefaultTheme&&typeof l.useDefaultTheme=="string"&&In.includes(l.useDefaultTheme.toLowerCase())?l.useDefaultTheme:"dark"},this.data={code:e.code&&typeof e.code=="string"?e.code:"",language:e.language&&typeof e.language=="string"?e.language:"Auto-detect",theme:e.theme&&typeof e.theme=="string"?e.theme:this._getThemeURLFromConfig()},this.highlightScriptID="highlightJSScriptElement",this.highlightCSSID="highlightJSCSSElement",this.codeArea=document.createElement("div"),this.selectInput=document.createElement("input"),this.selectDropIcon=document.createElement("i"),this._injectHighlightJSCSSElement(),this.api.listeners.on(window,"click",this._closeAllLanguageSelects,!0)}static get isReadOnlySupported(){return!0}static get sanitize(){return{code:!0,language:!1,theme:!1}}static get toolbox(){const e=re({render:()=>Te(jt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"CodeBox",icon:t.innerHTML}}static get displayInToolbox(){return!0}static get enableLineBreaks(){return!0}render(){const e=document.createElement("pre"),t=this._createLanguageSelectElement();return e.setAttribute("class","codeBoxHolder"),this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),this.codeArea.setAttribute("contenteditable","true"),this.codeArea.innerHTML=this.data.code,this.api.listeners.on(this.codeArea,"blur",l=>this._highlightCodeArea(l),!1),this.api.listeners.on(this.codeArea,"paste",l=>this._handleCodeAreaPaste(l),!1),e.appendChild(this.codeArea),!this.readOnly&&e.appendChild(t),e}save(e){return Object.assign(this.data,{code:this.codeArea.innerHTML,theme:this._getThemeURLFromConfig()})}validate(e){return!!e.code.trim()}destroy(){this.api.listeners.off(window,"click",this._closeAllLanguageSelects,!0),this.api.listeners.off(this.codeArea,"blur",e=>this._highlightCodeArea(e),!1),this.api.listeners.off(this.codeArea,"paste",e=>this._handleCodeAreaPaste(e),!1),this.api.listeners.off(this.selectInput,"click",e=>this._handleSelectInputClick(e),!1)}_createLanguageSelectElement(){const e=document.createElement("div"),t=document.createElement("div"),l=Object.entries(Dn);return e.setAttribute("class","codeBoxSelectDiv"),this.selectDropIcon.setAttribute("class",`codeBoxSelectDropIcon ${this.config.useDefaultTheme}`),this.selectDropIcon.innerHTML="&#8595;",this.selectInput.setAttribute("class",`codeBoxSelectInput ${this.config.useDefaultTheme}`),this.selectInput.setAttribute("type","text"),this.selectInput.setAttribute("readonly","true"),this.selectInput.value=this.data.language,this.api.listeners.on(this.selectInput,"click",r=>this._handleSelectInputClick(r),!1),t.setAttribute("class","codeBoxSelectPreview"),l.forEach(r=>{const i=document.createElement("p");i.setAttribute("class",`codeBoxSelectItem ${this.config.useDefaultTheme}`),i.setAttribute("data-key",r[0]),i.textContent=r[1],this.api.listeners.on(i,"click",_=>this._handleSelectItemClick(_,r),!1),t.appendChild(i)}),e.appendChild(this.selectDropIcon),e.appendChild(this.selectInput),e.appendChild(t),e}_highlightCodeArea(e){Ze.highlightBlock(this.codeArea)}_handleCodeAreaPaste(e){e.stopPropagation()}_handleSelectInputClick(e){e.target.nextSibling.classList.toggle("codeBoxShow")}_handleSelectItemClick(e,t){e.target.parentNode.parentNode.querySelector(".codeBoxSelectInput").value=t[1],e.target.parentNode.classList.remove("codeBoxShow"),this.codeArea.removeAttribute("class"),this.data.language=t[0],this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),Ze.highlightElement(this.codeArea)}_closeAllLanguageSelects(){const e=document.querySelectorAll(".codeBoxSelectPreview");for(let t=0,l=e.length;t<l;t++)e[t].classList.remove("codeBoxShow")}_injectHighlightJSCSSElement(){const e=document.querySelector(`#${this.highlightCSSID}`);let t=this._getThemeURLFromConfig();if(e)e.setAttribute("href",t);else{const l=document.createElement("link"),r=document.querySelector("head");l.setAttribute("rel","stylesheet"),l.setAttribute("href",t),l.setAttribute("id",this.highlightCSSID),r&&r.appendChild(l)}}_getThemeURLFromConfig(){let e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-${this.config.useDefaultTheme}.min.css`;return this.config.themeName&&(e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/${this.config.themeName}.min.css`),this.config.themeURL&&(e=this.config.themeURL),e}}const Un={class:"Folder"},On={class:"ml-4"},Bn={key:0,class:"mt-4 mb-4"},Vn={key:1},jn={key:2,class:"block mt-6 space-y-6"},Hn={class:"text-sm font-medium text-ink-gray-9"},Qn={class:"mt-1 flex flex-wrap items-center gap-1 text-sm text-ink-gray-6"},Jn=["onClick"],Gn={key:0},Wn={class:"flex flex-wrap items-center gap-2"},Yn=["placeholder"],Xn={class:"mb-2 text-sm font-semibold text-ink-gray-9"},Zn={key:0,class:"text-sm text-ink-gray-5"},Kn={key:1,class:"space-y-2"},er=["onClick"],tr={class:"mb-2 text-sm font-semibold text-ink-gray-9"},sr={key:0,class:"text-sm text-ink-gray-5"},ar={key:1,class:"space-y-2"},or=["href"],nr={class:"font-medium"},rr={class:"mt-1 text-ink-gray-6"},lr={__name:"FolderPlugin",props:{onAddition:{type:Function,required:!1},initialFolder:{type:String,default:null}},setup(d){const e=Ht(),t=C("select"),l=C(null),r=C(""),i=C(""),_=C([]),p=C([]),v=C(null),x=C(null),h=C(""),T=C([]),z=C([]),b=C(!1),Y=C(""),g=C(null),U=()=>{var m,$;return typeof window=="undefined"?null:window.csrf_token||((m=window.frappe)==null?void 0:m.csrf_token)||(($=document.querySelector('meta[name="csrf-token"]'))==null?void 0:$.getAttribute("content"))||null},F=()=>j(this,null,function*(){const m=e.params.courseName;if(console.log("Course Name: ",m),m){const A=yield H({url:"frappe.client.get_value",makeParams(Z){return{doctype:"Course Schedule",fieldname:"course",filters:{name:m}}}}).fetch();v.value=A.course,console.log("Fetched Course: ",v.value)}else return console.error("Course name not found in route params"),null}),S=d,y=()=>{if(!r.value)return;const m=r.value;typeof S.onAddition=="function"&&S.onAddition(m)},L=(A,...Z)=>j(this,[A,...Z],function*(m,{refreshFolders:$=!0}={}){const N=m==null?void 0:m.trim();if(!N)return;($||!p.value.length)&&(yield D());const le=p.value.find(de=>de.foldername===N||de.name===N);if(le){l.value!==le.name&&(l.value=le.name);return}r.value=N,h.value=N,T.value=[{id:null,label:N,folderName:N}],yield K({folderLabel:N}),T.value=[{id:x.value,label:h.value||N,folderName:r.value||N}]}),D=()=>j(this,null,function*(){if(v.value||(yield F()),!v.value)return[];const $=yield H({url:"frappe.client.get_list",makeParams(){return{doctype:"Course Folder",filters:{course:v.value},fields:["name","foldername","file_reference","parent_folder"]}}}).fetch();return p.value=$,p.value}),ee=()=>j(this,null,function*(){if(!i.value){alert("Folder name is required");return}if(v.value||(yield F()),!v.value){alert("Please select a course before creating a folder.");return}try{const $=yield new je({data:{},readOnly:!1}).createCourseFolder(v.value,i.value);p.value.push({name:$.name,foldername:$.foldername,file_reference:$.file_reference,parent_folder:$.parent_folder}),r.value=$.foldername,x.value=$.file_reference,h.value=$.foldername,l.value=$.name,T.value=[{id:x.value,label:h.value,folderName:$.foldername}],t.value="select",i.value="",yield K({folderId:x.value,folderLabel:h.value})}catch(m){console.error("Error creating folder:",m),alert(m.message||"Failed to create folder.")}}),K=(...A)=>j(this,[...A],function*({folderId:m,folderLabel:$}={}){var le;const Z=m!=null?m:x.value,N=(le=$!=null?$:h.value)!=null?le:r.value;if(!Z&&!N){console.warn("No folder selected for fetching files.");return}try{const oe=yield H({url:"seminary.api.folder_upload.get_files_in_folder",params:{folder_id:Z,foldername:N},auto:!0}).fetch(),$e=(oe==null?void 0:oe.entries)||[];z.value=$e.filter(_e=>_e.is_folder),_.value=$e.filter(_e=>!_e.is_folder),x.value=(oe==null?void 0:oe.folder_id)||Z,h.value=(oe==null?void 0:oe.folder_name)||N,r.value=h.value}catch(de){console.error("Error fetching files:",de),z.value=[],_.value=[]}}),Q=(m,$=null)=>j(this,null,function*(){var Z;const A=$||((Z=m==null?void 0:m.target)==null?void 0:Z.files);if(!(!A||!A.length)){if(!x.value&&!h.value){alert("Please select a folder first.");return}try{const N=new FormData;for(const oe of A)N.append("files",oe);x.value&&N.append("folder_id",x.value),h.value&&N.append("foldername",h.value);const le=U();if(!le){alert("Session expired. Refresh the page and try again.");return}const de=yield fetch("/api/method/seminary.api.folder_upload.upload_folder",{method:"POST",body:N,headers:{"X-Frappe-CSRF-Token":le},credentials:"include"});if(!de.ok){const oe=yield de.json().catch(()=>({}));console.error("Error uploading files:",oe),alert(`Error: ${oe.message||"Failed to upload files."}`);return}console.log("Files uploaded successfully."),m!=null&&m.target&&(m.target.value=""),yield K()}catch(N){console.error("Error uploading files:",N),alert("An error occurred while uploading files.")}finally{b.value=!1}}}),V=m=>j(this,null,function*(){const $=U();if(!$){alert("Session expired. Refresh the page and try again.");return}yield fetch("/api/method/seminary.api.folder_upload.delete_file",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":$},body:JSON.stringify({file_url:m}),credentials:"include"}).then(A=>A.json()),yield K()}),ne=m=>{m.preventDefault(),m.stopPropagation(),!(!x.value&&!h.value)&&(b.value=!0)},w=m=>{!x.value&&!h.value||(m.preventDefault(),m.stopPropagation(),m.dataTransfer.dropEffect="copy",b.value=!0)},E=m=>{m.preventDefault(),m.stopPropagation(),b.value=!1},k=m=>j(this,null,function*(){var A;if(m.preventDefault(),m.stopPropagation(),!x.value&&!h.value){alert("Please select a folder before uploading.");return}const $=(A=m.dataTransfer)==null?void 0:A.files;$!=null&&$.length&&(yield Q(null,$)),b.value=!1}),P=()=>{var m;if(!x.value&&!h.value){alert("Please select a folder first.");return}(m=g.value)==null||m.click()},X=m=>j(this,null,function*(){m!=null&&m.name&&(T.value=[...T.value,{id:m.name,label:m.file_name,folderName:m.file_name}],x.value=m.name,h.value=m.file_name,yield K({folderId:m.name,folderLabel:m.file_name}))}),fe=m=>j(this,null,function*(){if(m<0||m>=T.value.length)return;const $=T.value[m];T.value=T.value.slice(0,m+1),x.value=$.id,h.value=$.label,r.value=$.folderName||$.label,yield K({folderId:$.id,folderLabel:$.folderName||$.label})}),ye=()=>j(this,null,function*(){if(!Y.value){alert("Sub-folder name is required.");return}if(!x.value&&!h.value){alert("Please select a folder first.");return}try{yield new je({data:{},readOnly:!1}).createSubfolder({parentFolderId:x.value,parentFolderName:h.value,subfolderName:Y.value}),Y.value="",yield K()}catch(m){console.error("Error creating sub-folder:",m),alert(m.message||"Failed to create sub-folder.")}});te(l,m=>j(this,null,function*(){if(m)try{const A=yield H({url:"frappe.client.get_value",makeParams(){return{doctype:"Course Folder",fieldname:["foldername","file_reference","parent_folder"],filters:{name:m}}}}).fetch();r.value=(A==null?void 0:A.foldername)||"",x.value=(A==null?void 0:A.file_reference)||null,h.value=(A==null?void 0:A.foldername)||"",T.value=[{id:x.value,label:h.value,folderName:r.value}],y(),yield K({folderId:x.value,folderLabel:h.value})}catch($){console.error("Error fetching foldername:",$)}else r.value="",x.value=null,h.value="",T.value=[],z.value=[],_.value=[]}));let he=!1;return we(()=>j(this,null,function*(){he=!0,yield F(),yield D(),S.initialFolder&&(yield L(S.initialFolder,{refreshFolders:!1}))})),te(()=>S.initialFolder,(m,$)=>j(this,null,function*(){if(!he)return;const A=m==null?void 0:m.trim(),Z=$==null?void 0:$.trim();!A||A===Z||(yield L(A))})),(m,$)=>(o(),u("div",Un,[$[8]||($[8]=s("h3",null,"Manage Course Folders",-1)),s("div",null,[s("label",null,[xe(s("input",{type:"radio","onUpdate:modelValue":$[0]||($[0]=A=>t.value=A),value:"select"},null,512),[[Ke,t.value]]),$[6]||($[6]=me(" Select Existing Folder ",-1))]),s("label",On,[xe(s("input",{type:"radio","onUpdate:modelValue":$[1]||($[1]=A=>t.value=A),value:"create"},null,512),[[Ke,t.value]]),$[7]||($[7]=me(" Create New Folder ",-1))])]),t.value==="select"?(o(),u("div",Bn,[q(qe,{modelValue:l.value,"onUpdate:modelValue":$[2]||($[2]=A=>l.value=A),doctype:"Course Folder",options:"foldername",label:m.__("Select a folder")},null,8,["modelValue","label"])])):M("",!0),t.value==="create"?(o(),u("div",Vn,[xe(s("input",{type:"text","onUpdate:modelValue":$[3]||($[3]=A=>i.value=A),placeholder:"Enter folder name"},null,512),[[Pe,i.value]]),q(qe,{modelValue:v.value,"onUpdate:modelValue":$[4]||($[4]=A=>v.value=A),doctype:"Course",label:m.__("Select a course")},null,8,["modelValue","label"]),s("button",{onClick:ee},"Create Folder")])):M("",!0),l.value?(o(),u("div",jn,[s("div",null,[s("div",Hn,n(m.__("Current Folder")),1),s("div",Qn,[(o(!0),u(ae,null,ue(T.value,(A,Z)=>(o(),u(ae,{key:A.id||`${A.label}-${Z}`},[s("button",{type:"button",class:"rounded px-1.5 py-0.5 text-ink-gray-7 transition hover:bg-ink-gray-2 hover:text-ink-gray-9",onClick:N=>fe(Z)},n(A.label),9,Jn),Z<T.value.length-1?(o(),u("span",Gn,"/")):M("",!0)],64))),128))])]),s("div",Wn,[xe(s("input",{type:"text","onUpdate:modelValue":$[5]||($[5]=A=>Y.value=A),placeholder:m.__("New sub-folder name"),class:"flex-1 rounded border border-outline-gray-3 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"},null,8,Yn),[[Pe,Y.value]]),q(a(G),{size:"sm",onClick:ye},{default:R(()=>[me(n(m.__("Create Sub-folder")),1)]),_:1})]),s("div",null,[s("h5",Xn,n(m.__("Sub-folders")),1),z.value.length?(o(),u("ul",Kn,[(o(!0),u(ae,null,ue(z.value,A=>(o(),u("li",{key:A.name,class:"flex items-center justify-between rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("button",{type:"button",class:"flex-1 text-left text-sm font-medium text-blue-600 hover:underline",onClick:Z=>X(A)},n(A.file_name),9,er)]))),128))])):(o(),u("div",Zn,n(m.__("No sub-folders yet.")),1))]),s("div",null,[s("h5",tr,n(m.__("Files")),1),_.value.length?(o(),u("ul",ar,[(o(!0),u(ae,null,ue(_.value,A=>(o(),u("li",{key:A.file_url||A.name,class:"flex items-center gap-3 rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("a",{href:A.file_url,download:"",class:"flex-1 truncate text-sm text-blue-600 hover:underline"},n(A.file_name),9,or),q(a(He),{text:m.__("Delete File"),placement:"bottom"},{default:R(()=>[q(a(Qt),{onClick:Me(Z=>V(A.file_url),["prevent"]),class:"h-4 w-4 cursor-pointer text-red-500"},null,8,["onClick"])]),_:2},1032,["text"])]))),128))])):(o(),u("div",sr,n(m.__("No files found in this folder.")),1))]),s("div",{class:Fe(["rounded-md border-2 border-dashed border-outline-gray-3 p-6 text-center text-sm transition-colors duration-200 hover:border-outline-gray-4",{"bg-blue-50 border-blue-500 text-blue-700":b.value}]),onDragenter:Me(ne,["prevent","stop"]),onDragover:Me(w,["prevent","stop"]),onDragleave:Me(E,["prevent","stop"]),onDrop:Me(k,["prevent","stop"]),onClick:P},[s("p",nr,n(m.__("Drop files here or click to upload")),1),s("p",rr,n(m.__("Files will be added to"))+" "+n(h.value),1),s("input",{ref_key:"fileInputRef",ref:g,type:"file",class:"hidden",multiple:"",onChange:Q},null,544)],34)])):M("",!0)]))}},ir=rt(lr,[["__scopeId","data-v-b4e3a9b2"]]),ur={class:"flex flex-col gap-4 rounded-lg border-2 border-gray-200 p-4 mb-4"},dr={class:"flex flex-col gap-1"},cr={class:"text-lg font-semibold text-ink-gray-9"},mr={key:0,class:"text-sm text-ink-gray-6 flex flex-wrap items-center gap-1"},pr=["onClick"],fr={key:0},hr={key:0,class:"rounded border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700"},gr={key:1,class:"text-sm text-ink-gray-6"},vr={class:"space-y-2"},yr={class:"text-sm font-semibold text-ink-gray-9"},_r={key:0,class:"text-sm text-ink-gray-5"},br={key:1,class:"space-y-2"},xr=["onClick"],kr={class:"text-xs text-ink-gray-5"},wr={class:"space-y-2"},$r={class:"text-sm font-semibold text-ink-gray-9"},Sr={key:0,class:"text-sm text-ink-gray-5"},Cr={key:1,class:"space-y-2"},Tr=["href"],Ar={class:"text-xs text-ink-gray-5"},Er={__name:"FolderBlock",props:{folder:{type:[Object,String],required:!0}},setup(d){const e=d,t=ce(()=>typeof e.folder=="string"?e.folder:e.folder&&typeof e.folder=="object"&&(e.folder.folder||e.folder.foldername)||""),l=C(!1),r=C(""),i=C([]),_=C([]),p=C(null),v=C(""),x=C([]);let h=!1;const T=F=>{if(!F&&F!==0)return"";const S=Number(F);return Number.isNaN(S)?"":S>=1048576?`${(S/1048576).toFixed(2)} MB`:S>=1024?`${(S/1024).toFixed(2)} KB`:`${S} B`},z=({folderId:F=null,folderLabel:S=null})=>{const y={};F&&(y.folder_id=F);const L=S!=null?S:t.value;return!F&&L&&(y.foldername=L),y},b=(...y)=>j(this,[...y],function*({folderId:F=null,folderLabel:S=null}={}){const L=z({folderId:F,folderLabel:S});if(!L.folder_id&&!L.foldername)return null;l.value=!0,r.value="";try{const ee=yield H({url:"seminary.api.folder_upload.get_files_in_folder",params:L,auto:!0}).fetch(),K=(ee==null?void 0:ee.entries)||[];return _.value=K.filter(Q=>Q.is_folder),i.value=K.filter(Q=>!Q.is_folder),p.value=(ee==null?void 0:ee.folder_id)||F||null,v.value=(ee==null?void 0:ee.folder_name)||S||t.value||"",{id:p.value,label:v.value}}catch(D){return console.error("Error fetching folder contents:",D),r.value=(D==null?void 0:D.message)||__("Unable to load folder contents."),_.value=[],i.value=[],null}finally{l.value=!1}}),Y=()=>j(this,null,function*(){const F=yield b({folderLabel:t.value});F&&(x.value=[F])}),g=F=>j(this,null,function*(){if(!(F!=null&&F.name))return;const S=yield b({folderId:F.name,folderLabel:F.file_name});S&&(x.value=[...x.value,S])}),U=F=>j(this,null,function*(){if(F<0||F>=x.value.length)return;const S=x.value[F],y=yield b({folderId:S.id,folderLabel:S.label});y&&(x.value=[...x.value.slice(0,F),y])});return we(()=>j(this,null,function*(){h=!0,yield Y()})),te(()=>t.value,(F,S)=>j(this,null,function*(){if(!h)return;const y=(F||"").trim(),L=(S||"").trim();!y||y===L||(yield Y())})),(F,S)=>(o(),u("div",ur,[s("div",dr,[s("h4",cr,n(v.value||t.value),1),x.value.length?(o(),u("div",mr,[(o(!0),u(ae,null,ue(x.value,(y,L)=>(o(),u(ae,{key:y.id||`${y.label}-${L}`},[s("button",{type:"button",class:Fe(["rounded px-1.5 py-0.5 transition hover:bg-ink-gray-2 hover:text-ink-gray-9",L===x.value.length-1?"font-medium text-ink-gray-8 cursor-default":"text-ink-gray-7"]),onClick:D=>L===x.value.length-1?null:U(L)},n(y.label),11,pr),L<x.value.length-1?(o(),u("span",fr,"/")):M("",!0)],64))),128))])):M("",!0)]),r.value?(o(),u("div",hr,n(r.value),1)):l.value?(o(),u("div",gr,n(F.__("Loading folder contents")),1)):(o(),u(ae,{key:2},[s("section",vr,[s("h5",yr,n(F.__("Sub-folders")),1),_.value.length?(o(),u("ul",br,[(o(!0),u(ae,null,ue(_.value,y=>(o(),u("li",{key:y.name,class:"flex items-center justify-between rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("button",{type:"button",class:"text-left text-sm font-medium text-blue-600 hover:underline",onClick:L=>g(y)},n(y.file_name),9,xr),s("span",kr,n(F.__("Folder")),1)]))),128))])):(o(),u("div",_r,n(F.__("No sub-folders in this location.")),1))]),s("section",wr,[s("h5",$r,n(F.__("Files")),1),i.value.length?(o(),u("ul",Cr,[(o(!0),u(ae,null,ue(i.value,y=>(o(),u("li",{key:y.file_url||y.name,class:"flex items-center gap-3 rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("a",{href:y.file_url,download:"",class:"flex-1 truncate text-sm text-blue-600 hover:underline"},n(y.file_name),9,Tr),s("span",Ar,n(T(y.file_size)),1)]))),128))])):(o(),u("div",Sr,n(F.__("No files available in this folder.")),1))])],64))]))}},st=()=>{var d,e;return typeof window=="undefined"?null:window.csrf_token||((d=window.frappe)==null?void 0:d.csrf_token)||((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||null};class je{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l,this.api=t,this.wrapper=void 0,this.vueApp=null}static get toolbox(){const e=re({render:()=>Te(Jt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Folder",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.folder?this.renderFolder(this.data.folder):this.renderFolderModal(),this.wrapper}destroyApp(){this.vueApp&&(this.vueApp.unmount(),this.vueApp=null),this.wrapper&&(this.wrapper.innerHTML="")}renderFolder(e){if(this.readOnly){this.destroyApp(),this.vueApp=re(Er,{folder:e}),this.vueApp.use(ke),this.vueApp.use(Se),this.vueApp.mount(this.wrapper);return}this.renderFolderModal(e)}renderFolderModal(e=null){this.readOnly||(this.destroyApp(),this.vueApp=re(ir,{initialFolder:e,onAddition:t=>{this.data||(this.data={}),this.data.folder=t}}),this.vueApp.use(ke),this.vueApp.use(Se),this.vueApp.mount(this.wrapper))}save(e){var t;return{folder:(t=this.data)==null?void 0:t.folder}}destroy(){this.destroyApp()}createCourseFolder(e,t){return j(this,null,function*(){const l=t==null?void 0:t.trim();if(!l)throw new Error("Folder name is required to create a course folder");if(!e)throw new Error("Course is required to create a course folder");const r=st();if(!r)throw new Error("CSRF token not found. Please refresh the page and try again.");let i;const _=yield fetch("/api/resource/Course Folder",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":r},credentials:"include",body:JSON.stringify({course:e,foldername:l})});try{i=yield _.json()}catch(v){i=null}if(!_.ok){const v=(i==null?void 0:i.message)||(i==null?void 0:i.exc)||_.statusText;throw new Error(v||"Failed to create course folder")}const p=(i==null?void 0:i.data)||i;return this.data||(this.data={}),this.data.folder=(p==null?void 0:p.foldername)||l,p})}createSubfolder(r){return j(this,arguments,function*({parentFolderId:e,parentFolderName:t,subfolderName:l}){const i=l==null?void 0:l.trim();if(!i)throw new Error("Sub-folder name is required");if(!e&&!t)throw new Error("Parent folder information is required to create a sub-folder");const _=st();if(!_)throw new Error("CSRF token not found. Please refresh the page and try again.");let p;const v=yield fetch("/api/method/seminary.api.folder_upload.create_subfolder",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":_},credentials:"include",body:JSON.stringify({parent_folder_id:e,parent_foldername:t,subfoldername:i})});try{p=yield v.json()}catch(x){p=null}if(!v.ok){const x=(p==null?void 0:p.message)||(p==null?void 0:p.exc)||v.statusText;throw new Error(x||"Failed to create sub-folder")}return(p==null?void 0:p.message)||(p==null?void 0:p.data)||p})}}function vt(d){be(Ie({position:"bottom-right"},d))}function De(d){return ts(d).value}function Ir(d){return d>999?(d/1e3).toFixed(1)+"k":d}function Fr(d){let e=parseInt(d);return e>1048576?(e/1048576).toFixed(2)+"M":e>1024?(e/1024).toFixed(2)+"K":e}function Dr(d){te(()=>d,e=>{if(e.value.title){if(e.value.title&&e.value.subtitle){document.title=`${e.value.title} | ${e.value.subtitle}`;return}if(e.value.title){document.title=`${e.value.title}`;return}}},{immediate:!0,deep:!0})}function Rr(){return{header:{class:es,config:{placeholder:"Header"}},assignment:Ja,quiz:ma,exam:kn,upload:Nn,markdown:{class:Pn,inlineToolbar:!0},image:Kt,table:{class:Zt,inlineToolbar:!0},paragraph:{class:Xt,inlineToolbar:!0,config:{preserveBlank:!0}},codeBox:{class:Rn,config:{themeURL:"https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-dark.min.css",themeName:"atom-one-dark",useDefaultTheme:"dark"}},list:{class:Yt,inlineToolbar:!0,config:{defaultStyle:"ordered"}},inlineCode:{class:Wt,shortcut:"CMD+SHIFT+M"},embed:{class:Gt,inlineToolbar:!0,config:{services:{youtube:{regex:/(?:https?:\/\/)?(?:www\.)?(?:(?:youtu\.be\/)|(?:youtube\.com)\/(?:v\/|u\/\w\/|embed\/|watch))(?:(?:\?v=)?([^#&?=]*))?((?:[?&]\w*=\w*)*)/,embedUrl:"https://www.youtube.com/embed/<%= remote_id %>",html:'<iframe style="width:100%; height: 30rem;" frameborder="0" allowfullscreen></iframe>',height:320,width:580,id:([d,e])=>{if(!e&&d)return d;const t={start:"start",end:"end",t:"start",time_continue:"start",list:"list"};let l=e.slice(1).split("&").map(r=>{const[i,_]=r.split("=");return!d&&i==="v"?(d=_,null):!t[i]||_==="LL"||_.startsWith("RDMM")||_.startsWith("FL")?null:`${t[i]}=${_}`}).filter(r=>!!r);return d+"?"+l.join("&")}},vimeo:!0,codepen:!0,aparat:{regex:/(?:http[s]?:\/\/)?(?:www.)?aparat\.com\/v\/([^\/\?\&]+)\/?/,embedUrl:"https://www.aparat.com/video/video/embed/videohash/<%= remote_id %>/vt/frame",html:'<iframe style="margin: 0 auto; width: 100%; height: 25rem;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>',height:300,width:600},github:!0,slides:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/pub/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0' frameborder='0' allowfullscreen='true'></iframe>"},drive:{regex:/https:\/\/drive\.google\.com\/file\/d\/([A-Za-z0-9_-]+)\/view(\?.+)?/,embedUrl:"https://drive.google.com/file/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 25rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},docsPublic:{regex:/https:\/\/docs\.google\.com\/document\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/document/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},sheetsPublic:{regex:/https:\/\/docs\.google\.com\/spreadsheets\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/spreadsheets/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},slidesPublic:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0;' frameborder='0' allowfullscreen='true'></iframe>"},codesandbox:{regex:/^https:\/\/codesandbox\.io\/(?:embed\/)?([A-Za-z0-9_-]+)(?:\?[^\/]*)?$/,embedUrl:"https://codesandbox.io/embed/<%= remote_id %>?view=editor+%2B+preview&module=%2Findex.html",html:"<iframe style='width: 100%; height: 500px; border: 0; border-radius: 4px; overflow: hidden;' sandbox='allow-mods allow-forms allow-popups allow-scripts allow-same-origin' frameborder='0' allowfullscreen='true'></iframe>"}}}},folder:{class:je,config:{placeholder:"Add a folder with files",uploadEndpoint:"/api/upload-folder",renderFiles:d=>d.map(e=>`<a href="${e.url}" download>${e.name}</a>`).join("<br>")}}}}function yt(d){const e={ves:"fe",ies:"y",i:"us",zes:"ze",ses:"s",es:"e",s:""};return d.replace(new RegExp(`(${Object.keys(e).join("|")})$`),t=>e[t])}export{ra as _,xn as a,Er as b,Jo as c,ht as d,Fr as e,Ir as f,Rr as g,oa as h,ja as i,_n as j,De as t,Dr as u};
//# sourceMappingURL=index-DYgOoCE_.js.map
