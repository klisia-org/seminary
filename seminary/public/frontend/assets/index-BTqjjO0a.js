var bt=Object.defineProperty,kt=Object.defineProperties;var xt=Object.getOwnPropertyDescriptors;var We=Object.getOwnPropertySymbols;var wt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var Xe=(c,e,t)=>e in c?bt(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t,Pe=(c,e)=>{for(var t in e||(e={}))wt.call(e,t)&&Xe(c,t,e[t]);if(We)for(var t of We(e))$t.call(e,t)&&Xe(c,t,e[t]);return c},De=(c,e)=>kt(c,xt(e));var j=(c,e,t)=>new Promise((r,l)=>{var n=m=>{try{d(t.next(m))}catch(f){l(f)}},_=m=>{try{d(t.throw(m))}catch(f){l(f)}},d=m=>m.done?r(m.value):Promise.resolve(m.value).then(n,_);d((t=t.apply(c,e)).next())});import{G as je,d as u,o,f as s,T as St,V as Ct,W as Tt,s as ne,l as me,g as I,w as R,q as At,O as Me,e as a,$ as Be,i as Ce,r as C,a as ze,x as Ve,c as V,n as ae,h as M,t as i,j as z,_ as G,F as se,k as de,p as be,N as at,A as pe,C as ke,m as we,M as ot,D as nt,af as le,ag as Te,ah as xe,ai as Se,u as Qe,a0 as Et,ae as rt,E as Mt,a1 as Ft,y as lt,aj as it,z as ut,ak as zt,a8 as Je,b as qt,al as Ie,am as Lt,Z as It,ad as Ye,R as Fe,an as Nt}from"./index-CVWiL_Ou.js";import{_ as Ae}from"./Badge.vue_vue_type_script_setup_true_lang-DMvSTLfT.js";import{a as Ee}from"./FormControl.vue_vue_type_script_setup_true_lang-ClvexRF6.js";import{_ as Ne,H as Ze}from"./TextEditor.vue_vue_type_script_setup_true_lang-DxuhnEcI.js";import{c as qe}from"./call-DjkLykxt.js";import{_ as Le,X as Pt}from"./Link-D0cze3Hl.js";import{P as Rt}from"./pencil-W75E9_mf.js";import{m as Dt,s as Ut,f as Ht,n as Ot,F as jt,h as Bt,v as Vt}from"./FolderPlugin.vue_vue_type_style_index_0_scoped_b4e3a9b2_lang-_2hGWfCr.js";import{B as Qt}from"./book-open-check-yBkpgSvd.js";class Jt{constructor(){this.listeners={},this.failed=!1}on(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}trigger(e,t){(this.listeners[e]||[]).forEach(l=>{l.call(this,t)})}upload(e,t){return new Promise((r,l)=>{let n=new XMLHttpRequest;n.upload.addEventListener("loadstart",()=>{this.trigger("start")}),n.upload.addEventListener("progress",m=>{m.lengthComputable&&this.trigger("progress",{uploaded:m.loaded,total:m.total})}),n.upload.addEventListener("load",()=>{this.trigger("finish")}),n.addEventListener("error",()=>{this.trigger("error"),l()}),n.onreadystatechange=()=>{if(n.readyState==XMLHttpRequest.DONE){let m;if(n.status===200){let f=null;try{f=JSON.parse(n.responseText)}catch(P){f=n.responseText}let v=f.message||f;r(v)}else if(n.status===403)m=JSON.parse(n.responseText);else{this.failed=!0;try{m=JSON.parse(n.responseText)}catch(f){}}m&&m.exc&&console.error(JSON.parse(m.exc)[0]),l(m)}};const _=t.upload_endpoint||"/api/method/upload_file";n.open("POST",_,!0),n.setRequestHeader("Accept","application/json"),window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&n.setRequestHeader("X-Frappe-CSRF-Token",window.csrf_token);let d=new FormData;e&&d.append("file",e,e.name),d.append("is_private",t.private?"1":"0"),d.append("folder",t.folder||"Home"),t.file_url&&d.append("file_url",t.file_url),t.doctype&&d.append("doctype",t.doctype),t.docname&&d.append("docname",t.docname),t.fieldname&&d.append("fieldname",t.fieldname),t.method&&d.append("method",t.method),t.type&&d.append("type",t.type),t.optimize&&(d.append("optimize","1"),t.max_width&&d.append("max_width",t.max_width.toString()),t.max_height&&d.append("max_height",t.max_height.toString())),n.send(d)})}}const Gt={name:"FileUploader",props:{fileTypes:{type:[String,Array]},uploadArgs:{type:Object},validateFile:{type:Function,default:null}},data(){return{uploader:null,uploading:!1,uploaded:0,error:null,message:"",total:0,file:null,finishedUploading:!1}},computed:{progress(){let c=Math.floor(this.uploaded/this.total*100);return isNaN(c)?0:c},success(){return this.finishedUploading&&!this.error}},methods:{inputRef(){return this.$refs.input},openFileSelector(){this.$refs.input.click()},onFileAdd(c){return j(this,null,function*(){if(this.error=null,this.file=c.target.files[0],this.file&&this.validateFile)try{let e=yield this.validateFile(this.file);e&&(this.error=e)}catch(e){this.error=e}this.error||this.uploadFile(this.file)})},uploadFile(c){return j(this,null,function*(){this.error=null,this.uploaded=0,this.total=0,this.uploader=new Jt,this.uploader.on("start",()=>{this.uploading=!0}),this.uploader.on("progress",e=>{this.uploaded=e.uploaded,this.total=e.total}),this.uploader.on("error",()=>{this.uploading=!1,this.error="Error Uploading File"}),this.uploader.on("finish",()=>{this.uploading=!1,this.finishedUploading=!0}),this.uploader.upload(c,this.uploadArgs||{}).then(e=>{this.$emit("success",e)}).catch(e=>{this.uploading=!1;let t="Error Uploading File";e!=null&&e._server_messages?t=JSON.parse(JSON.parse(e._server_messages)[0]).message:e!=null&&e.exc&&(t=JSON.parse(e.exc)[0].split(`
`).slice(-2,-1)[0]),this.error=t,this.$emit("failure",e)})})}},expose:["inputRef"]},Wt=["accept"];function Xt(c,e,t,r,l,n){return o(),u("div",null,[s("input",{ref:"input",type:"file",accept:t.fileTypes,class:"hidden",onChange:e[0]||(e[0]=(..._)=>n.onFileAdd&&n.onFileAdd(..._))},null,40,Wt),St(c.$slots,"default",Ct(Tt({file:l.file,uploading:l.uploading,progress:n.progress,uploaded:l.uploaded,message:l.message,error:l.error,total:l.total,success:n.success,openFileSelector:n.openFileSelector})))])}const dt=je(Gt,[["render",Xt]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=ne("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=ne("CircleCheckBigIcon",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=ne("CircleHelpIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ne("CircleMinusIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=ne("CircleXIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=ne("CodeXmlIcon",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=ne("CodeIcon",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=ne("EllipsisIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=ne("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=ne("FolderOpenIcon",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=ne("MaximizeIcon",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=ne("MessageSquareTextIcon",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=ne("PauseIcon",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ne("PlayIcon",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=ne("SquarePenIcon",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=ne("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=ne("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=ne("Volume2Icon",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=ne("VolumeXIcon",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),us={class:"w-full bg-surface-gray-3 rounded-full h-1"},ht={__name:"ProgressBar",props:{progress:{type:Number,default:0},size:{type:String,default:"sm"}},setup(c){const e=c,t=me(()=>`${Math.min(Math.ceil(e.progress),100)}%`),r=me(()=>{if(e.size==="sm")return"h-1";if(e.size==="md")return"h-2";if(e.size==="lg")return"h-3"});return(l,n)=>(o(),I(a(Be),{text:`${e.progress}%`},{default:R(()=>[s("div",us,[s("div",{class:Me(["bg-surface-gray-7 rounded-full",r.value]),style:At({width:t.value})},null,6)])]),_:1},8,["text"]))}},ds={key:0},cs={class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},ms={class:"leading-5"},ps={key:0,class:"leading-5"},fs={key:1,class:"leading-5"},hs={key:2,class:"leading-relaxed"},gs={key:3,class:"leading-relaxed"},vs={key:0,class:"flex flex-col space-x-1 my-4"},ys={class:"mb-2"},_s={class:"font-semibold"},bs={key:1},ks={class:"border text-center p-20 rounded-md"},xs={class:"font-semibold text-lg"},ws={key:2},$s={key:2},Ss={key:0,class:"border rounded-md p-5"},Cs={class:"flex justify-between"},Ts={class:"text-sm text-ink-gray-5"},As={class:"mr-2"},Es={class:"text-ink-gray-9 text-sm font-semibold item-left"},Ms=["innerHTML"],Fs={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},zs=["name","onChange"],qs=["name","onChange"],Ls={key:0},Is=["innerHTML"],Ns={key:1},Ps={key:0},Rs={key:2},Ds={class:"flex items-center justify-between mt-4"},Us={class:"text-sm text-ink-gray-5"},Hs={key:3},Os={class:"flex justify-between"},js={class:"text-sm text-ink-gray-5"},Bs={class:"mr-2"},Vs={class:"text-ink-gray-9 text-sm font-semibold item-left"},Qs=["innerHTML"],Js={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Gs=["name","onChange"],Ws=["name","onChange"],Xs=["innerHTML"],Ys={key:1},Zs={class:"text-center mt-4"},Ks={key:4,class:"border rounded-md p-20 text-center space-y-4"},ea={class:"text-ink-gray-9"},ta={class:"mt-6"},sa={class:"flex justify-between"},aa={class:"text-lg text-ink-gray-5"},oa={class:"mr-2"},na=["innerHTML"],ra={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},la={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ia={key:0,class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ua={class:"mt-4"},da={key:1},ca={__name:"Quiz",props:{quizName:{type:String,required:!0}},setup(c){const e=Ce("$user"),t=C(!1),r=C(0),l=C(""),n=ze([0,0,0,0]),_=ze([]);let d=ze([]);const m=C(null),f=C(0);let v=null;const P=Ve(),D=C(0),k=ze({}),X=c,y=V({url:"frappe.client.get",makeParams(g){return{doctype:"Quiz",name:X.quizName}},cache:["quiz",X.quizName],auto:!0,transform(g){return g?(g.duration=parseInt(g.duration)||0,g):(console.error("Quiz data is null or undefined."),null)},onSuccess(g){g?(E(),S()):console.error("Failed to load quiz data.")},onError(g){console.error("Error loading quiz data:",g)}}),U=me(()=>!!y.data),E=()=>{let g=y.data;if(g.shuffle_questions){const p=ee([...g.questions]);d=g.limit_questions_to?p.slice(0,g.limit_questions_to):p}else d=g.questions},S=()=>{y.data.duration&&(f.value=y.data.duration*60)},b=()=>{v=setInterval(()=>{y.data.duration&&(f.value--,f.value==0&&(clearInterval(v),h())),D.value++},1e3)},F=g=>{const p=Math.floor(g/3600).toString().padStart(2,"0"),J=Math.floor(g%3600/60).toString().padStart(2,"0"),O=(g%60).toString().padStart(2,"0");return p!="00"?`${p}:${J}:${O}`:`${J}:${O}`},N=me(()=>f.value/(y.data.duration*60)*100),ee=g=>{for(let p=g.length-1;p>0;p--){const J=Math.floor(Math.random()*(p+1));[g[p],g[J]]=[g[J],g[p]]}return g},K=V({url:"frappe.client.get_list",makeParams(g){var p,J;return{doctype:"Quiz Submission",filters:{member:(p=e.data)==null?void 0:p.name,quiz:(J=y.data)==null?void 0:J.name},fields:["name","creation","score","score_out_of","percentage","passing_percentage"],order_by:"creation desc"}},transform(g){g.forEach((p,J)=>{p.creation=Re(p.creation),p.idx=J+1})}});ae(()=>y.data,g=>{g&&E(),g&&y.data.max_attempts&&(K.reload(),Z())});const Q=V({url:"seminary.seminary.doctype.quiz.quiz.quiz_summary",makeParams(g){if(!y.data)return{};const p=y.data.duration?y.data.duration*60-(f.value||0):D.value||0;return{quiz:y.data.name,course:P.currentRoute.value.params.courseName,results:(g==null?void 0:g.results)||localStorage.getItem(`${y.data.name}_results`),time_taken:p}},onSuccess(g){g.corrected_answers&&(re.data=g.corrected_answers.map(p=>De(Pe({},p),{user_answer:p.user_answer||null,correct_answer:p.correct_answer||null})))},onError(g){console.error("Error loading quiz summary:",g)},auto:!0}),B=V({url:"seminary.seminary.utils.get_question_details",makeParams(g){return{question:l.value}}});ae(r,g=>{g>0&&(l.value=y.data.questions[g-1].question,B.reload())}),ae(()=>X.quizName,g=>{g&&y.reload()});const re=V({url:"seminary.seminary.utils.get_all_questions_details",makeParams(g){return{questions:d.map(p=>p.name)}}}),w=()=>{r.value=1,localStorage.removeItem(y.data.title),b()},A=()=>{localStorage.removeItem(y.data.title),t.value=!0,b(),re.reload()},x=g=>{B.data.multiple||n.splice(0,n.length,0,0,0,0),n[g-1]=n[g-1]?0:1},L=()=>{let g=[];return B.data.type=="Choices"?n.forEach((J,O)=>{n[O]&&g.push(B.data[`option_${O+1}`])}):g.push(m.value),g},Y=()=>{let g=L();if(!g.length){vt({title:"Please select an option",icon:"alert-circle",iconClasses:"text-yellow-600 bg-yellow-100 rounded-full",position:"top-center"});return}V({url:"seminary.seminary.doctype.quiz.quiz.check_answer",params:{question:l.value,type:B.data.type,answers:JSON.stringify(g)},auto:!0,onSuccess(p){B.data.type==="Choices"?n.forEach((O,te)=>{O?_[te]=O&&p[te]:p[te]===2?_[te]=2:_[te]=void 0}):_.push(p),he(),y.data.show_answers||ge()}})},he=()=>{let g=JSON.parse(localStorage.getItem(y.data.title))||[],p={question_name:l.value,answer:L().join(),is_correct:_.filter(O=>O!=null)};const J=g.findIndex(O=>O.question_name===p.question_name);J!==-1?g[J]=p:g?g.push(p):g=[p],localStorage.setItem(y.data.title,JSON.stringify(g)),localStorage.setItem(`${y.data.name}_results`,JSON.stringify(g))},ye=()=>{y.data.show_answers?(he(),ge()):Y()},ge=()=>{r.value!=y.data.questions.length&&(r.value=r.value+1,n.splice(0,n.length,0,0,0,0),_.length=0,m.value=null)},h=()=>{if(!y.data.show_answers){Y(),setTimeout(()=>{T()},500);return}T(),console.log("Quiz submitted with Submit Quiz button and asnwers shown")},$=()=>j(this,null,function*(){var J;const g=[],p=[];for(let O=0;O<re.data.length;O++){const te=re.data[O],fe=((J=k[O])==null?void 0:J[0])||"",H=yield qe("seminary.seminary.doctype.quiz.quiz.check_answer",{question:te.question,type:te.type,answers:JSON.stringify([fe])}),ue=Array.isArray(H)?[H.find(W=>W===1)||0]:[H];g.push({question_name:te.question,answer:fe,is_correct:ue}),p.push({question_name:te.question,question_detail:te.question_detail,user_answer:fe,correct_answer:null,explanation:te.explanation||null})}Q.submit({results:JSON.stringify(g)},{onSuccess:O=>j(this,null,function*(){const te=yield qe("seminary.seminary.doctype.quiz.quiz.get_all_question_results",{questions:d.map(fe=>fe.question)});p.forEach(fe=>{const H=te.find(ue=>ue.name===fe.question_name);H&&(fe.correct_answer=H.correct_option,fe.explanation=H.correct_explanation||fe.explanation)}),localStorage.setItem(`${y.data.name}_questions`,JSON.stringify(p)),localStorage.setItem(`${y.data.name}_results`,JSON.stringify(g)),localStorage.setItem(`${y.data.name}_summary`,JSON.stringify(O)),Q.reload(),t.value=!1}),onError(O){console.error("Error submitting quiz:",O)}})}),T=()=>{const g=localStorage.getItem(`${y.data.name}_results`);if(!g){console.error("No results found to submit.");return}Q.submit({results:g},{onSuccess(p){ie(),y.data&&y.data.max_attempts&&K.reload(),y.data.duration&&clearInterval(v)},onError(p){var O,te;((p==null?void 0:p.message)||"").includes("MaximumAttemptsExceededError")&&((O=p.messages)!=null&&O[0],ke.error(((te=p.messages)==null?void 0:te[0])||p),setTimeout(()=>{window.location.reload()},3e3))}})},Z=()=>{r.value=0,n.splice(0,n.length,0,0,0,0),_.length=0,Q.reset(),E(),S(),D.value=0},q=g=>g.type=="Choices"?g.multiple?"Choose all answers that apply":"Choose one answer":"Type your answer",ie=()=>{P.currentRoute.value.name==="Lesson"&&qe("seminary.seminary.api.mark_lesson_progress",{course:P.currentRoute.value.params.courseName,chapter_number:P.currentRoute.value.params.chapterNumber,lesson_number:P.currentRoute.value.params.lessonNumber}).then(()=>{t.value&&Q.reload()})},ce=(g,p)=>{k[g]=[p]},oe=(g,p)=>{k[g]||(k[g]=[]);const J=k[g].indexOf(p);J===-1?k[g].push(p):k[g].splice(J,1)};ae(()=>re.data,g=>{g?console.log("All questions details updated"):console.warn("No data available in all_questions_details.")});const $e=C([]),_e=C([]);return ae(()=>Q.data,()=>{if(Q.data){const g=localStorage.getItem(`${y.data.name}_questions`),p=localStorage.getItem(`${y.data.name}_results`);$e.value=g?JSON.parse(g):[],_e.value=p?JSON.parse(p):[]}}),(g,p)=>{var J,O,te,fe;return U.value?(o(),u("div",ds,[s("div",cs,[s("div",ms,i(`This quiz consists of ${a(d).length} questions.`),1),(J=a(y).data)!=null&&J.duration?(o(),u("div",ps,i(`Please ensure that you complete all the questions in ${a(y).data.duration} minutes.`),1)):M("",!0),(O=a(y).data)!=null&&O.duration?(o(),u("div",fs,i("If you fail to do so, the quiz will be automatically submitted when the timer ends."))):M("",!0),a(y).data.passing_percentage?(o(),u("div",hs,i(`You will have to get ${a(y).data.passing_percentage}% correct answers in order to pass the quiz.`),1)):M("",!0),a(y).data.max_attempts?(o(),u("div",gs,i(`You can attempt this quiz ${a(y).data.max_attempts===1?"1 time":`${a(y).data.max_attempts} times`}.`),1)):M("",!0)]),a(y).data.duration?(o(),u("div",vs,[s("div",ys,[p[7]||(p[7]=s("span",{class:""},i("Time")+": ",-1)),s("span",_s,i(F(f.value)),1)]),z(ht,{progress:N.value},null,8,["progress"])])):M("",!0),t.value?M("",!0):(o(),u("div",bs,[s("div",ks,[s("div",xs,i(a(y).data.title),1),(!a(y).data.max_attempts||((te=a(K).data)==null?void 0:te.length)<a(y).data.max_attempts)&&a(y).data.qbyquestion?(o(),I(a(G),{key:0,onClick:w,class:"mt-2"},{default:R(()=>[...p[8]||(p[8]=[s("span",null,i("Start"),-1)])]),_:1})):!a(y).data.max_attempts||((fe=a(K).data)==null?void 0:fe.length)<a(y).data.max_attempts?(o(),I(a(G),{key:1,onClick:A,class:"mt-2"},{default:R(()=>[...p[9]||(p[9]=[s("span",null,i("Start full quiz"),-1)])]),_:1})):(o(),u("div",ws,i("You have already exceeded the maximum number of attempts allowed for this quiz.")))])])),t.value===!1&&r.value!==0&&!a(Q).data&&a(y).data.qbyquestion?(o(),u("div",$s,[(o(!0),u(se,null,de(a(d),(H,ue)=>(o(),u("div",null,[ue==r.value-1&&a(B).data?(o(),u("div",Ss,[s("div",Cs,[s("div",Ts,[s("span",As,i(`Question ${r.value}`)+": ",1),s("span",null,i(q(a(B).data)),1)]),s("div",Es,i(H.points)+" "+i(H.points==1?"Point":"Points"),1)]),s("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:a(B).data.question},null,8,Ms),a(B).data.type=="Choices"?(o(),u(se,{key:0},de(4,W=>s("div",null,[a(B).data[`option_${W}`]?(o(),u("label",Fs,[!_.length&&!a(B).data.multiple?(o(),u("input",{key:0,type:"radio",name:encodeURIComponent(a(B).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:ve=>x(W)},null,40,zs)):!_.length&&a(B).data.multiple?(o(),u("input",{key:1,type:"checkbox",name:encodeURIComponent(a(B).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:ve=>x(W)},null,40,qs)):a(y).data.show_answers?(o(!0),u(se,{key:2},de(_,(ve,_t)=>(o(),u("div",null,[W-1==_t?(o(),u("div",Ls,[ve==1?(o(),I(a(Ue),{key:0,class:"w-4 h-4 text-green-800"})):ve==2?(o(),I(a(Ke),{key:1,class:"w-4 h-4 text-ink-green-2"})):ve==0?(o(),I(a(He),{key:2,class:"w-4 h-4 text-red-600"})):(o(),I(a(Ke),{key:3,class:"w-4 h-4"}))])):M("",!0)]))),256)):M("",!0),s("span",{class:"ml-2",innerHTML:a(B).data[`option_${W}`]},null,8,Is)])):M("",!0),a(B).data[`explanation_${W}`]?be((o(),u("div",{key:1,class:"mt-2 text-xs"},i(a(B).data[`explanation_${W}`]),513)),[[at,_.length]]):M("",!0)])),64)):a(B).data.type=="User Input"?(o(),u("div",Ns,[z(a(Ee),{modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=W=>m.value=W),type:"textarea",disabled:!!_.length,class:"my-2"},null,8,["modelValue","disabled"]),_.length?(o(),u("div",Ps,[_[0]?(o(),I(a(Ae),{key:0,label:"Correct",theme:"green"},{prefix:R(()=>[z(a(Ue),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(o(),I(a(Ae),{key:1,theme:"red",label:"Incorrect"},{prefix:R(()=>[z(a(He),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])):M("",!0)])):(o(),u("div",Rs,[z(a(Ne),{class:"mt-4",content:m.value,onChange:p[1]||(p[1]=W=>m.value=W),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),s("div",Ds,[s("div",Us,i(`Question ${r.value} of ${a(d).length}`),1),a(y).data.show_answers&&!_.length?(o(),I(a(G),{key:0,onClick:p[2]||(p[2]=W=>Y())},{default:R(()=>[...p[10]||(p[10]=[s("span",null,i("Check"),-1)])]),_:1})):r.value!=a(d).length?(o(),I(a(G),{key:1,onClick:p[3]||(p[3]=W=>ye())},{default:R(()=>[...p[11]||(p[11]=[s("span",null,i("Next"),-1)])]),_:1})):(o(),I(a(G),{key:2,onClick:p[4]||(p[4]=W=>h())},{default:R(()=>[...p[12]||(p[12]=[s("span",null,i("Submit"),-1)])]),_:1}))])])):M("",!0)]))),256))])):M("",!0),t.value&&a(re).data&&a(re).data.length>0?(o(),u("div",Hs,[(o(!0),u(se,null,de(a(re).data,(H,ue)=>(o(),u("div",{key:H.name,class:"border rounded-md p-5 mb-4"},[s("div",Os,[s("div",js,[s("span",Bs,i(`Question ${ue+1}`)+":",1),s("span",null,i(q(H)),1)]),s("div",Vs,i(H.points||0)+" "+i(H.points==1?"Point":"Points"),1)]),s("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:H.question_detail},null,8,Qs),H.type=="Choices"?(o(),u(se,{key:0},de(4,W=>s("div",null,[H[`option_${W}`]?(o(),u("label",Js,[H.multiple?H.multiple?(o(),u("input",{key:1,type:"checkbox",name:`question_${ue}`,class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:ve=>oe(ue,H[`option_${W}`])},null,40,Ws)):M("",!0):(o(),u("input",{key:0,type:"radio",name:`question_${ue}`,class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:ve=>ce(ue,H[`option_${W}`])},null,40,Gs)),s("span",{class:"ml-2",innerHTML:H[`option_${W}`]},null,8,Xs)])):M("",!0)])),64)):H.type=="User Input"?(o(),u("div",Ys,[z(a(Ee),{modelValue:k[ue],"onUpdate:modelValue":W=>k[ue]=W,type:"textarea",class:"my-2"},null,8,["modelValue","onUpdate:modelValue"])])):M("",!0)]))),128)),s("div",Zs,[z(a(G),{onClick:p[5]||(p[5]=H=>$())},{default:R(()=>[...p[13]||(p[13]=[s("span",null,i("Submit Your Quiz"),-1)])]),_:1})])])):a(Q).data?(o(),u("div",Ks,[p[18]||(p[18]=s("div",{class:"text-lg font-semibold"},i("Quiz Summary"),-1)),s("div",ea,i(`You got ${Math.ceil(a(Q).data.percentage)}% correct answers with a score of ${a(Q).data.score} out of ${a(Q).data.score_out_of}`),1),s("div",ta,[(o(!0),u(se,null,de($e.value,(H,ue)=>{var W,ve;return o(),u("div",{key:H.question_name,class:"border rounded-md p-5 mb-4"},[s("div",sa,[s("div",aa,[s("span",oa,i(`Question ${ue+1}`)+":",1),s("span",{innerHTML:H.question_detail},null,8,na)])]),s("div",ra,[p[14]||(p[14]=s("strong",null,i("Your Answer:"),-1)),pe(" "+i(H.user_answer||"No Answer"),1)]),s("div",la,[p[15]||(p[15]=s("strong",null,i("Correct Answer:"),-1)),pe(" "+i(H.correct_answer||"No Correct Answer"),1)]),H.explanation?(o(),u("div",ia,[p[16]||(p[16]=s("strong",null,i("Explanation:"),-1)),pe(" "+i(H.explanation),1)])):M("",!0),s("div",ua,[((ve=(W=_e.value[ue])==null?void 0:W.is_correct)==null?void 0:ve[0])===1?(o(),I(a(Ae),{key:0,label:"Correct",theme:"green"},{prefix:R(()=>[z(a(Ue),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(o(),I(a(Ae),{key:1,label:"Incorrect",theme:"red"},{prefix:R(()=>[z(a(He),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])])}),128))]),z(a(G),{onClick:p[6]||(p[6]=H=>Z()),class:"mt-4"},{default:R(()=>[...p[17]||(p[17]=[s("span",null,i("Try Again"),-1)])]),_:1})])):M("",!0)])):(o(),u("div",da,[...p[19]||(p[19]=[s("p",null,"Loading quiz data...",-1)])]))}}},ma={key:1,class:"border rounded-md text-center py-20"},pa={__name:"QuizBlock",props:{quiz:{type:String,required:!0}},setup(c){const e=Ce("$user"),t=()=>{window.location.href="/login"};return(r,l)=>a(e).data?(o(),I(ca,{key:0,quizName:c.quiz},null,8,["quizName"])):(o(),u("div",ma,[s("div",null,i(r.__("Please login to access the quiz.")),1),z(a(G),{onClick:l[0]||(l[0]=n=>t()),class:"mt-2"},{default:R(()=>[s("span",null,i(r.__("Login")),1)]),_:1})]))}},fa={class:"p-5 space-y-4"},ha={key:0,class:"text-lg font-semibold"},ga={key:1,class:"text-lg font-semibold"},va={key:2,class:"text-lg font-semibold"},ya={class:"flex justify-end space-x-2"},Ge={__name:"AssessmentPlugin",props:{type:{type:String,required:!0},onAddition:{type:Function,required:!0}},setup(c){const e=C(!1),t=C(null),r=C(null),l=C(null),n=c;we(()=>j(this,null,function*(){yield ot(),e.value=!0}));const _=()=>{n.type=="quiz"?n.onAddition(t.value):n.type=="exam"?n.onAddition(l.value):n.onAddition(r.value),e.value=!1},d=()=>{n.type=="quiz"?window.open("/seminary/quizzes/new","_blank"):n.type=="exam"?window.open("/seminary/exams/new","_blank"):window.open("/seminary/assignments/new","_blank")};return(m,f)=>(o(),I(a(nt),{modelValue:e.value,"onUpdate:modelValue":f[4]||(f[4]=v=>e.value=v),options:{size:"xl"}},{body:R(()=>[f[5]||(f[5]=s("button",{style:{opacity:"0",position:"absolute"}},"Fallback Focus",-1)),s("div",fa,[c.type=="quiz"?(o(),u("div",ha,i(m.__("Add a quiz to your lesson")),1)):c.type=="exam"?(o(),u("div",ga,i(m.__("Add an exam to your lesson")),1)):(o(),u("div",va,i(m.__("Add an assignment to your lesson")),1)),s("div",null,[c.type=="quiz"?(o(),I(Le,{key:0,modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=v=>t.value=v),doctype:"Quiz",label:m.__("Select a quiz"),onCreate:(v,P)=>d()},null,8,["modelValue","label","onCreate"])):c.type=="exam"?(o(),I(Le,{key:1,modelValue:l.value,"onUpdate:modelValue":f[1]||(f[1]=v=>l.value=v),doctype:"Exam Activity",label:m.__("Select an exam"),onCreate:(v,P)=>d()},null,8,["modelValue","label","onCreate"])):(o(),I(Le,{key:2,modelValue:r.value,"onUpdate:modelValue":f[2]||(f[2]=v=>r.value=v),doctype:"Assignment Activity",label:m.__("Select an assignment"),onCreate:(v,P)=>d()},null,8,["modelValue","label","onCreate"]))]),s("div",ya,[z(a(G),{variant:"solid",onClick:f[3]||(f[3]=v=>_())},{default:R(()=>[pe(i(m.__("Save")),1)]),_:1})])])]),_:1},8,["modelValue"]))}};class _a{constructor({data:e,api:t,readOnly:r}){this.data=e,this.readOnly=r}static get toolbox(){const e=le({render:()=>Te(Zt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Quiz"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderQuiz(this.data.quiz):this.renderQuizModal(),this.wrapper}renderQuiz(e){if(this.readOnly){const t=le(pa,{quiz:e});t.use(xe),t.use(Se);const{userResource:r}=Qe();t.provide("$user",r),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Quiz: ${e}
            </span>
        </div>`}renderQuizModal(){if(this.readOnly)return;const e=le(Ge,{type:"quiz",onAddition:t=>{this.data.quiz=t,this.renderQuiz(t)}});e.use(xe),e.use(Se),e.mount(this.wrapper)}save(e){return{quiz:this.data.quiz}}}const ba={class:"border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},ka={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},xa={key:0},wa={key:1},$a={class:"text-sm text-ink-gray-7 font-medium mb-2"},Sa=["innerHTML"],Ca={class:"flex flex-col"},Ta={class:"p-5"},Aa={class:"flex items-center justify-between mb-4"},Ea={class:"font-semibold text-ink-gray-9"},Ma={class:"flex items-center space-x-2"},Fa={key:0,class:"bg-blue-200 p-3 rounded-md leading-5 text-sm mb-4"},za={key:1},qa={class:"text-xs text-ink-gray-5 mt-1 mb-2"},La={key:1},Ia={class:"flex text-ink-gray-7"},Na={class:"border self-start rounded-md p-2 mr-2"},Pa=["href"],Ra={class:"text-sm leading-5"},Da={class:"text-sm text-ink-gray-5 mt-1"},Ua={key:2},Ha={class:"text-xs text-ink-gray-5 mb-1"},Oa={key:3},ja={class:"text-sm mb-4"},Ba={key:4,class:"mt-8 p-3 bg-blue-200 rounded-md"},Va={class:"text-sm text-ink-gray-5 font-medium mb-2"},Qa={class:"leading-5"},Ja=["innerHTML"],Ga={key:5,class:"mt-8 space-y-4"},Wa={class:"font-semibold mb-2 text-ink-gray-9"},Xa={class:"text-sm text-ink-gray-5 mb-1"},Ya={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(c){var re;const e=C(null),t=C(null),r=C(null),l=Ve(),n=Ce("$user"),_=l.currentRoute.value.name=="AssignmentSubmission",d=C(!1),m=c;we(()=>{window.addEventListener("keydown",f),console.log("User: ",n.data)});const f=w=>{w.key==="s"&&(w.ctrlKey||w.metaKey)&&(X(),w.preventDefault())};Et(()=>{window.removeEventListener("keydown",f)});const v=V({url:"frappe.client.get",params:{doctype:"Assignment Activity",name:m.assignmentID},auto:!0,onSuccess(w){m.submissionName!="new"&&k.reload()}}),P=V({url:"frappe.client.insert",makeParams(w){var x;let A={doctype:"Assignment Submission",assignment:m.assignmentID,member:(x=n.data)==null?void 0:x.name,course:l.currentRoute.value.params.courseName};return B()?A.assignment_attachment=e.value.file_url:A.answer=t.value,{doc:A}}}),D=V({url:"seminary.seminary.api.get_file_info",makeParams(w){return{file_url:w.image}},auto:!1,onSuccess(w){e.value=w}}),k=rt({doctype:"Assignment Submission",name:m.submissionName,onError(w){var A;ke.error(((A=w.messages)==null?void 0:A[0])||w)},auto:!1,cache:[(re=n.data)==null?void 0:re.name,m.assignmentID]});ae(k,()=>{k.doc&&(k.doc.assignment_attachment&&D.reload({image:k.doc.assignment_attachment}),k.doc.answer&&(t.value=k.doc.answer),k.doc.comments&&(r.value=k.doc.comments),k.isDirty||B()&&!e.value||!B()&&!t.value?d.value=!0:d.value=!1)}),ae(e,()=>{m.submissionName=="new"&&e.value&&(d.value=!0)}),ae(()=>{var w;return(w=k.doc)==null?void 0:w.grade},(w,A)=>{w!==A&&k.doc&&(k.doc.status="Graded",d.value=!0)});const X=()=>{var w,A,x;if(m.submissionName!="new"){let L=k.doc&&k.doc.owner!=((w=n.data)==null?void 0:w.name)?(A=n.data)==null?void 0:A.name:null;k.setValue.submit(De(Pe({},k.doc),{assignment_attachment:(x=e.value)==null?void 0:x.file_url,evaluator:L,comments:r.value,answer:t.value}),{onSuccess(Y){ke.success(__("Changed successfully")),d.value=!1}})}else y()},y=()=>{P.submit({},{onSuccess(w){ke.success(__("Assignment submitted successfully")),l.currentRoute.value.name=="AssignmentSubmission"?l.push({name:"AssignmentSubmission",params:{assignmentID:m.assignmentID,submissionName:w.name}}):(E(),l.go()),k.name=w.name,d.value=!1,k.reload()},onError(w){var A;ke.error(((A=w.messages)==null?void 0:A[0])||w)}})},U=w=>{d.value=!0,e.value=w},E=()=>{if(l.currentRoute.value.name=="Lesson"){let w=l.currentRoute.value.params.courseName,A=l.currentRoute.value.params.chapterNumber,x=l.currentRoute.value.params.lessonNumber;console.log("Chapter Number: ",A),console.log("Lesson Number: ",x),qe("seminary.seminary.api.mark_lesson_progress",{course:w,chapter_number:A,lesson_number:x})}},S=()=>{var A;const w=(A=v.data)==null?void 0:A.type;if(w=="Image")return["image/*"];if(w=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(w=="PDF")return[".pdf"]},b=w=>{var L;let A=(L=v.data)==null?void 0:L.type,x=w.name.split(".").pop().toLowerCase();if(A=="Image"&&!["jpg","jpeg","png"].includes(x))return"Only image file is allowed.";if(A=="Document"&&!["doc","docx","xml"].includes(x))return"Only document file is allowed.";if(A=="PDF"&&!["pdf"].includes(x))return"Only PDF file is allowed."},F=()=>{d.value=!0,e.value=null},N=me(()=>{var w,A,x;return(((w=n.data)==null?void 0:w.is_moderator)||((A=n.data)==null?void 0:A.is_evaluator)||((x=n.data)==null?void 0:x.is_instructor))&&m.submissionName!="new"&&l.currentRoute.value.name=="AssignmentSubmission"}),ee=me(()=>{var w,A,x;return!k.doc||((w=k.doc)==null?void 0:w.owner)==((A=n.data)==null?void 0:A.name)&&((x=k.doc)==null?void 0:x.status)=="Not Graded"}),K=me(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),Q=me(()=>k.doc?k.doc.status=="Pass"||k.doc.status=="Graded"?"green":k.doc.status=="Not Graded"?"blue":"red":"orange"),B=()=>{var w;return["PDF","Image","Document"].includes((w=v.data)==null?void 0:w.type)};return(w,A)=>{var x,L,Y,he,ye,ge,h,$,T,Z;return a(v).data?(o(),u("div",{key:0,class:Me(["grid grid-cols-[65%,35%] h-full",{"border rounded-lg":!_}])},[s("div",ba,[_?(o(),u("div",ka,[c.submissionName==="new"?(o(),u("div",xa,i(w.__("Submission by"))+" "+i((x=a(n).data)==null?void 0:x.full_name),1)):(o(),u("div",wa,i(w.__("Submission by"))+" "+i((L=a(k).doc)==null?void 0:L.member_name),1))])):M("",!0),s("div",$a,i(w.__("Question"))+": ",1),s("div",{innerHTML:a(v).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,Sa)]),s("div",Ca,[s("div",Ta,[s("div",Aa,[s("div",Ea,i(w.__("Submission")),1),s("div",Ma,[d.value?(o(),I(a(Ae),{key:0,theme:"orange"},{default:R(()=>[pe(i(w.__("Not Saved")),1)]),_:1})):(Y=a(k).doc)!=null&&Y.status?(o(),I(a(Ae),{key:1,theme:Q.value,size:"lg"},{default:R(()=>{var q;return[pe(i((q=a(k).doc)==null?void 0:q.status),1)]}),_:1},8,["theme"])):M("",!0),z(a(G),{variant:"solid",onClick:A[0]||(A[0]=q=>X())},{default:R(()=>[pe(i(w.__("Save")),1)]),_:1})])]),c.submissionName!="new"&&!["Pass","Fail","Graded"].includes((he=a(k).doc)==null?void 0:he.status)&&((ye=a(k).doc)==null?void 0:ye.owner)==((ge=a(n).data)==null?void 0:ge.name)?(o(),u("div",Fa,i(w.__("You've successfully submitted the assignment."))+" "+i(w.__("Once the moderator grades your submission, you'll find the details here."))+" "+i(w.__("Feel free to make edits to your submission if needed, until it is graded.")),1)):M("",!0),B()?(o(),u("div",za,[s("div",qa,i(w.__("Add your assignment as {0}").format(a(v).data.type)),1),e.value?(o(),u("div",La,[s("div",Ia,[s("div",Na,[z(a(ss),{class:"h-5 w-5 stroke-1.5"})]),s("a",{href:e.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[s("span",Ra,i(e.value.file_name),1),s("span",Da,i(a(Pr)(e.value.file_size)),1)],8,Pa),ee.value?(o(),I(a(Pt),{key:0,onClick:A[2]||(A[2]=q=>F()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):M("",!0)])])):(o(),I(a(dt),{key:0,fileTypes:S(),validateFile:b,onSuccess:A[1]||(A[1]=q=>U(q))},{default:R(({uploading:q,progress:ie,openFileSelector:ce})=>[z(a(G),{onClick:ce,loading:q},{default:R(()=>[pe(i(q?w.__("Uploading {0}%").format(ie):w.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(v).data.type=="URL"?(o(),u("div",Ua,[s("div",Ha,i(w.__("Enter a URL")),1),z(a(Ee),{modelValue:t.value,"onUpdate:modelValue":A[3]||(A[3]=q=>t.value=q),type:"text",readonly:!ee.value},null,8,["modelValue","readonly"])])):(o(),u("div",Oa,[s("div",ja,i(w.__("Write your answer here")),1),z(a(Ne),{content:t.value,onChange:A[4]||(A[4]=q=>t.value=q),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((h=a(n).data)==null?void 0:h.name)==(($=a(k).doc)==null?void 0:$.owner)&&((T=a(k).doc)!=null&&T.comments)?(o(),u("div",Ba,[s("div",Va,i(w.__("Comments by"))+": "+i(((Z=a(k).doc)==null?void 0:Z.evaluator)||w.__("Evaluator")),1),s("div",Qa,[s("div",{innerHTML:a(k).doc.comments},null,8,Ja)])])):M("",!0),N.value?(o(),u("div",Ga,[s("div",Wa,i(w.__("Grading")),1),a(k).doc?(o(),I(a(Ee),{key:0,modelValue:a(k).doc.status,"onUpdate:modelValue":A[5]||(A[5]=q=>a(k).doc.status=q),label:w.__("Grading Status"),type:"select",options:K.value},null,8,["modelValue","label","options"])):M("",!0),a(k).doc?(o(),I(a(Ee),{key:1,modelValue:a(k).doc.grade,"onUpdate:modelValue":A[6]||(A[6]=q=>a(k).doc.grade=q),label:w.__("Score"),type:"number"},null,8,["modelValue","label"])):M("",!0),s("div",null,[s("div",Xa,i(w.__("Comments")),1),z(a(Ne),{content:r.value,onChange:A[7]||(A[7]=q=>{r.value=q,d.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):M("",!0)])])],2)):M("",!0)}}},Za={key:1,class:"border rounded-md text-center py-20"},Ka={__name:"AssignmentBlock",props:{assignmentID:{type:String,required:!0}},setup(c){const e=Ce("$user"),t=c,r=V({url:"frappe.client.get_value",makeParams(l){var n;return{doctype:"Assignment Submission",fieldname:"name",filters:{assignment:t.assignmentID,member:(n=e.data)==null?void 0:n.name}}},auto:!0});return(l,n)=>{var _;return a(e).data&&a(r).data?(o(),I(Ya,{key:0,assignmentID:c.assignmentID,submissionName:((_=a(r).data)==null?void 0:_.name)||"new"},null,8,["assignmentID","submissionName"])):(o(),u("div",Za,[s("div",null,i(l.__("Please login to access the assignment.")),1),z(a(G),{onClick:n[0]||(n[0]=d=>l.redirectToLogin()),class:"mt-2"},{default:R(()=>[s("span",null,i(l.__("Login")),1)]),_:1})]))}}};class eo{constructor({data:e,api:t,readOnly:r}){this.data=e,this.readOnly=r}static get toolbox(){const e=le({render:()=>Te(Rt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Assignment"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderAssignment(this.data.assignment):this.renderAssignmentModal(),this.wrapper}renderAssignment(e){if(this.readOnly){const t=le(Ka,{assignmentID:e});t.use(xe),t.use(Se);const{userResource:r}=Qe();t.provide("$user",r),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Assignment: ${e}
            </span>
        </div>`}renderAssignmentModal(){if(this.readOnly)return;const e=le(Ge,{type:"assignment",onAddition:t=>{this.data.assignment=t,this.renderAssignment(t)}});e.use(xe),e.use(Se),e.mount(this.wrapper)}save(e){return{assignment:this.data.assignment}}}const to={key:0,class:"text-center py-5"},so={key:1,class:"space-y-5"},ao={class:"grid grid-cols-3 gap-3"},oo={class:"col-span-3 space-y-4"},no={class:"space-y-4 border p-2 rounded-md"},ro={class:"flex items-center justify-between py-4"},lo={class:"text-center ml-5"},io={class:"text-3xl font-bold text-ink-gray-9"},uo={class:"text-center"},co={class:"text-3xl font-semibold text-ink-gray-9"},mo={class:"text-sm text-ink-gray-5"},po={class:"text-center mr-5"},fo={class:"text-3xl font-semibold text-ink-gray-9 mt-2"},ho={class:"space-y-1"},go={class:"font-semibold text-ink-gray-9 text-left"},vo=["innerHTML"],yo={class:"leading-5 text-ink-gray-7 space-x-1 text-left"},_o=["innerHTML"],bo={class:"flex justify-end items-center space-x-2"},ko={class:"text-sm text-ink-gray-7 text-xl"},xo={key:0,class:"leading-5 text-ink-gray-7 text-xl space-x-1 text-left"},wo=["innerHTML"],$o={key:2},So={__name:"ExamGraded",props:{submission:{type:Object,required:!0}},setup(c){const e=c;console.log("ExamGraded received submission:",e.submission);const t=rt({doctype:"Exam Submission",name:e.submission,auto:!0});console.log("ExamGraded submisisonDetails:",t),ae(()=>t.doc,l=>{t.loading=!1,console.log("ExamGraded updated with new submission details:",l)});const r=l=>{if(!l)return"00:00:00";const n=Math.floor(l/3600).toString().padStart(2,"0"),_=Math.floor(l%3600/60).toString().padStart(2,"0"),d=(l%60).toString().padStart(2,"0");return`${n}:${_}:${d}`};return(l,n)=>a(t).loading?(o(),u("div",to,[...n[0]||(n[0]=[s("p",null,"Loading submission details...",-1)])])):a(t).doc?(o(),u("div",so,[s("div",ao,[s("div",oo,[s("div",no,[s("div",ro,[s("div",lo,[s("div",io,i(a(t).doc.percentage||0)+"% ",1),n[1]||(n[1]=s("div",{class:"text-sm text-ink-gray-5"},"Score",-1))]),s("div",uo,[s("div",co,i(a(t).doc.score),1),s("div",mo," Out of "+i(a(t).doc.score_out_of)+" Points ",1)]),s("div",po,[s("div",fo,i(r(a(t).doc.time_taken)),1),n[2]||(n[2]=s("div",{class:"text-sm text-ink-gray-5"},"Time taken",-1))])])]),(o(!0),u(se,null,de(a(t).doc.result,(_,d)=>(o(),u("div",{key:d,class:"border p-5 rounded-md space-y-4"},[s("div",ho,[s("div",go,i(l.__("Question"))+" "+i(d+1)+": ",1),s("div",{class:"leading-5 text-ink-gray-9 text-left",innerHTML:_.question_name},null,8,vo)]),s("div",yo,[s("span",null,i(l.__("Your Answer"))+": ",1),s("span",{innerHTML:_.answer},null,8,_o)]),s("div",bo,[s("span",ko,i(_.points)+" / "+i(parseInt(_.points_out_of,10))+" "+i(l.__("Points")),1)]),_.comments?(o(),u("div",xo,[s("span",null,i(l.__("Comments"))+": ",1),s("span",{innerHTML:_.comments},null,8,wo)])):M("",!0)]))),128))])])])):(o(),u("div",$o,[...n[3]||(n[3]=[s("p",null,"Debug: No submission details found.",-1)])]))}},gt={__name:"UserAvatar",props:{user:{type:Object,default:null},size:{type:String}},setup(c){return(e,t)=>(o(),I(a(Be),{text:c.user.full_name},{default:R(()=>[c.user?(o(),I(a(Mt),Ft({key:0,class:"avatar border border-outline-gray-2 cursor-auto",label:c.user.full_name,image:c.user.user_image,size:c.size},e.$attrs),null,16,["label","image","size"])):M("",!0)]),_:1},8,["text"]))}},Co={class:"mt-6"},To={key:0,class:"flex items-center mb-5"},Ao={class:"text-lg font-semibold ml-2 text-ink-gray-9"},Eo={class:"flex items-center justify-between mb-2"},Mo={class:"flex items-center text-ink-gray-5"},Fo={class:"text-sm ml-2"},zo={key:1},qo={key:0},Lo={key:1,class:"formatted-reply"},Io=["innerHTML"],No=["value"],Po={class:"flex justify-between mt-2"},et={__name:"DiscussionReplies",props:lt({topic:{type:Object,required:!0},singleThread:{type:Boolean,default:!1}},{showTopics:{},showTopicsModifiers:{}}),emits:["update:showTopics"],setup(c){const e=it(),t=C(!1),r=ut(c,"showTopics"),l=C(""),n=Ce("$user");console.log("User data:",n.data.is_student);const _=C([]),d=C(!1),m=c,f=`editor-${m.topic.name}`;we(()=>{console.log("DiscussionReplies mounted. Registering socket listeners."),console.log("Topic received:",m.topic.name),D(),v.reload({},{onSuccess(b){console.log("Replies fetched successfully:",b)},onError(b){console.error("Error fetching replies:",b)}}),e.on("publish_message",b=>{v.reload()}),e.on("update_message",b=>{v.reload()}),e.on("delete_message",b=>{v.reload()}),d.value=!0,console.log("TextEditor renderEditor set to true."),console.log("Editor key:",f)}),ae(m.topic,(b,F)=>{b.name!==F.name&&(f.value=`editor-${b.name}`,console.log("Editor key updated:",f.value))}),ae(l,b=>{console.log("New reply value:",b),b||console.warn("Reply is empty. Ensure the input is being updated correctly.")}),ae(d,b=>{b&&console.log("TextEditor is now visible and ready for initialization.")});const v=V({url:"seminary.seminary.utils.get_discussion_replies",auto:!1,makeParams(){return{topic:m.topic.name}},onSuccess(b){console.log("Replies fetched successfully:",b)},onError(b){console.error("Error fetching replies:",b)}}),P=V({url:"seminary.seminary.utils.insert_discussion_reply",makeParams(b){return{reply:l.value,topic:m.topic.name}},onSuccess(b){console.log("Discussion saved successfully:",b)},onError(b){console.error("Error inserting replies:",b)}}),D=()=>{var b;console.log("User data in fetchMentionUsers:",n.data),(b=n.data)!=null&&b.is_student?d.value=!0:(t.value=!0,S.reload({},{onSuccess(F){_.value=Object.values(F).map(N=>({value:N.name,label:N.full_name})),d.value=!0,t.value=!1},onError(F){console.error("Error fetching mention users:",F),t.value=!1}}))},k=()=>{P.submit({},{onSuccess(){l.value="",v.reload()},onError(b){var F;vt({title:"Error",text:((F=b.messages)==null?void 0:F[0])||b,icon:"x",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:10})}})},X=V({url:"frappe.client.set_value",makeParams(b){return{doctype:"Discussion Reply",name:b.name,fieldname:"reply",value:b.reply}}}),y=b=>{X.submit({name:b.name,reply:b.reply},{validate(){if(!b.reply)return"Reply cannot be empty"},onSuccess(){b.editable=!1,v.reload()}})},U=V({url:"frappe.client.delete",makeParams(b){return{doctype:"Discussion Reply",name:b.name}}}),E=b=>{U.submit({name:b.name},{onSuccess(){v.reload()}})},S=V({url:"seminary.seminary.utils.get_all_users"});return console.log("All Users:",S),(b,F)=>(o(),u("div",Co,[c.singleThread?M("",!0):(o(),u("div",To,[z(a(G),{variant:"outline",onClick:F[0]||(F[0]=N=>r.value=!0)},{icon:R(()=>[z(a(Yt),{class:"w-5 h-5 stroke-1.5 text-ink-gray-7"})]),_:1}),s("span",Ao,i(c.topic.title),1)])),(o(!0),u(se,null,de(a(v).data,(N,ee)=>{var K;return o(),u("div",{key:N.name},[s("div",{class:Me(["py-3",{"border-b":ee+1!=a(v).data.length}])},[s("div",Eo,[s("div",Mo,[z(gt,{user:N.user,class:"mr-2"},null,8,["user"]),s("span",null,i(((K=N.user)==null?void 0:K.full_name)||N.owner),1),s("span",Fo,i(a(Re)(N.creation)),1)]),a(n).data.name==N.owner&&!N.editable?(o(),I(a(zt),{key:0,options:[{label:"Edit",onClick(){N.editable=!0}},{label:"Delete",onClick(){E(N)}}]},{default:R(({open:Q})=>[z(a(ts),{class:"w-4 h-4 stroke-1.5 cursor-pointer"})]),_:1},8,["options"])):M("",!0),N.editable?(o(),u("div",zo,[z(a(G),{variant:"ghost",onClick:Q=>y(N)},{default:R(()=>[pe(i(b.__("Post")),1)]),_:1},8,["onClick"]),z(a(G),{variant:"ghost",onClick:Q=>N.editable=!1},{default:R(()=>[pe(i(b.__("Discard")),1)]),_:1},8,["onClick"])])):M("",!0)]),N.editable?(o(),u("div",qo,[z(a(Ne),{content:N.reply,onChange:Q=>N.reply=Q,editable:!0,fixedMenu:!0,editorClass:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none"},null,8,["content","onChange"])])):(o(),u("div",Lo,[s("div",{innerHTML:N.reply,class:"p-2"},null,8,Io)]))],2)])}),128)),be(s("textarea",{class:"mt-5",value:l.value,onInput:F[1]||(F[1]=N=>l.value=N),placeholder:"Type your reply here...",fixedMenu:!0},null,40,No),[[at,d.value]]),s("div",Po,[F[3]||(F[3]=s("span",null,null,-1)),z(a(G),{onClick:F[2]||(F[2]=N=>k())},{default:R(()=>[s("span",null,i(b.__("Post")),1)]),_:1})])]))}},Ro={class:"flex flex-col gap-4"},Do={class:"mb-1.5 text-sm text-ink-gray-5"},tt={__name:"DiscussionModal",props:lt({title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0}},{reloadTopics:{},reloadTopicsModifiers:{}}),emits:["update:reloadTopics"],setup(c){const e=ut(c,"reloadTopics"),t=c,r=ze({title:"",reply:""}),l=V({url:"frappe.client.insert",makeParams(d){return{doc:{doctype:"Discussion Topic",reference_doctype:t.doctype,reference_docname:t.docname,title:r.title}}}}),n=V({url:"frappe.client.insert",makeParams(d){return{doc:{doctype:"Discussion Reply",topic:d.topic,reply:r.reply}}}}),_=d=>{l.submit({},{validate(){if(!r.title)return"Title cannot be empty.";if(!r.reply)return"Reply cannot be empty."},onSuccess(m){n.submit({topic:m.name},{onSuccess(){r.title="",r.reply="",e.value.reload(),d()}})},onError(m){var f;ke.error(((f=m.messages)==null?void 0:f[0])||m)}})};return(d,m)=>(o(),I(a(nt),{options:{title:a(yt)(t.title),size:"2xl",actions:[{label:"Post",variant:"solid",onClick:f=>_(f)}]}},{"body-content":R(()=>[s("div",Ro,[s("div",null,[z(a(Ee),{modelValue:r.title,"onUpdate:modelValue":m[0]||(m[0]=f=>r.title=f),label:d.__("Title"),type:"text"},null,8,["modelValue","label"])]),s("div",null,[s("div",Do,i(d.__("Details")),1),z(a(Ne),{content:r.reply,onChange:m[1]||(m[1]=f=>r.reply=f),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])]),_:1},8,["options"]))}};function Uo(){return window.scrollContainer}const Ho={class:"text-xl font-semibold text-ink-gray-9"},Oo={key:0},jo={key:1},Bo={key:2},Vo=["onClick"],Qo={class:"text-lg font-semibold mb-1 text-ink-gray-7"},Jo={class:"flex items-center text-ink-gray-5"},Go={class:"text-sm ml-3"},Wo={key:1},Xo={key:3,class:"flex flex-col items-center justify-center border-2 border-dashed mt-5 py-8 rounded-md"},Yo={class:""},Zo={key:0,class:"font-medium mb-2"},Ko={class:"text-ink-gray-5"},en={__name:"Discussions",props:{title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0},emptyStateTitle:{type:String,default:""},emptyStateText:{type:String,default:"Start a discussion"},singleThread:{type:Boolean,default:!1},scrollToBottom:{type:Boolean,default:!1},type:{type:String,default:"multi"}},setup(c){console.log("Discussions.vue script setup executed");const e=C(!0),t=C(null),r=Ce("$user"),l=C(!1),n=C(!0),_=C(!1),d=it();d?(console.log("Socket connection initialized in Discussions.vue:",d),d.on("connect",()=>{console.log("Socket connected:",d.id),_.value=!0}),d.on("connect_error",y=>{console.error("Socket connection error:",y)}),d.on("disconnect",y=>{console.warn("Socket disconnected:",y),_.value=!1})):console.error("Socket connection not initialized in Discussions.vue.");const m=c;ae(_,y=>{y&&(console.log("Socket is connected, proceeding with onMounted logic."),f())});const f=()=>{console.log("onMounted logic executed"),console.log("Props:",m),r.data&&(m.type==="single"?(console.log("Single-topic mode detected"),P.reload(),console.log("Topic",t.value)):n.value=!1,D.reload()),d.on("new_discussion_topic",y=>{D.refresh()}),m.scrollToBottom&&setTimeout(()=>{v()},100)},v=()=>{let y=Uo();y.scrollTop=y.scrollHeight},P=V({url:"seminary.seminary.utils.ensure_single_topic",cache:!1,makeParams(){return{doctype:m.doctype,docname:m.docname,title:m.title}},onSuccess(y){console.log("Ensure single topic response:",y),y&&(t.value=y,console.log("Current topic set:",t.value),e.value=!1,n.value=!1),console.log("Changed loading to:",n.value)},onError(y){console.error("Error ensuring single topic:",y),n.value=!1}}),D=V({url:"seminary.seminary.utils.get_discussion_topics",cache:["topics",m.doctype,m.docname],makeParams(){return{doctype:m.doctype,docname:m.docname,single_thread:m.singleThread}}}),k=y=>{e.value=!1,t.value=y},X=()=>{l.value=!0};return(y,U)=>{var E;return o(),u(se,null,[s("div",null,[!c.singleThread&&m.type==="multi"?(o(),I(a(G),{key:0,class:"float-right",onClick:U[0]||(U[0]=S=>X())},{default:R(()=>[pe(i(y.__("New {0}").format(a(yt)(c.title))),1)]),_:1})):M("",!0),s("div",Ho,i(y.__(c.title)),1)]),n.value&&m.type==="single"?(o(),u("div",Oo,[...U[6]||(U[6]=[s("div",{class:"text-center py-10"},[s("span",null,"Loading discussion...")],-1)])])):M("",!0),m.type==="single"&&!n.value?(o(),u("div",jo,[U[7]||(U[7]=s("div",{class:"flex flex-col items-center justify-center"},null,-1)),z(tt,{modelValue:l.value,"onUpdate:modelValue":U[1]||(U[1]=S=>l.value=S),title:c.title,doctype:m.doctype,docname:m.docname},null,8,["modelValue","title","doctype","docname"]),t.value.value?(o(),I(et,{key:0,topic:t.value.value,singleThread:!0,showTopics:e.value,"onUpdate:showTopics":U[2]||(U[2]=S=>e.value=S)},null,8,["topic","showTopics"])):M("",!0)])):M("",!0),(E=a(D).data)!=null&&E.length&&!c.singleThread?(o(),u("div",Bo,[e.value?(o(!0),u(se,{key:0},de(a(D).data,(S,b)=>(o(),u("div",{key:b},[s("div",{onClick:F=>k(S),class:Me(["flex items-center cursor-pointer py-5 w-full",{"border-b":b+1!=a(D).data.length}])},[z(gt,{user:S.user,size:"2xl",class:"mr-4"},null,8,["user"]),s("div",null,[s("div",Qo,i(S.title),1),s("div",Jo,[s("span",null,i(S.user.full_name),1),s("span",Go,i(a(Re)(S.creation)),1)])])],10,Vo)]))),128)):(o(),u("div",Wo,[z(et,{topic:t.value,showTopics:e.value,"onUpdate:showTopics":U[3]||(U[3]=S=>e.value=S)},null,8,["topic","showTopics"])]))])):(o(),u("div",Xo,[z(a(ns),{class:"w-7 h-7 text-ink-gray-4 stroke-1.5 mr-2"}),s("div",Yo,[c.emptyStateTitle?(o(),u("div",Zo,i(y.__(c.emptyStateTitle)),1)):M("",!0),s("div",Ko,i(y.__(c.emptyStateText)),1)])])),z(tt,{modelValue:l.value,"onUpdate:modelValue":U[4]||(U[4]=S=>l.value=S),title:y.__("New {0}").format(c.title),doctype:m.doctype,docname:m.docname,reloadTopics:a(D),"onUpdate:reloadTopics":U[5]||(U[5]=S=>Je(D)?D.value=S:null)},null,8,["modelValue","title","doctype","docname","reloadTopics"])],64)}}},tn={key:0},sn={key:0,class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},an={class:"leading-5"},on={key:0,class:"leading-5"},nn={key:1,class:"leading-5"},rn={key:1,class:"space-y-4 border p-5 rounded-md"},ln={key:2,class:"flex flex-col space-x-1 my-4"},un={class:"mb-2"},dn={class:"font-semibold"},cn={key:3},mn={class:"border text-center p-20 rounded-md"},pn={class:"font-semibold text-lg"},fn={key:2,class:"w-full max-w-4xl mx-auto py-5"},hn={key:3},gn={key:4},vn={class:"border text-center p-20 rounded-md"},yn={class:"font-semibold text-lg text-ink-gray-9 mt-3 mb-3"},_n={class:"absolute -top-3 -left-3 bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm"},bn={class:"text-ink-gray-9 text-sm font-semibold text-right"},kn={class:"text-ink-gray-9 text-left font-semibold mt-2 leading-5"},xn=["innerHTML"],wn={class:"mt-4"},$n=["onUpdate:modelValue","onChange"],Sn={class:"text-center mt-4"},Cn={__name:"Exam",props:{examName:{type:String,required:!0}},setup(c){var w,A;const e=Ce("$user"),t=C(0);let r=null;const l=C(0);C("");const n=C({});C([]);const _=C(!1),d=Ve();let m=!1;const f=c;console.log("Exam Name (PROPS):",f.examName);const v=V({url:"frappe.client.get",makeParams(x){return{doctype:"Exam Activity",name:f.examName}},cache:["exam",f.examName],auto:!0,transform(x){return x?(x.duration=parseInt(x.duration)||0,x):(console.error("Exam data is null or undefined."),null)},onSuccess(x){x?x.questions=x.questions||[]:console.error("Failed to load exam data.")},onError(x){console.error("Error loading exam data:",x)}}),P=me(()=>!!v.data),D=me(()=>{var x;return((x=N.data)==null?void 0:x.length)>0}),k=V({url:"seminary.seminary.utils.get_instructors",makeParams(x){const L=d.currentRoute.value.params.courseName;return L?{course:L}:(console.error("Course name is undefined in route parameters."),{})},auto:!0}),X=()=>(k.data&&k.data.forEach(x=>{var L;x.user===((L=e.data)==null?void 0:L.name)&&(m=!0)}),m);let y=null;const U=()=>{if(v.data.duration){t.value=v.data.duration*60,y=Date.now();const x=y+t.value*1e3;r=setInterval(()=>{const L=Date.now(),Y=Math.max(0,Math.floor((x-L)/1e3));t.value=Y,l.value=v.data.duration*60-Y,Y<=0&&(clearInterval(r),ee())},1e3)}else y=Date.now(),r=setInterval(()=>{const x=Date.now();l.value=Math.floor((x-y)/1e3)},1e3)},E=x=>{const L=Math.floor(x/60).toString().padStart(2,"0"),Y=(x%60).toString().padStart(2,"0");return`${L}:${Y}`},S=me(()=>t.value/(v.data.duration*60)*100);ae(n,x=>{},{deep:!0});const b=()=>{const x=Lt(n.value);return Object.entries(x).map(([L,Y])=>({question:L,answer:Y}))},F=(x,L)=>{n[x]=L},N=V({url:"frappe.client.get_list",makeParams(x){var L;return{doctype:"Exam Submission",filters:{member:(L=e.data)==null?void 0:L.name,exam:f.examName},fields:["name","creation"],order_by:"creation desc"}},auto:!0,transform(x){x.forEach((L,Y)=>{L.creation=Re(L.creation),L.idx=Y+1})}});ae(()=>N.data,x=>{console.log("Attempts data updated:",x)});const ee=()=>j(this,null,function*(){var x,L;try{const Y=b(),he=v.data.duration?v.data.duration*60-(t.value||0):l.value||0;yield qe("seminary.seminary.doctype.exam_submission.exam_submission.create_exam_submission",{exam:f.examName,course:d.currentRoute.value.params.courseName,member:(x=e.data)==null?void 0:x.name,answers:Y,time_taken:he}),ke.success(__("Your exam was submitted successfully.")),clearInterval(r)}catch(Y){console.error("Error during exam submission:",Y),ke.error(((L=err.messages)==null?void 0:L[0])||err)}}),K=()=>{activeQuestion.value=1,localStorage.removeItem(v.data.title),U()},Q=()=>{localStorage.removeItem(v.data.title),_.value=!0,U()},B=V({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:f.examName,member:(w=e.data)==null?void 0:w.name,status:"Graded"}},auto:!1,transform(x){return console.log("Fetched submission data:",x),x},onError(x){console.error("Error fetching submission:",x)}}),re=V({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:f.examName,member:(A=e.data)==null?void 0:A.name}},auto:!1,transform(x){return console.log("Fetched submission AnyStatus:",x.name),x},onError(x){console.error("Error fetching submission:",x)}});return we(()=>{B.reload(),re.reload()}),(x,L)=>{var he,ye,ge,h,$,T,Z,q,ie,ce,oe,$e,_e,g;const Y=qt("router-link");return P.value?(o(),u("div",tn,[D.value?M("",!0):(o(),u("div",sn,[s("div",an,i(`This exam consists of ${a(v).data.questions.length}`)+" "+i(a(v).data.questions.length===1?"question":"questions")+". ",1),(he=a(v).data)!=null&&he.duration?(o(),u("div",on,i(`Please ensure that you complete all the questions in ${a(v).data.duration} minutes.`),1)):M("",!0),(ye=a(v).data)!=null&&ye.duration?(o(),u("div",nn,i("If you fail to do so, the exam will be automatically submitted when the timer ends."))):M("",!0)])),D.value&&((ge=a(re))!=null&&ge.data||(h=a(N).data)!=null&&h[0])?(o(),u("div",rn,[(o(),I(en,{title:"Exam Comments",doctype:"Exam Submission",docname:((T=($=a(re))==null?void 0:$.data)==null?void 0:T.name)||((q=(Z=a(N).data)==null?void 0:Z[0])==null?void 0:q.name),key:((ce=(ie=a(re))==null?void 0:ie.data)==null?void 0:ce.name)||(($e=(oe=a(N).data)==null?void 0:oe[0])==null?void 0:$e.name),type:"single"},null,8,["docname"]))])):M("",!0),a(v).data.duration&&!D.value?(o(),u("div",ln,[s("div",un,[L[0]||(L[0]=s("span",{class:""},i("Time")+": ",-1)),s("span",dn,i(E(t.value)),1)]),z(ht,{progress:S.value},null,8,["progress"])])):M("",!0),!_.value&&!X()?(o(),u("div",cn,[s("div",mn,[s("div",pn,i(a(v).data.title),1),a(v).data.qbyquestion&&!D.value?(o(),I(a(G),{key:0,onClick:K,class:"mt-2"},{default:R(()=>[...L[1]||(L[1]=[s("span",null,i("Start"),-1)])]),_:1})):D.value?D.value&&((g=(_e=a(B))==null?void 0:_e.data)!=null&&g.name)?(o(),u("div",fn,[z(So,{submission:a(B).data.name},null,8,["submission"])])):(o(),u("div",hn,i("You have already submitted this exam. As soon as it is graded, you will see the feedback here."))):(o(),I(a(G),{key:1,onClick:Q,class:"mt-2"},{default:R(()=>[...L[2]||(L[2]=[s("span",null,i("Start Exam"),-1)])]),_:1}))])])):M("",!0),_.value||X()?(o(),u("div",gn,[s("div",vn,[s("div",yn,i(a(v).data.title),1),X()?(o(),I(Y,{key:0,to:{name:"ExamForm",params:{examID:a(v).data.name}},class:"flex items-center text-gray-400 mb-3 mr-4 hover:text-gray-600"},{default:R(()=>[z(a(rs),{class:"w-5 h-5 mr-2"}),L[3]||(L[3]=s("span",{class:"tooltip","data-tooltip":"Edit this exam"},"Edit",-1))]),_:1},8,["to"])):M("",!0),(o(!0),u(se,null,de(a(v).data.questions,(p,J)=>(o(),u("div",{key:p.name,class:"relative border rounded-md p-5 mb-4"},[s("div",_n,i(J+1),1),s("div",bn,i(p.points)+" "+i(p.points===1?"Point":"Points"),1),s("div",kn,[s("div",{innerHTML:p.question_detail||"No question detail provided."},null,8,xn)]),s("div",wn,[be(s("textarea",{"onUpdate:modelValue":O=>n.value[p.name]=O,class:"border rounded-md p-2 w-full",placeholder:"Type your answer here",onChange:O=>F(p.name,O)},null,40,$n),[[Ie,n.value[p.name]]])])]))),128)),s("div",Sn,[z(a(G),{onClick:ee},{default:R(()=>[...L[4]||(L[4]=[s("span",null,i("Submit Your Exam"),-1)])]),_:1})])])])):M("",!0)])):M("",!0)}}},Tn={key:1,class:"border rounded-md text-center py-20"},An={__name:"ExamBlock",props:{exam:{type:String,required:!0}},setup(c){const e=Ce("$user"),t=()=>{window.location.href="/login"};return(r,l)=>a(e).data?(o(),I(Cn,{key:0,examName:c.exam},null,8,["examName"])):(o(),u("div",Tn,[s("div",null,i(r.__("Please login to access the exam.")),1),z(a(G),{onClick:l[0]||(l[0]=n=>t()),class:"mt-2"},{default:R(()=>[s("span",null,i(r.__("Login")),1)]),_:1})]))}};class En{constructor({data:e,api:t,readOnly:r}){this.data=e,this.readOnly=r}static get toolbox(){const e=le({render:()=>Te(Qt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Exam"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderExam(this.data.exam):this.renderExamModal(),this.wrapper}renderExam(e){if(this.readOnly){const t=le(An,{exam:e});t.use(xe),t.use(Se);const{userResource:r}=Qe();t.provide("$user",r),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Exam: ${e}
            </span>
        </div>`}renderExamModal(){if(this.readOnly)return;const e=le(Ge,{type:"exam",onAddition:t=>{this.data.exam=t,this.renderExam(t)}});e.use(xe),e.use(Se),e.mount(this.wrapper)}save(e){return{exam:this.data.exam}}}const Mn=["src"],Fn={class:"flex items-center space-x-2 shadow rounded-lg p-1 w-1/2"},zn=["max"],qn={class:"text-xs text-ink-gray-9 font-medium"},Ln={__name:"AudioBlock",props:{file:{type:String,required:!0}},setup(c){const e=C(!1),t=C(null);let r=C(!1),l=C(0),n=C(0);we(()=>{setTimeout(()=>{t.value=document.querySelector("audio"),t.value.onloadedmetadata=()=>{n.value=t.value.duration},t.value.ontimeupdate=()=>{l.value=t.value.currentTime}},0)});const _=()=>{t.value.paused?(t.value.play(),e.value=!0):(t.value.pause(),e.value=!1)},d=()=>{t.value.muted=!t.value.muted,r.value=t.value.muted},m=()=>{t.value.currentTime=l.value},f=()=>{e.value=!1},v=P=>{const D=Math.floor(P/60),k=Math.floor(P%60);return`${D}:${k<10?"0":""}${k}`};return ae(e,P=>{P?t.value.play():t.value.pause()}),(P,D)=>(o(),u("div",null,[s("audio",{onEnded:f,controlsList:"nodownload",class:"mb-4"},[s("source",{src:encodeURI(c.file),type:"audio/mp3"},null,8,Mn)],32),s("div",Fn,[z(a(G),{variant:"ghost",onClick:_},{icon:R(()=>[e.value?(o(),I(a(ct),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),I(a(mt),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),be(s("input",{type:"range",min:"0",max:a(n),step:"0.1","onUpdate:modelValue":D[0]||(D[0]=k=>Je(l)?l.value=k:l=k),onInput:m,class:"duration-slider w-full h-1"},null,40,zn),[[Ie,a(l)]]),s("span",qn,i(v(a(l)))+" / "+i(v(a(n))),1),z(a(G),{variant:"ghost",onClick:d},{icon:R(()=>[a(r)?(o(),I(a(ft),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),I(a(pt),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1})])]))}},In=["src","type"],Nn={class:"flex items-center space-x-2 bg-surface-gray-3 rounded-md p-0.5 absolute bottom-3 w-[98%] left-0 right-0 mx-auto invisible group-hover:visible"},Pn=["max"],Rn={class:"text-xs font-medium"},Dn={__name:"VideoBlock",props:{file:{type:String,required:!0},type:{type:String,default:"video/mp4"}},setup(c){const e=C(null),t=C(null);let r=C(!1),l=C(0),n=C(0),_=C(!1);const d=c;we(()=>{setTimeout(()=>{e.value.onloadedmetadata=()=>{n.value=e.value.duration},e.value.ontimeupdate=()=>{l.value=e.value.currentTime}},0)});const m=me(()=>{if(f){let S=d.file;return S.includes("watch?v=")&&(S=S.replace("watch?v=","embed/")),`${S}?autoplay=0&controls=0&disablekb=1&playsinline=1&cc_load_policy=1&cc_lang_pref=auto`}return d.file}),f=me(()=>d.type=="video/youtube"),v=()=>{e.value.play(),r.value=!0},P=()=>{e.value.pause(),r.value=!1},D=()=>{r.value?P():v()},k=()=>{r.value=!1},X=()=>{e.value.muted=!e.value.muted,_.value=e.value.muted},y=()=>{e.value.currentTime=l.value},U=S=>{const b=Math.floor(S/60),F=Math.floor(S%60);return`${b}:${F<10?"0":""}${F}`},E=()=>{document.fullscreenElement?document.exitFullscreen():t.value.requestFullscreen()};return(S,b)=>(o(),u("div",{ref_key:"videoContainer",ref:t,class:"video-block group relative"},[s("video",{onTimeupdate:b[0]||(b[0]=(...F)=>S.updateTime&&S.updateTime(...F)),onEnded:k,onClick:D,oncontextmenu:"return false",class:"rounded-lg border border-gray-100 group cursor-pointer",ref_key:"videoRef",ref:e},[s("source",{src:m.value,type:c.type},null,8,In)],544),s("div",Nn,[z(a(G),{variant:"ghost"},{icon:R(()=>[a(r)?(o(),I(a(ct),{key:1,onClick:P,class:"w-4 h-4 text-ink-gray-9"})):(o(),I(a(mt),{key:0,onClick:v,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),z(a(G),{variant:"ghost",onClick:X},{icon:R(()=>[a(_)?(o(),I(a(ft),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(o(),I(a(pt),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),be(s("input",{type:"range",min:"0",max:a(n),step:"0.1","onUpdate:modelValue":b[1]||(b[1]=F=>Je(l)?l.value=F:l=F),onInput:y,class:"duration-slider w-full h-1"},null,40,Pn),[[Ie,a(l)]]),s("span",Rn,i(U(a(l)))+" / "+i(U(a(n))),1),z(a(G),{variant:"ghost",onClick:E},{icon:R(()=>[z(a(os),{class:"w-4 h-4 text-ink-gray-9"})]),_:1})])],512))}},Un=je(Dn,[["__scopeId","data-v-edd7c5f4"]]),Hn={__name:"UploadPlugin",props:{onFileUploaded:{type:Function,required:!0}},emits:["fileUploaded"],setup(c,{emit:e}){const t=C(null),r=c;we(()=>j(this,null,function*(){yield ot();const _=t.value.$el.querySelector('input[type="file"]');_&&_.click()}));const l=_=>{r.onFileUploaded({file_url:_.file_url,file_type:_.file_type})},n=_=>{let d=_.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","mp4","mov","mp3","pdf"].includes(d))return"Only image and video files are allowed."};return(_,d)=>(o(),I(a(dt),{fileTypes:["image/*","video/*","audio/*",".pdf"],validateFile:n,onSuccess:d[0]||(d[0]=m=>l(m)),ref_key:"fileUploader",ref:t,class:"hide"},null,512))}};class On{constructor({data:e,api:t,readOnly:r}){this.data=e,this.readOnly=r}static get toolbox(){const e=le({render:()=>Te(is,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Upload",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.file_url?this.renderFile(this.data):this.renderFileUploader(),this.wrapper}renderFile(e){if(this.isVideo(e.file_type)){le(Un,{file:e.file_url}).mount(this.wrapper);return}else if(this.isAudio(e.file_type)){le(Ln,{file:e.file_url}).mount(this.wrapper);return}else if(e.file_type=="PDF"){this.wrapper.innerHTML=`<iframe src="https://docs.google.com/viewer?url=${window.location.origin}${encodeURI(e.file_url)}&embedded=true" width='100%' height='700px' class="mb-4" type="application/pdf"></iframe>`;return}else{this.wrapper.innerHTML=`<img class="mb-4" src=${encodeURI(e.file_url)} width='100%'>`;return}}renderFileUploader(){const e=le(Hn,{onFileUploaded:t=>{this.data.file_url=t.file_url,this.data.file_type=t.file_type,this.renderFile(t)}});e.use(xe),e.mount(this.wrapper)}validate(e){return!(!e.file_url||!e.file_type)}save(e){return{file_url:this.data.file_url,file_type:this.data.file_type}}isVideo(e){return["mov","mp4","avi","mkv","webm"].includes(e.toLowerCase())}isAudio(e){return["mp3","wav","ogg"].includes(e.toLowerCase())}}class jn{constructor({data:e,api:t,readOnly:r,config:l}){this.api=t,this.data=e||{},this.config=l||{},this.text=e.text||"",this.readOnly=r,this.placeholder=__("Type '/' for commands or select text to format")}static get isReadOnlySupported(){return!0}static get conversionConfig(){return{export:"text",import:"text"}}static get toolbox(){const e=le({render:()=>Te(Kt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"",icon:t.innerHTML}}onPaste(e){const t={text:e.detail.data.innerHTML};this.data=t,window.requestAnimationFrame(()=>{this.wrapper&&(this.wrapper.innerHTML=this.data.text||"")})}static get pasteConfig(){return{tags:["P"]}}render(){return this.wrapper=document.createElement("div"),this.wrapper.classList.add("cdx-block","ce-paragraph"),this.wrapper.innerHTML=this.text,this.readOnly||(this.wrapper.contentEditable=!0,this.wrapper.innerHTML=this.text,this.wrapper.addEventListener("input",e=>{let t=e.target.textContent;e.keyCode===32&&t.startsWith("#")?this.convertToHeader(e,t):e.keyCode==189?this.convertBlock("list",{style:"unordered"}):/^[a-zA-Z]/.test(e.key)?this.convertBlock("paragraph",{text:t}):(e.keyCode===13||e.keyCode===190)&&this.parseContent(e)})),this.wrapper}_togglePlaceholder(){document.querySelectorAll(".cdx-block.ce-paragraph[data-placeholder]").forEach(t=>{t!==this.wrapper&&delete t.dataset.placeholder}),this.wrapper.innerHTML.trim()===""?this.wrapper.dataset.placeholder=this.placeholder:delete this.wrapper.dataset.placeholder}convertToHeader(e,t){if(e.preventDefault(),["#","##","###","####","#####","######"].includes(t)){let r=t.length;e.target.textContent="",this.convertBlock("header",{level:r})}}parseContent(e){e.preventDefault();let t=this.wrapper.textContent;if(e.keyCode===190&&(t=t+"."),t&&this.hasImage(t))this.wrapper.textContent="",this.convertBlock("image");else if(t&&this.hasLink(t)){const{text:r,url:l}=this.extractLink(t),n=`<a href="${l}" target="_blank">${r}</a>`;this.convertBlock("paragraph",{text:t.replace(/\[.+?\]\(.+?\)/,n)})}else t&&t.startsWith("- ")?this.convertBlock("list",{style:"unordered",items:[{content:t.replace("- ","")}]}):t&&t.startsWith("1.")?this.convertBlock("list",{style:"ordered",items:[{content:t.replace("1.","")}]}):t&&this.canBeEmbed(t)?(this.wrapper.textContent="",this.convertBlock("embed",{source:t})):this.convertBlock("paragraph",{text:t})}convertBlock(e,t,r=null){return j(this,null,function*(){const l=this.api.blocks.getCurrentBlockIndex(),n=this.api.blocks.getBlockByIndex(l);yield this.api.blocks.convert(n.id,e,t),this.api.caret.focus(!0)})}save(e){return{text:e.innerHTML}}hasImage(e){return/!\[.+?\]\(.+?\)/.test(e)}extractImage(e){const t=e.match(/!\[(.+?)\]\((.+?)\)/);return t?{alt:t[1],url:t[2]}:{alt:"",url:""}}hasLink(e){return/\[.+?\]\(.+?\)/.test(e)}extractLink(e){const t=e.match(/\[(.+?)\]\((.+?)\)/);return t?{text:t[1],url:t[2]}:{text:"",url:""}}canBeEmbed(e){return/^https?:\/\/.+/.test(e.trim())}}const Bn=["light","dark"],Vn={none:"Auto-detect",apache:"Apache",bash:"Bash",cs:"C#",cpp:"C++",css:"CSS",coffeescript:"CoffeeScript",diff:"Diff",go:"Go",html:"HTML, XML",http:"HTTP",json:"JSON",java:"Java",javascript:"JavaScript",kotlin:"Kotlin",less:"Less",lua:"Lua",makefile:"Makefile",markdown:"Markdown",nginx:"Nginx",objectivec:"Objective-C",php:"PHP",perl:"Perl",properties:"Properties",python:"Python",ruby:"Ruby",rust:"Rust",scss:"SCSS",sql:"SQL",shell:"Shell Session",swift:"Swift",toml:"TOML, also INI",typescript:"TypeScript",yaml:"YAML",plaintext:"Plaintext"};class Qn{constructor({data:e,api:t,config:r,readOnly:l}){this.api=t,this.readOnly=l,this.config={themeName:r.themeName&&typeof r.themeName=="string"?r.themeName:"",themeURL:r.themeURL&&typeof r.themeURL=="string"?r.themeURL:"",useDefaultTheme:r.useDefaultTheme&&typeof r.useDefaultTheme=="string"&&Bn.includes(r.useDefaultTheme.toLowerCase())?r.useDefaultTheme:"dark"},this.data={code:e.code&&typeof e.code=="string"?e.code:"",language:e.language&&typeof e.language=="string"?e.language:"Auto-detect",theme:e.theme&&typeof e.theme=="string"?e.theme:this._getThemeURLFromConfig()},this.highlightScriptID="highlightJSScriptElement",this.highlightCSSID="highlightJSCSSElement",this.codeArea=document.createElement("div"),this.selectInput=document.createElement("input"),this.selectDropIcon=document.createElement("i"),this._injectHighlightJSCSSElement(),this.api.listeners.on(window,"click",this._closeAllLanguageSelects,!0)}static get isReadOnlySupported(){return!0}static get sanitize(){return{code:!0,language:!1,theme:!1}}static get toolbox(){const e=le({render:()=>Te(es,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"CodeBox",icon:t.innerHTML}}static get displayInToolbox(){return!0}static get enableLineBreaks(){return!0}render(){const e=document.createElement("pre"),t=this._createLanguageSelectElement();return e.setAttribute("class","codeBoxHolder"),this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),this.codeArea.setAttribute("contenteditable","true"),this.codeArea.innerHTML=this.data.code,this.api.listeners.on(this.codeArea,"blur",r=>this._highlightCodeArea(r),!1),this.api.listeners.on(this.codeArea,"paste",r=>this._handleCodeAreaPaste(r),!1),e.appendChild(this.codeArea),!this.readOnly&&e.appendChild(t),e}save(e){return Object.assign(this.data,{code:this.codeArea.innerHTML,theme:this._getThemeURLFromConfig()})}validate(e){return!!e.code.trim()}destroy(){this.api.listeners.off(window,"click",this._closeAllLanguageSelects,!0),this.api.listeners.off(this.codeArea,"blur",e=>this._highlightCodeArea(e),!1),this.api.listeners.off(this.codeArea,"paste",e=>this._handleCodeAreaPaste(e),!1),this.api.listeners.off(this.selectInput,"click",e=>this._handleSelectInputClick(e),!1)}_createLanguageSelectElement(){const e=document.createElement("div"),t=document.createElement("div"),r=Object.entries(Vn);return e.setAttribute("class","codeBoxSelectDiv"),this.selectDropIcon.setAttribute("class",`codeBoxSelectDropIcon ${this.config.useDefaultTheme}`),this.selectDropIcon.innerHTML="&#8595;",this.selectInput.setAttribute("class",`codeBoxSelectInput ${this.config.useDefaultTheme}`),this.selectInput.setAttribute("type","text"),this.selectInput.setAttribute("readonly","true"),this.selectInput.value=this.data.language,this.api.listeners.on(this.selectInput,"click",l=>this._handleSelectInputClick(l),!1),t.setAttribute("class","codeBoxSelectPreview"),r.forEach(l=>{const n=document.createElement("p");n.setAttribute("class",`codeBoxSelectItem ${this.config.useDefaultTheme}`),n.setAttribute("data-key",l[0]),n.textContent=l[1],this.api.listeners.on(n,"click",_=>this._handleSelectItemClick(_,l),!1),t.appendChild(n)}),e.appendChild(this.selectDropIcon),e.appendChild(this.selectInput),e.appendChild(t),e}_highlightCodeArea(e){Ze.highlightBlock(this.codeArea)}_handleCodeAreaPaste(e){e.stopPropagation()}_handleSelectInputClick(e){e.target.nextSibling.classList.toggle("codeBoxShow")}_handleSelectItemClick(e,t){e.target.parentNode.parentNode.querySelector(".codeBoxSelectInput").value=t[1],e.target.parentNode.classList.remove("codeBoxShow"),this.codeArea.removeAttribute("class"),this.data.language=t[0],this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),Ze.highlightElement(this.codeArea)}_closeAllLanguageSelects(){const e=document.querySelectorAll(".codeBoxSelectPreview");for(let t=0,r=e.length;t<r;t++)e[t].classList.remove("codeBoxShow")}_injectHighlightJSCSSElement(){const e=document.querySelector(`#${this.highlightCSSID}`);let t=this._getThemeURLFromConfig();if(e)e.setAttribute("href",t);else{const r=document.createElement("link"),l=document.querySelector("head");r.setAttribute("rel","stylesheet"),r.setAttribute("href",t),r.setAttribute("id",this.highlightCSSID),l&&l.appendChild(r)}}_getThemeURLFromConfig(){let e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-${this.config.useDefaultTheme}.min.css`;return this.config.themeName&&(e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/${this.config.themeName}.min.css`),this.config.themeURL&&(e=this.config.themeURL),e}}const Jn={class:"Folder"},Gn={class:"ml-4"},Wn={key:0,class:"mt-4 mb-4"},Xn={key:1},Yn={key:2,class:"block mt-6 space-y-6"},Zn={class:"text-sm font-medium text-ink-gray-9"},Kn={class:"mt-1 flex flex-wrap items-center gap-1 text-sm text-ink-gray-6"},er=["onClick"],tr={key:0},sr={class:"flex flex-wrap items-center gap-2"},ar=["placeholder"],or={class:"mb-2 text-sm font-semibold text-ink-gray-9"},nr={key:0,class:"text-sm text-ink-gray-5"},rr={key:1,class:"space-y-2"},lr=["onClick"],ir={class:"mb-2 text-sm font-semibold text-ink-gray-9"},ur={key:0,class:"text-sm text-ink-gray-5"},dr={key:1,class:"space-y-2"},cr=["href"],mr={class:"font-medium"},pr={class:"mt-1 text-ink-gray-6"},fr={__name:"FolderPlugin",props:{onAddition:{type:Function,required:!1},initialFolder:{type:String,default:null}},setup(c){const e=It(),t=C("select"),r=C(null),l=C(""),n=C(""),_=C([]),d=C([]),m=C(null),f=C(null),v=C(""),P=C([]),D=C([]),k=C(!1),X=C(""),y=C(null),U=()=>{var h,$;return typeof window=="undefined"?null:window.csrf_token||((h=window.frappe)==null?void 0:h.csrf_token)||(($=document.querySelector('meta[name="csrf-token"]'))==null?void 0:$.getAttribute("content"))||null},E=()=>j(this,null,function*(){const h=e.params.courseName;if(console.log("Course Name: ",h),h){const T=yield V({url:"frappe.client.get_value",makeParams(Z){return{doctype:"Course Schedule",fieldname:"course",filters:{name:h}}}}).fetch();m.value=T.course,console.log("Fetched Course: ",m.value)}else return console.error("Course name not found in route params"),null}),S=c,b=()=>{if(!l.value)return;const h=l.value;typeof S.onAddition=="function"&&S.onAddition(h)},F=(T,...Z)=>j(this,[T,...Z],function*(h,{refreshFolders:$=!0}={}){const q=h==null?void 0:h.trim();if(!q)return;($||!d.value.length)&&(yield N());const ie=d.value.find(ce=>ce.foldername===q||ce.name===q);if(ie){r.value!==ie.name&&(r.value=ie.name);return}l.value=q,v.value=q,P.value=[{id:null,label:q,folderName:q}],yield K({folderLabel:q}),P.value=[{id:f.value,label:v.value||q,folderName:l.value||q}]}),N=()=>j(this,null,function*(){if(m.value||(yield E()),!m.value)return[];const $=yield V({url:"frappe.client.get_list",makeParams(){return{doctype:"Course Folder",filters:{course:m.value},fields:["name","foldername","file_reference","parent_folder"]}}}).fetch();return d.value=$,d.value}),ee=()=>j(this,null,function*(){if(!n.value){alert("Folder name is required");return}if(m.value||(yield E()),!m.value){alert("Please select a course before creating a folder.");return}try{const $=yield new Oe({data:{},readOnly:!1}).createCourseFolder(m.value,n.value);d.value.push({name:$.name,foldername:$.foldername,file_reference:$.file_reference,parent_folder:$.parent_folder}),l.value=$.foldername,f.value=$.file_reference,v.value=$.foldername,r.value=$.name,P.value=[{id:f.value,label:v.value,folderName:$.foldername}],t.value="select",n.value="",yield K({folderId:f.value,folderLabel:v.value})}catch(h){console.error("Error creating folder:",h),alert(h.message||"Failed to create folder.")}}),K=(...T)=>j(this,[...T],function*({folderId:h,folderLabel:$}={}){var ie;const Z=h!=null?h:f.value,q=(ie=$!=null?$:v.value)!=null?ie:l.value;if(!Z&&!q){console.warn("No folder selected for fetching files.");return}try{const oe=yield V({url:"seminary.api.folder_upload.get_files_in_folder",params:{folder_id:Z,foldername:q},auto:!0}).fetch(),$e=(oe==null?void 0:oe.entries)||[];D.value=$e.filter(_e=>_e.is_folder),_.value=$e.filter(_e=>!_e.is_folder),f.value=(oe==null?void 0:oe.folder_id)||Z,v.value=(oe==null?void 0:oe.folder_name)||q,l.value=v.value}catch(ce){console.error("Error fetching files:",ce),D.value=[],_.value=[]}}),Q=(h,$=null)=>j(this,null,function*(){var Z;const T=$||((Z=h==null?void 0:h.target)==null?void 0:Z.files);if(!(!T||!T.length)){if(!f.value&&!v.value){alert("Please select a folder first.");return}try{const q=new FormData;for(const oe of T)q.append("files",oe);f.value&&q.append("folder_id",f.value),v.value&&q.append("foldername",v.value);const ie=U();if(!ie){alert("Session expired. Refresh the page and try again.");return}const ce=yield fetch("/api/method/seminary.api.folder_upload.upload_folder",{method:"POST",body:q,headers:{"X-Frappe-CSRF-Token":ie},credentials:"include"});if(!ce.ok){const oe=yield ce.json().catch(()=>({}));console.error("Error uploading files:",oe),alert(`Error: ${oe.message||"Failed to upload files."}`);return}console.log("Files uploaded successfully."),h!=null&&h.target&&(h.target.value=""),yield K()}catch(q){console.error("Error uploading files:",q),alert("An error occurred while uploading files.")}finally{k.value=!1}}}),B=h=>j(this,null,function*(){const $=U();if(!$){alert("Session expired. Refresh the page and try again.");return}yield fetch("/api/method/seminary.api.folder_upload.delete_file",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":$},body:JSON.stringify({file_url:h}),credentials:"include"}).then(T=>T.json()),yield K()}),re=h=>{h.preventDefault(),h.stopPropagation(),!(!f.value&&!v.value)&&(k.value=!0)},w=h=>{!f.value&&!v.value||(h.preventDefault(),h.stopPropagation(),h.dataTransfer.dropEffect="copy",k.value=!0)},A=h=>{h.preventDefault(),h.stopPropagation(),k.value=!1},x=h=>j(this,null,function*(){var T;if(h.preventDefault(),h.stopPropagation(),!f.value&&!v.value){alert("Please select a folder before uploading.");return}const $=(T=h.dataTransfer)==null?void 0:T.files;$!=null&&$.length&&(yield Q(null,$)),k.value=!1}),L=()=>{var h;if(!f.value&&!v.value){alert("Please select a folder first.");return}(h=y.value)==null||h.click()},Y=h=>j(this,null,function*(){h!=null&&h.name&&(P.value=[...P.value,{id:h.name,label:h.file_name,folderName:h.file_name}],f.value=h.name,v.value=h.file_name,yield K({folderId:h.name,folderLabel:h.file_name}))}),he=h=>j(this,null,function*(){if(h<0||h>=P.value.length)return;const $=P.value[h];P.value=P.value.slice(0,h+1),f.value=$.id,v.value=$.label,l.value=$.folderName||$.label,yield K({folderId:$.id,folderLabel:$.folderName||$.label})}),ye=()=>j(this,null,function*(){if(!X.value){alert("Sub-folder name is required.");return}if(!f.value&&!v.value){alert("Please select a folder first.");return}try{yield new Oe({data:{},readOnly:!1}).createSubfolder({parentFolderId:f.value,parentFolderName:v.value,subfolderName:X.value}),X.value="",yield K()}catch(h){console.error("Error creating sub-folder:",h),alert(h.message||"Failed to create sub-folder.")}});ae(r,h=>j(this,null,function*(){if(h)try{const T=yield V({url:"frappe.client.get_value",makeParams(){return{doctype:"Course Folder",fieldname:["foldername","file_reference","parent_folder"],filters:{name:h}}}}).fetch();l.value=(T==null?void 0:T.foldername)||"",f.value=(T==null?void 0:T.file_reference)||null,v.value=(T==null?void 0:T.foldername)||"",P.value=[{id:f.value,label:v.value,folderName:l.value}],b(),yield K({folderId:f.value,folderLabel:v.value})}catch($){console.error("Error fetching foldername:",$)}else l.value="",f.value=null,v.value="",P.value=[],D.value=[],_.value=[]}));let ge=!1;return we(()=>j(this,null,function*(){ge=!0,yield E(),yield N(),S.initialFolder&&(yield F(S.initialFolder,{refreshFolders:!1}))})),ae(()=>S.initialFolder,(h,$)=>j(this,null,function*(){if(!ge)return;const T=h==null?void 0:h.trim(),Z=$==null?void 0:$.trim();!T||T===Z||(yield F(T))})),(h,$)=>(o(),u("div",Jn,[$[8]||($[8]=s("h3",null,"Manage Course Folders",-1)),s("div",null,[s("label",null,[be(s("input",{type:"radio","onUpdate:modelValue":$[0]||($[0]=T=>t.value=T),value:"select"},null,512),[[Ye,t.value]]),$[6]||($[6]=pe(" Select Existing Folder ",-1))]),s("label",Gn,[be(s("input",{type:"radio","onUpdate:modelValue":$[1]||($[1]=T=>t.value=T),value:"create"},null,512),[[Ye,t.value]]),$[7]||($[7]=pe(" Create New Folder ",-1))])]),t.value==="select"?(o(),u("div",Wn,[z(Le,{modelValue:r.value,"onUpdate:modelValue":$[2]||($[2]=T=>r.value=T),doctype:"Course Folder",options:"foldername",label:h.__("Select a folder")},null,8,["modelValue","label"])])):M("",!0),t.value==="create"?(o(),u("div",Xn,[be(s("input",{type:"text","onUpdate:modelValue":$[3]||($[3]=T=>n.value=T),placeholder:"Enter folder name"},null,512),[[Ie,n.value]]),z(Le,{modelValue:m.value,"onUpdate:modelValue":$[4]||($[4]=T=>m.value=T),doctype:"Course",label:h.__("Select a course")},null,8,["modelValue","label"]),s("button",{onClick:ee},"Create Folder")])):M("",!0),r.value?(o(),u("div",Yn,[s("div",null,[s("div",Zn,i(h.__("Current Folder")),1),s("div",Kn,[(o(!0),u(se,null,de(P.value,(T,Z)=>(o(),u(se,{key:T.id||`${T.label}-${Z}`},[s("button",{type:"button",class:"rounded px-1.5 py-0.5 text-ink-gray-7 transition hover:bg-ink-gray-2 hover:text-ink-gray-9",onClick:q=>he(Z)},i(T.label),9,er),Z<P.value.length-1?(o(),u("span",tr,"/")):M("",!0)],64))),128))])]),s("div",sr,[be(s("input",{type:"text","onUpdate:modelValue":$[5]||($[5]=T=>X.value=T),placeholder:h.__("New sub-folder name"),class:"flex-1 rounded border border-outline-gray-3 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"},null,8,ar),[[Ie,X.value]]),z(a(G),{size:"sm",onClick:ye},{default:R(()=>[pe(i(h.__("Create Sub-folder")),1)]),_:1})]),s("div",null,[s("h5",or,i(h.__("Sub-folders")),1),D.value.length?(o(),u("ul",rr,[(o(!0),u(se,null,de(D.value,T=>(o(),u("li",{key:T.name,class:"flex items-center justify-between rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("button",{type:"button",class:"flex-1 text-left text-sm font-medium text-blue-600 hover:underline",onClick:Z=>Y(T)},i(T.file_name),9,lr)]))),128))])):(o(),u("div",nr,i(h.__("No sub-folders yet.")),1))]),s("div",null,[s("h5",ir,i(h.__("Files")),1),_.value.length?(o(),u("ul",dr,[(o(!0),u(se,null,de(_.value,T=>(o(),u("li",{key:T.file_url||T.name,class:"flex items-center gap-3 rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("a",{href:T.file_url,download:"",class:"flex-1 truncate text-sm text-blue-600 hover:underline"},i(T.file_name),9,cr),z(a(Be),{text:h.__("Delete File"),placement:"bottom"},{default:R(()=>[z(a(ls),{onClick:Fe(Z=>B(T.file_url),["prevent"]),class:"h-4 w-4 cursor-pointer text-red-500"},null,8,["onClick"])]),_:2},1032,["text"])]))),128))])):(o(),u("div",ur,i(h.__("No files found in this folder.")),1))]),s("div",{class:Me(["rounded-md border-2 border-dashed border-outline-gray-3 p-6 text-center text-sm transition-colors duration-200 hover:border-outline-gray-4",{"bg-blue-50 border-blue-500 text-blue-700":k.value}]),onDragenter:Fe(re,["prevent","stop"]),onDragover:Fe(w,["prevent","stop"]),onDragleave:Fe(A,["prevent","stop"]),onDrop:Fe(x,["prevent","stop"]),onClick:L},[s("p",mr,i(h.__("Drop files here or click to upload")),1),s("p",pr,i(h.__("Files will be added to"))+" "+i(v.value),1),s("input",{ref_key:"fileInputRef",ref:y,type:"file",class:"hidden",multiple:"",onChange:Q},null,544)],34)])):M("",!0)]))}},hr=je(fr,[["__scopeId","data-v-b4e3a9b2"]]),gr={class:"flex flex-col gap-4 rounded-lg border-2 border-gray-200 p-4 mb-4"},vr={class:"flex flex-col gap-1"},yr={class:"text-lg font-semibold text-ink-gray-9"},_r={key:0,class:"text-sm text-ink-gray-6 flex flex-wrap items-center gap-1"},br=["onClick"],kr={key:0},xr={key:0,class:"rounded border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700"},wr={key:1,class:"text-sm text-ink-gray-6"},$r={class:"space-y-2"},Sr={class:"text-sm font-semibold text-ink-gray-9"},Cr={key:0,class:"text-sm text-ink-gray-5"},Tr={key:1,class:"space-y-2"},Ar=["onClick"],Er={class:"text-xs text-ink-gray-5"},Mr={class:"space-y-2"},Fr={class:"text-sm font-semibold text-ink-gray-9"},zr={key:0,class:"text-sm text-ink-gray-5"},qr={key:1,class:"space-y-2"},Lr=["href"],Ir={class:"text-xs text-ink-gray-5"},Nr={__name:"FolderBlock",props:{folder:{type:[Object,String],required:!0}},setup(c){const e=c,t=me(()=>typeof e.folder=="string"?e.folder:e.folder&&typeof e.folder=="object"&&(e.folder.folder||e.folder.foldername)||""),r=C(!1),l=C(""),n=C([]),_=C([]),d=C(null),m=C(""),f=C([]);let v=!1;const P=E=>{if(!E&&E!==0)return"";const S=Number(E);return Number.isNaN(S)?"":S>=1048576?`${(S/1048576).toFixed(2)} MB`:S>=1024?`${(S/1024).toFixed(2)} KB`:`${S} B`},D=({folderId:E=null,folderLabel:S=null})=>{const b={};E&&(b.folder_id=E);const F=S!=null?S:t.value;return!E&&F&&(b.foldername=F),b},k=(...b)=>j(this,[...b],function*({folderId:E=null,folderLabel:S=null}={}){const F=D({folderId:E,folderLabel:S});if(!F.folder_id&&!F.foldername)return null;r.value=!0,l.value="";try{const ee=yield V({url:"seminary.api.folder_upload.get_files_in_folder",params:F,auto:!0}).fetch(),K=(ee==null?void 0:ee.entries)||[];return _.value=K.filter(Q=>Q.is_folder),n.value=K.filter(Q=>!Q.is_folder),d.value=(ee==null?void 0:ee.folder_id)||E||null,m.value=(ee==null?void 0:ee.folder_name)||S||t.value||"",{id:d.value,label:m.value}}catch(N){return console.error("Error fetching folder contents:",N),l.value=(N==null?void 0:N.message)||__("Unable to load folder contents."),_.value=[],n.value=[],null}finally{r.value=!1}}),X=()=>j(this,null,function*(){const E=yield k({folderLabel:t.value});E&&(f.value=[E])}),y=E=>j(this,null,function*(){if(!(E!=null&&E.name))return;const S=yield k({folderId:E.name,folderLabel:E.file_name});S&&(f.value=[...f.value,S])}),U=E=>j(this,null,function*(){if(E<0||E>=f.value.length)return;const S=f.value[E],b=yield k({folderId:S.id,folderLabel:S.label});b&&(f.value=[...f.value.slice(0,E),b])});return we(()=>j(this,null,function*(){v=!0,yield X()})),ae(()=>t.value,(E,S)=>j(this,null,function*(){if(!v)return;const b=(E||"").trim(),F=(S||"").trim();!b||b===F||(yield X())})),(E,S)=>(o(),u("div",gr,[s("div",vr,[s("h4",yr,i(m.value||t.value),1),f.value.length?(o(),u("div",_r,[(o(!0),u(se,null,de(f.value,(b,F)=>(o(),u(se,{key:b.id||`${b.label}-${F}`},[s("button",{type:"button",class:Me(["rounded px-1.5 py-0.5 transition hover:bg-ink-gray-2 hover:text-ink-gray-9",F===f.value.length-1?"font-medium text-ink-gray-8 cursor-default":"text-ink-gray-7"]),onClick:N=>F===f.value.length-1?null:U(F)},i(b.label),11,br),F<f.value.length-1?(o(),u("span",kr,"/")):M("",!0)],64))),128))])):M("",!0)]),l.value?(o(),u("div",xr,i(l.value),1)):r.value?(o(),u("div",wr,i(E.__("Loading folder contents")),1)):(o(),u(se,{key:2},[s("section",$r,[s("h5",Sr,i(E.__("Sub-folders")),1),_.value.length?(o(),u("ul",Tr,[(o(!0),u(se,null,de(_.value,b=>(o(),u("li",{key:b.name,class:"flex items-center justify-between rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("button",{type:"button",class:"text-left text-sm font-medium text-blue-600 hover:underline",onClick:F=>y(b)},i(b.file_name),9,Ar),s("span",Er,i(E.__("Folder")),1)]))),128))])):(o(),u("div",Cr,i(E.__("No sub-folders in this location.")),1))]),s("section",Mr,[s("h5",Fr,i(E.__("Files")),1),n.value.length?(o(),u("ul",qr,[(o(!0),u(se,null,de(n.value,b=>(o(),u("li",{key:b.file_url||b.name,class:"flex items-center gap-3 rounded border border-outline-gray-2 px-3 py-2 transition hover:border-outline-gray-3"},[s("a",{href:b.file_url,download:"",class:"flex-1 truncate text-sm text-blue-600 hover:underline"},i(b.file_name),9,Lr),s("span",Ir,i(P(b.file_size)),1)]))),128))])):(o(),u("div",zr,i(E.__("No files available in this folder.")),1))])],64))]))}},st=()=>{var c,e;return typeof window=="undefined"?null:window.csrf_token||((c=window.frappe)==null?void 0:c.csrf_token)||((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||null};class Oe{constructor({data:e,api:t,readOnly:r}){this.data=e,this.readOnly=r,this.api=t,this.wrapper=void 0,this.vueApp=null}static get toolbox(){const e=le({render:()=>Te(as,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Folder",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.folder?this.renderFolder(this.data.folder):this.renderFolderModal(),this.wrapper}destroyApp(){this.vueApp&&(this.vueApp.unmount(),this.vueApp=null),this.wrapper&&(this.wrapper.innerHTML="")}renderFolder(e){if(this.readOnly){this.destroyApp(),this.vueApp=le(Nr,{folder:e}),this.vueApp.use(xe),this.vueApp.use(Se),this.vueApp.mount(this.wrapper);return}this.renderFolderModal(e)}renderFolderModal(e=null){this.readOnly||(this.destroyApp(),this.vueApp=le(hr,{initialFolder:e,onAddition:t=>{this.data||(this.data={}),this.data.folder=t}}),this.vueApp.use(xe),this.vueApp.use(Se),this.vueApp.mount(this.wrapper))}save(e){var t;return{folder:(t=this.data)==null?void 0:t.folder}}destroy(){this.destroyApp()}createCourseFolder(e,t){return j(this,null,function*(){const r=t==null?void 0:t.trim();if(!r)throw new Error("Folder name is required to create a course folder");if(!e)throw new Error("Course is required to create a course folder");const l=st();if(!l)throw new Error("CSRF token not found. Please refresh the page and try again.");let n;const _=yield fetch("/api/resource/Course Folder",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":l},credentials:"include",body:JSON.stringify({course:e,foldername:r})});try{n=yield _.json()}catch(m){n=null}if(!_.ok){const m=(n==null?void 0:n.message)||(n==null?void 0:n.exc)||_.statusText;throw new Error(m||"Failed to create course folder")}const d=(n==null?void 0:n.data)||n;return this.data||(this.data={}),this.data.folder=(d==null?void 0:d.foldername)||r,d})}createSubfolder(l){return j(this,arguments,function*({parentFolderId:e,parentFolderName:t,subfolderName:r}){const n=r==null?void 0:r.trim();if(!n)throw new Error("Sub-folder name is required");if(!e&&!t)throw new Error("Parent folder information is required to create a sub-folder");const _=st();if(!_)throw new Error("CSRF token not found. Please refresh the page and try again.");let d;const m=yield fetch("/api/method/seminary.api.folder_upload.create_subfolder",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":_},credentials:"include",body:JSON.stringify({parent_folder_id:e,parent_foldername:t,subfoldername:n})});try{d=yield m.json()}catch(f){d=null}if(!m.ok){const f=(d==null?void 0:d.message)||(d==null?void 0:d.exc)||m.statusText;throw new Error(f||"Failed to create sub-folder")}return(d==null?void 0:d.message)||(d==null?void 0:d.data)||d})}}function vt(c){ke(Pe({position:"bottom-right"},c))}function Re(c){return Nt(c).value}function Gr(c){return c>999?(c/1e3).toFixed(1)+"k":c}function Pr(c){let e=parseInt(c);return e>1048576?(e/1048576).toFixed(2)+"M":e>1024?(e/1024).toFixed(2)+"K":e}function Wr(c){ae(()=>c,e=>{if(e.value.title){if(e.value.title&&e.value.subtitle){document.title=`${e.value.title} | ${e.value.subtitle}`;return}if(e.value.title){document.title=`${e.value.title}`;return}}},{immediate:!0,deep:!0})}function Xr(){return{header:{class:Vt,config:{placeholder:"Header"}},assignment:eo,quiz:_a,exam:En,upload:On,markdown:{class:jn,inlineToolbar:!0},image:Bt,table:{class:jt,inlineToolbar:!0},paragraph:{class:Ot,inlineToolbar:!0,config:{preserveBlank:!0}},codeBox:{class:Qn,config:{themeURL:"https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-dark.min.css",themeName:"atom-one-dark",useDefaultTheme:"dark"}},list:{class:Ht,inlineToolbar:!0,config:{defaultStyle:"ordered"}},inlineCode:{class:Ut,shortcut:"CMD+SHIFT+M"},embed:{class:Dt,inlineToolbar:!0,config:{services:{youtube:{regex:/(?:https?:\/\/)?(?:www\.)?(?:(?:youtu\.be\/)|(?:youtube\.com)\/(?:v\/|u\/\w\/|embed\/|watch))(?:(?:\?v=)?([^#&?=]*))?((?:[?&]\w*=\w*)*)/,embedUrl:"https://www.youtube.com/embed/<%= remote_id %>",html:'<iframe style="width:100%; height: 30rem;" frameborder="0" allowfullscreen></iframe>',height:320,width:580,id:([c,e])=>{if(!e&&c)return c;const t={start:"start",end:"end",t:"start",time_continue:"start",list:"list"};let r=e.slice(1).split("&").map(l=>{const[n,_]=l.split("=");return!c&&n==="v"?(c=_,null):!t[n]||_==="LL"||_.startsWith("RDMM")||_.startsWith("FL")?null:`${t[n]}=${_}`}).filter(l=>!!l);return c+"?"+r.join("&")}},vimeo:!0,codepen:!0,aparat:{regex:/(?:http[s]?:\/\/)?(?:www.)?aparat\.com\/v\/([^\/\?\&]+)\/?/,embedUrl:"https://www.aparat.com/video/video/embed/videohash/<%= remote_id %>/vt/frame",html:'<iframe style="margin: 0 auto; width: 100%; height: 25rem;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>',height:300,width:600},github:!0,slides:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/pub/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0' frameborder='0' allowfullscreen='true'></iframe>"},drive:{regex:/https:\/\/drive\.google\.com\/file\/d\/([A-Za-z0-9_-]+)\/view(\?.+)?/,embedUrl:"https://drive.google.com/file/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 25rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},docsPublic:{regex:/https:\/\/docs\.google\.com\/document\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/document/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},sheetsPublic:{regex:/https:\/\/docs\.google\.com\/spreadsheets\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/spreadsheets/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},slidesPublic:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0;' frameborder='0' allowfullscreen='true'></iframe>"},codesandbox:{regex:/^https:\/\/codesandbox\.io\/(?:embed\/)?([A-Za-z0-9_-]+)(?:\?[^\/]*)?$/,embedUrl:"https://codesandbox.io/embed/<%= remote_id %>?view=editor+%2B+preview&module=%2Findex.html",html:"<iframe style='width: 100%; height: 500px; border: 0; border-radius: 4px; overflow: hidden;' sandbox='allow-mods allow-forms allow-popups allow-scripts allow-same-origin' frameborder='0' allowfullscreen='true'></iframe>"}}}},folder:{class:Oe,config:{placeholder:"Add a folder with files",uploadEndpoint:"/api/upload-folder",renderFiles:c=>c.map(e=>`<a href="${e.url}" download>${e.name}</a>`).join("<br>")}}}}function yt(c){const e={ves:"fe",ies:"y",i:"us",zes:"ze",ses:"s",es:"e",s:""};return c.replace(new RegExp(`(${Object.keys(e).join("|")})$`),t=>e[t])}export{Yt as C,dt as F,ls as T,pa as _,An as a,Nr as b,en as c,ht as d,ss as e,Gr as f,Xr as g,Pr as h,Zt as i,ca as j,Ya as k,Cn as l,Re as t,Wr as u};
//# sourceMappingURL=index-BTqjjO0a.js.map
