{"version":3,"file":"call-DjkLykxt.js","sources":["../../../../frontend/node_modules/frappe-ui/src/utils/call.js"],"sourcesContent":["export default async function call(method, args, options = {}) {\n  if (!args) {\n    args = {}\n  }\n\n  let headers = Object.assign(\n    {\n      Accept: 'application/json',\n      'Content-Type': 'application/json; charset=utf-8',\n      'X-Frappe-Site-Name': window.location.hostname,\n    },\n    options.headers || {},\n  )\n\n  if (window.csrf_token && window.csrf_token !== '{{ csrf_token }}') {\n    headers['X-Frappe-CSRF-Token'] = window.csrf_token\n  }\n\n  let path = method.startsWith('/') ? method : `/api/method/${method}`\n  const res = await fetch(path, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify(args),\n  })\n\n  if (res.ok) {\n    const data = await res.json()\n    if (data.docs || method === 'login') {\n      return data\n    }\n    if (data.exc) {\n      try {\n        console.groupCollapsed(method)\n        console.log(`method: ${method}`)\n        console.log(`params:`, args)\n        let warning = JSON.parse(data.exc)\n        for (let text of warning) {\n          console.log(text)\n        }\n        console.groupEnd()\n      } catch (e) {\n        console.warn('Error printing debug messages', e)\n      }\n    }\n    return data.message\n  } else {\n    let response = await res.text()\n    let error, exception\n    try {\n      error = JSON.parse(response)\n      // eslint-disable-next-line no-empty\n    } catch (e) {}\n    let errorParts = [\n      [method, error.exc_type, error._error_message].filter(Boolean).join(' '),\n    ]\n    if (error.exc) {\n      exception = error.exc\n      try {\n        exception = JSON.parse(exception)[0]\n        console.log(exception)\n        // eslint-disable-next-line no-empty\n      } catch (e) {}\n    }\n    let e = new Error(errorParts.join('\\n'))\n    e.exc_type = error.exc_type\n    e.exc = exception\n    e.status = res.status\n    e.messages = error._server_messages\n      ? JSON.parse(error._server_messages)\n      : []\n    e.messages = e.messages.concat(error.message)\n    e.messages = e.messages.map((m) => {\n      try {\n        return JSON.parse(m).message\n      } catch (error) {\n        return m\n      }\n    })\n    e.messages = e.messages.filter(Boolean)\n    if (!e.messages.length) {\n      e.messages = error._error_message\n        ? [error._error_message]\n        : ['Internal Server Error']\n    }\n\n    if (options.onError) {\n      options.onError({ response: res, status: res.status, error: e })\n    }\n\n    throw e\n  }\n}\n\nexport function createCall(options) {\n  return function customCall(method, args) {\n    return call(method, args, options)\n  }\n}\n"],"names":["call","_0","_1","__async","method","args","options","headers","path","res","data","warning","text","response","error","exception","e","errorParts","m"],"mappings":"6MAAe,SAAeA,EAAKC,EAAQC,EAAoB,QAAAC,EAAA,yBAA5BC,EAAQC,EAAMC,EAAU,CAAA,EAAI,CACxDD,IACHA,EAAO,CAAA,GAGT,IAAIE,EAAU,OAAO,OACnB,CACE,OAAQ,mBACR,eAAgB,kCAChB,qBAAsB,OAAO,SAAS,QAC5C,EACID,EAAQ,SAAW,CAAA,CACvB,EAEM,OAAO,YAAc,OAAO,aAAe,qBAC7CC,EAAQ,qBAAqB,EAAI,OAAO,YAG1C,IAAIC,EAAOJ,EAAO,WAAW,GAAG,EAAIA,EAAS,eAAeA,CAAM,GAClE,MAAMK,EAAM,MAAM,MAAMD,EAAM,CAC5B,OAAQ,OACR,QAAAD,EACA,KAAM,KAAK,UAAUF,CAAI,CAC7B,CAAG,EAED,GAAII,EAAI,GAAI,CACV,MAAMC,EAAO,MAAMD,EAAI,KAAI,EAC3B,GAAIC,EAAK,MAAQN,IAAW,QAC1B,OAAOM,EAET,GAAIA,EAAK,IACP,GAAI,CACF,QAAQ,eAAeN,CAAM,EAC7B,QAAQ,IAAI,WAAWA,CAAM,EAAE,EAC/B,QAAQ,IAAI,UAAWC,CAAI,EAC3B,IAAIM,EAAU,KAAK,MAAMD,EAAK,GAAG,EACjC,QAASE,KAAQD,EACf,QAAQ,IAAIC,CAAI,EAElB,QAAQ,SAAQ,CAClB,OAAS,EAAG,CACV,QAAQ,KAAK,gCAAiC,CAAC,CACjD,CAEF,OAAOF,EAAK,OACd,KAAO,CACL,IAAIG,EAAW,MAAMJ,EAAI,KAAI,EACzBK,EAAOC,EACX,GAAI,CACFD,EAAQ,KAAK,MAAMD,CAAQ,CAE7B,OAASG,EAAG,CAAC,CACb,IAAIC,EAAa,CACf,CAACb,EAAQU,EAAM,SAAUA,EAAM,cAAc,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,CAC7E,EACI,GAAIA,EAAM,IAAK,CACbC,EAAYD,EAAM,IAClB,GAAI,CACFC,EAAY,KAAK,MAAMA,CAAS,EAAE,CAAC,EACnC,QAAQ,IAAIA,CAAS,CAEvB,OAASC,EAAG,CAAC,CACf,CACA,IAAIA,EAAI,IAAI,MAAMC,EAAW,KAAK;AAAA,CAAI,CAAC,EACvC,MAAAD,EAAE,SAAWF,EAAM,SACnBE,EAAE,IAAMD,EACRC,EAAE,OAASP,EAAI,OACfO,EAAE,SAAWF,EAAM,iBACf,KAAK,MAAMA,EAAM,gBAAgB,EACjC,CAAA,EACJE,EAAE,SAAWA,EAAE,SAAS,OAAOF,EAAM,OAAO,EAC5CE,EAAE,SAAWA,EAAE,SAAS,IAAKE,GAAM,CACjC,GAAI,CACF,OAAO,KAAK,MAAMA,CAAC,EAAE,OACvB,OAASJ,EAAO,CACd,OAAOI,CACT,CACF,CAAC,EACDF,EAAE,SAAWA,EAAE,SAAS,OAAO,OAAO,EACjCA,EAAE,SAAS,SACdA,EAAE,SAAWF,EAAM,eACf,CAACA,EAAM,cAAc,EACrB,CAAC,uBAAuB,GAG1BR,EAAQ,SACVA,EAAQ,QAAQ,CAAE,SAAUG,EAAK,OAAQA,EAAI,OAAQ,MAAOO,CAAC,CAAE,EAG3DA,CACR,CACF","x_google_ignoreList":[0]}