var N=(_,f,l)=>new Promise((g,i)=>{var d=p=>{try{u(l.next(p))}catch(h){i(h)}},t=p=>{try{u(l.throw(p))}catch(h){i(h)}},u=p=>p.done?g(p.value):Promise.resolve(p.value).then(d,t);u((l=l.apply(_,f)).next())});import{r as G,n as U,g as w,o as m,e as n,x as O,i as R,m as X,$ as Y,c as L,ac as J,l as D,a2 as F,d as y,f as a,h as E,j as c,w as k,A as $,t as r,_ as S,p as W,v as Z,F as I,k as j}from"./index-BxfdauWF.js";import{_ as ee}from"./Badge.vue_vue_type_script_setup_true_lang-C08gucxE.js";import{_ as se}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-D--Gg2lu.js";import{a as V}from"./plus-DiqLtgoR.js";import{_ as te,s as B,d as oe}from"./index-hJJZ99sN.js";import{C as ae}from"./check-1-OLoX8c.js";import{X as ne}from"./Link-yxEDdXjU.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CszXfVPg.js";import"./pencil-zwFRmt2n.js";import"./FolderPlugin.vue_vue_type_style_index_0_scoped_84b7d54d_lang-bD12IzvZ.js";import"./book-open-check-B_dkhHVj.js";const ie={__name:"ExamQuestionEditor",props:{questionId:{type:String,required:!0},content:{type:String,default:""},editable:{type:Boolean,default:!0}},emits:["change"],setup(_,{emit:f}){const l=_,g=f;console.log("Props:",l);const i=G(l.content);U(()=>l.content,(t,u)=>{t!==u&&(i.value=t)});const d=t=>{i.value=t,g("change",t)};return(t,u)=>(m(),w(n(te),{content:i.value,key:_.questionId,editable:_.editable,fixedMenu:!0,label:`Comment for Question ${_.questionId}`,editorClass:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none",onChange:d},null,8,["content","editable","label"]))}},re={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},de={class:"space-x-2"},le={class:"flex items-center justify-between mb-5"},ce={class:"w-1/3"},ue={for:"submissionDropdown",class:"block text-sm font-medium text-gray-700"},me=["value"],pe={key:0,class:"w-2/3 mx-auto py-5 space-y-5"},_e={class:"grid grid-cols-3 gap-5"},be={class:"col-span-2 space-y-4"},fe={class:"text-xl font-semibold text-ink-gray-9"},ge={class:"space-y-4 border p-5 rounded-md"},ve={class:"flex items-center justify-between py-4"},ye={class:"text-center ml-5"},he={class:"text-3xl font-bold text-ink-gray-9"},xe={class:"text-center"},ke={class:"text-3xl font-semibold text-ink-gray-9"},Se={class:"text-sm text-ink-gray-5"},Ce={class:"text-center mr-5"},Ne={class:"text-3xl font-semibold text-ink-gray-9 mt-2"},$e={class:"space-y-1"},we={class:"font-semibold text-ink-gray-9"},De=["innerHTML"],Ee={class:"leading-5 text-ink-gray-7 space-x-1"},Ie=["innerHTML"],Ve={class:"flex items-center justify-end space-x-5"},Pe={class:"flex items-center space-x-2"},qe={class:"flex items-center space-x-2"},Me={class:"text-sm text-ink-gray-7"},Te={class:"col-span-1 space-y-4"},Le={class:"space-y-4 border p-5 rounded-md"},Fe={class:"space-y-4 border p-5 rounded-md"},Ye={__name:"ExamSubmission",props:{submission:{type:String,required:!0},courseName:{type:String,required:!0},examID:{type:String,required:!0}},setup(_){const f=O(),l=R("$user");X(()=>{var e,s;!((e=l.data)!=null&&e.is_instructor)&&!((s=l.data)!=null&&s.is_moderator)&&f.push({name:"Courses"}),window.addEventListener("keydown",g),console.log("Keyboard shortcut listener added")}),Y(()=>{window.removeEventListener("keydown",g),console.log("Keyboard shortcut listener removed")});const g=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(M(),e.preventDefault())},i=_,d=L({url:"frappe.client.get_list",params:{doctype:"Exam Submission",filters:[["exam","=",i.examID],["course","=",i.courseName]],fields:["name","member_name"],order_by:"member_name asc"},auto:!0});console.log("Submission List:",d);const t=J({doctype:"Exam Submission",name:i.submission,auto:!0}),u=L({url:"seminary.seminary.utils.get_course_details",cache:["course",i.courseName],params:{course:i.courseName},auto:!0}),p=D(()=>{var s;let e=[{label:"Courses",route:{name:"Courses"}}];return e.push({label:(s=u==null?void 0:u.data)==null?void 0:s.course,route:{name:"CourseDetail",params:{courseName:i.courseName}}}),e.push({label:"Gradebook",route:{name:"Gradebook",params:{courseName:i.courseName}}}),e.push({label:"Exam Submissions",route:{name:"ExamSubmissionCS",params:{courseName:i.courseName,examID:i.examID}}}),e}),h=e=>{if(!e)return"00:00:00";const s=Math.floor(e/3600).toString().padStart(2,"0"),o=Math.floor(e%3600/60).toString().padStart(2,"0"),v=(e%60).toString().padStart(2,"0");return`${s}:${o}:${v}`},P=(e,s)=>{e.points=s,e.graded=!0},q=()=>{const e=(t.doc.result||[]).reduce((b,z)=>b+Number(z.points||0),0);t.doc.score=e;const s=parseFloat(t.doc.score_out_of)||1,o=parseFloat(t.doc.fudge_points)||0,v=e/s*100+o;t.doc.percentage=parseFloat(v.toFixed(2))};D(()=>t.doc.result?t.doc.result.map(e=>e.points):[]),F(()=>{t.doc&&t.doc.result&&q()}),F(()=>{t.doc&&typeof t.doc.fudge_points!="undefined"&&q()});const Q=(e,s)=>{e.comments=s},A=()=>N(this,null,function*(){const e=t.doc.result.map((s,o)=>s.graded?null:`Question ${o+1}`).filter(s=>s!==null);if(e.length>0){if(!confirm(`The following questions need grading: ${e.join(", ")}. Do you want to save anyway?`))return}else t.doc.status="Graded";yield M()}),H=(e,s)=>{e.graded=!0,console.log(`Updated Points for Question: ${e.points}`)},M=()=>N(this,null,function*(){var e;try{console.log("Saving submission:",t.doc),yield t.save.submit(),B(__("Success"),__("Submission saved successfully"),"check")}catch(s){console.error("Error saving submission:",s),B(__("Error"),__(((e=s.messages)==null?void 0:e[0])||"An error occurred while saving"),"x")}}),x=G(i.submission),C=D(()=>{var e;return(e=d.data)==null?void 0:e.findIndex(s=>s.name===x.value)}),T=e=>{if(e>=0&&e<d.data.length){const s=d.data[e];f.push({name:"ExamSubmission",params:{submission:s.name,courseName:i.courseName,examID:i.examID}})}},K=e=>{const s=d.data.find(o=>o.name===e);s&&f.push({name:"ExamSubmission",params:{submission:s.name,courseName:i.courseName,examID:i.examID}})};return U(x,e=>N(this,null,function*(){e&&(console.log("Navigating to submission:",e),t.name=e,yield t.reload())})),(e,s)=>(m(),y(I,null,[a("header",re,[n(t).doc?(m(),w(n(se),{key:0,items:p.value},null,8,["items"])):E("",!0),a("div",de,[n(t).isDirty?(m(),w(n(ee),{key:0,label:e.__("Not Saved"),variant:"subtle",theme:"orange"},null,8,["label"])):E("",!0),c(n(S),{variant:"solid",onClick:s[0]||(s[0]=o=>A())},{default:k(()=>[$(r(e.__("Save")),1)]),_:1})])]),a("div",le,[c(n(S),{variant:"subtle",disabled:C.value===0,onClick:s[1]||(s[1]=o=>T(C.value-1))},{default:k(()=>[$(r(e.__("Previous")),1)]),_:1},8,["disabled"]),a("div",ce,[a("label",ue,r(e.__("Select Submission")),1),W(a("select",{id:"submissionDropdown","onUpdate:modelValue":s[2]||(s[2]=o=>x.value=o),onChange:s[3]||(s[3]=o=>K(x.value)),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[(m(!0),y(I,null,j(n(d).data,o=>(m(),y("option",{key:o.name,value:o.name},r(o.member_name),9,me))),128))],544),[[Z,x.value]])]),c(n(S),{variant:"subtle",disabled:!n(d).data||C.value===n(d).data.length-1,onClick:s[4]||(s[4]=o=>T(C.value+1))},{default:k(()=>[$(r(e.__("Next")),1)]),_:1},8,["disabled"])]),n(t).doc?(m(),y("div",pe,[a("div",_e,[a("div",be,[a("div",fe,r(n(t).doc.member_name),1),a("div",ge,[a("div",ve,[a("div",ye,[a("div",he,r(n(t).doc.percentage||0)+"% ",1),s[7]||(s[7]=a("div",{class:"text-sm text-ink-gray-5"}," Score ",-1))]),a("div",xe,[a("div",ke,r(n(t).doc.score),1),a("div",Se," Out of "+r(n(t).doc.score_out_of)+" Points ",1)]),a("div",Ce,[a("div",Ne,r(h(n(t).doc.time_taken)),1),s[8]||(s[8]=a("div",{class:"text-sm text-ink-gray-5"}," Time taken ",-1))])])]),(m(!0),y(I,null,j(n(t).doc.result,(o,v)=>(m(),y("div",{key:v,class:"border p-5 rounded-md space-y-4"},[$(r(console.log(o))+" ",1),a("div",$e,[a("div",we,r(e.__("Question"))+" "+r(v+1)+": ",1),a("div",{class:"leading-5 text-ink-gray-9",innerHTML:o.question_name},null,8,De)]),a("div",Ee,[a("span",null,r(e.__("Your Answer"))+": ",1),a("span",{innerHTML:o.answer},null,8,Ie)]),a("div",Ve,[a("div",Pe,[c(n(S),{variant:"solid",theme:"green",size:"sm",onClick:b=>P(o,o.points_out_of)},{default:k(()=>[c(n(ae),{class:"w-4 h-4"})]),_:1},8,["onClick"]),c(n(S),{variant:"solid",theme:"red",size:"sm",onClick:b=>P(o,0)},{default:k(()=>[c(n(ne),{class:"w-4 h-4"})]),_:1},8,["onClick"])]),a("div",qe,[c(n(V),{modelValue:o.points,"onUpdate:modelValue":b=>o.points=b,type:"number",class:"w-20 text-right",onChange:b=>H(o)},null,8,["modelValue","onUpdate:modelValue","onChange"]),a("span",Me," / "+r(parseInt(o.points_out_of,10))+" "+r(e.__("Points")),1)])]),c(ie,{questionId:o.name,content:o.comments,editable:!0,onChange:b=>Q(o,b),"<!--":"",Pass:"",the:"",updated:"",value:"","--":""},null,8,["questionId","content","onChange"])]))),128))]),a("div",Te,[a("div",Le,[c(n(V),{modelValue:n(t).doc.fudge_points,"onUpdate:modelValue":s[5]||(s[5]=o=>n(t).doc.fudge_points=o),label:e.__("Fudge Points"),disabled:!1},null,8,["modelValue","label"]),c(n(V),{modelValue:n(t).doc.status,"onUpdate:modelValue":s[6]||(s[6]=o=>n(t).doc.status=o),label:e.__("Status"),type:"select",options:[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"}],disabled:!1},null,8,["modelValue","label"])]),a("div",Fe,[(m(),w(oe,{title:"Exam Comments",doctype:"Exam Submission",docname:n(t).doc.name,key:n(t).doc.name,type:"single"},null,8,["docname"]))])])])])):E("",!0)],64))}};export{Ye as default};
//# sourceMappingURL=ExamSubmission-T5wHGb9d.js.map
