import{bk as M,r as g,c as i,av as P,I as x,am as D,a8 as q,t as l,b as r,g as o,D as u,z as p,H as f,O as y,e as T,u as U,bQ as O,L,aR as N,a as $,w as H,m as J,bJ as Q}from"./vendor-CA0oFrry.js";import{c as j}from"./frappe-ui-BC6vlBMo.js";import{u as G}from"./index-aYBfEZmz.js";import{u as z,C as K}from"./CourseCardToDo-CFTKXeja.js";const W={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},X={class:"flex items-center"},Y={class:"text-xl font-semibold text-ink-gray-9"},Z={class:"p-5 flex flex-row gap-4 w-full mx-auto"},ee={class:"w-1/4 p-4"},te={key:0},se={class:"text-md font-medium mb-2"},oe={key:0},ae={key:0,class:"text-xl text-center font-semibold text-gray-500 mt-5"},re={key:1,class:"text-xl text-center font-semibold text-gray-500 mt-5"},le={class:"w-3/4"},ne={class:"flex gap-4 mb-5"},ce=["value"],ie=["value"],ue={key:0,class:"flex flex-wrap justify-start gap-4"},me={class:"p-4 text-container"},de={class:"text-2xl font-semibold"},fe={class:"short-introduction text-ink-gray-7 text-sm"},_e={class:"academic-term text-right mt-auto"},ve={key:1,class:"flex flex-col items-center justify-center text-sm text-ink-gray-5 italic mt-48"},ke={__name:"Courses",setup(ge){var S;const c=M("$user");g(0);const{userResource:w}=G();console.log("User from inject:",c),console.log("User data:",c.data),console.log("User resource:",w),console.log("User resource data:",w.data);const m=i(()=>{var e;return((e=c.data)==null?void 0:e.is_student)||!1});i(()=>{var e;return((e=c.data)==null?void 0:e.is_moderator)||!1});const A=i(()=>{var e;return((e=c.data)==null?void 0:e.is_instructor)||!1});i(()=>{var e;return((e=c.data)==null?void 0:e.is_system_manager)||!1});const h=g(""),k=j({url:"frappe.client.get_value",params:{doctype:"Academic Term",fieldname:"title",filters:{iscurrent_acterm:1}},auto:!0,onSuccess:e=>{e!=null&&e.title?(h.value=e.title,console.log("Current Academic Term on success:",e.title),console.log("isStudent:",m.value)):console.log("Current Academic Term: undefined")}});P(()=>{k.reload()}),x(()=>k.data,e=>{e!=null&&e.title?h.value=e.title:console.log("Current Academic Term: undefined")},{immediate:!0}),x(()=>h.value,e=>{e&&(n.academic_term=e,console.log("Updated filters.academic_term:",n.academic_term))});const n=D({course:"",academic_term:((S=k.data)==null?void 0:S.title)||""});console.log(n.academic_term);const B=i(()=>m.value?"seminary.seminary.utils.get_courses_for_student":"seminary.seminary.utils.get_courses"),V=i(()=>{var e;return m.value?{student:(e=c.data)==null?void 0:e.name}:{}}),b=j({url:B.value,params:V.value,onSuccess:e=>{console.log("Courses data:",e),R.rows=e.sort((t,a)=>t.academic_term<a.academic_term?-1:t.academic_term>a.academic_term?1:t.course<a.course?-1:t.course>a.course?1:0)},auto:!0}),R=D({rows:[],columns:[{label:"Name",key:"name",width:1},{label:"Course",key:"course",width:1},{label:"Academic Term",key:"academic_term",width:1},{label:"Start Date",key:"c_datestart",width:1},{label:"End Date",key:"c_dateend",width:1},{label:"Image",key:"course_image",width:1}]}),E=i(()=>{var e;return[...new Set((e=b.data)==null?void 0:e.map(t=>t.course))]}),F=i(()=>{var e;return[...new Set((e=b.data)==null?void 0:e.map(t=>t.academic_term))]}),_=i(()=>{var e;return((e=b.data)==null?void 0:e.filter(t=>(!n.course||t.course===n.course)&&(!n.academic_term||t.academic_term===n.academic_term)))||[]}),v=g({}),d=g([]);x(_,e=>{if(!e)return;const t=[];e.forEach(a=>{v.value[a.name]||(v.value[a.name]=z(a.name,c),console.log("Created instance for course:",a.name,v.value[a.name]));const s=v.value[a.name],C=s.countToDoItems;console.log("Starting if statement with count:",C,"for todoInstance:",s),s&&C>0&&t.push({course:a,count:C})}),console.log("List: ",t),d.value=t,console.log("Updated courseToDoList:",d.value)});let I=!0;return x(()=>_,e=>{if(I){I=!1;return}Array.isArray(e)||(console.error("newFilteredCourses is not an array:",e),e=[]);const t=e.map(a=>{const s=z(a.name,c);return{course:a,count:s.countToDoItems.value,hasItems:s.countToDoItems.value>0}}).filter(a=>a.hasItems);d.value=t,console.log("Updated courseToDoList:",d.value)},{immediate:!0}),(e,t)=>{const a=q("router-link");return r(),l(f,null,[o("header",W,[o("div",X,[o("h1",Y,u(m.value?"My Courses":"All Courses"),1)])]),o("div",Z,[o("div",ee,[t[2]||(t[2]=o("h2",{class:"text-lg font-semibold mb-4"},"To Do",-1)),m.value||A.value?(r(),l("div",te,[(r(!0),l(f,null,y(d.value,s=>(r(),l("div",{key:s.course.name},[o("h3",se,u(s.course.name),1),T(K,{course:s.course.name,singleCourse:!1},null,8,["course"])]))),128)),d.value.length===0?(r(),l("div",oe,[T(U(O),{class:"size-20 mx-auto stroke-1 text-gray-500 mt-5"}),m.value?(r(),l("h3",ae," Congrats! No assessments to do!")):p("",!0),A.value?(r(),l("h3",re," Congrats! No assessments to grade!")):p("",!0)])):p("",!0)])):p("",!0)]),o("div",le,[o("div",ne,[o("div",null,[t[4]||(t[4]=o("label",{for:"courseFilter",class:"block text-sm font-medium text-gray-700"},"Course",-1)),L(o("select",{id:"courseFilter","onUpdate:modelValue":t[0]||(t[0]=s=>n.course=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[t[3]||(t[3]=o("option",{value:""},"All Courses",-1)),(r(!0),l(f,null,y(E.value,s=>(r(),l("option",{key:s,value:s},u(s),9,ce))),128))],512),[[N,n.course]])]),o("div",null,[t[6]||(t[6]=o("label",{for:"academicTermFilter",class:"block text-sm font-medium text-gray-700"},"Academic Term",-1)),L(o("select",{id:"academicTermFilter","onUpdate:modelValue":t[1]||(t[1]=s=>n.academic_term=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[t[5]||(t[5]=o("option",{value:""},"All Terms",-1)),(r(!0),l(f,null,y(F.value,s=>(r(),l("option",{key:s,value:s},u(s),9,ie))),128))],512),[[N,n.academic_term]])])]),_.value.length?(r(),l("div",ue,[(r(!0),l(f,null,y(_.value,s=>(r(),$(a,{to:{name:"CourseDetail",params:{courseName:s.name}},key:s.name,class:"course_card"},{default:H(()=>[o("div",{class:"course-image",style:J({backgroundImage:`url(${encodeURI(s.course_image)})`})},null,4),o("div",me,[o("h3",de,u(s.course),1),o("div",fe,u(s.short_introduction),1),o("div",_e,u(s.academic_term),1)])]),_:2},1032,["to"]))),128))])):(r(),l("div",ve,[T(U(Q),{class:"size-10 mx-auto stroke-1 text-ink-gray-4"}),t[7]||(t[7]=o("div",{class:"text-2xl font-medium mb-1"},[o("span",null,"No courses found")],-1))]))])])],64)}}};export{ke as default};
//# sourceMappingURL=Courses-Cxl4xXuA.js.map
