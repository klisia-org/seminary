var K=(b,f,x)=>new Promise((g,D)=>{var l=d=>{try{s(x.next(d))}catch(V){D(V)}},_=d=>{try{s(x.throw(d))}catch(V){D(V)}},s=d=>d.done?g(d.value):Promise.resolve(d.value).then(l,_);s((x=x.apply(b,f)).next())});import{U as oe,V as Z,am as le,I as ee,c as ne,a as v,b as r,w as y,g as p,e as m,t as h,z as k,u as a,C as Y,D as w,c2 as re,c0 as ie,bV as ce,F as ue,bk as de,r as G,a8 as pe,n as Q,H as W,O as te,c3 as me,b_ as _e,c4 as he,S as O,bW as ae,c5 as ge,c6 as fe,c7 as ke,bT as ye,bU as ve,c8 as be,c9 as Ce,ca as we,cb as xe}from"./vendor-CrP-kEM1.js";import{c as T,w as De,A as Ee,z as Ne,q as J,D as Se,t as N,b as X}from"./frappe-ui-Qp90XKmJ.js";import{h as Ve}from"./index-C61emWxo.js";import{c as $e,a as se}from"./index--sl_9lWu.js";import{u as Oe}from"./settings-dD7H0cID.js";const Te={class:"chapter-dialog space-y-4 text-base max-h-[70vh] overflow-y-auto"},Fe={key:0},ze={class:"mb-4"},Le={key:1,class:""},Me={class:"flex items-center"},Re={class:"border rounded-md p-2 mr-2"},Pe={class:"flex flex-col"},Ue={class:"text-sm text-ink-gray-4 mt-1"},Ae={__name:"ChapterModal",props:oe({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(b){const f=Z(b,"modelValue"),x=Z(b,"outline");Oe();const g=b,D=()=>({chapter_title:"",is_scorm_package:0,scorm_package:null}),l=le(D()),_=()=>{Object.assign(l,D())},s=T({url:"seminary.seminary.api.upsert_chapter",makeParams(t){var n;return{chapter_title:l.chapter_title,course:g.course,is_scorm_package:l.is_scorm_package,scorm_package:l.scorm_package,name:(n=g.chapterDetail)==null?void 0:n.name}}}),d=T({url:"frappe.client.insert",makeParams(t){return{doc:{doctype:"Course Schedule Chapter Reference",chapter:t.name,parent:g.course,parenttype:"Course Schedule",parentfield:"chapters"}}}}),V=t=>K(this,null,function*(){s.submit({},{validate(){return A()},onSuccess:n=>{$e("chapter_created"),d.submit({name:n.name},{onSuccess(){_(),x.value.reload(),N.success(__("Chapter added successfully")),f.value=!1,t()},onError(u){var $;N.error((($=u.messages)==null?void 0:$[0])||u)}})},onError(n){var u;N.error(((u=n.messages)==null?void 0:u[0])||n)}})}),A=()=>{if(!l.chapter_title)return __("Chapter Title is required");if(l.is_scorm_package&&!l.scorm_package)return __("Please upload a SCORM package or uncheck the SCORM package option")},B=t=>{s.submit({},{validate(){if(!l.chapter_title)return"Chapter Title is required"},onSuccess(){f.value=!1,_(),x.value.reload(),N.success(__("Chapter updated successfully")),t()},onError(n){var u;N.error(((u=n.messages)==null?void 0:u[0])||n)}})},R=t=>{if(!t){_();return}l.chapter_title=t.chapter_title||"",l.is_scorm_package=t.is_scorm_package||0,l.scorm_package=t.scorm_package||null},P=()=>{g.chapterDetail?R(g.chapterDetail):_()},q=t=>{f.value=!1,_(),t==null||t()};ee(f,t=>{t?P():_()}),ee(()=>g.chapterDetail,t=>{f.value&&R(t)});const I=t=>{if(t.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")},j=ne(()=>({title:g.chapterDetail?__("Edit Chapter"):__("Add Chapter"),size:"lg",actions:[{label:g.chapterDetail?__("Edit"):__("Create"),variant:"solid",onClick:t=>g.chapterDetail?B(t):V(t)},{label:__("Cancel"),variant:"text",onClick:t=>q(t)}]}));return(t,n)=>(r(),v(a(Se),{modelValue:f.value,"onUpdate:modelValue":n[4]||(n[4]=u=>f.value=u),options:j.value,disableOutsideClickToClose:!0},{"body-content":y(()=>[p("div",Te,[m(a(De),{label:"Title",modelValue:l.chapter_title,"onUpdate:modelValue":n[0]||(n[0]=u=>l.chapter_title=u),required:!0},null,8,["modelValue"]),m(a(Ee),{size:"sm",label:t.__("SCORM Package"),description:t.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:l.is_scorm_package,"onUpdate:modelValue":n[1]||(n[1]=u=>l.is_scorm_package=u)},null,8,["label","description","modelValue"]),l.is_scorm_package?(r(),h("div",Fe,[l.scorm_package?(r(),h("div",Le,[p("div",Me,[p("div",Re,[m(a(re),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),p("div",Pe,[p("span",null,w(l.scorm_package.file_name),1),p("span",Ue,w(a(Ve)(l.scorm_package.file_size)),1)]),m(a(ie),{onClick:n[3]||(n[3]=()=>l.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(r(),v(a(Ne),{key:0,fileTypes:[".zip"],validateFile:I,onSuccess:n[2]||(n[2]=u=>l.scorm_package=u)},{default:y(({file:u,progress:$,uploading:M,openFileSelector:H})=>[p("div",ze,[m(a(J),{onClick:H,loading:M},{default:y(()=>[Y(w(M?`Uploading ${$}%`:"Upload an zip file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):k("",!0)])]),_:1},8,["modelValue","options"]))}},Be={class:"text-base"},qe={class:"grid grid-cols-[70%,30%] mb-4 px-2"},Ie=["onClick"],je={key:0,class:"ml-auto flex space-x-4"},He=["onDrop"],Ge=["draggable","onDragstart"],Qe={class:"flex items-start gap-3"},We={key:0},Xe=["onClick"],Ye={class:"flex flex-col items-start gap-2 text-sm leading-5"},Je={class:"flex items-center gap-2"},Ke={key:0,class:"w-full rounded-md bg-[#E6F4FF] p-2"},Ze={key:1,class:"rounded-md bg-[#E6F7F4] p-2"},et={key:1,class:"ml-auto hidden items-center group-hover:flex"},tt=["onDrop"],at={key:0},st={key:1},rt={key:1,class:"flex mt-2 mb-4 pl-8"},dt={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1}},setup(b){const f=ce(),x=ue(),g=de("$user"),D=G(!1),l=G(null),_=G(null),s=b,d=T({url:"seminary.seminary.utils.get_course_outline",cache:["course_outline",s.courseName],params:{course:s.courseName,progress:s.getProgress},auto:!0});T({url:"seminary.seminary.utils.get_course_title",cache:["course_title",s.courseName],params:{course:s.courseName},auto:!0});const V=T({url:"seminary.seminary.api.delete_lesson",makeParams(e){return{lesson:e.lesson,chapter:e.chapter}},onSuccess(){d.reload(),N.success(__("Lesson deleted successfully"))}}),A=T({url:"seminary.seminary.api.update_lesson_index",makeParams(e){return{lesson:e.lesson,source_chapter:e.sourceChapter,target_chapter:e.targetChapter,idx:parseInt(e.idx,10)}},onSuccess(){d.reload(),N.success(__("Lesson moved successfully"))}}),B=(e,c)=>{se({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(C){V.submit({lesson:e,chapter:c}),C()}}]})},R=e=>e==f.params.chapterNumber||e==1,P=(e=null)=>{s.allowEdit&&(l.value=e,D.value=!0)},q=()=>l.value,I=T({url:"seminary.seminary.api.delete_chapter",makeParams(e){return{chapter:e.chapter}},onSuccess(){d.reload(),N.success(__("Chapter deleted successfully"))}}),j=e=>{s.allowEdit&&se({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(c){I.submit({chapter:e}),c()}}]})},t=e=>{if(e.is_scorm_package&&(event.preventDefault(),!s.allowEdit)){if(!g.data){N.warning(__("You are not enrolled"),__("Please enroll for this course to view this lesson"));return}x.push({name:"SCORMChapter",params:{courseName:s.courseName,chapterName:e.name}})}},n=e=>f.params.chapterNumber==e.split(".")[0]&&f.params.lessonNumber==e.split(".")[1],u=(e,c,C,F)=>{s.allowEdit&&(e!=null&&e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",C.name)),_.value={lessonName:C.name,sourceChapter:c.name,sourceIndex:F})},$=e=>{!s.allowEdit||!_.value||e!=null&&e.dataTransfer&&(e.dataTransfer.dropEffect="move")},M=(e,c,C)=>{var S;if(!s.allowEdit||!_.value)return;(S=e==null?void 0:e.preventDefault)==null||S.call(e);const{lessonName:F,sourceChapter:o,sourceIndex:U}=_.value,z=c.name;let E=C;if(o===z&&C>U&&(E=C-1),o===z&&E===U){_.value=null;return}const i=E+1;A.submit({lesson:F,sourceChapter:o,targetChapter:z,idx:i}),_.value=null},H=()=>{_.value=null};return(e,c)=>{var F;const C=pe("router-link");return r(),h(W,null,[p("div",Be,[p("div",qe,[c[5]||(c[5]=p("div",{class:"font-semibold text-lg leading-5 text-ink-gray-9"},null,-1)),s.allowEdit?(r(),v(a(J),{key:0,size:"sm",onClick:c[0]||(c[0]=o=>P())},{default:y(()=>[Y(w(e.__("Add Chapter")),1)]),_:1})):k("",!0)]),p("div",{class:Q({"border-2 rounded-md py-2 px-2":b.showOutline&&((F=a(d).data)==null?void 0:F.length)})},[(r(!0),h(W,null,te(a(d).data,(o,U)=>(r(),v(a(we),{key:o.name,defaultOpen:R(o.idx)},{default:y(({open:z})=>[m(a(me),{ref_for:!0,ref:"",class:"flex w-full items-center p-2 group"},{default:y(()=>[m(a(_e),{class:Q([{"rotate-90 transform duration-200":z,"duration-200":!z,hidden:o.is_scorm_package,open:U==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),p("div",{class:"ml-2 text-left text-base font-medium leading-5 text-ink-gray-9",onClick:E=>t(o)},w(o.chapter_title),9,Ie),s.allowEdit?(r(),h("div",je,[m(a(X),{text:e.__("Edit Chapter"),placement:"bottom"},{default:y(()=>[m(a(he),{onClick:O(E=>P(o),["prevent"]),class:"h-4 w-4 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])]),_:2},1032,["text"]),m(a(X),{text:e.__("Delete Chapter"),placement:"bottom"},{default:y(()=>[m(a(ae),{onClick:O(E=>j(o.name),["prevent"]),class:"h-4 w-4 text-red-500 invisible group-hover:visible"},null,8,["onClick"])]),_:2},1032,["text"])])):k("",!0)]),_:2},1536),o.is_scorm_package?k("",!0):(r(),v(a(ge),{key:0},{default:y(()=>{var E;return[(r(!0),h(W,null,te(o.lessons,(i,S)=>(r(),h("div",{key:i.name,class:"lesson-wrapper"},[s.allowEdit?(r(),h("div",{key:0,class:"ml-8 mr-4 h-3 rounded border border-dashed border-outline-gray-3 transition hover:border-outline-gray-4",onDragover:c[1]||(c[1]=O(L=>$(L),["prevent"])),onDrop:O(L=>M(L,o,S),["prevent"])},null,40,He)):k("",!0),p("div",{class:Q(["group ml-8 mr-4 rounded-lg border border-outline-gray-2 bg-white p-4 transition hover:border-outline-gray-3",{"bg-surface-selected":n(i.number),"cursor-grab":s.allowEdit}]),draggable:s.allowEdit,onDragstart:L=>u(L,o,i,S),onDragend:H},[p("div",Qe,[s.allowEdit?(r(),h("div",We,[m(a(X),{text:e.__("Delete Lesson"),placement:"bottom"},{default:y(()=>[p("button",{type:"button",class:"rounded-md p-1 text-red-500 opacity-0 transition-opacity group-hover:opacity-100 hover:bg-red-50",onClick:O(L=>B(i.name,o.name),["prevent"])},[m(a(ae),{class:"h-4 w-4"})],8,Xe)]),_:2},1032,["text"])])):k("",!0),m(C,{class:"flex-1",to:{name:"Lesson",params:{courseName:b.courseName,chapterNumber:i.number.split(".")[0],lessonNumber:i.number.split(".")[1]}}},{default:y(()=>[p("div",Ye,[p("div",Je,[i.icon==="icon-youtube"?(r(),v(a(fe),{key:0,class:"h-4 w-4 stroke-1"})):i.icon==="icon-quiz"?(r(),v(a(ke),{key:1,class:"h-4 w-4 stroke-1"})):i.icon==="icon-exam"?(r(),v(a(ye),{key:2,class:"h-4 w-4 stroke-1"})):i.icon==="icon-assignment"?(r(),v(a(ve),{key:3,class:"h-4 w-4 stroke-1"})):(r(),v(a(re),{key:4,class:"h-4 w-4 text-ink-gray-7 stroke-1"})),p("span",null,w(i.lesson_title),1),i.is_complete?(r(),v(a(be),{key:5,class:"h-4 w-4 text-green-700"})):k("",!0)]),i.preview?(r(),h("div",Ke,w(i.preview),1)):k("",!0),i.due_date?(r(),h("div",Ze,w(e.__("Due: ")+new Intl.DateTimeFormat(a(g).data.language||"en-US",{dateStyle:"medium"}).format(new Date(i.due_date))),1)):k("",!0)])]),_:2},1032,["to"]),s.allowEdit?(r(),h("div",et,[m(a(Ce),{class:"h-4 w-4 text-ink-gray-5","aria-hidden":"true"})])):k("",!0)])],42,Ge)]))),128)),s.allowEdit?(r(),h("div",{key:0,class:"ml-8 mr-4 mt-2 rounded-md border border-dashed border-outline-gray-3 p-3 text-sm text-ink-gray-5 transition hover:border-outline-gray-4 hover:text-ink-gray-7",onDragover:c[2]||(c[2]=O(i=>$(i),["prevent"])),onDrop:O(i=>{var S;return M(i,o,((S=o.lessons)==null?void 0:S.length)||0)},["prevent"])},[(E=o.lessons)!=null&&E.length?(r(),h("span",at,w(e.__("Drop here to move to the end of this chapter")),1)):(r(),h("span",st,w(e.__("Drop a lesson here to start this chapter")),1))],40,tt)):k("",!0),s.allowEdit?(r(),h("div",rt,[o.is_scorm_package?k("",!0):(r(),v(C,{key:0,to:{name:"LessonForm",params:{courseName:b.courseName,chapterNumber:o.idx,lessonNumber:o.lessons.length+1}}},{default:y(()=>[m(a(J),null,{default:y(()=>[Y(w(e.__("Add Lesson")),1)]),_:1})]),_:1},8,["to"]))])):k("",!0)]}),_:2},1024))]),_:2},1032,["defaultOpen"]))),128))],2)]),m(Ae,{modelValue:D.value,"onUpdate:modelValue":c[3]||(c[3]=o=>D.value=o),outline:a(d),"onUpdate:outline":c[4]||(c[4]=o=>xe(d)?d.value=o:null),course:b.courseName,chapterDetail:q()},null,8,["modelValue","outline","course","chapterDetail"])],64)}}};export{dt as _};
//# sourceMappingURL=CourseOutline-BAJ_RhIv.js.map
