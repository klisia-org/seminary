var ee=(F,H,A)=>new Promise((p,h)=>{var E=m=>{try{k(A.next(m))}catch(x){h(x)}},b=m=>{try{k(A.throw(m))}catch(x){h(x)}},k=m=>m.done?p(m.value):Promise.resolve(m.value).then(E,b);k((A=A.apply(F,H)).next())});import{ah as fe,ai as he,E as me,x as _e,Y as pe,r as R,c as te,m as ve,l as oe,n as ue,d as M,o as D,f,j as Z,e as Y,t as y,F as se,k as ce,N as $e,h as B,C as ye,w as be,Z as ge,p as we,aj as Se,A as le}from"./index-BxfdauWF.js";import{_ as Me}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-D--Gg2lu.js";import{s as De}from"./index-hJJZ99sN.js";import{C as ke}from"./check-1-OLoX8c.js";import{S as xe}from"./send-BtYLurXF.js";import"./Badge.vue_vue_type_script_setup_true_lang-C08gucxE.js";import"./plus-DiqLtgoR.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CszXfVPg.js";import"./Link-yxEDdXjU.js";import"./pencil-zwFRmt2n.js";import"./FolderPlugin.vue_vue_type_style_index_0_scoped_84b7d54d_lang-bD12IzvZ.js";import"./book-open-check-B_dkhHVj.js";var de={exports:{}};(function(F,H){(function(A,p){F.exports=p()})(he,function(){var A=1e3,p=6e4,h=36e5,E="millisecond",b="second",k="minute",m="hour",x="day",N="week",O="month",q="quarter",j="year",L="date",G="Invalid Date",U=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ne=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,r={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var s=["th","st","nd","rd"],e=a%100;return"["+a+(s[(e-20)%10]||s[e]||s[0])+"]"}},g=function(a,s,e){var n=String(a);return!n||n.length>=s?a:""+Array(s+1-n.length).join(e)+a},c={s:g,z:function(a){var s=-a.utcOffset(),e=Math.abs(s),n=Math.floor(e/60),t=e%60;return(s<=0?"+":"-")+g(n,2,"0")+":"+g(t,2,"0")},m:function a(s,e){if(s.date()<e.date())return-a(e,s);var n=12*(e.year()-s.year())+(e.month()-s.month()),t=s.clone().add(n,O),o=e-t<0,u=s.clone().add(n+(o?-1:1),O);return+(-(n+(e-t)/(o?t-u:u-t))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:O,y:j,w:N,d:x,D:L,h:m,m:k,s:b,ms:E,Q:q}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},i="en",w={};w[i]=r;var ae="$isDayjsObject",re=function(a){return a instanceof K||!(!a||!a[ae])},Q=function a(s,e,n){var t;if(!s)return i;if(typeof s=="string"){var o=s.toLowerCase();w[o]&&(t=o),e&&(w[o]=e,t=o);var u=s.split("-");if(!t&&u.length>1)return a(u[0])}else{var d=s.name;w[d]=s,t=d}return!n&&t&&(i=t),t||!n&&i},v=function(a,s){if(re(a))return a.clone();var e=typeof s=="object"?s:{};return e.date=a,e.args=arguments,new K(e)},l=c;l.l=Q,l.i=re,l.w=function(a,s){return v(a,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var K=function(){function a(e){this.$L=Q(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[ae]=!0}var s=a.prototype;return s.parse=function(e){this.$d=function(n){var t=n.date,o=n.utc;if(t===null)return new Date(NaN);if(l.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var u=t.match(U);if(u){var d=u[2]-1||0,_=(u[7]||"0").substring(0,3);return o?new Date(Date.UTC(u[1],d,u[3]||1,u[4]||0,u[5]||0,u[6]||0,_)):new Date(u[1],d,u[3]||1,u[4]||0,u[5]||0,u[6]||0,_)}}return new Date(t)}(e),this.init()},s.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},s.$utils=function(){return l},s.isValid=function(){return this.$d.toString()!==G},s.isSame=function(e,n){var t=v(e);return this.startOf(n)<=t&&t<=this.endOf(n)},s.isAfter=function(e,n){return v(e)<this.startOf(n)},s.isBefore=function(e,n){return this.endOf(n)<v(e)},s.$g=function(e,n,t){return l.u(e)?this[n]:this.set(t,e)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(e,n){var t=this,o=!!l.u(n)||n,u=l.p(e),d=function(W,C){var P=l.w(t.$u?Date.UTC(t.$y,C,W):new Date(t.$y,C,W),t);return o?P:P.endOf(x)},_=function(W,C){return l.w(t.toDate()[W].apply(t.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(C)),t)},$=this.$W,S=this.$M,T=this.$D,I="set"+(this.$u?"UTC":"");switch(u){case j:return o?d(1,0):d(31,11);case O:return o?d(1,S):d(0,S+1);case N:var V=this.$locale().weekStart||0,z=($<V?$+7:$)-V;return d(o?T-z:T+(6-z),S);case x:case L:return _(I+"Hours",0);case m:return _(I+"Minutes",1);case k:return _(I+"Seconds",2);case b:return _(I+"Milliseconds",3);default:return this.clone()}},s.endOf=function(e){return this.startOf(e,!1)},s.$set=function(e,n){var t,o=l.p(e),u="set"+(this.$u?"UTC":""),d=(t={},t[x]=u+"Date",t[L]=u+"Date",t[O]=u+"Month",t[j]=u+"FullYear",t[m]=u+"Hours",t[k]=u+"Minutes",t[b]=u+"Seconds",t[E]=u+"Milliseconds",t)[o],_=o===x?this.$D+(n-this.$W):n;if(o===O||o===j){var $=this.clone().set(L,1);$.$d[d](_),$.init(),this.$d=$.set(L,Math.min(this.$D,$.daysInMonth())).$d}else d&&this.$d[d](_);return this.init(),this},s.set=function(e,n){return this.clone().$set(e,n)},s.get=function(e){return this[l.p(e)]()},s.add=function(e,n){var t,o=this;e=Number(e);var u=l.p(n),d=function(S){var T=v(o);return l.w(T.date(T.date()+Math.round(S*e)),o)};if(u===O)return this.set(O,this.$M+e);if(u===j)return this.set(j,this.$y+e);if(u===x)return d(1);if(u===N)return d(7);var _=(t={},t[k]=p,t[m]=h,t[b]=A,t)[u]||1,$=this.$d.getTime()+e*_;return l.w($,this)},s.subtract=function(e,n){return this.add(-1*e,n)},s.format=function(e){var n=this,t=this.$locale();if(!this.isValid())return t.invalidDate||G;var o=e||"YYYY-MM-DDTHH:mm:ssZ",u=l.z(this),d=this.$H,_=this.$m,$=this.$M,S=t.weekdays,T=t.months,I=t.meridiem,V=function(C,P,J,X){return C&&(C[P]||C(n,o))||J[P].slice(0,X)},z=function(C){return l.s(d%12||12,C,"0")},W=I||function(C,P,J){var X=C<12?"AM":"PM";return J?X.toLowerCase():X};return o.replace(ne,function(C,P){return P||function(J){switch(J){case"YY":return String(n.$y).slice(-2);case"YYYY":return l.s(n.$y,4,"0");case"M":return $+1;case"MM":return l.s($+1,2,"0");case"MMM":return V(t.monthsShort,$,T,3);case"MMMM":return V(T,$);case"D":return n.$D;case"DD":return l.s(n.$D,2,"0");case"d":return String(n.$W);case"dd":return V(t.weekdaysMin,n.$W,S,2);case"ddd":return V(t.weekdaysShort,n.$W,S,3);case"dddd":return S[n.$W];case"H":return String(d);case"HH":return l.s(d,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return W(d,_,!0);case"A":return W(d,_,!1);case"m":return String(_);case"mm":return l.s(_,2,"0");case"s":return String(n.$s);case"ss":return l.s(n.$s,2,"0");case"SSS":return l.s(n.$ms,3,"0");case"Z":return u}return null}(C)||u.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(e,n,t){var o,u=this,d=l.p(n),_=v(e),$=(_.utcOffset()-this.utcOffset())*p,S=this-_,T=function(){return l.m(u,_)};switch(d){case j:o=T()/12;break;case O:o=T();break;case q:o=T()/3;break;case N:o=(S-$)/6048e5;break;case x:o=(S-$)/864e5;break;case m:o=S/h;break;case k:o=S/p;break;case b:o=S/A;break;default:o=S}return t?o:l.a(o)},s.daysInMonth=function(){return this.endOf(O).$D},s.$locale=function(){return w[this.$L]},s.locale=function(e,n){if(!e)return this.$L;var t=this.clone(),o=Q(e,n,!0);return o&&(t.$L=o),t},s.clone=function(){return l.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},a}(),ie=K.prototype;return v.prototype=ie,[["$ms",E],["$s",b],["$m",k],["$H",m],["$W",x],["$M",O],["$y",j],["$D",L]].forEach(function(a){ie[a[1]]=function(s){return this.$g(s,a[0],a[1])}}),v.extend=function(a,s){return a.$i||(a(s,K,v),a.$i=!0),v},v.locale=Q,v.isDayjs=re,v.unix=function(a){return v(1e3*a)},v.en=w[i],v.Ls=w,v.p={},v})})(de);var Ce=de.exports;const Oe=fe(Ce),Ae={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ne={class:"flex flex-row h-full"},je={class:"w-1/4 p-4 border-r"},Te={class:"text-lg font-semibold mb-4"},Ye={class:"flex flex-col space-y-2"},He=["disabled","onClick","title"],Ee={key:0,class:"text-green-500"},Le={class:"w-3/4 p-4"},Pe={key:0,class:"text-gray-500 text-lg font-semibold mb-4"},Ve={key:1,class:"w-3/4 p-4"},We={class:"text-lg font-semibold mb-4"},Ie={key:0,class:"mb-4"},Fe=["title"],Ue={key:1,class:"min-w-full table-auto border-collapse"},ze={class:"p-2 border"},Je={class:"p-2 border"},Re={class:"p-2 border"},Ze={class:"p-2 border"},Be={class:"flex items-center justify-center space-x-4"},qe=["href"],Ge={class:"p-2 border"},Qe={class:"p-2 border text-center"},Ke={key:0,class:"text-green-500 font-semibold"},Xe={key:1,class:"text-red-500 font-semibold"},et=["onUpdate:modelValue"],tt={key:2,class:"mb-4"},st={class:"text-lg font-semibold mt-4"},nt={class:"text-green-500"},at={class:"text-red-500"},rt={key:3,class:"mt-4"},ot={__name:"StudentAttendanceCS",props:{courseName:{type:String,required:!0}},setup(F){_e(),pe();const H=F,A=new Date,p=R(null),h=R({}),E=R(!1),b=R(!1);R(null);const k=te({url:"seminary.seminary.utils.get_course_meetingdates",makeParams(){return{course:H.courseName}},auto:!0});console.log("Meeting dates: ",k);const m=te({url:"frappe.client.get_list",makeParams(){return{doctype:"Scheduled Course Roster",filters:{course_sc:H.courseName,audit_bool:0,active:1},fields:["student","stuname_roster","stuimage","stuemail_rc"],order_by:"stuname_roster asc"}},auto:!0}),x=r=>Oe(r).format("MMM D"),N=te({url:"frappe.client.get_list",makeParams(){var r;return{doctype:"Student Attendance",filters:{course_schedule:H.courseName,date:(r=p.value)==null?void 0:r.cs_meetdate},fields:["student","status","date"]}},auto:!1});ve(()=>{j.value===0&&(b.value=!0)}),ue(()=>N.data,r=>{r&&(h.value={},r.forEach(g=>{var c;g.date===((c=p.value)==null?void 0:c.cs_meetdate)?h.value[g.student]=g.status==="Present":h.value[g.student]=!1}),E.value=Object.keys(h.value).length>0)}),ue(()=>p.value,r=>ee(this,null,function*(){r&&(N.data=yield N.reload(),console.log("Attendance data reloaded: ",N.data),console.log("Selected date: ",p.value),N.data.length===0&&(h.value={},m.data.forEach(g=>{h.value[g.student]=!1})))}));const O=r=>ee(this,null,function*(){p.value=r,b.value=!1,yield N.reload()}),q=()=>{b.value=!0},j=oe(()=>Object.values(h.value).filter(r=>r).length),L=oe(()=>Object.values(h.value).filter(r=>!r).length);ue(j,r=>{r===0&&(b.value=!0)});const G=()=>ee(this,null,function*(){const r=Object.keys(h.value).filter(c=>h.value[c]).map(c=>{const i=m.data.find(w=>w.student===c);return i?{student:c,stuname_roster:i.stuname_roster}:(console.error(`Student not found in students.data: ${c}`),null)}).filter(c=>c!==null),g=Object.keys(h.value).filter(c=>!h.value[c]).map(c=>{const i=m.data.find(w=>w.student===c);return i?{student:c,stuname_roster:i.stuname_roster}:(console.error(`Student not found in students.data: ${c}`),null)}).filter(c=>c!==null);yield fetch("/api/method/seminary.seminary.api.mark_attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course_schedule:H.courseName,date:p.value.cs_meetdate,students_present:r,students_absent:g})}).then(c=>c.json()).then(c=>{c.message&&(De("Success","Attendance updated successfully","check"),k.reload(),N.reload())}).catch(c=>{console.error("Error:",c)})}),U=te({url:"seminary.seminary.utils.get_course_details",cache:["course",H.courseName],params:{course:H.courseName},auto:!0}),ne=oe(()=>{var g;let r=[{label:"Courses",route:{name:"Courses"}}];return r.push({label:(g=U==null?void 0:U.data)==null?void 0:g.course,route:{name:"CourseDetail",params:{courseName:H.courseName}}}),r.push({label:"Attendance",route:{name:"StudentAttendanceCS",params:{courseName:H.courseName}}}),r});return(r,g)=>{var c;return D(),M(se,null,[f("header",Ae,[Z(Y(Me),{class:"h-7",items:ne.value},null,8,["items"])]),f("div",Ne,[f("div",je,[f("h2",Te,y(r.__("Course Schedule")),1),f("div",Ye,[(D(!0),M(se,null,ce(Y(k).data,i=>{var w;return D(),M("button",{key:i.name,disabled:new Date(i.cs_meetdate)>Y(A),class:$e(["p-2 border rounded-md text-left flex justify-between items-center",{"bg-gray-200":new Date(i.cs_meetdate)>Y(A),"bg-blue-100":((w=p.value)==null?void 0:w.name)===i.name}]),onClick:ae=>O(i),title:new Date(i.cs_meetdate)>Y(A)?r.__("Cannot set attendance of future dates"):""},[f("span",null,y(x(i.cs_meetdate)),1),i.attendance===1?(D(),M("span",Ee,[Z(Y(ke),{class:"h-5 w-5 text-green-500"})])):B("",!0)],10,He)}),128))])]),f("div",Le,[!Y(m).data||Y(m).data.length===0?(D(),M("div",Pe,y(r.__("There are no students enrolled in this course.")),1)):(D(),M("div",Ve,[f("h2",We,y(r.__("Attendance for: "))+" "+y(((c=p.value)==null?void 0:c.cs_meetdate)||r.__("Select a date")),1),E.value&&!b.value?(D(),M("div",Ie,[f("button",{class:"p-2 bg-yellow-200 border rounded-md",onClick:q,title:r.__("All changes will be recorded for audit purposes")},y(r.__("Edit Attendance")),9,Fe)])):B("",!0),p.value?(D(),M("table",Ue,[f("thead",null,[f("tr",null,[f("th",ze,y(r.__("Image")),1),f("th",Je,y(r.__("Student Name")),1),f("th",Re,y(r.__("Present")),1)])]),f("tbody",null,[(D(!0),M(se,null,ce(Y(m).data,i=>(D(),M("tr",{key:i.student},[f("td",Ze,[f("div",Be,[Z(Y(ye),{image:i.stuimage,label:i.stuname_roster,size:"md",class:"avatar border border-outline-gray-2 cursor-auto"},null,8,["image","label"]),Z(Y(ge),{text:`Send Email to ${i.stuname_roster}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:be(()=>[f("a",{href:`mailto:${i.stuemail_rc}`},[Z(Y(xe),{class:"w-5 h-5 text-blue-300"})],8,qe)]),_:2},1032,["text"])])]),f("td",Ge,y(i.stuname_roster),1),f("td",Qe,[E.value&&!b.value?(D(),M(se,{key:0},[h.value[i.student]?(D(),M("span",Ke,y(r.__("Present")),1)):(D(),M("span",Xe,y(r.__("Absent")),1))],64)):we((D(),M("input",{key:1,type:"checkbox","onUpdate:modelValue":w=>h.value[i.student]=w},null,8,et)),[[Se,h.value[i.student]]])])]))),128))])])):B("",!0),p.value?(D(),M("div",tt,[f("p",st,[f("span",nt,y(j.value),1),le(" "+y(r.__("Present"))+", ",1),f("span",at,y(L.value),1),le(" "+y(r.__("Absent")),1)])])):B("",!0),p.value&&(!E.value||E.value&&b.value)?(D(),M("div",rt,[f("button",{class:"p-2 bg-blue-500 text-white rounded-md",onClick:G},y(r.__("Mark Attendance")),1)])):B("",!0)]))])])],64)}}},bt=me(ot,[["__scopeId","data-v-e01deb82"]]);export{bt as default};
//# sourceMappingURL=StudentAttendanceCS-_1H3tL2R.js.map
