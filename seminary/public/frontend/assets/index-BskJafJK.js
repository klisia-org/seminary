var vt=Object.defineProperty,_t=Object.defineProperties;var bt=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var kt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var Ge=(d,e,t)=>e in d?vt(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t,qe=(d,e)=>{for(var t in e||(e={}))kt.call(e,t)&&Ge(d,t,e[t]);if(Je)for(var t of Je(e))xt.call(e,t)&&Ge(d,t,e[t]);return d},De=(d,e)=>_t(d,bt(e));var Y=(d,e,t)=>new Promise((l,n)=>{var r=m=>{try{h(t.next(m))}catch(w){n(w)}},y=m=>{try{h(t.throw(m))}catch(w){n(w)}},h=m=>m.done?l(m.value):Promise.resolve(m.value).then(r,y);h((t=t.apply(d,e)).next())});import{G as He,d as c,o as a,f as o,T as wt,V as $t,W as St,s as W,l as oe,g as A,w as F,q as Ct,O as Ie,e as s,$ as Oe,i as _e,r as C,a as Ee,x as Ve,c as D,n as X,h as S,t as i,j as T,_ as V,F as se,k as ne,p as ye,N as et,A as ae,C as ue,m as me,M as tt,D as st,af as Z,ag as xe,ah as ce,ai as ve,u as je,a0 as Tt,ae as ot,E as At,a1 as Et,y as at,aj as nt,z as rt,ak as Mt,a8 as Be,b as Ft,al as Ne,am as zt,Z as Lt,ad as We,R as qt,an as It}from"./index-Bp-UPm00.js";import{_ as Se}from"./Badge.vue_vue_type_script_setup_true_lang-BMWdk0aO.js";import{a as Ce}from"./FormControl.vue_vue_type_script_setup_true_lang-D9NZV9wG.js";import{_ as ze,H as Ye}from"./TextEditor.vue_vue_type_script_setup_true_lang-BTikwLvi.js";import{c as Me}from"./call-DjkLykxt.js";import{_ as Fe,X as Nt}from"./Link-Bb8vWraq.js";import{P as Pt}from"./pencil-IevyI9q7.js";import{m as Dt,s as Rt,f as Ut,n as Ht,F as Ot,h as Vt,v as jt}from"./FolderPlugin.vue_vue_type_style_index_0_scoped_84b7d54d_lang-DZhBt-lw.js";import{B as Bt}from"./book-open-check-BmkBAGoC.js";class Qt{constructor(){this.listeners={},this.failed=!1}on(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}trigger(e,t){(this.listeners[e]||[]).forEach(n=>{n.call(this,t)})}upload(e,t){return new Promise((l,n)=>{let r=new XMLHttpRequest;r.upload.addEventListener("loadstart",()=>{this.trigger("start")}),r.upload.addEventListener("progress",m=>{m.lengthComputable&&this.trigger("progress",{uploaded:m.loaded,total:m.total})}),r.upload.addEventListener("load",()=>{this.trigger("finish")}),r.addEventListener("error",()=>{this.trigger("error"),n()}),r.onreadystatechange=()=>{if(r.readyState==XMLHttpRequest.DONE){let m;if(r.status===200){let w=null;try{w=JSON.parse(r.responseText)}catch(R){w=r.responseText}let x=w.message||w;l(x)}else if(r.status===403)m=JSON.parse(r.responseText);else{this.failed=!0;try{m=JSON.parse(r.responseText)}catch(w){}}m&&m.exc&&console.error(JSON.parse(m.exc)[0]),n(m)}};const y=t.upload_endpoint||"/api/method/upload_file";r.open("POST",y,!0),r.setRequestHeader("Accept","application/json"),window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&r.setRequestHeader("X-Frappe-CSRF-Token",window.csrf_token);let h=new FormData;e&&h.append("file",e,e.name),h.append("is_private",t.private?"1":"0"),h.append("folder",t.folder||"Home"),t.file_url&&h.append("file_url",t.file_url),t.doctype&&h.append("doctype",t.doctype),t.docname&&h.append("docname",t.docname),t.fieldname&&h.append("fieldname",t.fieldname),t.method&&h.append("method",t.method),t.type&&h.append("type",t.type),t.optimize&&(h.append("optimize","1"),t.max_width&&h.append("max_width",t.max_width.toString()),t.max_height&&h.append("max_height",t.max_height.toString())),r.send(h)})}}const Jt={name:"FileUploader",props:{fileTypes:{type:[String,Array]},uploadArgs:{type:Object},validateFile:{type:Function,default:null}},data(){return{uploader:null,uploading:!1,uploaded:0,error:null,message:"",total:0,file:null,finishedUploading:!1}},computed:{progress(){let d=Math.floor(this.uploaded/this.total*100);return isNaN(d)?0:d},success(){return this.finishedUploading&&!this.error}},methods:{inputRef(){return this.$refs.input},openFileSelector(){this.$refs.input.click()},onFileAdd(d){return Y(this,null,function*(){if(this.error=null,this.file=d.target.files[0],this.file&&this.validateFile)try{let e=yield this.validateFile(this.file);e&&(this.error=e)}catch(e){this.error=e}this.error||this.uploadFile(this.file)})},uploadFile(d){return Y(this,null,function*(){this.error=null,this.uploaded=0,this.total=0,this.uploader=new Qt,this.uploader.on("start",()=>{this.uploading=!0}),this.uploader.on("progress",e=>{this.uploaded=e.uploaded,this.total=e.total}),this.uploader.on("error",()=>{this.uploading=!1,this.error="Error Uploading File"}),this.uploader.on("finish",()=>{this.uploading=!1,this.finishedUploading=!0}),this.uploader.upload(d,this.uploadArgs||{}).then(e=>{this.$emit("success",e)}).catch(e=>{this.uploading=!1;let t="Error Uploading File";e!=null&&e._server_messages?t=JSON.parse(JSON.parse(e._server_messages)[0]).message:e!=null&&e.exc&&(t=JSON.parse(e.exc)[0].split(`
`).slice(-2,-1)[0]),this.error=t,this.$emit("failure",e)})})}},expose:["inputRef"]},Gt=["accept"];function Wt(d,e,t,l,n,r){return a(),c("div",null,[o("input",{ref:"input",type:"file",accept:t.fileTypes,class:"hidden",onChange:e[0]||(e[0]=(...y)=>r.onFileAdd&&r.onFileAdd(...y))},null,40,Gt),wt(d.$slots,"default",$t(St({file:n.file,uploading:n.uploading,progress:r.progress,uploaded:n.uploaded,message:n.message,error:n.error,total:n.total,success:r.success,openFileSelector:r.openFileSelector})))])}const lt=He(Jt,[["render",Wt]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=W("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=W("CircleCheckBigIcon",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=W("CircleHelpIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=W("CircleMinusIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=W("CircleXIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=W("CodeXmlIcon",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=W("CodeIcon",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=W("EllipsisIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=W("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=W("FolderOpenIcon",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=W("MaximizeIcon",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=W("MessageSquareTextIcon",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=W("PauseIcon",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=W("PlayIcon",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=W("SquarePenIcon",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=W("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=W("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=W("Volume2Icon",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=W("VolumeXIcon",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),is={class:"w-full bg-surface-gray-3 rounded-full h-1"},mt={__name:"ProgressBar",props:{progress:{type:Number,default:0},size:{type:String,default:"sm"}},setup(d){const e=d,t=oe(()=>`${Math.min(Math.ceil(e.progress),100)}%`),l=oe(()=>{if(e.size==="sm")return"h-1";if(e.size==="md")return"h-2";if(e.size==="lg")return"h-3"});return(n,r)=>(a(),A(s(Oe),{text:`${e.progress}%`},{default:F(()=>[o("div",is,[o("div",{class:Ie(["bg-surface-gray-7 rounded-full",l.value]),style:Ct({width:t.value})},null,6)])]),_:1},8,["text"]))}},ds={key:0},us={class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},cs={class:"leading-5"},ms={key:0,class:"leading-5"},ps={key:1,class:"leading-5"},hs={key:2,class:"leading-relaxed"},fs={key:3,class:"leading-relaxed"},gs={key:0,class:"flex flex-col space-x-1 my-4"},ys={class:"mb-2"},vs={class:"font-semibold"},_s={key:1},bs={class:"border text-center p-20 rounded-md"},ks={class:"font-semibold text-lg"},xs={key:2},ws={key:2},$s={key:0,class:"border rounded-md p-5"},Ss={class:"flex justify-between"},Cs={class:"text-sm text-ink-gray-5"},Ts={class:"mr-2"},As={class:"text-ink-gray-9 text-sm font-semibold item-left"},Es=["innerHTML"],Ms={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Fs=["name","onChange"],zs=["name","onChange"],Ls={key:0},qs=["innerHTML"],Is={key:1},Ns={key:0},Ps={key:2},Ds={class:"flex items-center justify-between mt-4"},Rs={class:"text-sm text-ink-gray-5"},Us={key:3},Hs={class:"flex justify-between"},Os={class:"text-sm text-ink-gray-5"},Vs={class:"mr-2"},js={class:"text-ink-gray-9 text-sm font-semibold item-left"},Bs=["innerHTML"],Qs={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Js=["name","onChange"],Gs=["name","onChange"],Ws=["innerHTML"],Ys={key:1},Xs={class:"text-center mt-4"},Zs={key:4,class:"border rounded-md p-20 text-center space-y-4"},Ks={class:"text-ink-gray-9"},eo={class:"mt-6"},to={class:"flex justify-between"},so={class:"text-lg text-ink-gray-5"},oo={class:"mr-2"},ao=["innerHTML"],no={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},ro={class:"bg-surface-gray-3 rounded-md p-3 mt-4"},lo={key:0,class:"bg-surface-gray-3 rounded-md p-3 mt-4"},io={class:"mt-4"},uo={key:1},co={__name:"Quiz",props:{quizName:{type:String,required:!0}},setup(d){const e=_e("$user"),t=C(!1),l=C(0),n=C(""),r=Ee([0,0,0,0]),y=Ee([]);let h=Ee([]);const m=C(null),w=C(0);let x=null;const R=Ve(),I=C(0),k=Ee({}),J=d,f=D({url:"frappe.client.get",makeParams(p){return{doctype:"Quiz",name:J.quizName}},cache:["quiz",J.quizName],auto:!0,transform(p){return p?(p.duration=parseInt(p.duration)||0,p):(console.error("Quiz data is null or undefined."),null)},onSuccess(p){p?(L(),b()):console.error("Failed to load quiz data.")},onError(p){console.error("Error loading quiz data:",p)}}),P=oe(()=>!!f.data),L=()=>{let p=f.data;if(p.shuffle_questions){const u=re([...p.questions]);h=p.limit_questions_to?u.slice(0,p.limit_questions_to):u}else h=p.questions},b=()=>{f.data.duration&&(w.value=f.data.duration*60)},g=()=>{x=setInterval(()=>{f.data.duration&&(w.value--,w.value==0&&(clearInterval(x),he())),I.value++},1e3)},z=p=>{const u=Math.floor(p/3600).toString().padStart(2,"0"),H=Math.floor(p%3600/60).toString().padStart(2,"0"),N=(p%60).toString().padStart(2,"0");return u!="00"?`${u}:${H}:${N}`:`${H}:${N}`},M=oe(()=>w.value/(f.data.duration*60)*100),re=p=>{for(let u=p.length-1;u>0;u--){const H=Math.floor(Math.random()*(u+1));[p[u],p[H]]=[p[H],p[u]]}return p},le=D({url:"frappe.client.get_list",makeParams(p){var u,H;return{doctype:"Quiz Submission",filters:{member:(u=e.data)==null?void 0:u.name,quiz:(H=f.data)==null?void 0:H.name},fields:["name","creation","score","score_out_of","percentage","passing_percentage"],order_by:"creation desc"}},transform(p){p.forEach((u,H)=>{u.creation=Pe(u.creation),u.idx=H+1})}});X(()=>f.data,p=>{p&&L(),p&&f.data.max_attempts&&(le.reload(),ge())});const Q=D({url:"seminary.seminary.doctype.quiz.quiz.quiz_summary",makeParams(p){if(!f.data)return{};const u=f.data.duration?f.data.duration*60-(w.value||0):I.value||0;return{quiz:f.data.name,course:R.currentRoute.value.params.courseName,results:(p==null?void 0:p.results)||localStorage.getItem(`${f.data.name}_results`),time_taken:u}},onSuccess(p){p.corrected_answers&&(K.data=p.corrected_answers.map(u=>De(qe({},u),{user_answer:u.user_answer||null,correct_answer:u.correct_answer||null})))},onError(p){console.error("Error loading quiz summary:",p)},auto:!0}),U=D({url:"seminary.seminary.utils.get_question_details",makeParams(p){return{question:n.value}}});X(l,p=>{p>0&&(n.value=f.data.questions[p-1].question,U.reload())}),X(()=>J.quizName,p=>{p&&f.reload()});const K=D({url:"seminary.seminary.utils.get_all_questions_details",makeParams(p){return{questions:h.map(u=>u.name)}}}),_=()=>{l.value=1,localStorage.removeItem(f.data.title),g()},$=()=>{localStorage.removeItem(f.data.title),t.value=!0,g(),K.reload()},v=p=>{U.data.multiple||r.splice(0,r.length,0,0,0,0),r[p-1]=r[p-1]?0:1},E=()=>{let p=[];return U.data.type=="Choices"?r.forEach((H,N)=>{r[N]&&p.push(U.data[`option_${N+1}`])}):p.push(m.value),p},B=()=>{let p=E();if(!p.length){ft({title:"Please select an option",icon:"alert-circle",iconClasses:"text-yellow-600 bg-yellow-100 rounded-full",position:"top-center"});return}D({url:"seminary.seminary.doctype.quiz.quiz.check_answer",params:{question:n.value,type:U.data.type,answers:JSON.stringify(p)},auto:!0,onSuccess(u){U.data.type==="Choices"?r.forEach((N,G)=>{N?y[G]=N&&u[G]:u[G]===2?y[G]=2:y[G]=void 0}):y.push(u),ie(),f.data.show_answers||pe()}})},ie=()=>{let p=JSON.parse(localStorage.getItem(f.data.title))||[],u={question_name:n.value,answer:E().join(),is_correct:y.filter(N=>N!=null)};const H=p.findIndex(N=>N.question_name===u.question_name);H!==-1?p[H]=u:p?p.push(u):p=[u],localStorage.setItem(f.data.title,JSON.stringify(p)),localStorage.setItem(`${f.data.name}_results`,JSON.stringify(p))},be=()=>{f.data.show_answers?(ie(),pe()):B()},pe=()=>{l.value!=f.data.questions.length&&(l.value=l.value+1,r.splice(0,r.length,0,0,0,0),y.length=0,m.value=null)},he=()=>{if(!f.data.show_answers){B(),setTimeout(()=>{fe()},500);return}fe(),console.log("Quiz submitted with Submit Quiz button and asnwers shown")},ke=()=>Y(this,null,function*(){var H;const p=[],u=[];for(let N=0;N<K.data.length;N++){const G=K.data[N],te=((H=k[N])==null?void 0:H[0])||"",q=yield Me("seminary.seminary.doctype.quiz.quiz.check_answer",{question:G.question,type:G.type,answers:JSON.stringify([te])}),ee=Array.isArray(q)?[q.find(O=>O===1)||0]:[q];p.push({question_name:G.question,answer:te,is_correct:ee}),u.push({question_name:G.question,question_detail:G.question_detail,user_answer:te,correct_answer:null,explanation:G.explanation||null})}Q.submit({results:JSON.stringify(p)},{onSuccess:N=>Y(this,null,function*(){const G=yield Me("seminary.seminary.doctype.quiz.quiz.get_all_question_results",{questions:h.map(te=>te.question)});u.forEach(te=>{const q=G.find(ee=>ee.name===te.question_name);q&&(te.correct_answer=q.correct_option,te.explanation=q.correct_explanation||te.explanation)}),localStorage.setItem(`${f.data.name}_questions`,JSON.stringify(u)),localStorage.setItem(`${f.data.name}_results`,JSON.stringify(p)),localStorage.setItem(`${f.data.name}_summary`,JSON.stringify(N)),Q.reload(),t.value=!1}),onError(N){console.error("Error submitting quiz:",N)}})}),fe=()=>{const p=localStorage.getItem(`${f.data.name}_results`);if(!p){console.error("No results found to submit.");return}Q.submit({results:p},{onSuccess(u){we(),f.data&&f.data.max_attempts&&le.reload(),f.data.duration&&clearInterval(x)},onError(u){var N,G;((u==null?void 0:u.message)||"").includes("MaximumAttemptsExceededError")&&((N=u.messages)!=null&&N[0],ue.error(((G=u.messages)==null?void 0:G[0])||u),setTimeout(()=>{window.location.reload()},3e3))}})},ge=()=>{l.value=0,r.splice(0,r.length,0,0,0,0),y.length=0,Q.reset(),L(),b(),I.value=0},j=p=>p.type=="Choices"?p.multiple?"Choose all answers that apply":"Choose one answer":"Type your answer",we=()=>{R.currentRoute.value.name==="Lesson"&&Me("seminary.seminary.api.mark_lesson_progress",{course:R.currentRoute.value.params.courseName,chapter_number:R.currentRoute.value.params.chapterNumber,lesson_number:R.currentRoute.value.params.lessonNumber}).then(()=>{t.value&&Q.reload()})},$e=(p,u)=>{k[p]=[u]},Le=(p,u)=>{k[p]||(k[p]=[]);const H=k[p].indexOf(u);H===-1?k[p].push(u):k[p].splice(H,1)};X(()=>K.data,p=>{p?console.log("All questions details updated"):console.warn("No data available in all_questions_details.")});const Te=C([]),Ae=C([]);return X(()=>Q.data,()=>{if(Q.data){const p=localStorage.getItem(`${f.data.name}_questions`),u=localStorage.getItem(`${f.data.name}_results`);Te.value=p?JSON.parse(p):[],Ae.value=u?JSON.parse(u):[]}}),(p,u)=>{var H,N,G,te;return P.value?(a(),c("div",ds,[o("div",us,[o("div",cs,i(`This quiz consists of ${s(h).length} questions.`),1),(H=s(f).data)!=null&&H.duration?(a(),c("div",ms,i(`Please ensure that you complete all the questions in ${s(f).data.duration} minutes.`),1)):S("",!0),(N=s(f).data)!=null&&N.duration?(a(),c("div",ps,i("If you fail to do so, the quiz will be automatically submitted when the timer ends."))):S("",!0),s(f).data.passing_percentage?(a(),c("div",hs,i(`You will have to get ${s(f).data.passing_percentage}% correct answers in order to pass the quiz.`),1)):S("",!0),s(f).data.max_attempts?(a(),c("div",fs,i(`You can attempt this quiz ${s(f).data.max_attempts===1?"1 time":`${s(f).data.max_attempts} times`}.`),1)):S("",!0)]),s(f).data.duration?(a(),c("div",gs,[o("div",ys,[u[7]||(u[7]=o("span",{class:""},i("Time")+": ",-1)),o("span",vs,i(z(w.value)),1)]),T(mt,{progress:M.value},null,8,["progress"])])):S("",!0),t.value?S("",!0):(a(),c("div",_s,[o("div",bs,[o("div",ks,i(s(f).data.title),1),(!s(f).data.max_attempts||((G=s(le).data)==null?void 0:G.length)<s(f).data.max_attempts)&&s(f).data.qbyquestion?(a(),A(s(V),{key:0,onClick:_,class:"mt-2"},{default:F(()=>[...u[8]||(u[8]=[o("span",null,i("Start"),-1)])]),_:1})):!s(f).data.max_attempts||((te=s(le).data)==null?void 0:te.length)<s(f).data.max_attempts?(a(),A(s(V),{key:1,onClick:$,class:"mt-2"},{default:F(()=>[...u[9]||(u[9]=[o("span",null,i("Start full quiz"),-1)])]),_:1})):(a(),c("div",xs,i("You have already exceeded the maximum number of attempts allowed for this quiz.")))])])),t.value===!1&&l.value!==0&&!s(Q).data&&s(f).data.qbyquestion?(a(),c("div",ws,[(a(!0),c(se,null,ne(s(h),(q,ee)=>(a(),c("div",null,[ee==l.value-1&&s(U).data?(a(),c("div",$s,[o("div",Ss,[o("div",Cs,[o("span",Ts,i(`Question ${l.value}`)+": ",1),o("span",null,i(j(s(U).data)),1)]),o("div",As,i(q.points)+" "+i(q.points==1?"Point":"Points"),1)]),o("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:s(U).data.question},null,8,Es),s(U).data.type=="Choices"?(a(),c(se,{key:0},ne(4,O=>o("div",null,[s(U).data[`option_${O}`]?(a(),c("label",Ms,[!y.length&&!s(U).data.multiple?(a(),c("input",{key:0,type:"radio",name:encodeURIComponent(s(U).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:de=>v(O)},null,40,Fs)):!y.length&&s(U).data.multiple?(a(),c("input",{key:1,type:"checkbox",name:encodeURIComponent(s(U).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:de=>v(O)},null,40,zs)):s(f).data.show_answers?(a(!0),c(se,{key:2},ne(y,(de,yt)=>(a(),c("div",null,[O-1==yt?(a(),c("div",Ls,[de==1?(a(),A(s(Re),{key:0,class:"w-4 h-4 text-green-800"})):de==2?(a(),A(s(Xe),{key:1,class:"w-4 h-4 text-ink-green-2"})):de==0?(a(),A(s(Ue),{key:2,class:"w-4 h-4 text-red-600"})):(a(),A(s(Xe),{key:3,class:"w-4 h-4"}))])):S("",!0)]))),256)):S("",!0),o("span",{class:"ml-2",innerHTML:s(U).data[`option_${O}`]},null,8,qs)])):S("",!0),s(U).data[`explanation_${O}`]?ye((a(),c("div",{key:1,class:"mt-2 text-xs"},i(s(U).data[`explanation_${O}`]),513)),[[et,y.length]]):S("",!0)])),64)):s(U).data.type=="User Input"?(a(),c("div",Is,[T(s(Ce),{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=O=>m.value=O),type:"textarea",disabled:!!y.length,class:"my-2"},null,8,["modelValue","disabled"]),y.length?(a(),c("div",Ns,[y[0]?(a(),A(s(Se),{key:0,label:"Correct",theme:"green"},{prefix:F(()=>[T(s(Re),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(a(),A(s(Se),{key:1,theme:"red",label:"Incorrect"},{prefix:F(()=>[T(s(Ue),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])):S("",!0)])):(a(),c("div",Ps,[T(s(ze),{class:"mt-4",content:m.value,onChange:u[1]||(u[1]=O=>m.value=O),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),o("div",Ds,[o("div",Rs,i(`Question ${l.value} of ${s(h).length}`),1),s(f).data.show_answers&&!y.length?(a(),A(s(V),{key:0,onClick:u[2]||(u[2]=O=>B())},{default:F(()=>[...u[10]||(u[10]=[o("span",null,i("Check"),-1)])]),_:1})):l.value!=s(h).length?(a(),A(s(V),{key:1,onClick:u[3]||(u[3]=O=>be())},{default:F(()=>[...u[11]||(u[11]=[o("span",null,i("Next"),-1)])]),_:1})):(a(),A(s(V),{key:2,onClick:u[4]||(u[4]=O=>he())},{default:F(()=>[...u[12]||(u[12]=[o("span",null,i("Submit"),-1)])]),_:1}))])])):S("",!0)]))),256))])):S("",!0),t.value&&s(K).data&&s(K).data.length>0?(a(),c("div",Us,[(a(!0),c(se,null,ne(s(K).data,(q,ee)=>(a(),c("div",{key:q.name,class:"border rounded-md p-5 mb-4"},[o("div",Hs,[o("div",Os,[o("span",Vs,i(`Question ${ee+1}`)+":",1),o("span",null,i(j(q)),1)]),o("div",js,i(q.points||0)+" "+i(q.points==1?"Point":"Points"),1)]),o("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:q.question_detail},null,8,Bs),q.type=="Choices"?(a(),c(se,{key:0},ne(4,O=>o("div",null,[q[`option_${O}`]?(a(),c("label",Qs,[q.multiple?q.multiple?(a(),c("input",{key:1,type:"checkbox",name:`question_${ee}`,class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:de=>Le(ee,q[`option_${O}`])},null,40,Gs)):S("",!0):(a(),c("input",{key:0,type:"radio",name:`question_${ee}`,class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:de=>$e(ee,q[`option_${O}`])},null,40,Js)),o("span",{class:"ml-2",innerHTML:q[`option_${O}`]},null,8,Ws)])):S("",!0)])),64)):q.type=="User Input"?(a(),c("div",Ys,[T(s(Ce),{modelValue:k[ee],"onUpdate:modelValue":O=>k[ee]=O,type:"textarea",class:"my-2"},null,8,["modelValue","onUpdate:modelValue"])])):S("",!0)]))),128)),o("div",Xs,[T(s(V),{onClick:u[5]||(u[5]=q=>ke())},{default:F(()=>[...u[13]||(u[13]=[o("span",null,i("Submit Your Quiz"),-1)])]),_:1})])])):s(Q).data?(a(),c("div",Zs,[u[18]||(u[18]=o("div",{class:"text-lg font-semibold"},i("Quiz Summary"),-1)),o("div",Ks,i(`You got ${Math.ceil(s(Q).data.percentage)}% correct answers with a score of ${s(Q).data.score} out of ${s(Q).data.score_out_of}`),1),o("div",eo,[(a(!0),c(se,null,ne(Te.value,(q,ee)=>{var O,de;return a(),c("div",{key:q.question_name,class:"border rounded-md p-5 mb-4"},[o("div",to,[o("div",so,[o("span",oo,i(`Question ${ee+1}`)+":",1),o("span",{innerHTML:q.question_detail},null,8,ao)])]),o("div",no,[u[14]||(u[14]=o("strong",null,i("Your Answer:"),-1)),ae(" "+i(q.user_answer||"No Answer"),1)]),o("div",ro,[u[15]||(u[15]=o("strong",null,i("Correct Answer:"),-1)),ae(" "+i(q.correct_answer||"No Correct Answer"),1)]),q.explanation?(a(),c("div",lo,[u[16]||(u[16]=o("strong",null,i("Explanation:"),-1)),ae(" "+i(q.explanation),1)])):S("",!0),o("div",io,[((de=(O=Ae.value[ee])==null?void 0:O.is_correct)==null?void 0:de[0])===1?(a(),A(s(Se),{key:0,label:"Correct",theme:"green"},{prefix:F(()=>[T(s(Re),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1})):(a(),A(s(Se),{key:1,label:"Incorrect",theme:"red"},{prefix:F(()=>[T(s(Ue),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1}))])])}),128))]),T(s(V),{onClick:u[6]||(u[6]=q=>ge()),class:"mt-4"},{default:F(()=>[...u[17]||(u[17]=[o("span",null,i("Try Again"),-1)])]),_:1})])):S("",!0)])):(a(),c("div",uo,[...u[19]||(u[19]=[o("p",null,"Loading quiz data...",-1)])]))}}},mo={key:1,class:"border rounded-md text-center py-20"},po={__name:"QuizBlock",props:{quiz:{type:String,required:!0}},setup(d){const e=_e("$user"),t=()=>{window.location.href="/login"};return(l,n)=>s(e).data?(a(),A(co,{key:0,quizName:d.quiz},null,8,["quizName"])):(a(),c("div",mo,[o("div",null,i(l.__("Please login to access the quiz.")),1),T(s(V),{onClick:n[0]||(n[0]=r=>t()),class:"mt-2"},{default:F(()=>[o("span",null,i(l.__("Login")),1)]),_:1})]))}},ho={class:"p-5 space-y-4"},fo={key:0,class:"text-lg font-semibold"},go={key:1,class:"text-lg font-semibold"},yo={key:2,class:"text-lg font-semibold"},vo={class:"flex justify-end space-x-2"},Qe={__name:"AssessmentPlugin",props:{type:{type:String,required:!0},onAddition:{type:Function,required:!0}},setup(d){const e=C(!1),t=C(null),l=C(null),n=C(null),r=d;me(()=>Y(this,null,function*(){yield tt(),e.value=!0}));const y=()=>{r.type=="quiz"?r.onAddition(t.value):r.type=="exam"?r.onAddition(n.value):r.onAddition(l.value),e.value=!1},h=()=>{r.type=="quiz"?window.open("/seminary/quizzes/new","_blank"):r.type=="exam"?window.open("/seminary/exams/new","_blank"):window.open("/seminary/assignments/new","_blank")};return(m,w)=>(a(),A(s(st),{modelValue:e.value,"onUpdate:modelValue":w[4]||(w[4]=x=>e.value=x),options:{size:"xl"}},{body:F(()=>[w[5]||(w[5]=o("button",{style:{opacity:"0",position:"absolute"}},"Fallback Focus",-1)),o("div",ho,[d.type=="quiz"?(a(),c("div",fo,i(m.__("Add a quiz to your lesson")),1)):d.type=="exam"?(a(),c("div",go,i(m.__("Add an exam to your lesson")),1)):(a(),c("div",yo,i(m.__("Add an assignment to your lesson")),1)),o("div",null,[d.type=="quiz"?(a(),A(Fe,{key:0,modelValue:t.value,"onUpdate:modelValue":w[0]||(w[0]=x=>t.value=x),doctype:"Quiz",label:m.__("Select a quiz"),onCreate:(x,R)=>h()},null,8,["modelValue","label","onCreate"])):d.type=="exam"?(a(),A(Fe,{key:1,modelValue:n.value,"onUpdate:modelValue":w[1]||(w[1]=x=>n.value=x),doctype:"Exam Activity",label:m.__("Select an exam"),onCreate:(x,R)=>h()},null,8,["modelValue","label","onCreate"])):(a(),A(Fe,{key:2,modelValue:l.value,"onUpdate:modelValue":w[2]||(w[2]=x=>l.value=x),doctype:"Assignment Activity",label:m.__("Select an assignment"),onCreate:(x,R)=>h()},null,8,["modelValue","label","onCreate"]))]),o("div",vo,[T(s(V),{variant:"solid",onClick:w[3]||(w[3]=x=>y())},{default:F(()=>[ae(i(m.__("Save")),1)]),_:1})])])]),_:1},8,["modelValue"]))}};class _o{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=Z({render:()=>xe(Xt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Quiz"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderQuiz(this.data.quiz):this.renderQuizModal(),this.wrapper}renderQuiz(e){if(this.readOnly){const t=Z(po,{quiz:e});t.use(ce),t.use(ve);const{userResource:l}=je();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Quiz: ${e}
            </span>
        </div>`}renderQuizModal(){if(this.readOnly)return;const e=Z(Qe,{type:"quiz",onAddition:t=>{this.data.quiz=t,this.renderQuiz(t)}});e.use(ce),e.use(ve),e.mount(this.wrapper)}save(e){return{quiz:this.data.quiz}}}const bo={class:"border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]"},ko={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},xo={key:0},wo={key:1},$o={class:"text-sm text-ink-gray-7 font-medium mb-2"},So=["innerHTML"],Co={class:"flex flex-col"},To={class:"p-5"},Ao={class:"flex items-center justify-between mb-4"},Eo={class:"font-semibold text-ink-gray-9"},Mo={class:"flex items-center space-x-2"},Fo={key:0,class:"bg-blue-200 p-3 rounded-md leading-5 text-sm mb-4"},zo={key:1},Lo={class:"text-xs text-ink-gray-5 mt-1 mb-2"},qo={key:1},Io={class:"flex text-ink-gray-7"},No={class:"border self-start rounded-md p-2 mr-2"},Po=["href"],Do={class:"text-sm leading-5"},Ro={class:"text-sm text-ink-gray-5 mt-1"},Uo={key:2},Ho={class:"text-xs text-ink-gray-5 mb-1"},Oo={key:3},Vo={class:"text-sm mb-4"},jo={key:4,class:"mt-8 p-3 bg-blue-200 rounded-md"},Bo={class:"text-sm text-ink-gray-5 font-medium mb-2"},Qo={class:"leading-5"},Jo=["innerHTML"],Go={key:5,class:"mt-8 space-y-4"},Wo={class:"font-semibold mb-2 text-ink-gray-9"},Yo={class:"text-sm text-ink-gray-5 mb-1"},Xo={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(d){var K;const e=C(null),t=C(null),l=C(null),n=Ve(),r=_e("$user"),y=n.currentRoute.value.name=="AssignmentSubmission",h=C(!1),m=d;me(()=>{window.addEventListener("keydown",w),console.log("User: ",r.data)});const w=_=>{_.key==="s"&&(_.ctrlKey||_.metaKey)&&(J(),_.preventDefault())};Tt(()=>{window.removeEventListener("keydown",w)});const x=D({url:"frappe.client.get",params:{doctype:"Assignment Activity",name:m.assignmentID},auto:!0,onSuccess(_){m.submissionName!="new"&&k.reload()}}),R=D({url:"frappe.client.insert",makeParams(_){var v;let $={doctype:"Assignment Submission",assignment:m.assignmentID,member:(v=r.data)==null?void 0:v.name,course:n.currentRoute.value.params.courseName};return U()?$.assignment_attachment=e.value.file_url:$.answer=t.value,{doc:$}}}),I=D({url:"seminary.seminary.api.get_file_info",makeParams(_){return{file_url:_.image}},auto:!1,onSuccess(_){e.value=_}}),k=ot({doctype:"Assignment Submission",name:m.submissionName,onError(_){var $;ue.error((($=_.messages)==null?void 0:$[0])||_)},auto:!1,cache:[(K=r.data)==null?void 0:K.name,m.assignmentID]});X(k,()=>{k.doc&&(k.doc.assignment_attachment&&I.reload({image:k.doc.assignment_attachment}),k.doc.answer&&(t.value=k.doc.answer),k.doc.comments&&(l.value=k.doc.comments),k.isDirty||U()&&!e.value||!U()&&!t.value?h.value=!0:h.value=!1)}),X(e,()=>{m.submissionName=="new"&&e.value&&(h.value=!0)}),X(()=>{var _;return(_=k.doc)==null?void 0:_.grade},(_,$)=>{_!==$&&k.doc&&(k.doc.status="Graded",h.value=!0)});const J=()=>{var _,$,v;if(m.submissionName!="new"){let E=k.doc&&k.doc.owner!=((_=r.data)==null?void 0:_.name)?($=r.data)==null?void 0:$.name:null;k.setValue.submit(De(qe({},k.doc),{assignment_attachment:(v=e.value)==null?void 0:v.file_url,evaluator:E,comments:l.value,answer:t.value}),{onSuccess(B){ue.success(__("Changed successfully")),h.value=!1}})}else f()},f=()=>{R.submit({},{onSuccess(_){ue.success(__("Assignment submitted successfully")),n.currentRoute.value.name=="AssignmentSubmission"?n.push({name:"AssignmentSubmission",params:{assignmentID:m.assignmentID,submissionName:_.name}}):(L(),n.go()),k.name=_.name,h.value=!1,k.reload()},onError(_){var $;ue.error((($=_.messages)==null?void 0:$[0])||_)}})},P=_=>{h.value=!0,e.value=_},L=()=>{if(n.currentRoute.value.name=="Lesson"){let _=n.currentRoute.value.params.courseName,$=n.currentRoute.value.params.chapterNumber,v=n.currentRoute.value.params.lessonNumber;console.log("Chapter Number: ",$),console.log("Lesson Number: ",v),Me("seminary.seminary.api.mark_lesson_progress",{course:_,chapter_number:$,lesson_number:v})}},b=()=>{var $;const _=($=x.data)==null?void 0:$.type;if(_=="Image")return["image/*"];if(_=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(_=="PDF")return[".pdf"]},g=_=>{var E;let $=(E=x.data)==null?void 0:E.type,v=_.name.split(".").pop().toLowerCase();if($=="Image"&&!["jpg","jpeg","png"].includes(v))return"Only image file is allowed.";if($=="Document"&&!["doc","docx","xml"].includes(v))return"Only document file is allowed.";if($=="PDF"&&!["pdf"].includes(v))return"Only PDF file is allowed."},z=()=>{h.value=!0,e.value=null},M=oe(()=>{var _,$,v;return(((_=r.data)==null?void 0:_.is_moderator)||(($=r.data)==null?void 0:$.is_evaluator)||((v=r.data)==null?void 0:v.is_instructor))&&m.submissionName!="new"&&n.currentRoute.value.name=="AssignmentSubmission"}),re=oe(()=>{var _,$,v;return!k.doc||((_=k.doc)==null?void 0:_.owner)==(($=r.data)==null?void 0:$.name)&&((v=k.doc)==null?void 0:v.status)=="Not Graded"}),le=oe(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Graded",value:"Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),Q=oe(()=>k.doc?k.doc.status=="Pass"||k.doc.status=="Graded"?"green":k.doc.status=="Not Graded"?"blue":"red":"orange"),U=()=>{var _;return["PDF","Image","Document"].includes((_=x.data)==null?void 0:_.type)};return(_,$)=>{var v,E,B,ie,be,pe,he,ke,fe,ge;return s(x).data?(a(),c("div",{key:0,class:Ie(["grid grid-cols-[65%,35%] h-full",{"border rounded-lg":!y}])},[o("div",bo,[y?(a(),c("div",ko,[d.submissionName==="new"?(a(),c("div",xo,i(_.__("Submission by"))+" "+i((v=s(r).data)==null?void 0:v.full_name),1)):(a(),c("div",wo,i(_.__("Submission by"))+" "+i((E=s(k).doc)==null?void 0:E.member_name),1))])):S("",!0),o("div",$o,i(_.__("Question"))+": ",1),o("div",{innerHTML:s(x).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,So)]),o("div",Co,[o("div",To,[o("div",Ao,[o("div",Eo,i(_.__("Submission")),1),o("div",Mo,[h.value?(a(),A(s(Se),{key:0,theme:"orange"},{default:F(()=>[ae(i(_.__("Not Saved")),1)]),_:1})):(B=s(k).doc)!=null&&B.status?(a(),A(s(Se),{key:1,theme:Q.value,size:"lg"},{default:F(()=>{var j;return[ae(i((j=s(k).doc)==null?void 0:j.status),1)]}),_:1},8,["theme"])):S("",!0),T(s(V),{variant:"solid",onClick:$[0]||($[0]=j=>J())},{default:F(()=>[ae(i(_.__("Save")),1)]),_:1})])]),d.submissionName!="new"&&!["Pass","Fail","Graded"].includes((ie=s(k).doc)==null?void 0:ie.status)&&((be=s(k).doc)==null?void 0:be.owner)==((pe=s(r).data)==null?void 0:pe.name)?(a(),c("div",Fo,i(_.__("You've successfully submitted the assignment."))+" "+i(_.__("Once the moderator grades your submission, you'll find the details here."))+" "+i(_.__("Feel free to make edits to your submission if needed, until it is graded.")),1)):S("",!0),U()?(a(),c("div",zo,[o("div",Lo,i(_.__("Add your assignment as {0}").format(s(x).data.type)),1),e.value?(a(),c("div",qo,[o("div",Io,[o("div",No,[T(s(ts),{class:"h-5 w-5 stroke-1.5"})]),o("a",{href:e.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[o("span",Do,i(e.value.file_name),1),o("span",Ro,i(s(nr)(e.value.file_size)),1)],8,Po),re.value?(a(),A(s(Nt),{key:0,onClick:$[2]||($[2]=j=>z()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):S("",!0)])])):(a(),A(s(lt),{key:0,fileTypes:b(),validateFile:g,onSuccess:$[1]||($[1]=j=>P(j))},{default:F(({uploading:j,progress:we,openFileSelector:$e})=>[T(s(V),{onClick:$e,loading:j},{default:F(()=>[ae(i(j?_.__("Uploading {0}%").format(we):_.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):s(x).data.type=="URL"?(a(),c("div",Uo,[o("div",Ho,i(_.__("Enter a URL")),1),T(s(Ce),{modelValue:t.value,"onUpdate:modelValue":$[3]||($[3]=j=>t.value=j),type:"text",readonly:!re.value},null,8,["modelValue","readonly"])])):(a(),c("div",Oo,[o("div",Vo,i(_.__("Write your answer here")),1),T(s(ze),{content:t.value,onChange:$[4]||($[4]=j=>t.value=j),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((he=s(r).data)==null?void 0:he.name)==((ke=s(k).doc)==null?void 0:ke.owner)&&((fe=s(k).doc)!=null&&fe.comments)?(a(),c("div",jo,[o("div",Bo,i(_.__("Comments by"))+": "+i(((ge=s(k).doc)==null?void 0:ge.evaluator)||_.__("Evaluator")),1),o("div",Qo,[o("div",{innerHTML:s(k).doc.comments},null,8,Jo)])])):S("",!0),M.value?(a(),c("div",Go,[o("div",Wo,i(_.__("Grading")),1),s(k).doc?(a(),A(s(Ce),{key:0,modelValue:s(k).doc.status,"onUpdate:modelValue":$[5]||($[5]=j=>s(k).doc.status=j),label:_.__("Grading Status"),type:"select",options:le.value},null,8,["modelValue","label","options"])):S("",!0),s(k).doc?(a(),A(s(Ce),{key:1,modelValue:s(k).doc.grade,"onUpdate:modelValue":$[6]||($[6]=j=>s(k).doc.grade=j),label:_.__("Score"),type:"number"},null,8,["modelValue","label"])):S("",!0),o("div",null,[o("div",Yo,i(_.__("Comments")),1),T(s(ze),{content:l.value,onChange:$[7]||($[7]=j=>{l.value=j,h.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):S("",!0)])])],2)):S("",!0)}}},Zo={key:1,class:"border rounded-md text-center py-20"},Ko={__name:"AssignmentBlock",props:{assignmentID:{type:String,required:!0}},setup(d){const e=_e("$user"),t=d,l=D({url:"frappe.client.get_value",makeParams(n){var r;return{doctype:"Assignment Submission",fieldname:"name",filters:{assignment:t.assignmentID,member:(r=e.data)==null?void 0:r.name}}},auto:!0});return(n,r)=>{var y;return s(e).data&&s(l).data?(a(),A(Xo,{key:0,assignmentID:d.assignmentID,submissionName:((y=s(l).data)==null?void 0:y.name)||"new"},null,8,["assignmentID","submissionName"])):(a(),c("div",Zo,[o("div",null,i(n.__("Please login to access the assignment.")),1),T(s(V),{onClick:r[0]||(r[0]=h=>n.redirectToLogin()),class:"mt-2"},{default:F(()=>[o("span",null,i(n.__("Login")),1)]),_:1})]))}}};class ea{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=Z({render:()=>xe(Pt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Assignment"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderAssignment(this.data.assignment):this.renderAssignmentModal(),this.wrapper}renderAssignment(e){if(this.readOnly){const t=Z(Ko,{assignmentID:e});t.use(ce),t.use(ve);const{userResource:l}=je();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Assignment: ${e}
            </span>
        </div>`}renderAssignmentModal(){if(this.readOnly)return;const e=Z(Qe,{type:"assignment",onAddition:t=>{this.data.assignment=t,this.renderAssignment(t)}});e.use(ce),e.use(ve),e.mount(this.wrapper)}save(e){return{assignment:this.data.assignment}}}const ta={key:0,class:"text-center py-5"},sa={key:1,class:"space-y-5"},oa={class:"grid grid-cols-3 gap-3"},aa={class:"col-span-3 space-y-4"},na={class:"space-y-4 border p-2 rounded-md"},ra={class:"flex items-center justify-between py-4"},la={class:"text-center ml-5"},ia={class:"text-3xl font-bold text-ink-gray-9"},da={class:"text-center"},ua={class:"text-3xl font-semibold text-ink-gray-9"},ca={class:"text-sm text-ink-gray-5"},ma={class:"text-center mr-5"},pa={class:"text-3xl font-semibold text-ink-gray-9 mt-2"},ha={class:"space-y-1"},fa={class:"font-semibold text-ink-gray-9 text-left"},ga=["innerHTML"],ya={class:"leading-5 text-ink-gray-7 space-x-1 text-left"},va=["innerHTML"],_a={class:"flex justify-end items-center space-x-2"},ba={class:"text-sm text-ink-gray-7 text-xl"},ka={key:0,class:"leading-5 text-ink-gray-7 text-xl space-x-1 text-left"},xa=["innerHTML"],wa={key:2},$a={__name:"ExamGraded",props:{submission:{type:Object,required:!0}},setup(d){const e=d;console.log("ExamGraded received submission:",e.submission);const t=ot({doctype:"Exam Submission",name:e.submission,auto:!0});console.log("ExamGraded submisisonDetails:",t),X(()=>t.doc,n=>{t.loading=!1,console.log("ExamGraded updated with new submission details:",n)});const l=n=>{if(!n)return"00:00:00";const r=Math.floor(n/3600).toString().padStart(2,"0"),y=Math.floor(n%3600/60).toString().padStart(2,"0"),h=(n%60).toString().padStart(2,"0");return`${r}:${y}:${h}`};return(n,r)=>s(t).loading?(a(),c("div",ta,[...r[0]||(r[0]=[o("p",null,"Loading submission details...",-1)])])):s(t).doc?(a(),c("div",sa,[o("div",oa,[o("div",aa,[o("div",na,[o("div",ra,[o("div",la,[o("div",ia,i(s(t).doc.percentage||0)+"% ",1),r[1]||(r[1]=o("div",{class:"text-sm text-ink-gray-5"},"Score",-1))]),o("div",da,[o("div",ua,i(s(t).doc.score),1),o("div",ca," Out of "+i(s(t).doc.score_out_of)+" Points ",1)]),o("div",ma,[o("div",pa,i(l(s(t).doc.time_taken)),1),r[2]||(r[2]=o("div",{class:"text-sm text-ink-gray-5"},"Time taken",-1))])])]),(a(!0),c(se,null,ne(s(t).doc.result,(y,h)=>(a(),c("div",{key:h,class:"border p-5 rounded-md space-y-4"},[o("div",ha,[o("div",fa,i(n.__("Question"))+" "+i(h+1)+": ",1),o("div",{class:"leading-5 text-ink-gray-9 text-left",innerHTML:y.question_name},null,8,ga)]),o("div",ya,[o("span",null,i(n.__("Your Answer"))+": ",1),o("span",{innerHTML:y.answer},null,8,va)]),o("div",_a,[o("span",ba,i(y.points)+" / "+i(parseInt(y.points_out_of,10))+" "+i(n.__("Points")),1)]),y.comments?(a(),c("div",ka,[o("span",null,i(n.__("Comments"))+": ",1),o("span",{innerHTML:y.comments},null,8,xa)])):S("",!0)]))),128))])])])):(a(),c("div",wa,[...r[3]||(r[3]=[o("p",null,"Debug: No submission details found.",-1)])]))}},pt={__name:"UserAvatar",props:{user:{type:Object,default:null},size:{type:String}},setup(d){return(e,t)=>(a(),A(s(Oe),{text:d.user.full_name},{default:F(()=>[d.user?(a(),A(s(At),Et({key:0,class:"avatar border border-outline-gray-2 cursor-auto",label:d.user.full_name,image:d.user.user_image,size:d.size},e.$attrs),null,16,["label","image","size"])):S("",!0)]),_:1},8,["text"]))}},Sa={class:"mt-6"},Ca={key:0,class:"flex items-center mb-5"},Ta={class:"text-lg font-semibold ml-2 text-ink-gray-9"},Aa={class:"flex items-center justify-between mb-2"},Ea={class:"flex items-center text-ink-gray-5"},Ma={class:"text-sm ml-2"},Fa={key:1},za={key:0},La={key:1,class:"formatted-reply"},qa=["innerHTML"],Ia=["value"],Na={class:"flex justify-between mt-2"},Ze={__name:"DiscussionReplies",props:at({topic:{type:Object,required:!0},singleThread:{type:Boolean,default:!1}},{showTopics:{},showTopicsModifiers:{}}),emits:["update:showTopics"],setup(d){const e=nt(),t=C(!1),l=rt(d,"showTopics"),n=C(""),r=_e("$user");console.log("User data:",r.data.is_student);const y=C([]),h=C(!1),m=d,w=`editor-${m.topic.name}`;me(()=>{console.log("DiscussionReplies mounted. Registering socket listeners."),console.log("Topic received:",m.topic.name),I(),x.reload({},{onSuccess(g){console.log("Replies fetched successfully:",g)},onError(g){console.error("Error fetching replies:",g)}}),e.on("publish_message",g=>{x.reload()}),e.on("update_message",g=>{x.reload()}),e.on("delete_message",g=>{x.reload()}),h.value=!0,console.log("TextEditor renderEditor set to true."),console.log("Editor key:",w)}),X(m.topic,(g,z)=>{g.name!==z.name&&(w.value=`editor-${g.name}`,console.log("Editor key updated:",w.value))}),X(n,g=>{console.log("New reply value:",g),g||console.warn("Reply is empty. Ensure the input is being updated correctly.")}),X(h,g=>{g&&console.log("TextEditor is now visible and ready for initialization.")});const x=D({url:"seminary.seminary.utils.get_discussion_replies",auto:!1,makeParams(){return{topic:m.topic.name}},onSuccess(g){console.log("Replies fetched successfully:",g)},onError(g){console.error("Error fetching replies:",g)}}),R=D({url:"seminary.seminary.utils.insert_discussion_reply",makeParams(g){return{reply:n.value,topic:m.topic.name}},onSuccess(g){console.log("Discussion saved successfully:",g)},onError(g){console.error("Error inserting replies:",g)}}),I=()=>{var g;console.log("User data in fetchMentionUsers:",r.data),(g=r.data)!=null&&g.is_student?h.value=!0:(t.value=!0,b.reload({},{onSuccess(z){y.value=Object.values(z).map(M=>({value:M.name,label:M.full_name})),h.value=!0,t.value=!1},onError(z){console.error("Error fetching mention users:",z),t.value=!1}}))},k=()=>{R.submit({},{onSuccess(){n.value="",x.reload()},onError(g){var z;ft({title:"Error",text:((z=g.messages)==null?void 0:z[0])||g,icon:"x",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:10})}})},J=D({url:"frappe.client.set_value",makeParams(g){return{doctype:"Discussion Reply",name:g.name,fieldname:"reply",value:g.reply}}}),f=g=>{J.submit({name:g.name,reply:g.reply},{validate(){if(!g.reply)return"Reply cannot be empty"},onSuccess(){g.editable=!1,x.reload()}})},P=D({url:"frappe.client.delete",makeParams(g){return{doctype:"Discussion Reply",name:g.name}}}),L=g=>{P.submit({name:g.name},{onSuccess(){x.reload()}})},b=D({url:"seminary.seminary.utils.get_all_users"});return console.log("All Users:",b),(g,z)=>(a(),c("div",Sa,[d.singleThread?S("",!0):(a(),c("div",Ca,[T(s(V),{variant:"outline",onClick:z[0]||(z[0]=M=>l.value=!0)},{icon:F(()=>[T(s(Yt),{class:"w-5 h-5 stroke-1.5 text-ink-gray-7"})]),_:1}),o("span",Ta,i(d.topic.title),1)])),(a(!0),c(se,null,ne(s(x).data,(M,re)=>{var le;return a(),c("div",{key:M.name},[o("div",{class:Ie(["py-3",{"border-b":re+1!=s(x).data.length}])},[o("div",Aa,[o("div",Ea,[T(pt,{user:M.user,class:"mr-2"},null,8,["user"]),o("span",null,i(((le=M.user)==null?void 0:le.full_name)||M.owner),1),o("span",Ma,i(s(Pe)(M.creation)),1)]),s(r).data.name==M.owner&&!M.editable?(a(),A(s(Mt),{key:0,options:[{label:"Edit",onClick(){M.editable=!0}},{label:"Delete",onClick(){L(M)}}]},{default:F(({open:Q})=>[T(s(es),{class:"w-4 h-4 stroke-1.5 cursor-pointer"})]),_:1},8,["options"])):S("",!0),M.editable?(a(),c("div",Fa,[T(s(V),{variant:"ghost",onClick:Q=>f(M)},{default:F(()=>[ae(i(g.__("Post")),1)]),_:1},8,["onClick"]),T(s(V),{variant:"ghost",onClick:Q=>M.editable=!1},{default:F(()=>[ae(i(g.__("Discard")),1)]),_:1},8,["onClick"])])):S("",!0)]),M.editable?(a(),c("div",za,[T(s(ze),{content:M.reply,onChange:Q=>M.reply=Q,editable:!0,fixedMenu:!0,editorClass:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none"},null,8,["content","onChange"])])):(a(),c("div",La,[o("div",{innerHTML:M.reply,class:"p-2"},null,8,qa)]))],2)])}),128)),ye(o("textarea",{class:"mt-5",value:n.value,onInput:z[1]||(z[1]=M=>n.value=M),placeholder:"Type your reply here...",fixedMenu:!0},null,40,Ia),[[et,h.value]]),o("div",Na,[z[3]||(z[3]=o("span",null,null,-1)),T(s(V),{onClick:z[2]||(z[2]=M=>k())},{default:F(()=>[o("span",null,i(g.__("Post")),1)]),_:1})])]))}},Pa={class:"flex flex-col gap-4"},Da={class:"mb-1.5 text-sm text-ink-gray-5"},Ke={__name:"DiscussionModal",props:at({title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0}},{reloadTopics:{},reloadTopicsModifiers:{}}),emits:["update:reloadTopics"],setup(d){const e=rt(d,"reloadTopics"),t=d,l=Ee({title:"",reply:""}),n=D({url:"frappe.client.insert",makeParams(h){return{doc:{doctype:"Discussion Topic",reference_doctype:t.doctype,reference_docname:t.docname,title:l.title}}}}),r=D({url:"frappe.client.insert",makeParams(h){return{doc:{doctype:"Discussion Reply",topic:h.topic,reply:l.reply}}}}),y=h=>{n.submit({},{validate(){if(!l.title)return"Title cannot be empty.";if(!l.reply)return"Reply cannot be empty."},onSuccess(m){r.submit({topic:m.name},{onSuccess(){l.title="",l.reply="",e.value.reload(),h()}})},onError(m){var w;ue.error(((w=m.messages)==null?void 0:w[0])||m)}})};return(h,m)=>(a(),A(s(st),{options:{title:s(gt)(t.title),size:"2xl",actions:[{label:"Post",variant:"solid",onClick:w=>y(w)}]}},{"body-content":F(()=>[o("div",Pa,[o("div",null,[T(s(Ce),{modelValue:l.title,"onUpdate:modelValue":m[0]||(m[0]=w=>l.title=w),label:h.__("Title"),type:"text"},null,8,["modelValue","label"])]),o("div",null,[o("div",Da,i(h.__("Details")),1),T(s(ze),{content:l.reply,onChange:m[1]||(m[1]=w=>l.reply=w),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])]),_:1},8,["options"]))}};function Ra(){return window.scrollContainer}const Ua={class:"text-xl font-semibold text-ink-gray-9"},Ha={key:0},Oa={key:1},Va={key:2},ja=["onClick"],Ba={class:"text-lg font-semibold mb-1 text-ink-gray-7"},Qa={class:"flex items-center text-ink-gray-5"},Ja={class:"text-sm ml-3"},Ga={key:1},Wa={key:3,class:"flex flex-col items-center justify-center border-2 border-dashed mt-5 py-8 rounded-md"},Ya={class:""},Xa={key:0,class:"font-medium mb-2"},Za={class:"text-ink-gray-5"},Ka={__name:"Discussions",props:{title:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0},emptyStateTitle:{type:String,default:""},emptyStateText:{type:String,default:"Start a discussion"},singleThread:{type:Boolean,default:!1},scrollToBottom:{type:Boolean,default:!1},type:{type:String,default:"multi"}},setup(d){console.log("Discussions.vue script setup executed");const e=C(!0),t=C(null),l=_e("$user"),n=C(!1),r=C(!0),y=C(!1),h=nt();h?(console.log("Socket connection initialized in Discussions.vue:",h),h.on("connect",()=>{console.log("Socket connected:",h.id),y.value=!0}),h.on("connect_error",f=>{console.error("Socket connection error:",f)}),h.on("disconnect",f=>{console.warn("Socket disconnected:",f),y.value=!1})):console.error("Socket connection not initialized in Discussions.vue.");const m=d;X(y,f=>{f&&(console.log("Socket is connected, proceeding with onMounted logic."),w())});const w=()=>{console.log("onMounted logic executed"),console.log("Props:",m),l.data&&(m.type==="single"?(console.log("Single-topic mode detected"),R.reload(),console.log("Topic",t.value)):r.value=!1,I.reload()),h.on("new_discussion_topic",f=>{I.refresh()}),m.scrollToBottom&&setTimeout(()=>{x()},100)},x=()=>{let f=Ra();f.scrollTop=f.scrollHeight},R=D({url:"seminary.seminary.utils.ensure_single_topic",cache:!1,makeParams(){return{doctype:m.doctype,docname:m.docname,title:m.title}},onSuccess(f){console.log("Ensure single topic response:",f),f&&(t.value=f,console.log("Current topic set:",t.value),e.value=!1,r.value=!1),console.log("Changed loading to:",r.value)},onError(f){console.error("Error ensuring single topic:",f),r.value=!1}}),I=D({url:"seminary.seminary.utils.get_discussion_topics",cache:["topics",m.doctype,m.docname],makeParams(){return{doctype:m.doctype,docname:m.docname,single_thread:m.singleThread}}}),k=f=>{e.value=!1,t.value=f},J=()=>{n.value=!0};return(f,P)=>{var L;return a(),c(se,null,[o("div",null,[!d.singleThread&&m.type==="multi"?(a(),A(s(V),{key:0,class:"float-right",onClick:P[0]||(P[0]=b=>J())},{default:F(()=>[ae(i(f.__("New {0}").format(s(gt)(d.title))),1)]),_:1})):S("",!0),o("div",Ua,i(f.__(d.title)),1)]),r.value&&m.type==="single"?(a(),c("div",Ha,[...P[6]||(P[6]=[o("div",{class:"text-center py-10"},[o("span",null,"Loading discussion...")],-1)])])):S("",!0),m.type==="single"&&!r.value?(a(),c("div",Oa,[P[7]||(P[7]=o("div",{class:"flex flex-col items-center justify-center"},null,-1)),T(Ke,{modelValue:n.value,"onUpdate:modelValue":P[1]||(P[1]=b=>n.value=b),title:d.title,doctype:m.doctype,docname:m.docname},null,8,["modelValue","title","doctype","docname"]),t.value.value?(a(),A(Ze,{key:0,topic:t.value.value,singleThread:!0,showTopics:e.value,"onUpdate:showTopics":P[2]||(P[2]=b=>e.value=b)},null,8,["topic","showTopics"])):S("",!0)])):S("",!0),(L=s(I).data)!=null&&L.length&&!d.singleThread?(a(),c("div",Va,[e.value?(a(!0),c(se,{key:0},ne(s(I).data,(b,g)=>(a(),c("div",{key:g},[o("div",{onClick:z=>k(b),class:Ie(["flex items-center cursor-pointer py-5 w-full",{"border-b":g+1!=s(I).data.length}])},[T(pt,{user:b.user,size:"2xl",class:"mr-4"},null,8,["user"]),o("div",null,[o("div",Ba,i(b.title),1),o("div",Qa,[o("span",null,i(b.user.full_name),1),o("span",Ja,i(s(Pe)(b.creation)),1)])])],10,ja)]))),128)):(a(),c("div",Ga,[T(Ze,{topic:t.value,showTopics:e.value,"onUpdate:showTopics":P[3]||(P[3]=b=>e.value=b)},null,8,["topic","showTopics"])]))])):(a(),c("div",Wa,[T(s(as),{class:"w-7 h-7 text-ink-gray-4 stroke-1.5 mr-2"}),o("div",Ya,[d.emptyStateTitle?(a(),c("div",Xa,i(f.__(d.emptyStateTitle)),1)):S("",!0),o("div",Za,i(f.__(d.emptyStateText)),1)])])),T(Ke,{modelValue:n.value,"onUpdate:modelValue":P[4]||(P[4]=b=>n.value=b),title:f.__("New {0}").format(d.title),doctype:m.doctype,docname:m.docname,reloadTopics:s(I),"onUpdate:reloadTopics":P[5]||(P[5]=b=>Be(I)?I.value=b:null)},null,8,["modelValue","title","doctype","docname","reloadTopics"])],64)}}},en={key:0},tn={key:0,class:"bg-blue-200 space-y-1 py-4 px-3 mb-4 rounded-md text-lg text-ink-blue-900"},sn={class:"leading-5"},on={key:0,class:"leading-5"},an={key:1,class:"leading-5"},nn={key:1,class:"space-y-4 border p-5 rounded-md"},rn={key:2,class:"flex flex-col space-x-1 my-4"},ln={class:"mb-2"},dn={class:"font-semibold"},un={key:3},cn={class:"border text-center p-20 rounded-md"},mn={class:"font-semibold text-lg"},pn={key:2,class:"w-full max-w-4xl mx-auto py-5"},hn={key:3},fn={key:4},gn={class:"border text-center p-20 rounded-md"},yn={class:"font-semibold text-lg text-ink-gray-9 mt-3 mb-3"},vn={class:"absolute -top-3 -left-3 bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm"},_n={class:"text-ink-gray-9 text-sm font-semibold text-right"},bn={class:"text-ink-gray-9 text-left font-semibold mt-2 leading-5"},kn=["innerHTML"],xn={class:"mt-4"},wn=["onUpdate:modelValue","onChange"],$n={class:"text-center mt-4"},Sn={__name:"Exam",props:{examName:{type:String,required:!0}},setup(d){var _,$;const e=_e("$user"),t=C(0);let l=null;const n=C(0);C("");const r=C({});C([]);const y=C(!1),h=Ve();let m=!1;const w=d;console.log("Exam Name (PROPS):",w.examName);const x=D({url:"frappe.client.get",makeParams(v){return{doctype:"Exam Activity",name:w.examName}},cache:["exam",w.examName],auto:!0,transform(v){return v?(v.duration=parseInt(v.duration)||0,v):(console.error("Exam data is null or undefined."),null)},onSuccess(v){v?v.questions=v.questions||[]:console.error("Failed to load exam data.")},onError(v){console.error("Error loading exam data:",v)}}),R=oe(()=>!!x.data),I=oe(()=>{var v;return((v=M.data)==null?void 0:v.length)>0}),k=D({url:"seminary.seminary.utils.get_instructors",makeParams(v){const E=h.currentRoute.value.params.courseName;return E?{course:E}:(console.error("Course name is undefined in route parameters."),{})},auto:!0}),J=()=>(k.data&&k.data.forEach(v=>{var E;v.user===((E=e.data)==null?void 0:E.name)&&(m=!0)}),m);let f=null;const P=()=>{if(x.data.duration){t.value=x.data.duration*60,f=Date.now();const v=f+t.value*1e3;l=setInterval(()=>{const E=Date.now(),B=Math.max(0,Math.floor((v-E)/1e3));t.value=B,n.value=x.data.duration*60-B,B<=0&&(clearInterval(l),re())},1e3)}else f=Date.now(),l=setInterval(()=>{const v=Date.now();n.value=Math.floor((v-f)/1e3)},1e3)},L=v=>{const E=Math.floor(v/60).toString().padStart(2,"0"),B=(v%60).toString().padStart(2,"0");return`${E}:${B}`},b=oe(()=>t.value/(x.data.duration*60)*100);X(r,v=>{},{deep:!0});const g=()=>{const v=zt(r.value);return Object.entries(v).map(([E,B])=>({question:E,answer:B}))},z=(v,E)=>{r[v]=E},M=D({url:"frappe.client.get_list",makeParams(v){var E;return{doctype:"Exam Submission",filters:{member:(E=e.data)==null?void 0:E.name,exam:w.examName},fields:["name","creation"],order_by:"creation desc"}},auto:!0,transform(v){v.forEach((E,B)=>{E.creation=Pe(E.creation),E.idx=B+1})}});X(()=>M.data,v=>{console.log("Attempts data updated:",v)});const re=()=>Y(this,null,function*(){var v,E;try{const B=g(),ie=x.data.duration?x.data.duration*60-(t.value||0):n.value||0;yield Me("seminary.seminary.doctype.exam_submission.exam_submission.create_exam_submission",{exam:w.examName,course:h.currentRoute.value.params.courseName,member:(v=e.data)==null?void 0:v.name,answers:B,time_taken:ie}),ue.success(__("Your exam was submitted successfully.")),clearInterval(l)}catch(B){console.error("Error during exam submission:",B),ue.error(((E=err.messages)==null?void 0:E[0])||err)}}),le=()=>{activeQuestion.value=1,localStorage.removeItem(x.data.title),P()},Q=()=>{localStorage.removeItem(x.data.title),y.value=!0,P()},U=D({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:w.examName,member:(_=e.data)==null?void 0:_.name,status:"Graded"}},auto:!1,transform(v){return console.log("Fetched submission data:",v),v},onError(v){console.error("Error fetching submission:",v)}}),K=D({url:"frappe.client.get_value",params:{doctype:"Exam Submission",fieldname:"name",filters:{exam:w.examName,member:($=e.data)==null?void 0:$.name}},auto:!1,transform(v){return console.log("Fetched submission AnyStatus:",v.name),v},onError(v){console.error("Error fetching submission:",v)}});return me(()=>{U.reload(),K.reload()}),(v,E)=>{var ie,be,pe,he,ke,fe,ge,j,we,$e,Le,Te,Ae,p;const B=Ft("router-link");return R.value?(a(),c("div",en,[I.value?S("",!0):(a(),c("div",tn,[o("div",sn,i(`This exam consists of ${s(x).data.questions.length}`)+" "+i(s(x).data.questions.length===1?"question":"questions")+". ",1),(ie=s(x).data)!=null&&ie.duration?(a(),c("div",on,i(`Please ensure that you complete all the questions in ${s(x).data.duration} minutes.`),1)):S("",!0),(be=s(x).data)!=null&&be.duration?(a(),c("div",an,i("If you fail to do so, the exam will be automatically submitted when the timer ends."))):S("",!0)])),I.value&&((pe=s(K))!=null&&pe.data||(he=s(M).data)!=null&&he[0])?(a(),c("div",nn,[(a(),A(Ka,{title:"Exam Comments",doctype:"Exam Submission",docname:((fe=(ke=s(K))==null?void 0:ke.data)==null?void 0:fe.name)||((j=(ge=s(M).data)==null?void 0:ge[0])==null?void 0:j.name),key:(($e=(we=s(K))==null?void 0:we.data)==null?void 0:$e.name)||((Te=(Le=s(M).data)==null?void 0:Le[0])==null?void 0:Te.name),type:"single"},null,8,["docname"]))])):S("",!0),s(x).data.duration&&!I.value?(a(),c("div",rn,[o("div",ln,[E[0]||(E[0]=o("span",{class:""},i("Time")+": ",-1)),o("span",dn,i(L(t.value)),1)]),T(mt,{progress:b.value},null,8,["progress"])])):S("",!0),!y.value&&!J()?(a(),c("div",un,[o("div",cn,[o("div",mn,i(s(x).data.title),1),s(x).data.qbyquestion&&!I.value?(a(),A(s(V),{key:0,onClick:le,class:"mt-2"},{default:F(()=>[...E[1]||(E[1]=[o("span",null,i("Start"),-1)])]),_:1})):I.value?I.value&&((p=(Ae=s(U))==null?void 0:Ae.data)!=null&&p.name)?(a(),c("div",pn,[T($a,{submission:s(U).data.name},null,8,["submission"])])):(a(),c("div",hn,i("You have already submitted this exam. As soon as it is graded, you will see the feedback here."))):(a(),A(s(V),{key:1,onClick:Q,class:"mt-2"},{default:F(()=>[...E[2]||(E[2]=[o("span",null,i("Start Exam"),-1)])]),_:1}))])])):S("",!0),y.value||J()?(a(),c("div",fn,[o("div",gn,[o("div",yn,i(s(x).data.title),1),J()?(a(),A(B,{key:0,to:{name:"ExamForm",params:{examID:s(x).data.name}},class:"flex items-center text-gray-400 mb-3 mr-4 hover:text-gray-600"},{default:F(()=>[T(s(ns),{class:"w-5 h-5 mr-2"}),E[3]||(E[3]=o("span",{class:"tooltip","data-tooltip":"Edit this exam"},"Edit",-1))]),_:1},8,["to"])):S("",!0),(a(!0),c(se,null,ne(s(x).data.questions,(u,H)=>(a(),c("div",{key:u.name,class:"relative border rounded-md p-5 mb-4"},[o("div",vn,i(H+1),1),o("div",_n,i(u.points)+" "+i(u.points===1?"Point":"Points"),1),o("div",bn,[o("div",{innerHTML:u.question_detail||"No question detail provided."},null,8,kn)]),o("div",xn,[ye(o("textarea",{"onUpdate:modelValue":N=>r.value[u.name]=N,class:"border rounded-md p-2 w-full",placeholder:"Type your answer here",onChange:N=>z(u.name,N)},null,40,wn),[[Ne,r.value[u.name]]])])]))),128)),o("div",$n,[T(s(V),{onClick:re},{default:F(()=>[...E[4]||(E[4]=[o("span",null,i("Submit Your Exam"),-1)])]),_:1})])])])):S("",!0)])):S("",!0)}}},Cn={key:1,class:"border rounded-md text-center py-20"},Tn={__name:"ExamBlock",props:{exam:{type:String,required:!0}},setup(d){const e=_e("$user"),t=()=>{window.location.href="/login"};return(l,n)=>s(e).data?(a(),A(Sn,{key:0,examName:d.exam},null,8,["examName"])):(a(),c("div",Cn,[o("div",null,i(l.__("Please login to access the exam.")),1),T(s(V),{onClick:n[0]||(n[0]=r=>t()),class:"mt-2"},{default:F(()=>[o("span",null,i(l.__("Login")),1)]),_:1})]))}};class An{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=Z({render:()=>xe(Bt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:__("Exam"),icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),Object.keys(this.data).length?this.renderExam(this.data.exam):this.renderExamModal(),this.wrapper}renderExam(e){if(this.readOnly){const t=Z(Tn,{exam:e});t.use(ce),t.use(ve);const{userResource:l}=je();t.provide("$user",l),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
            <span class="font-medium">
                Exam: ${e}
            </span>
        </div>`}renderExamModal(){if(this.readOnly)return;const e=Z(Qe,{type:"exam",onAddition:t=>{this.data.exam=t,this.renderExam(t)}});e.use(ce),e.use(ve),e.mount(this.wrapper)}save(e){return{exam:this.data.exam}}}const En=["src"],Mn={class:"flex items-center space-x-2 shadow rounded-lg p-1 w-1/2"},Fn=["max"],zn={class:"text-xs text-ink-gray-9 font-medium"},Ln={__name:"AudioBlock",props:{file:{type:String,required:!0}},setup(d){const e=C(!1),t=C(null);let l=C(!1),n=C(0),r=C(0);me(()=>{setTimeout(()=>{t.value=document.querySelector("audio"),t.value.onloadedmetadata=()=>{r.value=t.value.duration},t.value.ontimeupdate=()=>{n.value=t.value.currentTime}},0)});const y=()=>{t.value.paused?(t.value.play(),e.value=!0):(t.value.pause(),e.value=!1)},h=()=>{t.value.muted=!t.value.muted,l.value=t.value.muted},m=()=>{t.value.currentTime=n.value},w=()=>{e.value=!1},x=R=>{const I=Math.floor(R/60),k=Math.floor(R%60);return`${I}:${k<10?"0":""}${k}`};return X(e,R=>{R?t.value.play():t.value.pause()}),(R,I)=>(a(),c("div",null,[o("audio",{onEnded:w,controlsList:"nodownload",class:"mb-4"},[o("source",{src:encodeURI(d.file),type:"audio/mp3"},null,8,En)],32),o("div",Mn,[T(s(V),{variant:"ghost",onClick:y},{icon:F(()=>[e.value?(a(),A(s(it),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(a(),A(s(dt),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),ye(o("input",{type:"range",min:"0",max:s(r),step:"0.1","onUpdate:modelValue":I[0]||(I[0]=k=>Be(n)?n.value=k:n=k),onInput:m,class:"duration-slider w-full h-1"},null,40,Fn),[[Ne,s(n)]]),o("span",zn,i(x(s(n)))+" / "+i(x(s(r))),1),T(s(V),{variant:"ghost",onClick:h},{icon:F(()=>[s(l)?(a(),A(s(ct),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(a(),A(s(ut),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1})])]))}},qn=["src","type"],In={class:"flex items-center space-x-2 bg-surface-gray-3 rounded-md p-0.5 absolute bottom-3 w-[98%] left-0 right-0 mx-auto invisible group-hover:visible"},Nn=["max"],Pn={class:"text-xs font-medium"},Dn={__name:"VideoBlock",props:{file:{type:String,required:!0},type:{type:String,default:"video/mp4"}},setup(d){const e=C(null),t=C(null);let l=C(!1),n=C(0),r=C(0),y=C(!1);const h=d;me(()=>{setTimeout(()=>{e.value.onloadedmetadata=()=>{r.value=e.value.duration},e.value.ontimeupdate=()=>{n.value=e.value.currentTime}},0)});const m=oe(()=>{if(w){let b=h.file;return b.includes("watch?v=")&&(b=b.replace("watch?v=","embed/")),`${b}?autoplay=0&controls=0&disablekb=1&playsinline=1&cc_load_policy=1&cc_lang_pref=auto`}return h.file}),w=oe(()=>h.type=="video/youtube"),x=()=>{e.value.play(),l.value=!0},R=()=>{e.value.pause(),l.value=!1},I=()=>{l.value?R():x()},k=()=>{l.value=!1},J=()=>{e.value.muted=!e.value.muted,y.value=e.value.muted},f=()=>{e.value.currentTime=n.value},P=b=>{const g=Math.floor(b/60),z=Math.floor(b%60);return`${g}:${z<10?"0":""}${z}`},L=()=>{document.fullscreenElement?document.exitFullscreen():t.value.requestFullscreen()};return(b,g)=>(a(),c("div",{ref_key:"videoContainer",ref:t,class:"video-block group relative"},[o("video",{onTimeupdate:g[0]||(g[0]=(...z)=>b.updateTime&&b.updateTime(...z)),onEnded:k,onClick:I,oncontextmenu:"return false",class:"rounded-lg border border-gray-100 group cursor-pointer",ref_key:"videoRef",ref:e},[o("source",{src:m.value,type:d.type},null,8,qn)],544),o("div",In,[T(s(V),{variant:"ghost"},{icon:F(()=>[s(l)?(a(),A(s(it),{key:1,onClick:R,class:"w-4 h-4 text-ink-gray-9"})):(a(),A(s(dt),{key:0,onClick:x,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),T(s(V),{variant:"ghost",onClick:J},{icon:F(()=>[s(y)?(a(),A(s(ct),{key:1,class:"w-4 h-4 text-ink-gray-9"})):(a(),A(s(ut),{key:0,class:"w-4 h-4 text-ink-gray-9"}))]),_:1}),ye(o("input",{type:"range",min:"0",max:s(r),step:"0.1","onUpdate:modelValue":g[1]||(g[1]=z=>Be(n)?n.value=z:n=z),onInput:f,class:"duration-slider w-full h-1"},null,40,Nn),[[Ne,s(n)]]),o("span",Pn,i(P(s(n)))+" / "+i(P(s(r))),1),T(s(V),{variant:"ghost",onClick:L},{icon:F(()=>[T(s(os),{class:"w-4 h-4 text-ink-gray-9"})]),_:1})])],512))}},Rn=He(Dn,[["__scopeId","data-v-edd7c5f4"]]),Un={__name:"UploadPlugin",props:{onFileUploaded:{type:Function,required:!0}},emits:["fileUploaded"],setup(d,{emit:e}){const t=C(null),l=d;me(()=>Y(this,null,function*(){yield tt();const y=t.value.$el.querySelector('input[type="file"]');y&&y.click()}));const n=y=>{l.onFileUploaded({file_url:y.file_url,file_type:y.file_type})},r=y=>{let h=y.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","mp4","mov","mp3","pdf"].includes(h))return"Only image and video files are allowed."};return(y,h)=>(a(),A(s(lt),{fileTypes:["image/*","video/*","audio/*",".pdf"],validateFile:r,onSuccess:h[0]||(h[0]=m=>n(m)),ref_key:"fileUploader",ref:t,class:"hide"},null,512))}};class Hn{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l}static get toolbox(){const e=Z({render:()=>xe(ls,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Upload",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.file_url?this.renderFile(this.data):this.renderFileUploader(),this.wrapper}renderFile(e){if(this.isVideo(e.file_type)){Z(Rn,{file:e.file_url}).mount(this.wrapper);return}else if(this.isAudio(e.file_type)){Z(Ln,{file:e.file_url}).mount(this.wrapper);return}else if(e.file_type=="PDF"){this.wrapper.innerHTML=`<iframe src="https://docs.google.com/viewer?url=${window.location.origin}${encodeURI(e.file_url)}&embedded=true" width='100%' height='700px' class="mb-4" type="application/pdf"></iframe>`;return}else{this.wrapper.innerHTML=`<img class="mb-4" src=${encodeURI(e.file_url)} width='100%'>`;return}}renderFileUploader(){const e=Z(Un,{onFileUploaded:t=>{this.data.file_url=t.file_url,this.data.file_type=t.file_type,this.renderFile(t)}});e.use(ce),e.mount(this.wrapper)}validate(e){return!(!e.file_url||!e.file_type)}save(e){return{file_url:this.data.file_url,file_type:this.data.file_type}}isVideo(e){return["mov","mp4","avi","mkv","webm"].includes(e.toLowerCase())}isAudio(e){return["mp3","wav","ogg"].includes(e.toLowerCase())}}class On{constructor({data:e,api:t,readOnly:l,config:n}){this.api=t,this.data=e||{},this.config=n||{},this.text=e.text||"",this.readOnly=l,this.placeholder=__("Type '/' for commands or select text to format")}static get isReadOnlySupported(){return!0}static get conversionConfig(){return{export:"text",import:"text"}}static get toolbox(){const e=Z({render:()=>xe(Zt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"",icon:t.innerHTML}}onPaste(e){const t={text:e.detail.data.innerHTML};this.data=t,window.requestAnimationFrame(()=>{this.wrapper&&(this.wrapper.innerHTML=this.data.text||"")})}static get pasteConfig(){return{tags:["P"]}}render(){return this.wrapper=document.createElement("div"),this.wrapper.classList.add("cdx-block","ce-paragraph"),this.wrapper.innerHTML=this.text,this.readOnly||(this.wrapper.contentEditable=!0,this.wrapper.innerHTML=this.text,this.wrapper.addEventListener("input",e=>{let t=e.target.textContent;e.keyCode===32&&t.startsWith("#")?this.convertToHeader(e,t):e.keyCode==189?this.convertBlock("list",{style:"unordered"}):/^[a-zA-Z]/.test(e.key)?this.convertBlock("paragraph",{text:t}):(e.keyCode===13||e.keyCode===190)&&this.parseContent(e)})),this.wrapper}_togglePlaceholder(){document.querySelectorAll(".cdx-block.ce-paragraph[data-placeholder]").forEach(t=>{t!==this.wrapper&&delete t.dataset.placeholder}),this.wrapper.innerHTML.trim()===""?this.wrapper.dataset.placeholder=this.placeholder:delete this.wrapper.dataset.placeholder}convertToHeader(e,t){if(e.preventDefault(),["#","##","###","####","#####","######"].includes(t)){let l=t.length;e.target.textContent="",this.convertBlock("header",{level:l})}}parseContent(e){e.preventDefault();let t=this.wrapper.textContent;if(e.keyCode===190&&(t=t+"."),t&&this.hasImage(t))this.wrapper.textContent="",this.convertBlock("image");else if(t&&this.hasLink(t)){const{text:l,url:n}=this.extractLink(t),r=`<a href="${n}" target="_blank">${l}</a>`;this.convertBlock("paragraph",{text:t.replace(/\[.+?\]\(.+?\)/,r)})}else t&&t.startsWith("- ")?this.convertBlock("list",{style:"unordered",items:[{content:t.replace("- ","")}]}):t&&t.startsWith("1.")?this.convertBlock("list",{style:"ordered",items:[{content:t.replace("1.","")}]}):t&&this.canBeEmbed(t)?(this.wrapper.textContent="",this.convertBlock("embed",{source:t})):this.convertBlock("paragraph",{text:t})}convertBlock(e,t,l=null){return Y(this,null,function*(){const n=this.api.blocks.getCurrentBlockIndex(),r=this.api.blocks.getBlockByIndex(n);yield this.api.blocks.convert(r.id,e,t),this.api.caret.focus(!0)})}save(e){return{text:e.innerHTML}}hasImage(e){return/!\[.+?\]\(.+?\)/.test(e)}extractImage(e){const t=e.match(/!\[(.+?)\]\((.+?)\)/);return t?{alt:t[1],url:t[2]}:{alt:"",url:""}}hasLink(e){return/\[.+?\]\(.+?\)/.test(e)}extractLink(e){const t=e.match(/\[(.+?)\]\((.+?)\)/);return t?{text:t[1],url:t[2]}:{text:"",url:""}}canBeEmbed(e){return/^https?:\/\/.+/.test(e.trim())}}const Vn=["light","dark"],jn={none:"Auto-detect",apache:"Apache",bash:"Bash",cs:"C#",cpp:"C++",css:"CSS",coffeescript:"CoffeeScript",diff:"Diff",go:"Go",html:"HTML, XML",http:"HTTP",json:"JSON",java:"Java",javascript:"JavaScript",kotlin:"Kotlin",less:"Less",lua:"Lua",makefile:"Makefile",markdown:"Markdown",nginx:"Nginx",objectivec:"Objective-C",php:"PHP",perl:"Perl",properties:"Properties",python:"Python",ruby:"Ruby",rust:"Rust",scss:"SCSS",sql:"SQL",shell:"Shell Session",swift:"Swift",toml:"TOML, also INI",typescript:"TypeScript",yaml:"YAML",plaintext:"Plaintext"};class Bn{constructor({data:e,api:t,config:l,readOnly:n}){this.api=t,this.readOnly=n,this.config={themeName:l.themeName&&typeof l.themeName=="string"?l.themeName:"",themeURL:l.themeURL&&typeof l.themeURL=="string"?l.themeURL:"",useDefaultTheme:l.useDefaultTheme&&typeof l.useDefaultTheme=="string"&&Vn.includes(l.useDefaultTheme.toLowerCase())?l.useDefaultTheme:"dark"},this.data={code:e.code&&typeof e.code=="string"?e.code:"",language:e.language&&typeof e.language=="string"?e.language:"Auto-detect",theme:e.theme&&typeof e.theme=="string"?e.theme:this._getThemeURLFromConfig()},this.highlightScriptID="highlightJSScriptElement",this.highlightCSSID="highlightJSCSSElement",this.codeArea=document.createElement("div"),this.selectInput=document.createElement("input"),this.selectDropIcon=document.createElement("i"),this._injectHighlightJSCSSElement(),this.api.listeners.on(window,"click",this._closeAllLanguageSelects,!0)}static get isReadOnlySupported(){return!0}static get sanitize(){return{code:!0,language:!1,theme:!1}}static get toolbox(){const e=Z({render:()=>xe(Kt,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"CodeBox",icon:t.innerHTML}}static get displayInToolbox(){return!0}static get enableLineBreaks(){return!0}render(){const e=document.createElement("pre"),t=this._createLanguageSelectElement();return e.setAttribute("class","codeBoxHolder"),this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),this.codeArea.setAttribute("contenteditable","true"),this.codeArea.innerHTML=this.data.code,this.api.listeners.on(this.codeArea,"blur",l=>this._highlightCodeArea(l),!1),this.api.listeners.on(this.codeArea,"paste",l=>this._handleCodeAreaPaste(l),!1),e.appendChild(this.codeArea),!this.readOnly&&e.appendChild(t),e}save(e){return Object.assign(this.data,{code:this.codeArea.innerHTML,theme:this._getThemeURLFromConfig()})}validate(e){return!!e.code.trim()}destroy(){this.api.listeners.off(window,"click",this._closeAllLanguageSelects,!0),this.api.listeners.off(this.codeArea,"blur",e=>this._highlightCodeArea(e),!1),this.api.listeners.off(this.codeArea,"paste",e=>this._handleCodeAreaPaste(e),!1),this.api.listeners.off(this.selectInput,"click",e=>this._handleSelectInputClick(e),!1)}_createLanguageSelectElement(){const e=document.createElement("div"),t=document.createElement("div"),l=Object.entries(jn);return e.setAttribute("class","codeBoxSelectDiv"),this.selectDropIcon.setAttribute("class",`codeBoxSelectDropIcon ${this.config.useDefaultTheme}`),this.selectDropIcon.innerHTML="&#8595;",this.selectInput.setAttribute("class",`codeBoxSelectInput ${this.config.useDefaultTheme}`),this.selectInput.setAttribute("type","text"),this.selectInput.setAttribute("readonly","true"),this.selectInput.value=this.data.language,this.api.listeners.on(this.selectInput,"click",n=>this._handleSelectInputClick(n),!1),t.setAttribute("class","codeBoxSelectPreview"),l.forEach(n=>{const r=document.createElement("p");r.setAttribute("class",`codeBoxSelectItem ${this.config.useDefaultTheme}`),r.setAttribute("data-key",n[0]),r.textContent=n[1],this.api.listeners.on(r,"click",y=>this._handleSelectItemClick(y,n),!1),t.appendChild(r)}),e.appendChild(this.selectDropIcon),e.appendChild(this.selectInput),e.appendChild(t),e}_highlightCodeArea(e){Ye.highlightBlock(this.codeArea)}_handleCodeAreaPaste(e){e.stopPropagation()}_handleSelectInputClick(e){e.target.nextSibling.classList.toggle("codeBoxShow")}_handleSelectItemClick(e,t){e.target.parentNode.parentNode.querySelector(".codeBoxSelectInput").value=t[1],e.target.parentNode.classList.remove("codeBoxShow"),this.codeArea.removeAttribute("class"),this.data.language=t[0],this.codeArea.setAttribute("class",`codeBoxTextArea ${this.config.useDefaultTheme} ${this.data.language}`),Ye.highlightElement(this.codeArea)}_closeAllLanguageSelects(){const e=document.querySelectorAll(".codeBoxSelectPreview");for(let t=0,l=e.length;t<l;t++)e[t].classList.remove("codeBoxShow")}_injectHighlightJSCSSElement(){const e=document.querySelector(`#${this.highlightCSSID}`);let t=this._getThemeURLFromConfig();if(e)e.setAttribute("href",t);else{const l=document.createElement("link"),n=document.querySelector("head");l.setAttribute("rel","stylesheet"),l.setAttribute("href",t),l.setAttribute("id",this.highlightCSSID),n&&n.appendChild(l)}}_getThemeURLFromConfig(){let e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-${this.config.useDefaultTheme}.min.css`;return this.config.themeName&&(e=`https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/${this.config.themeName}.min.css`),this.config.themeURL&&(e=this.config.themeURL),e}}const Qn={class:"Folder"},Jn={class:"ml-4"},Gn={key:0,class:"mt-4 mb-4"},Wn={key:1},Yn={key:2,class:"block mt-4"},Xn={key:0,class:"mb-4"},Zn=["href"],Kn={__name:"FolderPlugin",props:{onAddition:{type:Function,required:!1}},setup(d){const e=Lt(),t=C("select"),l=C(null),n=C(""),r=C(""),y=C([]),h=C([]),m=C(null),w=()=>Y(this,null,function*(){const L=e.params.courseName;if(console.log("Course Name: ",L),L){const g=yield D({url:"frappe.client.get_value",makeParams(z){return{doctype:"Course Schedule",fieldname:"course",filters:{name:L}}}}).fetch();m.value=g.course,console.log("Fetched Course: ",m.value)}else return console.error("Course name not found in route params"),null}),x=d,R=()=>{if(n.value){const L=n.value;x.onAddition(L),console.log("Updating props",x.onAddition)}},I=()=>Y(this,null,function*(){if(m.value||w(),m.value){const b=yield D({url:"frappe.client.get_list",makeParams(g){return{doctype:"Course Folder",filters:{course:m.value},fields:["name","foldername"]}}}).fetch();return h.value=b,console.log("Fetched Folders: ",h.value),h.value}}),k=()=>Y(this,null,function*(){if(!r.value)return alert("Folder name is required");const b=yield new ht({}).createCourseFolder(m.value,r.value);h.value.push(b),l.value=b.foldername,r.value=""}),J=()=>Y(this,null,function*(){if(n.value)try{console.log("Selected Folder (foldername): ",n.value);const b=yield D({url:"seminary.api.folder_upload.get_files_in_folder",params:{foldername:n.value},auto:!0}).fetch();y.value=b,console.log("Fetched Files: ",y.value)}catch(L){console.error("Error fetching files:",L)}}),f=L=>Y(this,null,function*(){const b=L.target.files;if(console.log("Uploaded Files: ",b),!n.value)return alert("Please select a folder first.");try{console.log("Selected Folder (foldername): ",n.value);const g=new FormData;for(const M of b)g.append("files",M);g.append("foldername",n.value),console.log("Form Data:");for(const[M,re]of g.entries())console.log(`${M}:`,re);const z=yield fetch("/api/method/seminary.api.folder_upload.upload_folder",{method:"POST",body:g});if(!z.ok){const M=yield z.json();console.error("Error uploading files:",M),alert(`Error: ${M.message||"Failed to upload files."}`);return}console.log("Files uploaded successfully."),yield J()}catch(g){console.error("Error uploading files:",g),alert("An error occurred while uploading files.")}}),P=L=>Y(this,null,function*(){yield fetch("seminary.api.folder_upload.delete_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_url:L})}).then(b=>b.json()),yield J()});return X(l,L=>Y(this,null,function*(){if(L)try{const g=yield D({url:"frappe.client.get_value",makeParams(z){return{doctype:"Course Folder",fieldname:"foldername",filters:{name:L}}}}).fetch();n.value=g.foldername,console.log("Updated foldername: ",n.value),yield R(),yield J()}catch(b){console.error("Error fetching foldername:",b)}else n.value=""})),me(()=>Y(this,null,function*(){yield w(),yield I()})),(L,b)=>(a(),c("div",Qn,[b[7]||(b[7]=o("h3",null,"Manage Course Folders",-1)),o("div",null,[o("label",null,[ye(o("input",{type:"radio","onUpdate:modelValue":b[0]||(b[0]=g=>t.value=g),value:"select"},null,512),[[We,t.value]]),b[5]||(b[5]=ae(" Select Existing Folder ",-1))]),o("label",Jn,[ye(o("input",{type:"radio","onUpdate:modelValue":b[1]||(b[1]=g=>t.value=g),value:"create"},null,512),[[We,t.value]]),b[6]||(b[6]=ae(" Create New Folder ",-1))])]),t.value==="select"?(a(),c("div",Gn,[T(Fe,{modelValue:l.value,"onUpdate:modelValue":b[2]||(b[2]=g=>l.value=g),doctype:"Course Folder",options:"foldername",label:L.__("Select a folder")},null,8,["modelValue","label"])])):S("",!0),t.value==="create"?(a(),c("div",Wn,[ye(o("input",{type:"text","onUpdate:modelValue":b[3]||(b[3]=g=>r.value=g),placeholder:"Enter folder name"},null,512),[[Ne,r.value]]),T(Fe,{modelValue:m.value,"onUpdate:modelValue":b[4]||(b[4]=g=>m.value=g),doctype:"Course",label:L.__("Select a course")},null,8,["modelValue","label"]),o("button",{onClick:k},"Create Folder")])):S("",!0),l.value?(a(),c("div",Yn,[o("h4",null,"Files in "+i(l.value),1),o("ul",null,[y.value?S("",!0):(a(),c("div",Xn,"No files found in this folder.")),(a(!0),c(se,null,ne(y.value,g=>(a(),c("li",{key:g.file_url,class:"flex items-center mb-4"},[o("a",{href:g.file_url,download:"",class:"flex-1"},i(g.file_name),9,Zn),T(s(Oe),{text:L.__("Delete File"),placement:"bottom"},{default:F(()=>[T(s(rs),{onClick:qt(z=>P(g.file_url),["prevent"]),class:"ml-4 h-4 w-4 text-red-500"},null,8,["onClick"])]),_:2},1032,["text"])]))),128))]),o("input",{type:"file",multiple:"",onChange:f},null,32)])):S("",!0)]))}},er=He(Kn,[["__scopeId","data-v-84b7d54d"]]),tr={class:"flex flex-col border-2 border-gray-200 rounded-lg p-4 mb-4"},sr={key:0,class:"mb-4"},or=["href"],ar={__name:"FolderBlock",props:{folder:{type:Object,required:!0}},setup(d){const e=C([]),t=d;console.log("folder",t.folder.folder),me(()=>{l()});const l=()=>Y(this,null,function*(){try{const r=yield D({url:"seminary.api.folder_upload.get_files_in_folder",params:{foldername:t.folder.folder},auto:!0}).fetch();e.value=r,console.log("Fetched Files: ",e.value)}catch(n){console.error("Error fetching files:",n)}});return(n,r)=>(a(),c("div",tr,[o("h4",null,"Files in "+i(t.folder.folder),1),o("ul",null,[e.value?S("",!0):(a(),c("div",sr,"No files found in this folder.")),(a(!0),c(se,null,ne(e.value,y=>(a(),c("li",{key:y.file_url,class:"flex items-center mb-4"},[o("a",{href:y.file_url,download:"",class:"flex-1"},i(y.file_name),9,or)]))),128))])]))}};class ht{constructor({data:e,api:t,readOnly:l}){this.data=e,this.readOnly=l,this.api=t,this.wrapper=void 0}static get toolbox(){const e=Z({render:()=>xe(ss,{size:18,strokeWidth:1.5,color:"black"})}),t=document.createElement("div");return e.mount(t),{title:"Folder",icon:t.innerHTML}}static get isReadOnlySupported(){return!0}render(){return this.wrapper=document.createElement("div"),this.data&&this.data.folder?this.renderFolder(this.data):this.renderFolderModal(),this.wrapper}renderFolder(e){if(this.readOnly){const t=Z(ar,{folder:e});t.use(ce),t.use(ve),t.mount(this.wrapper);return}this.wrapper.innerHTML=`<div class='border rounded-md p-10 text-center bg-surface-menu-bar mb-2'>
              <span class="font-medium">
                  Folder: ${e}
              </span>
          </div>`}renderFolderModal(){if(this.readOnly)return;const e=Z(er,{onAddition:t=>{this.data.folder=t,this.renderFolder(t)}});e.use(ce),e.use(ve),e.mount(this.wrapper)}save(e){return{folder:this.data.folder}}}function ft(d){ue(qe({position:"bottom-right"},d))}function Pe(d){return It(d).value}function gr(d){return d>999?(d/1e3).toFixed(1)+"k":d}function nr(d){let e=parseInt(d);return e>1048576?(e/1048576).toFixed(2)+"M":e>1024?(e/1024).toFixed(2)+"K":e}function yr(d){X(()=>d,e=>{if(e.value.title){if(e.value.title&&e.value.subtitle){document.title=`${e.value.title} | ${e.value.subtitle}`;return}if(e.value.title){document.title=`${e.value.title}`;return}}},{immediate:!0,deep:!0})}function vr(){return{header:{class:jt,config:{placeholder:"Header"}},assignment:ea,quiz:_o,exam:An,upload:Hn,markdown:{class:On,inlineToolbar:!0},image:Vt,table:{class:Ot,inlineToolbar:!0},paragraph:{class:Ht,inlineToolbar:!0,config:{preserveBlank:!0}},codeBox:{class:Bn,config:{themeURL:"https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-dark.min.css",themeName:"atom-one-dark",useDefaultTheme:"dark"}},list:{class:Ut,inlineToolbar:!0,config:{defaultStyle:"ordered"}},inlineCode:{class:Rt,shortcut:"CMD+SHIFT+M"},embed:{class:Dt,inlineToolbar:!0,config:{services:{youtube:{regex:/(?:https?:\/\/)?(?:www\.)?(?:(?:youtu\.be\/)|(?:youtube\.com)\/(?:v\/|u\/\w\/|embed\/|watch))(?:(?:\?v=)?([^#&?=]*))?((?:[?&]\w*=\w*)*)/,embedUrl:"https://www.youtube.com/embed/<%= remote_id %>",html:'<iframe style="width:100%; height: 30rem;" frameborder="0" allowfullscreen></iframe>',height:320,width:580,id:([d,e])=>{if(!e&&d)return d;const t={start:"start",end:"end",t:"start",time_continue:"start",list:"list"};let l=e.slice(1).split("&").map(n=>{const[r,y]=n.split("=");return!d&&r==="v"?(d=y,null):!t[r]||y==="LL"||y.startsWith("RDMM")||y.startsWith("FL")?null:`${t[r]}=${y}`}).filter(n=>!!n);return d+"?"+l.join("&")}},vimeo:!0,codepen:!0,aparat:{regex:/(?:http[s]?:\/\/)?(?:www.)?aparat\.com\/v\/([^\/\?\&]+)\/?/,embedUrl:"https://www.aparat.com/video/video/embed/videohash/<%= remote_id %>/vt/frame",html:'<iframe style="margin: 0 auto; width: 100%; height: 25rem;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>',height:300,width:600},github:!0,slides:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/pub/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0' frameborder='0' allowfullscreen='true'></iframe>"},drive:{regex:/https:\/\/drive\.google\.com\/file\/d\/([A-Za-z0-9_-]+)\/view(\?.+)?/,embedUrl:"https://drive.google.com/file/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 25rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},docsPublic:{regex:/https:\/\/docs\.google\.com\/document\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/document/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},sheetsPublic:{regex:/https:\/\/docs\.google\.com\/spreadsheets\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/spreadsheets/d/<%= remote_id %>/preview",html:"<iframe style='width: 100%; height: 40rem; border: 1px solid #D3D3D3; border-radius: 12px;' frameborder='0' allowfullscreen='true'></iframe>"},slidesPublic:{regex:/https:\/\/docs\.google\.com\/presentation\/d\/([A-Za-z0-9_-]+)\/edit(\?.+)?/,embedUrl:"https://docs.google.com/presentation/d/<%= remote_id %>/embed",html:"<iframe style='width: 100%; height: 30rem; border: 1px solid #D3D3D3; border-radius: 12px; margin: 1rem 0;' frameborder='0' allowfullscreen='true'></iframe>"},codesandbox:{regex:/^https:\/\/codesandbox\.io\/(?:embed\/)?([A-Za-z0-9_-]+)(?:\?[^\/]*)?$/,embedUrl:"https://codesandbox.io/embed/<%= remote_id %>?view=editor+%2B+preview&module=%2Findex.html",html:"<iframe style='width: 100%; height: 500px; border: 0; border-radius: 4px; overflow: hidden;' sandbox='allow-mods allow-forms allow-popups allow-scripts allow-same-origin' frameborder='0' allowfullscreen='true'></iframe>"}}}},folder:{class:ht,config:{placeholder:"Add a folder with files",uploadEndpoint:"/api/upload-folder",renderFiles:d=>d.map(e=>`<a href="${e.url}" download>${e.name}</a>`).join("<br>")}}}}function gt(d){const e={ves:"fe",ies:"y",i:"us",zes:"ze",ses:"s",es:"e",s:""};return d.replace(new RegExp(`(${Object.keys(e).join("|")})$`),t=>e[t])}export{Yt as C,lt as F,rs as T,po as _,Tn as a,ar as b,Ka as c,mt as d,ts as e,gr as f,vr as g,nr as h,Xt as i,co as j,Xo as k,Sn as l,Pe as t,yr as u};
//# sourceMappingURL=index-BskJafJK.js.map
