import{c as z,u as G,q as C}from"./frappe-ui-DItCq3tW.js";import{bY as K,t as n,b as r,z as c,g as a,H as E,O as J,u as s,e as p,bk as V,F as X,bW as ee,r as I,av as te,bZ as se,c as R,I as re,bg as oe,a8 as ae,D as b,a as N,w as y,b_ as ne,C as j,b$ as ie}from"./vendor-HNRiXHBS.js";import{_ as ue}from"./CourseOutline-agG91JAR.js";import{_ as le,a as de,b as ce,c as me,g as pe,u as _e,d as he,e as fe}from"./index-zqmVXotY.js";import{_ as be}from"./InstructorAvatar-H0GgLMal.js";import"./index-DYiOfYjK.js";import"./settings-ocK7QO_r.js";import"./Link-CDfjKa6y.js";/* empty css                                                                     */const ye={key:0},ge=["src"],ve={key:0},Ne=["src"],ke={key:1},we={controls:"",width:"100%",controlsList:"nodownload",oncontextmenu:"return false;"},xe=["src"],$e={key:2},Ie=["src"],Se={key:3},De={width:"100%",controls:"",controlsList:"nodownload"},qe=["src"],Ce={key:4},Le=["src"],Pe=["innerHTML"],ze={key:1},Ee={key:2},Me={key:3},Te={key:4},H={__name:"LessonContent",props:{content:{type:String,required:!0},youtube:{type:String,required:!1},quizId:{type:String,required:!1},exam:{type:String,required:!1},discussionID:{type:String,required:!1},folder:{type:String,required:!1}},setup(i){const h=new K({html:!0,linkify:!0}),S=m=>(m.includes("{{")&&(m=f(m)),`https://www.youtube.com/embed/${m}`),D=m=>`${f(m)}#toolbar=0`,f=m=>m.match(/\(["']([^"']+?)["']\)/)[1];return(m,L)=>{var k;return r(),n(E,null,[i.youtube?(r(),n("div",ye,[a("iframe",{class:"youtube-video",src:S(i.youtube.split("/").pop()),width:"100%",height:"400",frameborder:"0",allowfullscreen:""},null,8,ge)])):c("",!0),(r(!0),n(E,null,J((k=i.content)==null?void 0:k.split(`

`),l=>(r(),n("div",null,[l.includes("{{ YouTubeVideo")?(r(),n("div",ve,[a("iframe",{class:"youtube-video",src:S(l),width:"100%",height:"400",frameborder:"0",allowfullscreen:""},null,8,Ne)])):l.includes("{{ Video")?(r(),n("div",ke,[a("video",we,[a("source",{src:f(l),type:"video/mp4"},null,8,xe)])])):l.includes("{{ PDF")?(r(),n("div",$e,[a("iframe",{src:D(l),width:"100%",height:"700px",frameborder:"0",allowfullscreen:""},null,8,Ie)])):l.includes("{{ Audio")?(r(),n("div",Se,[a("audio",De,[a("source",{src:f(l),type:"audio/mp3"},null,8,qe)])])):l.includes("{{ Embed")?(r(),n("div",Ce,[a("iframe",{width:"100%",height:"400",src:f(l),frameborder:"0",allowfullscreen:""},null,8,Le)])):(r(),n("div",{key:5,innerHTML:s(h).render(l)},null,8,Pe))]))),256)),i.quizId?(r(),n("div",ze,[p(le,{quiz:i.quizId},null,8,["quiz"])])):c("",!0),i.exam?(r(),n("div",Ee,[p(de,{exam:i.exam},null,8,["exam"])])):c("",!0),i.discussionID?(r(),n("div",Me,[p(ce,{discussion:i.discussionID},null,8,["discussion"])])):c("",!0),i.folder?(r(),n("div",Te,[p(me,{folder:i.folder},null,8,["folder"])])):c("",!0)],64)}}},Be={key:0,class:""},Fe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Oe={class:"grid md:grid-cols-[70%,30%] h-screen"},Ve={class:"border-r container pt-5 pb-10 px-5"},Re={class:"flex flex-col md:flex-row md:items-center justify-between"},je={class:"text-3xl font-semibold text-ink-gray-9"},He={class:"flex items-center mt-2 md:mt-0"},Je={class:"flex items-center"},Ae={key:0,class:"bg-surface-gray-2 p-3 rounded-md mt-6"},Ye={class:"text-ink-gray-5 font-medium"},Ue={key:1,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-6"},Qe={key:2,class:"rounded-md bg-[#E6F7F4] p-2 mt-2"},We={key:3,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-5"},Ze={key:4,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-5"},Ge={class:"mt-20"},Ke={class:"sticky top-10"},Xe={class:"bg-surface-menu-bar py-5 px-2 border-b"},et={class:"text-lg font-semibold text-ink-gray-9"},tt={key:0,class:"text-sm mt-4 mb-2 text-ink-gray-5"},ct={__name:"Lesson",props:{courseName:{type:String,required:!0},chapterNumber:{type:String,required:!0},lessonNumber:{type:String,required:!0}},setup(i){const h=V("$user"),S=X(),D=ee(),f=I(!1),m=I(null),L=I(null),k=I(0),l=I(0);let q;const P=V("$socket");P?console.log("Socket connection available in Lesson.vue:",P):console.error("Socket connection not found in Lesson.vue.");const d=i;te(()=>{T()});const e=z({url:"seminary.seminary.utils.get_lesson",cache:["lesson",d.courseName,d.chapterNumber,d.lessonNumber],makeParams(t){return{course:d.courseName,chapter:t?t.chapter:d.chapterNumber,lesson:t?t.lesson:d.lessonNumber}},auto:!0,onSuccess(t){var o,u,_,g;if(Object.keys(t).length===0){S.push({name:"CourseDetail",params:{courseName:d.courseName}});return}k.value=(o=t.membership)==null?void 0:o.progress,t.content&&(m.value=M("editor",t.content)),t.instructor_content&&((_=(u=JSON.parse(t.instructor_content))==null?void 0:u.blocks)==null?void 0:_.length)>1&&(L.value=M("instructor-content",t.instructor_content)),(g=m.value)==null||g.isReady.then(()=>{Q()})}}),M=(t,o)=>(document.getElementById(t)&&(document.getElementById(t).innerHTML=""),new se({holder:t,tools:pe(),data:JSON.parse(o),readOnly:!0,defaultBlock:"embed"}));console.log(e);const A=()=>{h.data&&e.data&&!e.data.progress&&Y.submit()},Y=z({url:"seminary.seminary.doctype.course_lesson.course_lesson.save_progress",makeParams(){return{lesson:e.data.name,course:d.courseName}},onSuccess(t){k.value=t}}),U=R(()=>{var o,u;let t=[{label:"Courses",route:{name:"Courses"}}];return t.push({label:(o=e==null?void 0:e.data)==null?void 0:o.course_title,route:{name:"CourseDetail",params:{courseName:d.courseName}}}),t.push({label:(u=e==null?void 0:e.data)==null?void 0:u.lesson_title,route:{name:"Lesson",params:{courseName:d.courseName,chapterNumber:d.chapterNumber,lessonNumber:d.lessonNumber}}}),t});re([()=>D.params.chapterNumber,()=>D.params.lessonNumber],([t,o],[u,_])=>{(t||o)&&(m.value=null,L.value=null,f.value=!1,e.submit({chapter:t,lesson:o}),clearInterval(q),l.value=0,T())});const T=()=>{q=setInterval(()=>{l.value++,l.value==30&&(clearInterval(q),A())},1e3)};oe(()=>{clearInterval(q)});const B=()=>{var o;let t=!1;return(o=e.data)!=null&&o.instructors&&e.data.instructors.forEach(u=>{var _;!t&&u.user==((_=h.data)==null?void 0:_.name)&&(t=!0)}),t};z({url:"frappe.client.insert",makeParams(){var t;return{doc:{doctype:"Scheduled Course Roster",course:d.courseName,member:(t=h.data)==null?void 0:t.name}}}});const Q=()=>{var o,u,_,g,w;console.log("Lesson Data:",e.data),console.log("allow_discuss:",(o=e.data)==null?void 0:o.allow_discuss);let t=!1;if((u=e.data)!=null&&u.content)try{(_=JSON.parse(e.data.content).blocks)==null||_.forEach(v=>{v.type==="quiz"&&v.data&&Object.keys(v.data).some($=>v.data[$]!==null&&v.data[$]!=="")&&(t=!0)})}catch(x){console.error("Error parsing content:",x)}(((g=e.data)==null?void 0:g.allow_discuss)===!0||((w=e.data)==null?void 0:w.allow_discuss)===1)&&!t?f.value=!0:f.value=!1},W=R(()=>{var t,o;return{title:(t=e.data)==null?void 0:t.lesson_title,description:(o=e.data)==null?void 0:o.course_sc}});return _e(W),(t,o)=>{var _,g,w,x,v,$,F,O;const u=ae("router-link");return s(e).data?(r(),n("div",Be,[a("header",Fe,[p(s(G),{class:"h-7",items:U.value},null,8,["items"])]),a("div",Oe,[a("div",Ve,[a("div",Re,[a("div",je,b(s(e).data.lesson_title),1),a("div",He,[s(e).data.prev?(r(),N(u,{key:0,to:{name:"Lesson",params:{courseName:i.courseName,chapterNumber:s(e).data.prev.split(".")[0],lessonNumber:s(e).data.prev.split(".")[1]}}},{default:y(()=>[p(s(C),{class:"mr-2"},{prefix:y(()=>[p(s(ne),{class:"w-4 h-4 stroke-1"})]),default:y(()=>[a("span",null,b(t.__("Previous")),1)]),_:1})]),_:1},8,["to"])):c("",!0),(g=(_=s(h))==null?void 0:_.data)!=null&&g.is_moderator||B()?(r(),N(u,{key:1,to:{name:"LessonForm",params:{courseName:i.courseName,chapterNumber:d.chapterNumber,lessonNumber:d.lessonNumber}}},{default:y(()=>[p(s(C),{variant:"solid",class:"mr-2"},{default:y(()=>[j(b(t.__("Edit")),1)]),_:1})]),_:1},8,["to"])):c("",!0),s(e).data.next?(r(),N(u,{key:2,to:{name:"Lesson",params:{courseName:i.courseName,chapterNumber:s(e).data.next.split(".")[0],lessonNumber:s(e).data.next.split(".")[1]}}},{default:y(()=>[p(s(C),null,{suffix:y(()=>[p(s(ie),{class:"w-4 h-4 stroke-1"})]),default:y(()=>[a("span",null,b(t.__("Next")),1)]),_:1})]),_:1},8,["to"])):(r(),N(u,{key:3,to:{name:"CourseDetail",params:{courseName:i.courseName}}},{default:y(()=>[p(s(C),null,{default:y(()=>[j(b(t.__("Back to Course")),1)]),_:1})]),_:1},8,["to"]))])]),(r(!0),n(E,null,J(s(e).data.instructors,Z=>(r(),n("div",Je,[o[0]||(o[0]=a("br",null,null,-1)),p(be,{instructor:Z,size:"xl"},null,8,["instructor"]),o[1]||(o[1]=a("br",null,null,-1))]))),256)),s(e).data.instructor_content&&((x=(w=JSON.parse(s(e).data.instructor_content))==null?void 0:w.blocks)==null?void 0:x.length)>1&&(($=(v=s(h))==null?void 0:v.data)!=null&&$.is_moderator||B())?(r(),n("div",Ae,[a("div",Ye,b(t.__("Instructor Notes")),1),o[2]||(o[2]=a("div",{id:"instructor-content",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,-1))])):s(e).data.instructor_notes?(r(),n("div",Ue,[p(H,{content:s(e).data.instructor_notes},null,8,["content"])])):c("",!0),s(e).data.due_date?(r(),n("div",Qe,b(t.__("Due: ")+new Intl.DateTimeFormat(s(h).data.language||"en-US",{dateStyle:"medium"}).format(new Date(s(e).data.due_date))),1)):c("",!0),s(e).data.content?(r(),n("div",We,[...o[3]||(o[3]=[a("div",{id:"editor"},null,-1)])])):(r(),n("div",Ze,[(F=s(e).data)!=null&&F.body?(r(),N(H,{key:0,content:s(e).data.body,youtube:s(e).data.youtube,quizId:s(e).data.quiz_id,exam:s(e).data.exam,assignmentID:s(e).data.assignment_id,discussionID:s(e).data.discussion_id,socket:s(P)},null,8,["content","youtube","quizId","exam","assignmentID","discussionID","socket"])):c("",!0)])),a("div",Ge,[f.value&&((O=s(e).data)!=null&&O.name)?(r(),N(he,{title:"Questions",doctype:"Course Lesson",docname:s(e).data.name,key:s(e).data.name},null,8,["docname"])):c("",!0)])]),a("div",Ke,[a("div",Xe,[a("div",et,b(s(e).data.lesson_title),1),s(h)&&s(e).data.membership?(r(),n("div",tt,b(Math.ceil(k.value))+"% "+b("completed"),1)):c("",!0),s(h)&&s(e).data.membership?(r(),N(fe,{key:1,progress:k.value},null,8,["progress"])):c("",!0)]),(r(),N(ue,{courseName:i.courseName,key:i.chapterNumber,getProgress:!!s(e).data.membership},null,8,["courseName","getProgress"]))])])])):c("",!0)}}};export{ct as default};
//# sourceMappingURL=Lesson-DdiACPEr.js.map
