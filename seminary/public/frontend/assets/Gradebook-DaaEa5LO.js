var O=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var B=(n,u,s)=>u in n?O(n,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[u]=s,I=(n,u)=>{for(var s in u||(u={}))M.call(u,s)&&B(n,s,u[s]);if(V)for(var s of V(u))W.call(u,s)&&B(n,s,u[s]);return n},E=(n,u)=>J(n,K(u));var R=(n,u,s)=>new Promise((k,b)=>{var y=m=>{try{v(s.next(m))}catch(w){b(w)}},f=m=>{try{v(s.throw(m))}catch(w){b(w)}},v=m=>m.done?k(m.value):Promise.resolve(m.value).then(y,f);v((s=s.apply(n,u)).next())});import{c as T,u as X,b as F,H as Z,t as q}from"./frappe-ui-BC6vlBMo.js";import{bV as ee,r as $,c as H,I as te,a8 as re,t as l,b as c,g as d,e as A,u as g,D as _,H as z,O as G,a as C,w as x,C as D,z as h,bS as ae,n as se,cf as oe}from"./vendor-CA0oFrry.js";const ce={class:"gradebook"},le={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ue={class:"text-2xl font-bold mt-5 mb-4"},ne={key:0,class:"text-gray-500 text-center mt-4"},ie={key:1,class:"overflow-auto"},de={class:"table-auto border-collapse border border-gray-300 w-full"},_e={key:0,class:"block text-gray-500 text-sm"},me={key:0,class:"block text-gray-500 text-sm"},pe={key:0,class:"block text-gray-500 text-sm"},be={key:0,class:"block text-gray-500 text-sm"},ye={key:4},fe={key:0,class:"block text-gray-500 text-sm"},ge={class:"border border-gray-300 px-4 py-2 relative"},xe=["href"],he={key:0},ke=["value","onInput"],ve={key:1},we=["value","onInput"],Se={__name:"Gradebook",props:{courseName:{type:String,required:!0}},setup(n){const u=ee(),s=n,k=$([]),b=$([]),y=$({}),f=T({url:"seminary.seminary.utils.get_course_details",cache:["course",s.courseName],params:{course:s.courseName},auto:!0}),v=T({url:"seminary.seminary.utils.get_gradebook",cache:["gradebook",s.courseName],params:{course:s.courseName},auto:!0,onSuccess(r){var t;k.value=r.map(a=>E(I({},a),{assessments:a.assessments.map(o=>E(I({},o),{rawscore_card:o.rawscore_card||0,actualextrapt_card:o.actualextrapt_card||0}))})),b.value=((t=r[0])==null?void 0:t.assessments)||[]},onError(r){console.error("Error loading gradebook:",r)}}),m=H(()=>[...b.value].sort((r,t)=>{if(!r.due_date&&t.due_date)return 1;if(r.due_date&&!t.due_date)return-1;if(r.due_date&&t.due_date){const a=new Date(r.due_date),o=new Date(t.due_date);if(a<o)return-1;if(a>o)return 1}return r.title.localeCompare(t.title)})),w=(r,t)=>{const a=r.assessments.find(o=>o.assessment_criteria===t.assessment_criteria);return a?a.actualextrapt_card:0},P=(r,t)=>{const a=r.assessments.find(o=>o.assessment_criteria===t.assessment_criteria);return a?a.rawscore_card:0},Q=(r,t,a)=>{const o=r.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);o&&(o.actualextrapt_card=parseFloat(a)||0,y.value[o.name]=!0)},U=(r,t,a)=>{const o=r.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);o&&(o.rawscore_card=parseFloat(a)||0,y.value[o.name]=!0)},Y=(r,t)=>{const a=r.assessments.find(o=>o.assessment_criteria===t.assessment_criteria);return a&&y.value[a.name]},j=(r,t)=>R(this,null,function*(){var o;const a=r.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);if(a)try{const i=t.extracredit_scac?"actualextrapt_card":"rawscore_card",e=t.extracredit_scac?a.actualextrapt_card:a.rawscore_card;console.log("Saving cell:",a.name,"with value:",e),yield Z("frappe.client.set_value",{doctype:"Course Assess Results Detail",name:a.name,fieldname:i,value:e}),delete y.value[a.name],q.success(__("Grade saved successfully"))}catch(i){console.error("Error saving cell:",i),q.error(((o=err.messages)==null?void 0:o[0])||err)}});te(()=>u.fullPath,(r,t)=>{v.reload()},{immediate:!0});const N=r=>{if(!r)return"";const t=new Date(r);return isNaN(t)?"":new Intl.DateTimeFormat(void 0,{day:"2-digit",month:"short"}).format(t)},L=H(()=>{var t;let r=[{label:"Courses",route:{name:"Courses"}}];return r.push({label:(t=f==null?void 0:f.data)==null?void 0:t.course,route:{name:"CourseDetail",params:{courseName:s.courseName}}}),r.push({label:"Gradebook",route:{name:"Gradebook",params:{courseName:s.courseName}}}),r});return(r,t)=>{var o,i;const a=re("router-link");return c(),l("div",ce,[d("header",le,[A(g(X),{class:"h-7",items:L.value},null,8,["items"])]),d("h1",ue,"Gradebook for "+_((i=(o=g(f))==null?void 0:o.data)==null?void 0:i.course),1),k.value.length===0?(c(),l("div",ne," There are no students enrolled in this course. ")):(c(),l("div",ie,[d("table",de,[d("thead",null,[d("tr",null,[t[0]||(t[0]=d("th",{class:"border border-gray-300 px-4 py-2 bg-gray-100"},"Student",-1)),(c(!0),l(z,null,G(m.value,e=>(c(),l("th",{key:e.assessment_criteria,class:"border border-gray-300 px-4 py-2 bg-gray-100"},[e.type==="Exam"?(c(),C(a,{key:0,to:{name:"ExamSubmissionCS",params:{courseName:s.courseName,examID:e.exam}},class:"underline"},{default:x(()=>[D(_(e.title)+" ",1),e.due_date?(c(),l("span",_e," ("+_(N(e.due_date))+") ",1)):h("",!0)]),_:2},1032,["to"])):e.type==="Assignment"?(c(),C(a,{key:1,to:{name:"AssignmentSubmissionCS",params:{courseName:s.courseName,assignmentID:e.assignment}},class:"underline"},{default:x(()=>[D(_(e.title)+" ",1),e.due_date?(c(),l("span",me," ("+_(N(e.due_date))+") ",1)):h("",!0)]),_:2},1032,["to"])):e.type==="Quiz"?(c(),C(a,{key:2,to:{name:"QuizSubmissionCS",params:{courseName:s.courseName,quizID:e.quiz}},class:"underline"},{default:x(()=>[D(_(e.title)+" ",1),e.due_date?(c(),l("span",pe," ("+_(N(e.due_date))+") ",1)):h("",!0)]),_:2},1032,["to"])):e.type==="Discussion"?(c(),C(a,{key:3,to:{name:"DiscussionActivitySubmissionCS",params:{courseName:s.courseName,discussionID:e.discussion}},class:"underline"},{default:x(()=>[D(_(e.title)+" ",1),e.due_date?(c(),l("span",be," ("+_(N(e.due_date))+") ",1)):h("",!0)]),_:2},1032,["to"])):(c(),l("span",ye,[D(_(e.title)+" ",1),e.due_date?(c(),l("span",fe," ("+_(N(e.due_date))+") ",1)):h("",!0)]))]))),128))])]),d("tbody",null,[(c(!0),l(z,null,G(k.value,e=>(c(),l("tr",{key:e.student_card},[d("td",ge,[A(g(F),{text:`Program: ${e.program_std_scr}
Audit: ${e.audit_bool?"Yes":"No"} 
 Active: ${e.active?"Yes":"No"}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:x(()=>[d("span",null,_(e.stuname_roster),1)]),_:2},1032,["text"]),A(g(F),{text:`Send Email to ${e.stuname_roster}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:x(()=>[d("a",{href:`mailto:${e.stuemail_rc}`},[A(g(ae),{class:"absolute right-2 top-2 text-blue-300 cursor-pointer"})],8,xe)]),_:2},1032,["text"])]),(c(!0),l(z,null,G(b.value,p=>(c(),l("td",{key:p.assessment_criteria,class:se([p.extracredit_scac?"bg-blue-100":"","border border-gray-300 px-4 py-2 text-center relative"])},[p.extracredit_scac?(c(),l("div",he,[d("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:w(e,p),onInput:S=>Q(e,p,S.target.value)},null,40,ke)])):(c(),l("div",ve,[d("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:P(e,p),onInput:S=>U(e,p,S.target.value)},null,40,we)])),Y(e,p)?(c(),C(g(oe),{key:2,class:"absolute right-12 top-4 text-blue-300",onClick:S=>j(e,p)},null,8,["onClick"])):h("",!0)],2))),128))]))),128))])])]))])}}};export{Se as default};
//# sourceMappingURL=Gradebook-DaaEa5LO.js.map
