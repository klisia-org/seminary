var N=(g,y,i)=>new Promise((C,c)=>{var s=a=>{try{V(i.next(a))}catch(l){c(l)}},A=a=>{try{V(i.throw(a))}catch(l){c(l)}},V=a=>a.done?C(a.value):Promise.resolve(a.value).then(s,A);V((i=i.apply(g,y)).next())});import{v as E,x as P,p as Q,y as T,d as w,o as u,f as h,w as x,a as d,h as m,e as p,t as f,c as _,D as G,z as H,r as K,b as $,l as q,A as X,C as M,s as Y,q as S,F as j,k as Z,i as ee,_ as U,E as se}from"./index-D2hg7nHX.js";import{_ as ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Dx4-1JCs.js";import{_ as v,a as b,s as k,u as te}from"./index-CUzxg6RN.js";import{u as O}from"./settings-CXJgiWd5.js";import"./table-DhGkjCET.js";import"./ListView-6JS4BnER.js";const le={class:"space-y-4 text-base"},oe={key:3},re={__name:"CourseAssessmentModal",props:E({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{},CourseAssessment:{},CourseAssessmentModifiers:{}}),emits:E(["assessment-saved"],["update:modelValue","update:CourseAssessment"]),setup(g,{emit:y}){P(),Q();const i=T(g,"modelValue");T(g,"CourseAssessment"),O();const C=y,c=g;w({title:"",assesscriteria_scac:"",type:"",weight_scac:"",quiz:"",exam:"",assignment:"",extracredit_scac:"",fudgepoints_scac:"",parent:c.courseName,parenttype:"Course Schedule",parentfield:"courseassescrit_sc"});const s=w({title:"",assesscriteria_scac:"",type:"",weight_scac:"",quiz:"",exam:"",assignment:"",extracredit_scac:"",fudgepoints_scac:"",parent:c.courseName,parenttype:"Course Schedule",parentfield:"courseassescrit_sc"});function A(a){return N(this,null,function*(){if(a.assesscriteria_scac)try{const o=yield(yield fetch(`/api/resource/Assessment Criteria/${a.assesscriteria_scac}`)).json();a.type=o.data.type}catch(l){console.error("Error fetching type:",l)}})}const V=()=>{console.log("Inserting Criteria:",s),s&&fetch("/api/method/seminary.seminary.api.insert_cs_assessment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({criteria:s})}).then(a=>a.json()).then(a=>{k("Success","Course Assessment added successfully","check"),C("assessment-saved"),close()}).catch(a=>{console.error("Error:",a),k("Failed to add Course Assessment","error")})};return(a,l)=>(u(),h(p(G),{modelValue:i.value,"onUpdate:modelValue":l[7]||(l[7]=o=>i.value=o),options:{title:"Add Course Assessment",size:"lg",actions:[{label:"Create",variant:"solid",onClick:o=>V()}]}},{"body-content":x(()=>[d("div",le,[m(p(v),{modelValue:s.title,"onUpdate:modelValue":l[0]||(l[0]=o=>s.title=o),label:a.__("Title"),class:"mb-4",required:!1},null,8,["modelValue","label"]),m(b,{modelValue:s.assesscriteria_scac,"onUpdate:modelValue":[l[1]||(l[1]=o=>s.assesscriteria_scac=o),l[2]||(l[2]=o=>{console.log("update:modelValue triggered:",o),A(s)})],label:a.__("Assessment Criteria"),class:"mb-4",doctype:"Assessment Criteria",required:!0},null,8,["modelValue","label"]),d("p",null,f(s.type),1),s.type==="Quiz"?(u(),h(b,{key:0,modelValue:s.quiz,"onUpdate:modelValue":l[3]||(l[3]=o=>s.quiz=o),doctype:"Quiz",label:a.__("Select a Quiz"),onCreate:(o,z)=>a.redirectToForm()},null,8,["modelValue","label","onCreate"])):s.type==="Exam"?(u(),h(b,{key:1,modelValue:s.exam,"onUpdate:modelValue":l[4]||(l[4]=o=>s.exam=o),doctype:"Exam",label:a.__("Select an Exam")},null,8,["modelValue","label"])):s.type==="Assignment"?(u(),h(b,{key:2,modelValue:s.assignment,"onUpdate:modelValue":l[5]||(l[5]=o=>s.assignment=o),doctype:"Assignment Activity",label:a.__("Select an Assignment"),onCreate:(o,z)=>a.redirectToForm()},null,8,["modelValue","label","onCreate"])):(u(),_("p",oe,"Offline")),m(p(v),{modelValue:s.weight_scac,"onUpdate:modelValue":l[6]||(l[6]=o=>s.weight_scac=o),label:a.__("Weight"),class:"mb-4",required:!0,maxlength:"10"},null,8,["modelValue","label"])])]),_:1},8,["modelValue","options"]))}},ne={class:""},ie={class:"grid md:grid-cols-[70%,30%] h-full"},de={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ue={key:0,class:"flex items-center mt-3 md:mt-0"},ce={key:1,class:"flex items-center mt-3 md:mt-0"},me={class:"mt-5 mb-10"},pe={class:"container mb-5"},_e={key:0,class:"text-lg font-semibold mb-4"},fe={key:1,class:"text-lg font-semibold mb-4"},ge={class:"border border-gray-300 p-4 rounded-md"},ye={class:"flex-1 grid grid-cols-1 md:grid-cols-5 gap-4"},be={key:3},Ve={key:4,class:"mb-4 light-blue-bg p-2 rounded"},he={key:5,class:"mb-4"},Ce={__name:"CourseAssessment",props:E({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g){P(),Q(),ee("$user"),O();const y=K(!1);T(g,"modelValue");const i=g,C=w({title:"",assesscriteria_scac:"",type:"",weight_scac:"",quiz:"",exam:"",assignment:"",extracredit_scac:0,fudgepoints_scac:"",parent:i.courseName,parenttype:"Course Schedule",parentfield:"courseassescrit_sc"}),c=$({url:"seminary.seminary.utils.get_course_details",cache:["course",i.courseName],params:{course:i.courseName},auto:!0}),s=$({url:"seminary.seminary.utils.get_assessments",cache:["assessments",i.courseName],params:{course:i.courseName},auto:!0}),A=q(()=>{var r;let e=[{label:"Courses",route:{name:"Courses"}}];return e.push({label:(r=c==null?void 0:c.data)==null?void 0:r.course,route:{name:"CourseDetail",params:{courseName:i.courseName}}}),e.push({label:"Assessment",route:{name:"CourseAssessment",params:{courseName:i.courseName}}}),e}),V=q(()=>{var e;return{title:(e=c==null?void 0:c.data)==null?void 0:e.title,description:"Assessment Configuration for the course"}});te(V);const a=w([]),l=q(()=>a.reduce((e,r)=>r.extracredit_scac===0?e+parseFloat(r.weight_scac||0):e,0)),o=q(()=>a.reduce((e,r)=>r.extracredit_scac?e+parseFloat(r.fudgepoints_scac||0):e,0));X(()=>{M(()=>s.data,e=>{e&&z()}),s.reload()});function z(){a.length=0,s.data?Array.isArray(s.data)?s.data.forEach(e=>{a.push({title:e.title||"",assesscriteria_scac:e.assesscriteria_scac||"",type:e.type||"",weight_scac:e.weight_scac||0,quiz:e.quiz||"",exam:e.exam||"",assignment:e.assignment||"",creator:e.creator||"",extracredit_scac:e.extracredit_scac||0,fudgepoints_scac:e.fudgepoints_scac||"",name:e.name||"",parent:e.parent||"",parenttype:e.parenttype||"",parentfield:e.parentfield||""})}):a.push({title:s.data.title||"",assesscriteria_scac:s.data.assesscriteria_scac||"",type:s.data.type||"",weight_scac:s.data.weight_scac||0,quiz:s.data.quiz||"",exam:s.data.exam||"",assignment:s.data.assignment||"",creator:s.data.creator||"",extracredit_scac:s.data.extracredit_scac||0,fudgepoints_scac:s.data.fudgepoints_scac||"",name:s.data.name||"",parent:s.data.parent||"",parenttype:s.data.parenttype||"",parentfield:s.data.parentfield||""}):console.log("No assessments data found"),D()}function D(){const e=w({title:"",assesscriteria_scac:"",type:"",weight_scac:0,quiz:"",exam:"",assignment:"",extracredit_scac:0,fudgepoints_scac:"",parent:i.courseName,parenttype:"Course Schedule",parentfield:"courseassescrit_sc"});a.push(e),M(()=>e.assesscriteria_scac,r=>{r&&(F(e),console.log("New Criteria:",e))})}function B(){y.value=!0}function I(){for(const e of a)if(!e.assesscriteria_scac||e.type==="Quiz"&&!e.quiz||e.type==="Exam"&&!e.exam||e.type==="Assignment"&&!e.assignment||!e.extracredit_scac&&!e.weight_scac||e.extracredit_scac&&!e.fudgepoints_scac)return!1;return!0}function R(){if(!I()){k("Error","Please fill in all required fields","error");return}fetch("/api/method/seminary.seminary.api.save_course_assessment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course:i.courseName,assessment_data:a})}).then(e=>e.json()).then(e=>{console.log("Success:",e),e.message&&k("Success","Course updated successfully","check")}).catch(e=>{console.error("Error:",e)})}function F(e){return N(this,null,function*(){if(e.assesscriteria_scac)try{const t=yield(yield fetch(`/api/resource/Assessment Criteria/${e.assesscriteria_scac}`)).json();e.type=t.data.type}catch(r){console.error("Error fetching type:",r)}})}function J(){s.reload(),y.value=!1}return(e,r)=>(u(),_(j,null,[d("div",ne,[d("div",ie,[d("div",null,[d("header",de,[m(p(ae),{class:"h-7",items:A.value},null,8,["items"]),l.value!==100?(u(),_("div",ue,[m(p(se),{text:e.__("Save only allowed when Total Points = 100"),placement:"bottom"},{default:x(()=>[m(p(U),{variant:"subtle",class:"ml-2"},{default:x(()=>[d("span",null,f(e.__("Adjust totals to save")),1)]),_:1})]),_:1},8,["text"])])):(u(),_("div",ce,[m(p(U),{variant:"solid",onClick:r[0]||(r[0]=t=>R()),class:"ml-2"},{default:x(()=>[d("span",null,f(e.__("Save")),1)]),_:1})]))]),d("div",me,[d("div",pe,[p(c).data?(u(),_("div",fe,f(e.__("Assessment Criteria for "+p(c).data.course)),1)):(u(),_("div",_e,f(e.__("Assessment Criteria")),1)),d("div",{class:Y({"flex justify-between mb-4 p-3 text-xl":!0,"bg-red-400 rounded":l.value!==100})},[d("div",null,[d("strong",null,f(e.__("Total Points"))+":",1),S(" "+f(l.value),1)]),d("div",null,[d("strong",null,f(e.__("Max Fudge Points"))+":",1),S(" "+f(o.value),1)])],2),d("div",ge,[(u(!0),_(j,null,Z(a,(t,W)=>(u(),_("div",{key:W,class:"border border-gray-300 p-4 mb-4 rounded-md flex items-center"},[d("div",ye,[m(p(v),{modelValue:t.title,"onUpdate:modelValue":n=>t.title=n,label:e.__("Title"),class:"mb-4",required:!1},null,8,["modelValue","onUpdate:modelValue","label"]),m(b,{modelValue:t.assesscriteria_scac,"onUpdate:modelValue":[n=>t.assesscriteria_scac=n,n=>{console.log("update:modelValue triggered:",n),F(t)}],label:e.__("Assessment Criteria"),class:"mb-4",doctype:"Assessment Criteria",required:!0},null,8,["modelValue","onUpdate:modelValue","label"]),t.type==="Quiz"?(u(),h(b,{key:0,modelValue:t.quiz,"onUpdate:modelValue":n=>t.quiz=n,doctype:"Quiz",label:e.__("Select a Quiz"),required:!0,onCreate:(n,L)=>e.redirectToForm()},null,8,["modelValue","onUpdate:modelValue","label","onCreate"])):t.type==="Exam"?(u(),h(b,{key:1,modelValue:t.exam,"onUpdate:modelValue":n=>t.exam=n,doctype:"Exam",label:e.__("Select an Exam"),required:!0},null,8,["modelValue","onUpdate:modelValue","label"])):t.type==="Assignment"?(u(),h(b,{key:2,modelValue:t.assignment,"onUpdate:modelValue":n=>t.assignment=n,doctype:"Assignment Activity",label:e.__("Select an Assignment"),required:!0,onCreate:(n,L)=>e.redirectToForm()},null,8,["modelValue","onUpdate:modelValue","label","onCreate"])):(u(),_("p",be,"Offline")),m(p(v),{modelValue:t.extracredit_scac,"onUpdate:modelValue":n=>t.extracredit_scac=n,label:e.__("Is Extra Credit?"),type:"checkbox",required:!1,class:"mb-4",default:!1},null,8,["modelValue","onUpdate:modelValue","label"]),t.extracredit_scac?(u(),_("div",Ve,[m(p(v),{modelValue:t.fudgepoints_scac,"onUpdate:modelValue":n=>t.fudgepoints_scac=n,label:e.__("Fudge Points"),type:"float",required:!0},null,8,["modelValue","onUpdate:modelValue","label"])])):(u(),_("div",he,[m(p(v),{modelValue:t.weight_scac,"onUpdate:modelValue":n=>t.weight_scac=n,label:e.__("Weight"),type:"float",class:"max-w-14ch",required:!0},null,8,["modelValue","onUpdate:modelValue","label"])]))])]))),128))]),r[3]||(r[3]=d("br",null,null,-1)),m(p(U),{size:"sm",onClick:B},{default:x(()=>[S(f(e.__("Add Evaluation")),1)]),_:1})])])])])]),m(re,{modelValue:y.value,"onUpdate:modelValue":r[1]||(r[1]=t=>y.value=t),modalcriteria:C,"onUpdate:modalcriteria":r[2]||(r[2]=t=>C=t),courseName:i.courseName,onAssessmentSaved:J},null,8,["modelValue","modalcriteria","courseName"])],64))}},Ne=H(Ce,[["__scopeId","data-v-73f0ea9a"]]);export{Ne as default};
