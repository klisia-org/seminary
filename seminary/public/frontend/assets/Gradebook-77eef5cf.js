var Q=Object.defineProperty,Z=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var T=(i,l,o)=>l in i?Q(i,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[l]=o,E=(i,l)=>{for(var o in l||(l={}))K.call(l,o)&&T(i,o,l[o]);if(G)for(var o of G(l))O.call(l,o)&&T(i,o,l[o]);return i},I=(i,l)=>Z(i,J(l));var B=(i,l,o)=>new Promise((g,y)=>{var b=_=>{try{x(o.next(_))}catch(k){y(k)}},f=_=>{try{x(o.throw(_))}catch(k){y(k)}},x=_=>_.done?g(_.value):Promise.resolve(_.value).then(b,f);x((o=o.apply(i,l)).next())});import{s as W,Y as X,r as V,c as F,l as R,n as ee,d as n,e as d,h as S,b as h,t as m,F as $,k as z,j as te,o as c,f as D,w as v,A,g as w,Z as q,U as ae}from"./index-aa2d5c8c.js";import{_ as re}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-f4602792.js";import{o as se,s as M}from"./index-ae42c77f.js";import{S as oe}from"./send-90966041.js";import"./Badge.vue_vue_type_script_setup_true_lang-db3ab37b.js";import"./plus-35171fed.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-98ed7af9.js";import"./Link-4414b9a7.js";import"./pencil-d10cdea0.js";import"./FolderPlugin.vue_vue_type_style_index_0_scoped_84b7d54d_lang-09f2e4ee.js";import"./book-open-check-240c5796.js";/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=W("SaveIcon",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),le={class:"gradebook"},ne={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ue={class:"text-2xl font-bold mt-5 mb-4"},ie={key:0,class:"text-gray-500 text-center mt-4"},de={key:1,class:"overflow-auto"},me={class:"table-auto border-collapse border border-gray-300 w-full"},_e={key:0,class:"block text-gray-500 text-sm"},pe={key:0,class:"block text-gray-500 text-sm"},ye={key:0,class:"block text-gray-500 text-sm"},be={key:3},fe={key:0,class:"block text-gray-500 text-sm"},he={class:"border border-gray-300 px-4 py-2 relative"},ge=["href"],xe={key:0},ke=["value","onInput"],ve={key:1},we=["value","onInput"],Be={__name:"Gradebook",props:{courseName:{type:String,required:!0}},setup(i){const l=X(),o=i,g=V([]),y=V([]),b=V({}),f=F({url:"seminary.seminary.utils.get_course_details",cache:["course",o.courseName],params:{course:o.courseName},auto:!0}),x=F({url:"seminary.seminary.utils.get_gradebook",cache:["gradebook",o.courseName],params:{course:o.courseName},auto:!0,onSuccess(a){var t;g.value=a.map(r=>I(E({},r),{assessments:r.assessments.map(s=>I(E({},s),{rawscore_card:s.rawscore_card||0,actualextrapt_card:s.actualextrapt_card||0}))})),y.value=((t=a[0])==null?void 0:t.assessments)||[]},onError(a){console.error("Error loading gradebook:",a)}}),_=R(()=>[...y.value].sort((a,t)=>{if(!a.due_date&&t.due_date)return 1;if(a.due_date&&!t.due_date)return-1;if(a.due_date&&t.due_date){const r=new Date(a.due_date),s=new Date(t.due_date);if(r<s)return-1;if(r>s)return 1}return a.title.localeCompare(t.title)})),k=(a,t)=>{const r=a.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return r?r.actualextrapt_card:0},U=(a,t)=>{const r=a.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return r?r.rawscore_card:0},Y=(a,t,r)=>{const s=a.assessments.find(u=>u.assessment_criteria===t.assessment_criteria);s&&(s.actualextrapt_card=parseFloat(r)||0,b.value[s.name]=!0)},j=(a,t,r)=>{const s=a.assessments.find(u=>u.assessment_criteria===t.assessment_criteria);s&&(s.rawscore_card=parseFloat(r)||0,b.value[s.name]=!0)},H=(a,t)=>{const r=a.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return r&&b.value[r.name]},L=(a,t)=>B(this,null,function*(){var s;const r=a.assessments.find(u=>u.assessment_criteria===t.assessment_criteria);if(r)try{const u=t.extracredit_scac?"actualextrapt_card":"rawscore_card",e=t.extracredit_scac?r.actualextrapt_card:r.rawscore_card;console.log("Saving cell:",r.name,"with value:",e),yield se("frappe.client.set_value",{doctype:"Course Assess Results Detail",name:r.name,fieldname:u,value:e}),delete b.value[r.name],M(__("Success"),__("Changes saved successfully"),"check")}catch(u){console.error("Error saving cell:",u),M("Error",((s=u.messages)==null?void 0:s[0])||u,"x")}});ee(()=>l.fullPath,(a,t)=>{x.reload()},{immediate:!0});const C=a=>{if(!a)return"";const t=new Date(a);return isNaN(t)?"":new Intl.DateTimeFormat(void 0,{day:"2-digit",month:"short"}).format(t)},P=R(()=>{var t;let a=[{label:"Courses",route:{name:"Courses"}}];return a.push({label:(t=f==null?void 0:f.data)==null?void 0:t.course,route:{name:"CourseDetail",params:{courseName:o.courseName}}}),a.push({label:"Gradebook",route:{name:"Gradebook",params:{courseName:o.courseName}}}),a});return(a,t)=>{var s,u;const r=te("router-link");return c(),n("div",le,[d("header",ne,[S(h(re),{class:"h-7",items:P.value},null,8,["items"])]),d("h1",ue,"Gradebook for "+m((u=(s=h(f))==null?void 0:s.data)==null?void 0:u.course),1),g.value.length===0?(c(),n("div",ie," There are no students enrolled in this course. ")):(c(),n("div",de,[d("table",me,[d("thead",null,[d("tr",null,[t[0]||(t[0]=d("th",{class:"border border-gray-300 px-4 py-2 bg-gray-100"},"Student",-1)),(c(!0),n($,null,z(_.value,e=>(c(),n("th",{key:e.assessment_criteria,class:"border border-gray-300 px-4 py-2 bg-gray-100"},[e.type==="Exam"?(c(),D(r,{key:0,to:{name:"ExamSubmissionCS",params:{courseName:o.courseName,examID:e.exam}},class:"underline"},{default:v(()=>[A(m(e.title)+" ",1),e.due_date?(c(),n("span",_e," ("+m(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):e.type==="Assignment"?(c(),D(r,{key:1,to:{name:"AssignmentSubmissionCS",params:{courseName:o.courseName,assignmentID:e.assignment}},class:"underline"},{default:v(()=>[A(m(e.title)+" ",1),e.due_date?(c(),n("span",pe," ("+m(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):e.type==="Quiz"?(c(),D(r,{key:2,to:{name:"QuizSubmissionCS",params:{courseName:o.courseName,quizID:e.quiz}},class:"underline"},{default:v(()=>[A(m(e.title)+" ",1),e.due_date?(c(),n("span",ye," ("+m(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):(c(),n("span",be,[A(m(e.title)+" ",1),e.due_date?(c(),n("span",fe," ("+m(C(e.due_date))+") ",1)):w("",!0)]))]))),128))])]),d("tbody",null,[(c(!0),n($,null,z(g.value,e=>(c(),n("tr",{key:e.student_card},[d("td",he,[S(h(q),{text:`Program: ${e.program_std_scr}
Audit: ${e.audit_bool?"Yes":"No"} 
 Active: ${e.active?"Yes":"No"}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:v(()=>[d("span",null,m(e.stuname_roster),1)]),_:2},1032,["text"]),S(h(q),{text:`Send Email to ${e.stuname_roster}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:v(()=>[d("a",{href:`mailto:${e.stuemail_rc}`},[S(h(oe),{class:"absolute right-2 top-2 text-blue-300 cursor-pointer"})],8,ge)]),_:2},1032,["text"])]),(c(!0),n($,null,z(y.value,p=>(c(),n("td",{key:p.assessment_criteria,class:ae([p.extracredit_scac?"bg-blue-100":"","border border-gray-300 px-4 py-2 text-center relative"])},[p.extracredit_scac?(c(),n("div",xe,[d("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:k(e,p),onInput:N=>Y(e,p,N.target.value)},null,40,ke)])):(c(),n("div",ve,[d("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:U(e,p),onInput:N=>j(e,p,N.target.value)},null,40,we)])),H(e,p)?(c(),D(h(ce),{key:2,class:"absolute right-12 top-4 text-blue-300",onClick:N=>L(e,p)},null,8,["onClick"])):w("",!0)],2))),128))]))),128))])])]))])}}};export{Be as default};
//# sourceMappingURL=Gradebook-77eef5cf.js.map
