{"version":3,"file":"DiscussionActivitySubmission-CZqO4Aei.js","sources":["../../../../frontend/src/pages/DiscussionActivitySubmission.vue"],"sourcesContent":["<template>\n  <header class=\"flex justify-between sticky top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5\">\n    <Breadcrumbs :items=\"breadcrumbs\" />\n  </header>\n  <div class=\"flex items-center justify-between mb-5\">\n    <!-- Previous Button -->\n    <Button variant=\"subtle\" :disabled=\"currentIndex === 0\"\n      @click=\"currentSubmission = submissionlist.data[currentIndex - 1]?.name\">\n      {{ __('Previous') }}\n    </Button>\n\n    <!-- Dropdown for All Submissions -->\n    <div class=\"w-1/3\">\n      <h1 class=\"text-2xl font-bold mt-4 mb-4\">\n        {{ title.data?.discussion_name || __('Discussion Activity Submission') }}\n      </h1>\n      <label for=\"submissionDropdown\" class=\"block text-sm font-medium text-gray-700 mb-4\">\n        {{ __('Select Submission') }}\n      </label>\n      <select id=\"submissionDropdown\" v-model=\"currentSubmission\"\n        class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\">\n        <option v-for=\"submission in submissionlist.data\" :key=\"submission.name\" :value=\"submission.name\">\n          {{ submission.student_name }}\n        </option>\n      </select>\n    </div>\n\n    <!-- Next Button -->\n    <Button variant=\"subtle\" :disabled=\"!submissionlist.data || currentIndex === submissionlist.data.length - 1\"\n      @click=\"currentSubmission = submissionlist.data[currentIndex + 1]?.name\">\n      {{ __('Next') }}\n    </Button>\n  </div>\n  <Suspense>\n    <template #default>\n      <div class=\"flex space-x-6 overflow-hidden h-[calc(100vh-7.2rem)]\">\n        <div class=\"w-2/3 h-[calc(100vh-3.2rem)]\">\n          <div class=\"mb-6 border-round border-gray-300 p-4 bg-surface-white shadow-sm mt-4 mb-8\">\n            <h2>{{ __('Original Post(s) by') }} {{ studentName }}</h2>\n            <div v-for=\"post in originalPosts\" :key=\"post.name\"\n              class=\"m-2 border-round border-gray-300 p-4 bg-surface-white shadow-sm mt-4 mb-4\">\n              <div class=\"post-content\" v-html=\"post.original_post\"></div>\n              <div class=\"post-meta text-sm text-ink-gray-5\">\n                {{ formatDate(post.creation) }}\n              </div>\n              <a v-if=\"post.original_attachment\" :href=\"post.original_attachment\" target=\"_blank\"\n                class=\"text-blue-500 underline\">\n                {{ __('View Attachment') }}\n              </a>\n            </div>\n          </div>\n\n          <div class=\"mb-6 border-round border-gray-300 p-4 bg-surface-white shadow-sm mt-4 mb-8\">\n            <h2>{{ __('Replies by') }} {{ studentName }}</h2>\n            <div v-for=\"reply in studentReplies\" :key=\"reply.creation\"\n              class=\"m-2 border-round border-gray-300 p-4 bg-surface-white shadow-sm mt-4 mb-4\">\n              <div class=\"reply-meta text-sm text-ink-gray-5\">\n                {{ __('Reply to:') }} {{ reply.student_name }}\n                <div class=\"post-content\" v-html=\"reply.original_post\"></div>\n              </div>\n              <div class=\"reply-content mt-4\" v-html=\"reply.reply\"></div>\n              <div class=\"reply-meta text-sm text-ink-gray-5\">\n                {{ formatDate(reply.reply_dt) }}\n              </div>\n              <a v-if=\"reply.reply_attach\" :href=\"reply.reply_attach\" target=\"_blank\" class=\"text-blue-500 underline\">\n                {{ __('View Attachment') }}\n              </a>\n            </div>\n          </div>\n        </div>\n        <div class=\"w-1/3 border-l pl-4\">\n          <h2 class=\"text-lg font-semibold mb-4\">{{ __('Grading') }}</h2>\n\n          <!-- Grade Input -->\n          <label for=\"gradeInput\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n            {{ __('Grade') }}\n          </label>\n          <input id=\"gradeInput\" v-model=\"grade\" type=\"number\"\n            class=\"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm mb-4\" />\n\n          <!-- Save Button -->\n          <Button variant=\"solid\" @click=\"saveGrading\" class=\"w-full\">\n            {{ __('Save') }}\n          </Button>\n          <!-- Comments TextEditor -->\n          <div class=\"mt-20\">\n            <Discussions :title=\"'Comments on Discussion Submission'\" :doctype=\"'Discussion Submission'\"\n              :docname=\"currentSubmission\" :key=\"currentSubmission\" />\n          </div>\n        </div>\n      </div>\n    </template>\n    <template #fallback>\n      <div class=\"text-center py-10\">\n        <span>{{ __('Loading submission data...') }}</span>\n      </div>\n    </template>\n  </Suspense>\n</template>\n<script setup>\nimport { Breadcrumbs, createResource, Button, toast } from 'frappe-ui'\nimport { computed, onBeforeUnmount, onMounted, inject, watch, ref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport dayjsModule from 'dayjs';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport Discussions from '@/components/Discussions.vue'\n\n\nconst dayjs = typeof dayjsModule === 'function' ? dayjsModule : dayjsModule.default;\ndayjs.extend(relativeTime);\n\nconst router = useRouter()\nconst user = inject('$user')\n\nconst props = defineProps({\n  discussionID: {\n    type: String,\n    required: true,\n  },\n  submissionName: {\n    type: String,\n    required: true,\n  },\n  courseName: {\n    type: String,\n    required: true,\n  },\n})\n\nconst currentSubmission = ref(props.submissionName); // Initialize with the current submissionName\nconst submissionName = ref(props.submissionName); // Create a reactive copy of the prop\nconst originalPosts = ref([]);\nconst studentReplies = ref([]);\nconst grade = ref('');\n\n\nconst title = createResource({\n  url: 'frappe.client.get_value',\n  params: {\n    doctype: 'Discussion Activity',\n    fieldname: 'discussion_name',\n    filters: {\n      name: props.discussionID,\n    },\n  },\n  auto: true,\n})\n\nconst formatDate = (dateString) => {\n  if (dateString && dateString.includes('.')) {\n    return dayjs(dateString.split('.')[0]).fromNow();\n  }\n  return dayjs(dateString).fromNow();\n};\n\nconst submissionlist = createResource({\n  url: 'frappe.client.get_list',\n  params: {\n    doctype: 'Discussion Submission',\n    filters: [\n      ['disc_activity', '=', props.discussionID],\n      ['coursesc', '=', props.courseName],\n    ],\n    fields: ['name', 'student_name', 'member'], // Fetch only necessary fields\n    order_by: 'student_name asc', // Order by student name\n  },\n  auto: true,\n});\n\n\nonMounted(() => {\n\n\n  if (!user.data?.is_instructor && !user.data?.is_moderator)\n    router.push({ name: 'Courses' })\n})\n\nconst currentIndex = computed(() =>\n  submissionlist.data?.findIndex((submission) => submission.name === currentSubmission.value)\n);\n\nconst studentName = computed(() => submissionlist.data?.find(sub => sub.name === currentSubmission.value)?.student_name);\nconst memberName = computed(() => submissionlist.data?.find(sub => sub.name === currentSubmission.value)?.member);\n\nconst fetchStudentData = createResource({\n  url: 'seminary.seminary.api.get_user_discussion_submission',\n  makeParams(values) {\n    return {\n      course_name: router.currentRoute.value.params.courseName,\n      discussion_id: props.discussionID,\n      owner: memberName.value,\n    }\n  },\n  auto: false,\n  onSuccess(data) {\n    originalPosts.value = data;\n\n  },\n});\n\nconst fetchStudentReplies = createResource({\n  url: 'seminary.seminary.api.get_user_discussion_replies',\n  makeParams(values) {\n    return {\n      course_name: router.currentRoute.value.params.courseName,\n      discussion_id: props.discussionID,\n      member: memberName.value,\n    }\n  },\n  auto: false,\n  onSuccess(data) {\n    studentReplies.value = data;\n  },\n});\n\nwatch(currentSubmission, (newSubmission) => {\n  submissionName.value = newSubmission; // Update submissionName\n  router.push({\n    name: 'DiscussionActivitySubmission',\n    params: {\n      discussionID: props.discussionID,\n      courseName: props.courseName,\n      submissionName: newSubmission,\n    },\n  });\n});\n\nwatch(\n  () => studentName.value,\n  (newStudentName) => {\n    if (newStudentName) {\n      fetchStudentData.reload();\n      fetchStudentReplies.reload();\n    }\n  }\n);\nconst course = createResource({\n  url: 'seminary.seminary.utils.get_course_details',\n  cache: ['course', props.courseName],\n  params: {\n    course: props.courseName,\n  },\n  auto: true,\n}) // Needed for the breadcrumbs\n\nconst submissionDoc = createResource({\n  url: 'seminary.seminary.api.save_discussion_submission_grade',\n  makeParams(values) {\n    return {\n      submission_name: currentSubmission.value,\n      grade: grade.value,\n\n    }\n  },\n  onSuccess(data) {\n    toast.success(__('Grade saved successfully'));\n  },\n});\nconst saveGrading = () => {\n  // Call API to update the current discussion submission with grade and comments\n  submissionDoc.reload()\n    .then(() => {\n      toast.success(__('Grade saved successfully'));\n    })\n    .catch((error) => {\n      toast.error(__('Failed to save grade: {0}').format(error.message));\n    });\n};\n\nconst breadcrumbs = computed(() => {\n  let items = [{ label: 'Courses', route: { name: 'Courses' } }]\n  items.push({\n    label: course?.data?.course,\n    route: { name: 'CourseDetail', params: { courseName: props.courseName } },\n  })\n  items.push({\n    label: 'Gradebook',\n    route: { name: 'Gradebook', params: { courseName: props.courseName } },\n  })\n  items.push({\n    label: 'Discussion Submissions',\n    route: { name: 'DiscussionActivitySubmission', params: { courseName: props.courseName, discussionID: props.discussionID } },\n  })\n  return items\n})\n\n\n</script>\n"],"names":["dayjs","dayjsModule","relativeTime","router","useRouter","user","inject","props","__props","currentSubmission","ref","submissionName","originalPosts","studentReplies","grade","title","createResource","formatDate","dateString","submissionlist","onMounted","_a","_b","currentIndex","computed","submission","studentName","sub","memberName","fetchStudentData","values","data","fetchStudentReplies","watch","newSubmission","newStudentName","course","submissionDoc","toast","saveGrading","error","breadcrumbs","items","_createElementVNode","_hoisted_1","_createVNode","_unref","Breadcrumbs","_hoisted_2","Button","_cache","$event","__","_hoisted_3","_hoisted_4","_toDisplayString","_hoisted_5","_openBlock","_createElementBlock","_Fragment","_renderList","_hoisted_6","_createBlock","_Suspense","_hoisted_7","_hoisted_8","_hoisted_9","post","_hoisted_11","_hoisted_12","_hoisted_13","reply","_hoisted_14","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","Discussions","_hoisted_23"],"mappings":"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"}