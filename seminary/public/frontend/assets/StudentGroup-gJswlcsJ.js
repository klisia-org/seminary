import{F as z,bV as B,bk as F,c as p,r as N,I as T,t as i,z as U,u as a,b as n,g as l,e as g,D as w,w as h,H as x,O as G,a as V,L as M,aw as R}from"./vendor-CA0oFrry.js";import{c as v,u as q,j as H,k as L,C as P,l as J,m as K,o as Q,w as W,q as X}from"./frappe-ui-BC6vlBMo.js";import{u as Y}from"./index-Bde-fBPp.js";import"./Link-Dl_y0tb2.js";import"./index-aYBfEZmz.js";/* empty css                                                                     */const Z={key:0},ee={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},te={class:"text-2xl font-bold mb-4 ml-5"},se={key:0,class:"student-group-page"},ae={class:"text-xs"},oe={key:1,class:"mt-8 ml-5"},re={class:"mb-4"},ue=["max"],ne={key:0,class:"mb-4"},le=["for"],ce={key:1,class:"mb-4"},ie={class:"text-lg font-medium text-gray-700 mb-2"},he={__name:"StudentGroup",props:{courseName:{type:String,required:!0}},setup(A){z(),B(),F("$user");const o=A,r=v({url:"seminary.seminary.utils.get_instructors",params:{course:o.courseName},auto:!0});console.log("Instructors fetched:",r),console.log("Course Name:",o.courseName);const u=v({url:"seminary.seminary.utils.get_course_details",cache:["course",o.courseName],params:{course:o.courseName},auto:!0}),_=v({url:"seminary.seminary.utils.get_student_groups",cache:["saved_groups",o.courseName],params:{course:o.courseName},auto:!0});console.log("Course:",u),console.log("Saved Groups:",_);const C=p(()=>r.data&&r.data.length>1),D=p(()=>_.data&&_.data.length>0),O=p(()=>{var t;let e=[{label:"Courses",route:{name:"Courses"}}];return e.push({label:(t=u==null?void 0:u.data)==null?void 0:t.course,route:{name:"CourseDetail",params:{courseName:o.courseName}}}),e.push({label:"Assessment",route:{name:"CourseAssessment",params:{courseName:o.courseName}}}),e}),E=p(()=>{var e;return{title:(e=u==null?void 0:u.data)==null?void 0:e.title,description:"Configuration of Student Groups for the course"}});Y(E);const d=N(2),f=N([]);N([]);const S=p(()=>[{label:__("Student"),key:"student_name",width:2},{label:__("Student Group"),key:"student_group",width:2},{label:__("Instructor"),key:"group_instructor",width:2}]),$=p(()=>d.value>1&&d.value<=u.data.enrollments&&(C.value&&f.value.length===d.value||!C.value)),k=p(()=>(console.log("Instructors Data in Computed:",r.data),Array.isArray(r.data)?r.data.map(e=>({label:e.instructor_name,value:e.user})):Object.values(r.data||{}).map(e=>({label:e.instructor_name,value:e.user}))));console.log("Can Create Groups:",$.value),console.log("Instructor Options Outside Computed:",k.value);const y=v({url:"seminary.seminary.utils.get_roster",cache:["roster",o.courseName],params:{course:o.courseName},auto:!0});console.log("Students fetched:",y.data);function j(){try{if(console.log("Create Groups function called"),!y.data||!Array.isArray(y.data))throw new Error("Students data is not available or not an array.");const t=y.data.filter(s=>s.audit_bool===0&&s.active===1).map(s=>({member:s.student}));console.log("Filtered and Transformed Students:",t);const c=Array.from({length:d.value},()=>[]);t.forEach((s,m)=>{c[m%d.value].push(s)}),console.log("Formed Groups:",c),c.forEach((s,m)=>{const b=`${u.data.name} ${f.value[m]||r.data[0].instructor_name} Group ${m+1}`,I=f.value[m]||r.data[0].instructor_name;console.log(`Creating group: ${I} ${b}`,s);const de=v({url:"seminary.seminary.utils.create_student_group",cache:["student_group",o.courseName],params:{course:o.courseName,group_name:b,group_instructor:I,members:s},auto:!0})})}catch(e){console.error("Error in createGroups function:",e)}}return T(()=>r.data,e=>{console.log("Instructors data changed:",e),console.log("Instructor Options Updated:",k.value)}),(e,t)=>a(u).data&&a(r).data?(n(),i("div",Z,[l("header",ee,[g(a(q),{class:"h-7",items:O.value},null,8,["items"])]),l("h1",te,w(e.__("Student Group Management for "+a(u).data.course)),1),t[4]||(t[4]=l("h2",{class:"text-l mb-12 ml-5"},"Student Groups are used to assign students to specific groups within the course, both for assigning grading to specific instructors and for organizing collaborative work.",-1)),D.value?(n(),i("div",se,[t[1]||(t[1]=l("h2",{class:"text-xl font-bold mb-4 ml-5"},"Student Groups",-1)),g(a(Q),{columns:S.value,rows:a(_).data.student_name,"row-key":"student_name",options:{showTooltip:!1,selectable:!1}},{default:h(()=>[g(a(H),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:h(()=>[(n(!0),i(x,null,G(S.value,c=>(n(),V(a(L),{item:c},null,8,["item"]))),256))]),_:1}),g(a(P),null,{default:h(()=>[(n(!0),i(x,null,G(a(_).data,c=>(n(),V(a(J),{row:c,class:"cursor-pointer"},{default:h(({idx:s,column:m,item:b})=>[g(a(K),{item:b},{default:h(()=>[l("div",ae,w(b),1)]),_:2},1032,["item"])]),_:1},8,["row"]))),256))]),_:1})]),_:1},8,["columns","rows"])])):(n(),i("div",oe,[l("div",re,[t[2]||(t[2]=l("label",{for:"groupCount",class:"block text-lg font-medium text-gray-700 mb-4"}," How many student groups should be created? ",-1)),M(l("input",{id:"groupCount",type:"number","onUpdate:modelValue":t[0]||(t[0]=c=>d.value=c),min:2,max:a(u).data.enrollments,class:"mt-1 mb-4 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},null,8,ue),[[R,d.value]])]),C.value?(n(),i("div",ne,[t[3]||(t[3]=l("p",{class:"text-lg font-medium text-gray-700 mb-2"}," Please, select the instructor for each group: ",-1)),(n(!0),i(x,null,G(d.value,(c,s)=>(n(),i("div",{key:s,class:"mb-2"},[l("label",{for:`instructor-${s}`,class:"block text-sm font-medium text-gray-700"}," Group "+w(s+1)+" Instructor ",9,le),g(a(W),{modelValue:f.value[s],"onUpdate:modelValue":m=>f.value[s]=m,label:e.__("Instructor"),type:"select",options:k.value},null,8,["modelValue","onUpdate:modelValue","label","options"])]))),128))])):(n(),i("div",ce,[l("p",ie," Only one instructor is assigned to this course. Student groups will be created with instructor: "+w(a(r).data[0].instructor_name),1)])),g(a(X),{variant:"solid",theme:"gray",size:"sm",label:"Create Groups",loading:!1,onClick:j,disabled:!$.value},null,8,["disabled"])]))])):U("",!0)}};export{he as default};
//# sourceMappingURL=StudentGroup-gJswlcsJ.js.map
