var ie=Object.defineProperty;var Z=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var ee=(q,p,m)=>p in q?ie(q,p,{enumerable:!0,configurable:!0,writable:!0,value:m}):q[p]=m,D=(q,p)=>{for(var m in p||(p={}))ne.call(p,m)&&ee(q,m,p[m]);if(Z)for(var m of Z(p))ue.call(p,m)&&ee(q,m,p[m]);return q};import{c as z,r as re,w as f,D as de,t as V,u as me,q as S,j as pe,k as _e,C as ce,l as fe,m as be,E as qe,o as ye}from"./frappe-ui-DItCq3tW.js";import{U as ve,V as se,r as J,am as A,I as le,c as F,a as U,b as c,w as b,g as d,t as w,z as $,L as te,ce as oe,D as v,e as r,u as n,H as I,O as N,bk as we,F as Ve,av as he,bg as ge,a8 as ze,C as L,cd as Qe,bX as ke,cc as De}from"./vendor-HNRiXHBS.js";import{_ as ae}from"./Link-CDfjKa6y.js";import{u as $e}from"./index-zqmVXotY.js";import{e as E}from"./exam-B7rGJcfK.js";import"./index-DYiOfYjK.js";/* empty css                                                                     */const Ue={class:"question-dialog space-y-4 max-h-[70vh] overflow-y-auto"},xe={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},Ce={class:"flex items-center space-x-2"},Se={for:"existing",class:"cursor-pointer"},Ee={class:"flex items-center space-x-2"},Ie={for:"new",class:"cursor-pointer"},Pe={key:1,class:"space-y-2"},Me={class:"block text-xs text-ink-gray-5 mb-1"},Oe={key:0,class:"divide-y border-t"},Te={class:"space-y-4 py-2"},je={class:"space-y-2"},Le={key:2,class:"space-y-2"},Fe={__name:"Question",props:ve({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(q){const p=se(q,"modelValue"),m=se(q,"quiz"),x=()=>({question:"",points:0}),C=()=>({question:"",type:"Choices",points:0,option_1:"",option_2:"",option_3:"",option_4:"",explanation_1:"",explanation_2:"",explanation_3:"",explanation_4:"",is_correct_1:!1,is_correct_2:!1,is_correct_3:!1,is_correct_4:!1,possibility_1:"",possibility_2:"",possibility_3:"",possibility_4:""}),_=J("new"),l=J(!1),h=A(x()),i=A(C()),P=()=>{Object.assign(i,C())},R=()=>{Object.assign(h,x())},g=q,M=z({url:"frappe.client.get",auto:!1,makeParams(){return{doctype:"Question",name:g.questionDetail.question}},onSuccess(o){var u,a;l.value=!0,_.value="new",P(),Object.keys(i).forEach(s=>{Object.hasOwn(o,s)&&(s.startsWith("is_correct_")?i[s]=!!o[s]:o[s]!==void 0&&o[s]!==null&&(i[s]=o[s]))}),i.points=(a=(u=g.questionDetail.points)!=null?u:o.points)!=null?a:0}}),B=()=>{var o;g.questionDetail.question?(l.value=!0,_.value="new",i.points=(o=g.questionDetail.points)!=null?o:0,M.fetch()):(l.value=!1,Q(),_.value="new")},Q=()=>{P(),R()};le(p,o=>{o?B():(Q(),l.value=!1,_.value="new")});const O=z({url:"frappe.client.insert",makeParams(o){return{doc:D({doctype:"Quiz Question",parent:m.value.data.name,parentfield:"questions",parenttype:"Quiz"},o)}}}),T=z({url:"frappe.client.insert",makeParams(){return{doc:D({doctype:"Question"},i)}}}),H=o=>{var u;(u=g.questionDetail)!=null&&u.question?t(o):K(o)},K=o=>{_.value==="existing"?j({question:h.question,points:h.points},o):T.submit({},{onSuccess(u){j({question:u.name,points:i.points},o)},onError(u){var a;V.error(((a=u.messages)==null?void 0:a[0])||u)}})},j=(o,u)=>{O.submit(D({},o),{onSuccess(){p.value=!1,V.success(__("Question added successfully")),m.value.reload(),Q(),u()},onError(a){var s;V.error(((s=a.messages)==null?void 0:s[0])||a),u()}})},W=z({url:"frappe.client.set_value",auto:!1,makeParams(){var o;return{doctype:"Question",name:(o=M.data)==null?void 0:o.name,fieldname:D({},i)}}}),e=z({url:"frappe.client.set_value",auto:!1,makeParams(){return{doctype:"Quiz Question",name:g.questionDetail.name,fieldname:{points:i.points}}}}),t=o=>{W.submit({},{onSuccess(){e.submit({},{onSuccess(){p.value=!1,V.success(__("Question updated successfully")),m.value.reload(),Q(),o()},onError(u){var a;V.error(((a=u.messages)==null?void 0:a[0])||u)}})},onError(u){var a;V.error(((a=u.messages)==null?void 0:a[0])||u)}})},y=o=>{p.value=!1,Q(),l.value=!1,_.value="new",o==null||o()},k=F(()=>({title:__(g.title),size:"xl",actions:[{label:__("Submit"),variant:"solid",onClick:o=>H(o)},{label:__("Cancel"),variant:"text",onClick:o=>y(o)}]}));return(o,u)=>(c(),U(n(de),{modelValue:p.value,"onUpdate:modelValue":u[7]||(u[7]=a=>p.value=a),options:k.value,disableOutsideClickToClose:!0},{"body-content":b(()=>[d("div",Ue,[l.value?$("",!0):(c(),w("div",xe,[d("div",Ce,[te(d("input",{type:"radio",id:"existing",value:"existing","onUpdate:modelValue":u[0]||(u[0]=a=>_.value=a),class:"w-3 h-3 cursor-pointer"},null,512),[[oe,_.value]]),d("label",Se,v(o.__("Add an existing question")),1)]),d("div",Ee,[te(d("input",{type:"radio",id:"new",value:"new","onUpdate:modelValue":u[1]||(u[1]=a=>_.value=a),class:"w-3 h-3 cursor-pointer"},null,512),[[oe,_.value]]),d("label",Ie,v(o.__("Create a new question")),1)])])),_.value=="new"||l.value?(c(),w("div",Pe,[d("div",null,[d("label",Me,v(o.__("Question")),1),r(n(re),{content:i.question,onChange:u[2]||(u[2]=a=>i.question=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r(n(f),{modelValue:i.points,"onUpdate:modelValue":u[3]||(u[3]=a=>i.points=a),label:o.__("Points"),type:"number"},null,8,["modelValue","label"]),r(n(f),{label:o.__("Type"),modelValue:i.type,"onUpdate:modelValue":u[4]||(u[4]=a=>i.type=a),type:"select",options:["Choices","User Input"],class:"pb-2",required:!0},null,8,["label","modelValue"]),i.type=="Choices"?(c(),w("div",Oe,[(c(),w(I,null,N(4,a=>d("div",Te,[r(n(f),{label:o.__("Option")+" "+a,modelValue:i[`option_${a}`],"onUpdate:modelValue":s=>i[`option_${a}`]=s,required:a<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),r(n(f),{label:o.__("Explanation"),modelValue:i[`explanation_${a}`],"onUpdate:modelValue":s=>i[`explanation_${a}`]=s},null,8,["label","modelValue","onUpdate:modelValue"]),r(n(f),{label:o.__("Correct Answer"),modelValue:i[`is_correct_${a}`],"onUpdate:modelValue":s=>i[`is_correct_${a}`]=s,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):i.type=="User Input"?(c(),w(I,{key:1},N(4,a=>d("div",je,[r(n(f),{label:o.__("Possibility")+" "+a,modelValue:i[`possibility_${a}`],"onUpdate:modelValue":s=>i[`possibility_${a}`]=s,required:a==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64)):$("",!0)])):_.value=="existing"?(c(),w("div",Le,[r(ae,{modelValue:h.question,"onUpdate:modelValue":u[5]||(u[5]=a=>h.question=a),label:o.__("Select a question"),doctype:"Question"},null,8,["modelValue","label"]),r(n(f),{modelValue:h.points,"onUpdate:modelValue":u[6]||(u[6]=a=>h.points=a),label:o.__("Points"),type:"number"},null,8,["modelValue","label"])])):$("",!0)])]),_:1},8,["modelValue","options"]))}},Ae={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ne={class:"space-x-2"},Re={class:"w-3/4 mx-auto py-5"},Be={class:"mb-8"},He={class:"font-semibold mb-4"},Ke={key:0},We={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Xe={class:"mb-8"},Ge={class:"font-semibold mb-4"},Je={class:"grid grid-cols-3 gap-5 my-4"},Ye={class:"mb-8"},Ze={class:"font-semibold mb-4"},es={class:"grid grid-cols-3"},ss={class:"flex items-center justify-between mb-4"},ts={class:"font-semibold"},os=["innerHTML"],ls={key:1,class:"text-xs"},as={class:"flex gap-2"},cs={__name:"QuizForm",props:{quizID:{type:String,required:!1}},setup(q){const p=J(!1),m=A({question:"",points:0,name:""}),x=we("$user"),C=Ve(),_=q,l=A({title:"",course:"",total_points:0,passing_percentage:0,max_attempts:0,duration:0,qbyquestion:!1,limit_questions_to:0,show_answers:!0,show_submission_history:!1,shuffle_questions:!1,questions:[]});he(()=>{var e,t;_.quizID=="new"&&!((e=x.data)!=null&&e.is_moderator)&&!((t=x.data)!=null&&t.is_instructor)&&C.push({name:"Courses"}),_.quizID==="new"&&(E.prefillData.title&&(l.title=E.prefillData.title),E.prefillData.course&&(l.course=E.prefillData.course)),_.quizID!=="new"&&i.reload(),window.addEventListener("keydown",h)});const h=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(g(),e.preventDefault())};ge(()=>{window.removeEventListener("keydown",h)}),le(()=>_.quizID!=="new",e=>{e&&(i.reload(),E.clearPrefillData())});const i=z({url:"frappe.client.get",makeParams(e){return{doctype:"Quiz",name:_.quizID}},auto:!1,onSuccess(e){Object.keys(e).forEach(y=>{Object.hasOwn(l,y)&&(l[y]=e[y])});let t=["show_answers","show_submission_history","shuffle_questions"];for(let y in t){let k=t[y];l[k]=!!l[k]}}}),P=z({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:D({doctype:"Quiz"},l)}}}),R=z({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"Quiz",name:e.quizID,fieldname:D({total_points:Q()},l)}}}),g=()=>{var e;(e=i.data)!=null&&e.name?B():M()},M=()=>{P.submit({},{onSuccess(e){V.success(__("Quiz created successfully")),C.push({name:"QuizForm",params:{quizID:e.name}})},onError(e){var t;V.error(((t=e.messages)==null?void 0:t[0])||e)}})},B=()=>{var e;R.submit({quizID:(e=i.data)==null?void 0:e.name},{onSuccess(t){l.total_points=t.total_points,V.success(__("Quiz updated successfully"))},onError(t){var y;V.error(((y=t.messages)==null?void 0:y[0])||t)}})},Q=()=>{let e=0;return l.limit_questions_to&&l.questions.length>0?l.questions[0].points*l.limit_questions_to:(l.questions.forEach(t=>{e+=t.points}),e)},O=F(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Points"),key:"points",width:"5rem"}]),T=(e=null)=>{e?(m.question=e.question,m.points=e.points,m.name=e.name):(m.question="",m.points=0,m.name=""),p.value=!0},H=z({url:"seminary.seminary.api.delete_documents",makeParams(e){return{doctype:"Quiz Question",documents:e.questions}}}),K=(e,t)=>{H.submit({questions:Array.from(e)},{onSuccess(){V.success(__("Questions deleted successfully")),i.reload(),t()}})},j=F(()=>{var t;let e=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return e.push({label:_.quizID=="new"?__("New Quiz"):(t=i.data)==null?void 0:t.title,route:{name:"QuizForm",params:{quizID:_.quizID}}}),e}),W=F(()=>{var e;return{title:_.quizID=="new"?__("New Quiz"):(e=i.data)==null?void 0:e.title,description:__("Form to create and edit quizzes")}});return $e(W),(e,t)=>{var k,o,u,a;const y=ze("router-link");return c(),w(I,null,[d("header",Ae,[r(n(me),{items:j.value},null,8,["items"]),d("div",Ne,[(k=n(i).data)!=null&&k.name?(c(),U(y,{key:0,to:{name:"QuizPage",params:{quizID:n(i).data.name}}},{default:b(()=>[r(n(S),null,{default:b(()=>[L(v(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):$("",!0),(o=n(i).data)!=null&&o.name?(c(),U(y,{key:1,to:{name:"QuizSubmissionList",params:{quizID:n(i).data.name}}},{default:b(()=>[r(n(S),null,{default:b(()=>[L(v(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):$("",!0),r(n(S),{variant:"solid",onClick:t[0]||(t[0]=s=>g())},{default:b(()=>[L(v(e.__("Save")),1)]),_:1})])]),d("div",Re,[d("div",Be,[d("div",He,v(e.__("Details")),1),r(n(f),{modelValue:l.title,"onUpdate:modelValue":t[1]||(t[1]=s=>l.title=s),label:(u=n(i).data)!=null&&u.name?e.__("Title"):e.__("Enter a title and save the quiz to proceed"),required:!0},null,8,["modelValue","label"]),r(ae,{modelValue:l.course,"onUpdate:modelValue":t[2]||(t[2]=s=>l.course=s),doctype:"Course",label:e.__("Course where this quiz will be used - you may reuse this quiz in other schedules"),required:!0},null,8,["modelValue","label"]),(a=n(i).data)!=null&&a.name?(c(),w("div",Ke,[d("div",We,[r(n(f),{type:"number",modelValue:l.max_attempts,"onUpdate:modelValue":t[3]||(t[3]=s=>l.max_attempts=s),label:e.__("Maximum Attempts"),default:1},null,8,["modelValue","label"]),r(n(f),{type:"number",modelValue:l.duration,"onUpdate:modelValue":t[4]||(t[4]=s=>l.duration=s),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),r(n(f),{modelValue:l.total_points,"onUpdate:modelValue":t[5]||(t[5]=s=>l.total_points=s),label:e.__("Total Points"),disabled:""},null,8,["modelValue","label"]),r(n(f),{modelValue:l.passing_percentage,"onUpdate:modelValue":t[6]||(t[6]=s=>l.passing_percentage=s),label:e.__("Passing Percentage. Use this to force students to retake the quiz until they pass")},null,8,["modelValue","label"])]),d("div",Xe,[d("div",Ge,v(e.__("Settings")),1),d("div",Je,[r(n(f),{modelValue:l.show_answers,"onUpdate:modelValue":t[7]||(t[7]=s=>l.show_answers=s),type:"checkbox",label:e.__("Show Answers")},null,8,["modelValue","label"]),r(n(f),{modelValue:l.show_submission_history,"onUpdate:modelValue":t[8]||(t[8]=s=>l.show_submission_history=s),type:"checkbox",label:e.__("Show Submission History")},null,8,["modelValue","label"]),r(n(f),{modelValue:l.qbyquestion,"onUpdate:modelValue":t[9]||(t[9]=s=>l.qbyquestion=s),type:"checkbox",label:e.__("Force student to answer a question before moving on? Each question will have its own page and a next button")},null,8,["modelValue","label"])])]),d("div",Ye,[d("div",Ze,v(e.__("Shuffle Settings")),1),d("div",es,[r(n(f),{modelValue:l.shuffle_questions,"onUpdate:modelValue":t[10]||(t[10]=s=>l.shuffle_questions=s),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),l.shuffle_questions?(c(),U(n(f),{key:0,modelValue:l.limit_questions_to,"onUpdate:modelValue":t[11]||(t[11]=s=>l.limit_questions_to=s),label:e.__("Limit Questions To (on shuffle). Leave as zero to shuffle all questions")},null,8,["modelValue","label"])):$("",!0)])]),d("div",null,[d("div",ss,[d("div",ts,v(e.__("Questions")),1),r(n(S),{onClick:t[12]||(t[12]=s=>T())},{prefix:b(()=>[r(n(Qe),{class:"w-4 h-4"})]),default:b(()=>[L(" "+v(e.__("New Question")),1)]),_:1})]),r(n(ye),{columns:O.value,rows:l.questions,"row-key":"name",options:{showTooltip:!1}},{default:b(()=>[r(n(pe),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:b(()=>[(c(!0),w(I,null,N(O.value,s=>(c(),U(n(_e),{item:s},null,8,["item"]))),256))]),_:1}),r(n(ce),null,{default:b(()=>[(c(!0),w(I,null,N(l.questions,s=>(c(),U(n(fe),{row:s,onClick:X=>T(s),class:"cursor-pointer"},{default:b(({idx:X,column:Y,item:G})=>[r(n(be),{item:G},{default:b(()=>[Y.key=="question_detail"?(c(),w("div",{key:0,class:"text-xs truncate h-4",innerHTML:G},null,8,os)):(c(),w("div",ls,v(G),1))]),_:2},1032,["item"])]),_:1},8,["row","onClick"]))),256))]),_:1}),r(n(qe),null,{actions:b(({unselectAll:s,selections:X})=>[d("div",as,[r(n(S),{variant:"ghost",onClick:Y=>K(X,s)},{default:b(()=>[r(n(ke),{class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):$("",!0)])]),r(Fe,{modelValue:p.value,"onUpdate:modelValue":t[13]||(t[13]=s=>p.value=s),questionDetail:m,quiz:n(i),"onUpdate:quiz":t[14]||(t[14]=s=>De(i)?i.value=s:null),title:m.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{cs as default};
//# sourceMappingURL=QuizForm-LdXxoICB.js.map
