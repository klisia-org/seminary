{"version":3,"file":"StudentGroup-CCsLEp6h.js","sources":["../../../../frontend/src/pages/StudentGroup.vue"],"sourcesContent":["<template>\n  <div v-if=\"course.data && instructors.data\">\n    <header class=\"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\">\n      <Breadcrumbs class=\"h-7\" :items=\"breadcrumbs\" />\n    </header>\n    <h1 class=\"text-2xl font-bold mb-4 ml-5\">{{ __('Student Group Management for ' + course.data.course) }}</h1>\n    <h2 class=\"text-l mb-12 ml-5\">Student Groups are used to assign students to specific groups within the course, both\n      for assigning grading to specific instructors and for organizing collaborative work.</h2>\n\n\n    <div v-if=\"hasSavedGroups\" class=\"student-group-page\">\n      <!-- Input for number of groups -->\n\n      <!-- Table of Students and Groups -->\n\n      <h2 class=\"text-xl font-bold mb-4 ml-5\">Student Groups</h2>\n      <ListView :columns=\"groupColumns\" :rows=\"saved_groups.data.student_name\" row-key=\"student_name\" :options=\"{\n        showTooltip: false,\n        selectable: false,\n      }\">\n        <ListHeader class=\"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2\">\n          <ListHeaderItem :item=\"item\" v-for=\"item in groupColumns\" />\n        </ListHeader>\n        <ListRows>\n          <ListRow :row=\"row\" v-slot=\"{ idx, column, item }\" v-for=\"row in saved_groups.data\" class=\"cursor-pointer\">\n            <ListRowItem :item=\"item\">\n              <div class=\"text-xs\">\n                {{ item }}\n              </div>\n            </ListRowItem>\n          </ListRow>\n        </ListRows>\n      </ListView>\n    </div>\n    <div v-else class=\"mt-8 ml-5\">\n      <div class=\"mb-4\">\n        <label for=\"groupCount\" class=\"block text-lg font-medium text-gray-700 mb-4\">\n          How many student groups should be created?\n        </label>\n        <input id=\"groupCount\" type=\"number\" v-model=\"groupCount\" :min=\"2\" :max=\"course.data.enrollments\"\n          class=\"mt-1 mb-4 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\" />\n      </div>\n\n      <!-- Instructor selection -->\n      <div v-if=\"hasInstructors\" class=\"mb-4\">\n        <p class=\"text-lg font-medium text-gray-700 mb-2\">\n          Please, select the instructor for each group:\n        </p>\n        <div v-for=\"(group, index) in groupCount\" :key=\"index\" class=\"mb-2\">\n          <label :for=\"`instructor-${index}`\" class=\"block text-sm font-medium text-gray-700\">\n            Group {{ index + 1 }} Instructor\n          </label>\n          <FormControl v-model=\"selectedInstructors[index]\" :label=\"__('Instructor')\" type=\"select\"\n            :options=\"instructorOptions\" />\n        </div>\n      </div>\n      <div v-else class=\"mb-4\">\n        <p class=\"text-lg font-medium text-gray-700 mb-2\">\n          Only one instructor is assigned to this course. Student groups will be created with instructor: {{\n            instructors.data[0].instructor_name }}\n        </p>\n      </div>\n\n      <!-- Create Groups Button -->\n      <Button :variant=\"'solid'\" theme=\"gray\" size=\"sm\" :label=\"__('Create Groups')\" :loading=\"false\"\n        @click=\"createGroups\" :disabled=\"!canCreateGroups\" </Button>\n    </div>\n  </div>\n\n\n</template>\n\n<script setup>\nimport { ref, computed, inject, watch } from 'vue';\nimport { createResource, Breadcrumbs, ListView, ListHeader, ListHeaderItem, ListRows, ListRow, ListRowItem, FormControl, Button } from 'frappe-ui'\nimport { useRouter, useRoute } from 'vue-router';\nimport Link from '@/components/Controls/Link.vue'\nimport { updateDocumentTitle } from '@/utils'\n\nconst router = useRouter();\nconst route = useRoute();\nconst user = inject('$user')\n\nconst props = defineProps({\n  courseName: {\n    type: String,\n    required: true,\n  },\n})\n\nconst instructors = createResource({\n  url: 'seminary.seminary.utils.get_instructors',\n  params: {\n    course: props.courseName,\n  },\n  auto: true,\n});\nconsole.log(\"Instructors fetched:\", instructors);\n\nconsole.log(\"Course Name:\", props.courseName);\n\nconst course = createResource({\n  url: 'seminary.seminary.utils.get_course_details',\n  cache: ['course', props.courseName],\n  params: {\n    course: props.courseName,\n  },\n  auto: true,\n})\n\nconst saved_groups = createResource({\n  url: 'seminary.seminary.utils.get_student_groups',\n  cache: ['saved_groups', props.courseName],\n  params: {\n    course: props.courseName,\n  },\n  auto: true,\n});\n\nconsole.log(\"Course:\", course);\nconsole.log(\"Saved Groups:\", saved_groups);\n\nconst hasInstructors = computed(() => instructors.data && instructors.data.length > 1);\nconst hasSavedGroups = computed(() => saved_groups.data && saved_groups.data.length > 0);\n\nconst breadcrumbs = computed(() => {\n  let items = [{ label: __('Courses'), route: { name: 'Courses' } }]\n  items.push({\n    label: course?.data?.course,\n    route: { name: 'CourseDetail', params: { courseName: props.courseName } },\n  })\n  items.push({\n    label: __('Assessment'),\n    route: { name: 'CourseAssessment', params: { courseName: props.courseName } }\n  })\n  return items\n})\n\nconst pageMeta = computed(() => {\n  return {\n    title: course?.data?.title,\n    description: __(\"Configuration of Student Groups for the course\"),\n  }\n})\n\nupdateDocumentTitle(pageMeta)\n\nconst groupCount = ref(2);\nconst selectedInstructors = ref([]);\nconst studentGroups = ref([]);\n\nconst groupColumns = computed(() => {\n  return [\n    {\n      label: __('Student'),\n      key: 'student_name',\n      width: 2,\n    },\n    {\n      label: __('Student Group'),\n      key: 'student_group',\n      width: 2,\n    },\n    {\n      label: __('Instructor'),\n      key: 'group_instructor',\n      width: 2,\n    },\n\n  ]\n})\n\nconst canCreateGroups = computed(() => {\n  return (\n    groupCount.value > 1 &&\n    groupCount.value <= course.data.enrollments &&\n    ((hasInstructors.value &&\n      selectedInstructors.value.length === groupCount.value) || !hasInstructors.value)\n  );\n});\n\nconst instructorOptions = computed(() => {\n  console.log(\"Instructors Data in Computed:\", instructors.data);\n\n  // Transform instructors.data into the expected format for FormControl\n  if (Array.isArray(instructors.data)) {\n    return instructors.data.map((instructor) => ({\n      label: instructor.instructor_name, // Adjust based on actual data structure\n      value: instructor.user, // Adjust based on actual data structure\n    }));\n  }\n\n  return Object.values(instructors.data || {}).map((instructor) => ({\n    label: instructor.instructor_name, // Adjust based on actual data structure\n    value: instructor.user, // Adjust based on actual data structure\n  }));\n});\n\nconsole.log(\"Can Create Groups:\", canCreateGroups.value);\nconsole.log(\"Instructor Options Outside Computed:\", instructorOptions.value);\n\nconst students = createResource({\n  url: 'seminary.seminary.utils.get_roster',\n  cache: ['roster', props.courseName],\n  params: {\n    course: props.courseName,\n  },\n  auto: true,\n})\nconsole.log(\"Students fetched:\", students.data);\n\n\nfunction createGroups() {\n  try {\n    console.log(\"Create Groups function called\");\n\n\n    // Ensure students.data is defined\n    if (!students.data || !Array.isArray(students.data)) {\n      throw new Error(__(\"Students data is not available or not an array.\"));\n    }\n\n    // Filter students based on audit_bool and active fields\n    const filteredStudents = students.data.filter(\n      (student) => student.audit_bool === 0 && student.active === 1\n    );\n\n    // Map to extract student id\n    const studentData = filteredStudents.map((student) => ({\n      member: student.student,\n\n    }));\n\n    // Log the resulting array\n    console.log(\"Filtered and Transformed Students:\", studentData);\n\n    // Logic to distribute students evenly among groups\n    const groups = Array.from({ length: groupCount.value }, () => []);\n    studentData.forEach((student, index) => {\n      groups[index % groupCount.value].push(student);\n    });\n\n    // Log the groups for debugging\n    console.log(\"Formed Groups:\", groups);\n\n    // Logic to assign instructors and create groups\n    groups.forEach((group, index) => {\n      const groupName = `${course.data.name} ${selectedInstructors.value[index] || instructors.data[0].instructor_name} Group ${index + 1}`;\n      const mentor = selectedInstructors.value[index] || instructors.data[0].instructor_name;\n      console.log(`Creating group: ${mentor} ${groupName}`, group);\n      // Call API to create group\n      const group_creator = createResource({\n        url: 'seminary.seminary.utils.create_student_group',\n        cache: ['student_group', props.courseName],\n        params: {\n          course: props.courseName,\n          group_name: groupName,\n          group_instructor: mentor,\n          members: group,\n        },\n        auto: true,\n      })\n    });\n  } catch (error) {\n    console.error(\"Error in createGroups function:\", error);\n  }\n}\n\n// Watch for changes in instructors.data to debug its state\nwatch(\n  () => instructors.data,\n  (newValue) => {\n    console.log(\"Instructors data changed:\", newValue);\n    console.log(\"Instructor Options Updated:\", instructorOptions.value);\n  }\n);\n</script>\n\n<style>\n.student-group-page {\n  max-width: 800px;\n  margin: 0 auto;\n  padding: 20px;\n}\n</style>"],"names":["useRouter","useRoute","inject","props","__props","instructors","createResource","course","saved_groups","hasInstructors","computed","hasSavedGroups","breadcrumbs","items","_a","pageMeta","updateDocumentTitle","groupCount","ref","selectedInstructors","groupColumns","canCreateGroups","instructorOptions","instructor","students","createGroups","studentData","student","groups","index","group","groupName","mentor","group_creator","error","watch","newValue","_unref","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","Breadcrumbs","_hoisted_3","_toDisplayString","__","_cache","_openBlock","_hoisted_4","ListView","ListHeader","_Fragment","_renderList","item","_createBlock","ListHeaderItem","ListRows","row","ListRow","_withCtx","idx","column","ListRowItem","_hoisted_5","_hoisted_6","_hoisted_7","$event","_hoisted_9","_hoisted_10","FormControl","_hoisted_11","_hoisted_12","Button"],"mappings":"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"}