{"version":3,"file":"Courses-f9fb298b.js","sources":["../../../../frontend/src/pages/Courses.vue"],"sourcesContent":["<template>\n  <header\n    class=\"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n  >\n    <div class=\"flex items-center\">\n      <h1 class=\"text-xl font-semibold text-ink-gray-9\">{{ isStudent ? 'My Courses' : 'All Courses' }}</h1>\n    </div>\n  </header>\n\n  <!-- Parent container for filters and course cards -->\n  <div class=\"p-5 flex flex-row gap-4 w-full mx-auto\">\n    <!-- To Do Column -->\n<div class=\"w-1/4 p-4\">\n  <h2 class=\"text-lg font-semibold mb-4\">To Do</h2>\n  <div v-if=\"isStudent || isInstructor\">\n    <div v-for=\"entry in courseToDoList\" :key=\"entry.course.name\" >\n  <h3 class=\"text-md font-medium mb-2\">{{ entry.course.name }}</h3>\n  <CourseCardToDo :course=\"entry.course.name\" :singleCourse=\"false\" />\n</div>\n\n<div v-if=\"courseToDoList.length === 0\">\n  <PartyPopper class=\"size-20 mx-auto stroke-1 text-gray-500 mt-5\" />\n  <h3 v-if=\"isStudent\" class=\"text-xl text-center font-semibold text-gray-500 mt-5\"> Congrats! No assessments to do!</h3>\n  <h3 v-if=\"isInstructor\" class=\"text-xl text-center font-semibold text-gray-500 mt-5\"> Congrats! No assessments to grade!</h3>\n</div>\n  </div>\n</div>\n\n    <!-- Main Content -->\n    <div class=\"w-3/4\">\n      <!-- Filters for non-student users -->\n      <div class=\"flex gap-4 mb-5\">\n        <div>\n          <label for=\"courseFilter\" class=\"block text-sm font-medium text-gray-700\">Course</label>\n          <select\n            id=\"courseFilter\"\n            v-model=\"filters.course\"\n            class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n          >\n            <option value=\"\">All Courses</option>\n            <option v-for=\"course in uniqueCourses\" :key=\"course\" :value=\"course\">\n              {{ course }}\n            </option>\n          </select>\n        </div>\n        <div>\n          <label for=\"academicTermFilter\" class=\"block text-sm font-medium text-gray-700\">Academic Term</label>\n          <select\n            id=\"academicTermFilter\"\n            v-model=\"filters.academic_term\"\n            class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n          >\n            <option value=\"\">All Terms</option>\n            <option v-for=\"term in uniqueAcademicTerms\" :key=\"term\" :value=\"term\">\n              {{ term }}\n            </option>\n          </select>\n        </div>\n      </div>\n\n      <!-- Course Cards -->\n      <div v-if=\"filteredCourses.length\" class=\"flex flex-wrap justify-start gap-4\">\n        <router-link\n          v-for=\"course in filteredCourses\"\n          :to=\"{ name: 'CourseDetail', params: { courseName: course.name } }\"\n          :key=\"course.name\"\n          class=\"course_card\"\n        >\n          <div class=\"course-image\" :style=\"{ backgroundImage: `url(${encodeURI(course.course_image)})` }\"></div>\n          <div class=\"p-4 text-container\">\n            <h3 class=\"text-2xl font-semibold\">{{ course.course }}</h3>\n            <div class=\"short-introduction text-ink-gray-7 text-sm\">\n              {{ course.short_introduction }}\n            </div>\n            <div class=\"academic-term text-right mt-auto\">\n              {{ course.academic_term }}\n            </div>\n          </div>\n        </router-link>\n      </div>\n      <div v-else class=\"flex flex-col items-center justify-center text-sm text-ink-gray-5 italic mt-48\">\n        <BookOpen class=\"size-10 mx-auto stroke-1 text-ink-gray-4\" />\n        <div class=\"text-2xl font-medium mb-1\">\n          <span>No courses found</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { computed, inject, onMounted, ref, watch, watchEffect, reactive, toRaw } from 'vue'\nimport { BookOpen, Plus, PartyPopper } from 'lucide-vue-next'\nimport { createResource } from 'frappe-ui'\nimport { ListView, ListHeader, ListHeaderItem, ListRow, ListRowItem } from 'frappe-ui'\nimport { usersStore } from '../stores/user'\nimport CourseCardToDo from '@/components/CourseCardToDo.vue'\n import { useCourseToDo } from '@/utils/useCourseToDo'\n\nconst user = inject('$user')\nconst start = ref(0)\n\nlet userResource = usersStore()\nlet isStudent = user.data.is_student\nlet isModerator = user.data.is_moderator\nlet isInstructor = user.data.is_instructor\nlet isSystemManager = user.data.is_system_manager\n\n\nconst current_AcademicTerm = createResource({\n  url: \"frappe.client.get_value\",\n  params: {\n    doctype: \"Academic Term\",\n    fieldname: \"title\",\n    filters: {\n      iscurrent_acterm: 1\n    }\n  },\n  auto: true\n\n})\n\nconst cachedAcademicTerm = ref('');\n\nonMounted(() => {\n  current_AcademicTerm.reload()\n  if (current_AcademicTerm.data?.title) {\n    cachedAcademicTerm.value = current_AcademicTerm.data.title;\n  \n  }\n});\n\n\n\n\n\nwatch(\n  () => current_AcademicTerm.data,\n  (newData) => {\n    if (newData?.title) {\n      cachedAcademicTerm.value = newData.title;\n    } else {\n      console.log(\"Current Academic Term: undefined\");\n    }\n  },\n  { immediate: true }\n);\n\nwatch(\n  () => cachedAcademicTerm.value,\n  (newTerm) => {\n    if (newTerm) {\n      filters.academic_term = newTerm;\n      console.log(\"Updated filters.academic_term:\", filters.academic_term);\n    }\n  }\n);\n\nconst filters = reactive({\n  course: '',\n  academic_term: current_AcademicTerm.data?.title || ''\n});\nconsole.log(filters.academic_term)\n\nconst courses = createResource({\n  url: isStudent ? \"seminary.seminary.utils.get_courses_for_student\" : \"seminary.seminary.utils.get_courses\",\n  params: isStudent ? { student: user.data.name } : {},\n  onSuccess: (response) => {\n    tableData.rows = response.sort((a, b) => {\n      if (a.academic_term < b.academic_term) return -1;\n      if (a.academic_term > b.academic_term) return 1;\n      if (a.course < b.course) return -1;\n      if (a.course > b.course) return 1;\n      return 0;\n    });\n  },\n  auto: true\n});\n\nconst tableData = reactive({\n  rows: [],\n  columns: [\n    {\n      label: 'Name',\n      key: 'name',\n      width: 1,\n    },\n    {\n      label: 'Course',\n      key: 'course',\n      width: 1,\n    },\n    {\n      label: 'Academic Term',\n      key: 'academic_term',\n      width: 1,\n    },\n    {\n      label: 'Start Date',\n      key: 'c_datestart',\n      width: 1,\n    },\n    {\n      label: 'End Date',\n      key: 'c_dateend',\n      width: 1,\n    },\n    {\n      label: 'Image',\n      key: 'course_image',\n      width: 1,\n    }\n  ]\n})\n\nconst uniqueCourses = computed(() => {\n  return [...new Set(courses.data?.map(course => course.course))]\n})\n\nconst uniqueAcademicTerms = computed(() => {\n  return [...new Set(courses.data?.map(course => course.academic_term))]\n})\n\nconst filteredCourses = computed(() => {\n  return courses.data?.filter(course => {\n    return (!filters.course || course.course === filters.course) &&\n           (!filters.academic_term || course.academic_term === filters.academic_term)\n  }) || []\n})\n\n\n\nconst setQueryParams = () => {\n  let queries = new URLSearchParams(location.search)\n  let filterKeys = {\n    name: course?.name || '',\n  }\n\n  Object.keys(filterKeys).forEach((key) => {\n    if (filterKeys[key]) {\n      queries.set(key, filterKeys[key])\n    } else {\n      queries.delete(key)\n    }\n  })\n\n  history.replaceState({}, '', `${location.pathname}?${queries.toString()}`)\n}\n\n// We'll store one instance per course (keyed by course name) in a map.\nconst courseTodoInstances = ref({})\nconst courseToDoList = ref([]);\n// When filteredCourses changes, add a to-do instance for any new course.\n// Populate the map when filteredCourses changes:\nwatch(filteredCourses, (newCourses) => {\n  if (!newCourses) return;\n  const list = [];\n  newCourses.forEach(course => {\n    if (!courseTodoInstances.value[course.name]) {\n      courseTodoInstances.value[course.name] = useCourseToDo(course.name, user);\n      console.log('Created instance for course:', course.name, courseTodoInstances.value[course.name]);\n    }\n    const todoInstance = courseTodoInstances.value[course.name];\n    const count = todoInstance.countToDoItems;\n    console.log('Starting if statement with count:', count, 'for todoInstance:', todoInstance);\n    if (todoInstance && count > 0) {\n      list.push({ course: course, count: count });\n    }\n    });\n    console.log('List: ', list);\n    courseToDoList.value = list;\n    console.log('Updated courseToDoList:', courseToDoList.value);\n  });\n\n\n\nwatch(\n  () => filteredCourses,\n  (newFilteredCourses) => {\n    if (!Array.isArray(newFilteredCourses)) {\n      console.error(\"newFilteredCourses is not an array:\", newFilteredCourses);\n      newFilteredCourses = [];\n    }\n\n    const updatedList = newFilteredCourses.map(course => {\n      const todo = useCourseToDo(course.name, user);\n      return {\n        course,\n        count: todo.countToDoItems.value, // Accessing the value correctly\n        hasItems: todo.countToDoItems.value > 0, // Ensuring correct comparison\n      };\n    }).filter(entry => entry.hasItems);\n\n    courseToDoList.value = updatedList;\n    console.log(\"Updated courseToDoList:\", courseToDoList.value);\n  },\n  { immediate: true }\n);\n\n</script>\n\n<style>\n.course_card {\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  max-width: 400px;\n  height: 400px;\n  align-items: center;\n  justify-content: flex-start;\n  padding: 0;\n  border-radius: 0.5rem;\n  box-shadow: 0 0 1rem rgba(0, 0, 0, 0.1);\n  background-color: #fff;\n  transition: all 0.3s;\n}\n.course-image {\n    width: 100%;\n    height: 66.67%; /* 4:3 aspect ratio */\n    background-size: cover;\n    background-position: center;\n    background-repeat: no-repeat;\n    border-top-left-radius: 0.5rem;\n    border-top-right-radius: 0.5rem;\n}\n.text-container {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    height: 33.33%; /* Bottom third of the card */\n    padding: 1rem;\n    width: 100%;\n}\n.short-introduction {\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    line-clamp: 2;\n    -webkit-box-orient: vertical;\n    text-overflow: ellipsis;\n    width: 100%;\n    overflow: hidden;\n    margin: 0.25rem 0 1.25rem;\n    line-height: 1.5;\n}\n@media (max-width: 640px) {\n  .course_card {\n    max-width: 100%;\n    height: auto;\n  }\n  .course-image {\n    height: auto;\n    aspect-ratio: 4 / 3;\n  }\n  .text-container {\n    height: auto;\n  }\n}\n</style>"],"names":["user","inject","ref","usersStore","isStudent","isInstructor","current_AcademicTerm","createResource","cachedAcademicTerm","onMounted","_a","watch","newData","newTerm","filters","reactive","courses","response","tableData","a","b","uniqueCourses","computed","course","uniqueAcademicTerms","filteredCourses","courseTodoInstances","courseToDoList","newCourses","list","useCourseToDo","todoInstance","count","newFilteredCourses","updatedList","todo","entry","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_toDisplayString","_unref","_hoisted_4","_hoisted_5","_cache","_createElementBlock","_hoisted_6","_Fragment","_renderList","_hoisted_7","_createVNode","CourseCardToDo","_hoisted_8","PartyPopper","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","$event","_hoisted_13","_vModelSelect","term","_hoisted_14","_openBlock","_hoisted_15","_createBlock","_component_router_link","_normalizeStyle","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","BookOpen"],"mappings":"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"}