import{s as J,y as H,z as X,r as y,l as C,a1 as G,c as D,o as u,d as p,U as P,A as V,t as c,g as S,e as o,F as A,k as K,f as I,w as h,h as n,b as i,S as z,P as B,_ as F,p as Q,V as W,L as Y,i as Z,x as ee,a as se,m as te,$ as oe}from"./index-99ce2d99.js";import{_ as re}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-d765e83c.js";import{s as j,u as ae,_ as le,F as ie}from"./index-424b6fdc.js";import{_ as ne,i as ue,u as ce,r as de,l as me,a as U}from"./plus-5e4fea15.js";import{_ as pe}from"./CourseOutline-e9bd719b.js";import{X as fe}from"./Link-ea839e37.js";import"./telemetry-1b93602e.js";import{u as _e}from"./settings-4170a1c2.js";import"./Badge.vue_vue_type_script_setup_true_lang-cc7b8027.js";import"./pencil-5a62532b.js";import"./FolderPlugin.vue_vue_type_style_index_0_scoped_84b7d54d_lang-09f2e4ee.js";import"./book-open-check-a8ea3893.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-89c1576a.js";import"./file-up-49390357.js";import"./check-d7dcbbf2.js";/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=J("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),ve={key:0,class:"text-ink-red-3"},ge={class:"grid grid-cols-3 gap-1"},ye={class:""},be={class:"mt-1 rounded-lg bg-surface-white py-1 text-base shadow-2xl"},xe={class:"flex flex-col gap-1 p-1"},ke={class:"text-base font-medium"},we={class:"text-sm text-ink-gray-5"},Ce={__name:"MultiSelect",props:H({label:{type:String},size:{type:String,default:"sm"},doctype:{type:String,required:!0},filters:{type:Object,default:()=>({})},validate:{type:Function,default:null},errorMessage:{type:Function,default:v=>`${v} is an Invalid value`},required:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v,{expose:x}){const g=v,d=X(v,"modelValue"),f=y([]),k=y(null),r=y(null),_=y(""),b=y(""),m=y(!1),$=C({get:()=>_.value||"",set:s=>{_.value="",s&&(m.value=!1),s!=null&&s.value&&L(s.value)}});G(_,s=>{s=s||"",b.value!==s&&(b.value=s,T(s))},{debounce:300,immediate:!0});const w=D({url:"frappe.desk.search.search_link",method:"POST",cache:[b.value,g.doctype],auto:!0,params:{txt:b.value,doctype:g.doctype}}),M=C(()=>w.data||[]);function T(s){w.update({params:{txt:s,doctype:g.doctype}}),w.reload()}const L=s=>{r.value=null,s&&(s.split(",").forEach(t=>{var a;if(t=t.trim(),t&&!((a=d.value)!=null&&a.includes(t))){if(t&&g.validate&&!g.validate(t)){r.value=g.errorMessage(t);return}d.value?d.value.push(t):d.value=[t],t=t.replace(t,"")}}),!r.value&&(s=""))},O=s=>{d.value=d.value.filter(l=>l!==s)},E=()=>{var l;if(_.value)return;let s=(l=f.value[f.value.length-1])==null?void 0:l.$el;document.activeElement===s?(d.value.pop(),Y(()=>{d.value.length?(s=f.value[f.value.length-1].$el,s==null||s.focus()):N()})):s==null||s.focus()};function N(){k.value.$el.focus()}x({setFocus:N});const e=C(()=>[{sm:"text-xs",md:"text-base"}[g.size||"sm"],"text-ink-gray-5"]);return(s,l)=>(u(),p("div",null,[v.label?(u(),p("label",{key:0,class:P(["block mb-1",e.value])},[V(c(v.label)+" ",1),v.required?(u(),p("span",ve,"*")):S("",!0)],2)):S("",!0),o("div",ge,[(u(!0),p(A,null,K(d.value,t=>(u(),I(i(F),{ref_for:!0,ref_key:"emails",ref:f,key:t,label:t,theme:"gray",variant:"subtle",class:"rounded-md",onKeydownCapture:z(B(E,["stop"]),["delete"])},{suffix:h(()=>[n(i(fe),{onClick:a=>O(t),class:"h-4 w-4 stroke-1.5"},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),o("div",ye,[n(i(me),{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=t=>$.value=t),nullable:""},{default:h(()=>[n(i(ne),{class:"w-full",show:m.value,"onUpdate:show":l[1]||(l[1]=t=>m.value=t)},{target:h(({togglePopover:t})=>[n(i(ue),{ref_key:"search",ref:k,class:"search-input form-input w-full focus-visible:!ring-0",type:"text",value:_.value,onChange:l[0]||(l[0]=a=>{_.value=a.target.value,m.value=!0}),autocomplete:"off",onFocus:()=>t(),onKeydownCapture:z(B(E,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:h(({isOpen:t})=>[Q(o("div",null,[o("div",be,[n(i(ce),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:h(()=>[(u(!0),p(A,null,K(M.value,a=>(u(),I(i(de),{key:a.value,value:a},{default:h(({active:q})=>[o("li",{class:P(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-2":q}])},[o("div",xe,[o("div",ke,c(a.description),1),o("div",we,c(a.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[W,t]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])])]))}},Ve={class:""},Se={class:"grid md:grid-cols-[70%,30%] h-full"},$e={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ee={class:"flex items-center mt-3 md:mt-0"},Ne={class:"mt-5 mb-10"},Fe={class:"container mb-5"},Ie={class:"text-lg font-semibold mb-4"},Me={key:0},Te={key:1},Le={class:"mb-4"},Oe={class:"mb-1.5 mt-4 text-sm text-ink-gray-5"},je={class:"mb-4"},Ue={class:"text-xs text-ink-gray-5 mb-2"},De={class:"flex items-center"},Pe={class:"border rounded-md w-fit py-5 px-20"},qe={class:"ml-4"},Ae={class:"mt-2 text-ink-gray-5 text-sm"},Ke={key:1,class:"mb-4"},ze={class:"flex items-center"},Be=["src"],Re={class:"ml-4"},Je={class:"mt-2 text-ink-gray-5 text-sm"},He={class:"mb-4"},Xe={class:"container border-t"},Ge={key:0,class:"text-lg font-semibold mt-5 mb-4"},Qe={class:"grid grid-cols-2 gap-10 mb-4"},We={key:0,class:"flex flex-col space-y-4"},Ye={class:"border-l pt-5"},Ze=55,hs={__name:"CourseForm",props:{courseName:{type:String}},setup(v){const x=Z("$user");y("");const g=ee(),d=y([]),f=y([]);_e();const k=v,r=se({course:"",short_introduction:"",course_description_for_lms:"",course_image:null,published:!1}),_=C(()=>{const e=r.short_introduction.length||0;return Ze-e});te(()=>{m.reload(),window.addEventListener("keydown",b)});const b=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(w(),e.preventDefault())};oe(()=>{window.removeEventListener("keydown",b)});const m=D({url:"frappe.client.get",makeParams(e){return{doctype:"Course Schedule",name:k.courseName}},auto:!1,onSuccess(e){if(!e){console.error("No data received from courseResource");return}Object.keys(e).forEach(l=>{l=="instructor1"?(d.value=[],f.value=[],e.instructor1.forEach(t=>{d.value.push(t),f.value.push(t.instructor)})):Object.hasOwn(r,l)&&(r[l]=e[l])});let s=["published"];for(let l in s){let t=s[l];r[t]=!!r[t]}e.course_image&&$.reload({image:e.course_image}),O()},onError(e){console.error("courseResource onError:",e)}}),$=D({url:"seminary.seminary.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){r.course_image=e},onError(e){console.error("imageResource onError:",e)}}),w=()=>{m.data&&fetch("/api/method/seminary.seminary.api.save_course",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({course:m.data.name,course_data:r})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>{var s;e.message&&e.message.success?j("Success","Course updated successfully","check"):j("Error",((s=e.message)==null?void 0:s.message)||"An error occurred","x")}).catch(e=>{console.error("Fetch error:",e);const s=typeof e=="object"?JSON.stringify(e):e.toString();j("Error",s||"An error occurred","x")})},M=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return __("Only image file is allowed.")},T=e=>{r.course_image=e},L=()=>{r.course_image=null},O=()=>{var s;let e=!1;(s=x.data)!=null&&s.is_moderator||(d.value.forEach(l=>{var t;!e&&l.user==((t=x.data)==null?void 0:t.name)&&(e=!0)}),e||(console.log("Redirecting to Courses due to insufficient permissions"),g.push({name:"Courses"})))},E=C(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return m.data&&e.push({label:r.course,route:{name:"CourseDetail",params:{courseName:k.courseName}}}),e.push({label:"Edit Course",route:{name:"CourseForm",params:{courseName:k.courseName}}}),e}),N=C(()=>({title:"Edit Course",description:"Edit a course for your learning system."}));return ae(N),(e,s)=>{var l,t;return u(),p("div",Ve,[o("div",Se,[o("div",null,[o("header",$e,[n(i(re),{class:"h-7",items:E.value},null,8,["items"]),o("div",Ee,[n(i(F),{variant:"solid",onClick:s[0]||(s[0]=a=>w()),class:"ml-2"},{default:h(()=>[o("span",null,c(e.__("Save")),1)]),_:1})])]),o("div",Ne,[o("div",Fe,[o("div",Ie,c(e.__("Details")),1),n(i(U),{modelValue:r.course,"onUpdate:modelValue":s[1]||(s[1]=a=>r.course=a),label:e.__("Title"),class:"mb-4",required:!0},null,8,["modelValue","label"]),n(i(U),{modelValue:r.short_introduction,"onUpdate:modelValue":s[2]||(s[2]=a=>r.short_introduction=a),label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card (less than 55 characters)"),class:"mb-2",required:!0},null,8,["modelValue","label","placeholder"]),o("div",{class:P(["text-sm mt-1",_.value<0?"text-red-500":"text-ink-gray-5"])},[_.value>=0?(u(),p("span",Me,c(`${_.value} characters available`),1)):(u(),p("span",Te,c(e.__("This introduction may be truncated on the course card.")),1))],2),o("div",Le,[o("div",Oe,[V(c(e.__("Course Description"))+" ",1),s[8]||(s[8]=o("span",{class:"text-ink-red-3"},"*",-1))]),n(i(le),{content:r.course_description_for_lms,onChange:s[3]||(s[3]=a=>r.course_description_for_lms=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),o("div",je,[o("div",Ue,[V(c(e.__("Course Image"))+" ",1),s[9]||(s[9]=o("span",{class:"text-ink-red-3"},"*",-1))]),r.course_image?(u(),p("div",Ke,[o("div",ze,[o("img",{src:r.course_image.file_url,class:"border rounded-md w-40"},null,8,Be),o("div",Re,[n(i(F),{onClick:s[5]||(s[5]=a=>L())},{default:h(()=>[V(c(e.__("Remove")),1)]),_:1}),o("div",Je,c(e.__("Appears on the course card in the course list")),1)])])])):(u(),I(i(ie),{key:0,fileTypes:["image/*"],validateFile:M,onSuccess:s[4]||(s[4]=a=>T(a))},{default:h(({file:a,progress:q,uploading:es,openFileSelector:R})=>[o("div",De,[o("div",Pe,[n(i(he),{class:"size-5 stroke-1 text-ink-gray-7"})]),o("div",qe,[n(i(F),{onClick:R},{default:h(()=>[V(c(e.__("Upload")),1)]),_:1},8,["onClick"]),o("div",Ae,c(e.__("Appears on the course card in the course list")),1)])])]),_:1}))]),o("div",He,[n(Ce,{modelValue:f.value,"onUpdate:modelValue":s[6]||(s[6]=a=>f.value=a),doctype:"Instructor",label:e.__("Instructors"),filters:{Status:"Active"},required:!0},null,8,["modelValue","label"])])]),o("div",Xe,[(l=i(x).data)!=null&&l.is_moderator?(u(),p("div",Ge,c(e.__("Settings")),1)):S("",!0),o("div",Qe,[(t=i(x).data)!=null&&t.is_moderator?(u(),p("div",We,[n(i(U),{type:"checkbox",modelValue:r.published,"onUpdate:modelValue":s[7]||(s[7]=a=>r.published=a),label:e.__("Published")},null,8,["modelValue","label"])])):S("",!0)])])])]),o("div",Ye,[i(m).data?(u(),I(pe,{key:0,courseName:i(m).data.name,title:r.course,allowEdit:!0},null,8,["courseName","title"])):S("",!0)])])])}}};export{hs as default};
//# sourceMappingURL=CourseForm-fe3e545c.js.map
