var re=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var q=(t,u)=>{var n={};for(var o in t)we.call(t,o)&&u.indexOf(o)<0&&(n[o]=t[o]);if(t!=null&&re)for(var o of re(t))u.indexOf(o)<0&&Se.call(t,o)&&(n[o]=t[o]);return n};var ne=(t,u,n)=>new Promise((o,e)=>{var k=c=>{try{l(n.next(c))}catch(b){e(b)}},m=c=>{try{l(n.throw(c))}catch(b){e(b)}},l=c=>c.done?o(c.value):Promise.resolve(c.value).then(k,m);l((n=n.apply(t,u)).next())});import{r as $,m as J,a3 as he,L as W,l as H,a4 as ge,a5 as ye,i as ee,s as te,y as Ee,z as ie,a as $e,c as F,n as Ne,g as x,o as d,w as C,f as g,j as y,d as v,h as D,e as r,a6 as Oe,_ as Y,A as Z,t as E,D as Pe,C as O,a7 as Me,Z as Te,x as Ve,b as Le,O as G,F as Q,k as ue,$ as X,R as L,a8 as Fe,a9 as ce}from"./index-CVWiL_Ou.js";import{F as Ie,e as ve,h as Be,T as de,i as ze}from"./index-BTqjjO0a.js";import{o as P,A as ae,b as Re,c as K,d as pe,t as Ue,e as me,f as A,N as fe,a as Ae}from"./FormControl.vue_vue_type_script_setup_true_lang-ClvexRF6.js";import{u as je}from"./settings-CEgcVaKi.js";import{X as qe}from"./Link-D0cze3Hl.js";import{C as He}from"./chevron-right-BsOdfCj-.js";import{B as Ke}from"./book-open-check-yBkpgSvd.js";import{F as Ge}from"./file-up-BWU3Xov9.js";import{C as Qe}from"./check-B_liISYN.js";function _e(t,u){if(t)return t;let n=u!=null?u:"button";if(typeof n=="string"&&n.toLowerCase()==="button")return"button"}function Xe(t,u){let n=$(_e(t.value.type,t.value.as));return J(()=>{n.value=_e(t.value.type,t.value.as)}),he(()=>{var o;n.value||P(u)&&P(u)instanceof HTMLButtonElement&&!((o=P(u))!=null&&o.hasAttribute("type"))&&(n.value="button")}),n}var Ye=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(Ye||{});let ke=Symbol("DisclosureContext");function se(t){let u=ee(ke,null);if(u===null){let n=new Error(`<${t} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,se),n}return u}let be=Symbol("DisclosurePanelContext");function Ze(){return ee(be,null)}let Je=W({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(t,{slots:u,attrs:n}){let o=$(t.defaultOpen?0:1),e=$(null),k=$(null),m={buttonId:$(`headlessui-disclosure-button-${pe()}`),panelId:$(`headlessui-disclosure-panel-${pe()}`),disclosureState:o,panel:e,button:k,toggleDisclosure(){o.value=me(o.value,{0:1,1:0})},closeDisclosure(){o.value!==1&&(o.value=1)},close(l){m.closeDisclosure();let c=l?l instanceof HTMLElement?l:l.value instanceof HTMLElement?P(l):P(m.button):P(m.button);c==null||c.focus()}};return ye(ke,m),Ue(H(()=>me(o.value,{0:K.Open,1:K.Closed}))),()=>{let w=t,{defaultOpen:l}=w,c=q(w,["defaultOpen"]),b={open:o.value===0,close:m.close};return ae({theirProps:c,ourProps:{},slot:b,slots:u,attrs:n,name:"Disclosure"})}}}),We=W({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(t,{attrs:u,slots:n,expose:o}){let e=se("DisclosureButton"),k=Ze(),m=H(()=>k===null?!1:k.value===e.panelId.value);J(()=>{m.value||t.id!==null&&(e.buttonId.value=t.id)}),ge(()=>{m.value||(e.buttonId.value=null)});let l=$(null);o({el:l,$el:l}),m.value||he(()=>{e.button.value=l.value});let c=Xe(H(()=>({as:t.as,type:u.type})),l);function b(){var s;t.disabled||(m.value?(e.toggleDisclosure(),(s=P(e.button))==null||s.focus()):e.toggleDisclosure())}function w(s){var i;if(!t.disabled)if(m.value)switch(s.key){case A.Space:case A.Enter:s.preventDefault(),s.stopPropagation(),e.toggleDisclosure(),(i=P(e.button))==null||i.focus();break}else switch(s.key){case A.Space:case A.Enter:s.preventDefault(),s.stopPropagation(),e.toggleDisclosure();break}}function V(s){switch(s.key){case A.Space:s.preventDefault();break}}return()=>{var s;let i={open:e.disclosureState.value===0},B=t,{id:f}=B,M=q(B,["id"]),I=m.value?{ref:l,type:c.value,onClick:b,onKeydown:w}:{id:(s=e.buttonId.value)!=null?s:f,ref:l,type:c.value,"aria-expanded":e.disclosureState.value===0,"aria-controls":e.disclosureState.value===0||P(e.panel)?e.panelId.value:void 0,disabled:t.disabled?!0:void 0,onClick:b,onKeydown:w,onKeyup:V};return ae({ourProps:I,theirProps:M,slot:i,attrs:u,slots:n,name:"DisclosureButton"})}}}),et=W({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(t,{attrs:u,slots:n,expose:o}){let e=se("DisclosurePanel");J(()=>{t.id!==null&&(e.panelId.value=t.id)}),ge(()=>{e.panelId.value=null}),o({el:e.panel,$el:e.panel}),ye(be,e.panelId);let k=Re(),m=H(()=>k!==null?(k.value&K.Open)===K.Open:e.disclosureState.value===0);return()=>{var l;let c={open:e.disclosureState.value===0,close:e.close},s=t,{id:b}=s,w=q(s,["id"]),V={id:(l=e.panelId.value)!=null?l:b,ref:e.panel};return ae({ourProps:V,theirProps:w,slot:c,attrs:u,slots:n,features:fe.RenderStrategy|fe.Static,visible:m.value,name:"DisclosurePanel"})}}});/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=te("FilePenLineIcon",[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=te("GripVerticalIcon",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-vue-next v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=te("MonitorPlayIcon",[["path",{d:"M10 7.75a.75.75 0 0 1 1.142-.638l3.664 2.249a.75.75 0 0 1 0 1.278l-3.664 2.25a.75.75 0 0 1-1.142-.64z",key:"1pctta"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]]),lt={class:"space-y-4 text-base"},ot={key:0},rt={class:"mb-4"},nt={key:1,class:""},it={class:"flex items-center"},ut={class:"border rounded-md p-2 mr-2"},ct={class:"flex flex-col"},dt={class:"text-sm text-ink-gray-4 mt-1"},pt={__name:"ChapterModal",props:Ee({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(t){const u=ie(t,"modelValue"),n=ie(t,"outline");je();const o=t,e=$e({title:"",is_scorm_package:0,scorm_package:null}),k=F({url:"seminary.seminary.api.upsert_chapter",makeParams(s){var i;return{chapter_title:e.chapter_title,course:o.course,is_scorm_package:e.is_scorm_package,scorm_package:e.scorm_package,name:(i=o.chapterDetail)==null?void 0:i.name}}}),m=F({url:"frappe.client.insert",makeParams(s){return{doc:{doctype:"Course Schedule Chapter Reference",chapter:s.name,parent:o.course,parenttype:"Course Schedule",parentfield:"chapters"}}}}),l=s=>ne(this,null,function*(){k.submit({},{validate(){return c()},onSuccess:i=>{Me("chapter_created"),m.submit({name:i.name},{onSuccess(f){b(),n.value.reload(),O.success(__("Chapter added successfully")),u.value=!1,s()},onError(f){var M;O.error(((M=f.messages)==null?void 0:M[0])||f)}})},onError(i){var f;O.error(((f=i.messages)==null?void 0:f[0])||i)}})}),c=()=>{if(!e.chapter_title)return __("Chapter Title is required");if(e.is_scorm_package&&!e.scorm_package)return __("Please upload a SCORM package or uncheck the SCORM package option")},b=()=>{e.chapter_title="",e.is_scorm_package=0,e.scorm_package=null},w=s=>{k.submit({},{validate(){if(!e.chapter_title)return"Chapter Title is required"},onSuccess(){n.value.reload(),O.success(__("Chapter updated successfully")),s()},onError(i){var f;O.error(((f=i.messages)==null?void 0:f[0])||i)}})};Ne(()=>o.chapterDetail,s=>{e.chapter_title=s==null?void 0:s.chapter_title,e.is_scorm_package=s==null?void 0:s.is_scorm_package,e.scorm_package=s==null?void 0:s.scorm_package});const V=s=>{if(s.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(s,i)=>(d(),x(r(Pe),{modelValue:u.value,"onUpdate:modelValue":i[4]||(i[4]=f=>u.value=f),options:{title:t.chapterDetail?s.__("Edit Chapter"):s.__("Add Chapter"),size:"lg",actions:[{label:t.chapterDetail?s.__("Edit"):s.__("Create"),variant:"solid",onClick:f=>t.chapterDetail?w(f):l(f)}]}},{"body-content":C(()=>[g("div",lt,[y(r(Ae),{label:"Title",modelValue:e.chapter_title,"onUpdate:modelValue":i[0]||(i[0]=f=>e.chapter_title=f),required:!0},null,8,["modelValue"]),y(r(Oe),{size:"sm",label:s.__("SCORM Package"),description:s.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:e.is_scorm_package,"onUpdate:modelValue":i[1]||(i[1]=f=>e.is_scorm_package=f)},null,8,["label","description","modelValue"]),e.is_scorm_package?(d(),v("div",ot,[e.scorm_package?(d(),v("div",nt,[g("div",it,[g("div",ut,[y(r(ve),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),g("div",ct,[g("span",null,E(e.scorm_package.file_name),1),g("span",dt,E(r(Be)(e.scorm_package.file_size)),1)]),y(r(qe),{onClick:i[3]||(i[3]=()=>e.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(d(),x(r(Ie),{key:0,fileTypes:[".zip"],validateFile:V,onSuccess:i[2]||(i[2]=f=>e.scorm_package=f)},{default:C(({file:f,progress:M,uploading:I,openFileSelector:B})=>[g("div",rt,[y(r(Y),{onClick:B,loading:I},{default:C(()=>[Z(E(I?`Uploading ${M}%`:"Upload an zip file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):D("",!0)])]),_:1},8,["modelValue","options"]))}},mt={class:"text-base"},ft={class:"grid grid-cols-[70%,30%] mb-4 px-2"},_t=["onClick"],ht={key:0,class:"ml-auto flex space-x-4"},gt=["onDrop"],yt=["draggable","onDragstart"],vt={class:"flex items-start gap-3"},kt={key:0},bt=["onClick"],Dt={class:"flex flex-col items-start gap-2 text-sm leading-5"},Ct={class:"flex items-center gap-2"},xt={key:0,class:"w-full rounded-md bg-[#E6F4FF] p-2"},wt={key:1,class:"rounded-md bg-[#E6F7F4] p-2"},St={key:1,class:"ml-auto hidden items-center group-hover:flex"},Et=["onDrop"],$t={key:0},Nt={key:1},Ot={key:1,class:"flex mt-2 mb-4 pl-8"},Ut={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1}},setup(t){const u=Te(),n=Ve(),o=ee("$user"),e=$(!1),k=$(null),m=$(null),l=t,c=F({url:"seminary.seminary.utils.get_course_outline",cache:["course_outline",l.courseName],params:{course:l.courseName,progress:l.getProgress},auto:!0});F({url:"seminary.seminary.utils.get_course_title",cache:["course_title",l.courseName],params:{course:l.courseName},auto:!0});const b=F({url:"seminary.seminary.api.delete_lesson",makeParams(a){return{lesson:a.lesson,chapter:a.chapter}},onSuccess(){c.reload(),O.success(__("Lesson deleted successfully"))}}),w=F({url:"seminary.seminary.api.update_lesson_index",makeParams(a){return{lesson:a.lesson,source_chapter:a.sourceChapter,target_chapter:a.targetChapter,idx:parseInt(a.idx,10)}},onSuccess(){c.reload(),O.success(__("Lesson moved successfully"))}}),V=(a,h)=>{ce({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(S){b.submit({lesson:a,chapter:h}),S()}}]})},s=a=>a==u.params.chapterNumber||a==1,i=(a=null)=>{l.allowEdit&&(k.value=a,e.value=!0)},f=()=>k.value,M=F({url:"seminary.seminary.api.delete_chapter",makeParams(a){return{chapter:a.chapter}},onSuccess(){c.reload(),O.success(__("Chapter deleted successfully"))}}),I=a=>{l.allowEdit&&ce({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(h){M.submit({chapter:a}),h()}}]})},B=a=>{if(a.is_scorm_package&&(event.preventDefault(),!l.allowEdit)){if(!o.data){O.warning(__("You are not enrolled"),__("Please enroll for this course to view this lesson"));return}n.push({name:"SCORMChapter",params:{courseName:l.courseName,chapterName:a.name}})}},De=a=>u.params.chapterNumber==a.split(".")[0]&&u.params.lessonNumber==a.split(".")[1],Ce=(a,h,S,z)=>{l.allowEdit&&(a!=null&&a.dataTransfer&&(a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",S.name)),m.value={lessonName:S.name,sourceChapter:h.name,sourceIndex:z})},le=a=>{!l.allowEdit||!m.value||a!=null&&a.dataTransfer&&(a.dataTransfer.dropEffect="move")},oe=(a,h,S)=>{var T;if(!l.allowEdit||!m.value)return;(T=a==null?void 0:a.preventDefault)==null||T.call(a);const{lessonName:z,sourceChapter:p,sourceIndex:j}=m.value,R=h.name;let N=S;if(p===R&&S>j&&(N=S-1),p===R&&N===j){m.value=null;return}const _=N+1;w.submit({lesson:z,sourceChapter:p,targetChapter:R,idx:_}),m.value=null},xe=()=>{m.value=null};return(a,h)=>{var z;const S=Le("router-link");return d(),v(Q,null,[g("div",mt,[g("div",ft,[h[5]||(h[5]=g("div",{class:"font-semibold text-lg leading-5 text-ink-gray-9"},null,-1)),l.allowEdit?(d(),x(r(Y),{key:0,size:"sm",onClick:h[0]||(h[0]=p=>i())},{default:C(()=>[Z(E(a.__("Add Chapter")),1)]),_:1})):D("",!0)]),g("div",{class:G({"border-2 rounded-md py-2 px-2":t.showOutline&&((z=r(c).data)==null?void 0:z.length)})},[(d(!0),v(Q,null,ue(r(c).data,(p,j)=>(d(),x(r(Je),{key:p.name,defaultOpen:s(p.idx)},{default:C(({open:R})=>[y(r(We),{ref_for:!0,ref:"",class:"flex w-full items-center p-2 group"},{default:C(()=>[y(r(He),{class:G([{"rotate-90 transform duration-200":R,"duration-200":!R,hidden:p.is_scorm_package,open:j==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),g("div",{class:"ml-2 text-left text-base font-medium leading-5 text-ink-gray-9",onClick:N=>B(p)},E(p.chapter_title),9,_t),l.allowEdit?(d(),v("div",ht,[y(r(X),{text:a.__("Edit Chapter"),placement:"bottom"},{default:C(()=>[y(r(tt),{onClick:L(N=>i(p),["prevent"]),class:"h-4 w-4 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])]),_:2},1032,["text"]),y(r(X),{text:a.__("Delete Chapter"),placement:"bottom"},{default:C(()=>[y(r(de),{onClick:L(N=>I(p.name),["prevent"]),class:"h-4 w-4 text-red-500 invisible group-hover:visible"},null,8,["onClick"])]),_:2},1032,["text"])])):D("",!0)]),_:2},1536),p.is_scorm_package?D("",!0):(d(),x(r(et),{key:0},{default:C(()=>{var N;return[(d(!0),v(Q,null,ue(p.lessons,(_,T)=>(d(),v("div",{key:_.name,class:"lesson-wrapper"},[l.allowEdit?(d(),v("div",{key:0,class:"ml-8 mr-4 h-3 rounded border border-dashed border-outline-gray-3 transition hover:border-outline-gray-4",onDragover:h[1]||(h[1]=L(U=>le(U),["prevent"])),onDrop:L(U=>oe(U,p,T),["prevent"])},null,40,gt)):D("",!0),g("div",{class:G(["group ml-8 mr-4 rounded-lg border border-outline-gray-2 bg-white p-4 transition hover:border-outline-gray-3",{"bg-surface-selected":De(_.number),"cursor-grab":l.allowEdit}]),draggable:l.allowEdit,onDragstart:U=>Ce(U,p,_,T),onDragend:xe},[g("div",vt,[l.allowEdit?(d(),v("div",kt,[y(r(X),{text:a.__("Delete Lesson"),placement:"bottom"},{default:C(()=>[g("button",{type:"button",class:"rounded-md p-1 text-red-500 opacity-0 transition-opacity group-hover:opacity-100 hover:bg-red-50",onClick:L(U=>V(_.name,p.name),["prevent"])},[y(r(de),{class:"h-4 w-4"})],8,bt)]),_:2},1032,["text"])])):D("",!0),y(S,{class:"flex-1",to:{name:"Lesson",params:{courseName:t.courseName,chapterNumber:_.number.split(".")[0],lessonNumber:_.number.split(".")[1]}}},{default:C(()=>[g("div",Dt,[g("div",Ct,[_.icon==="icon-youtube"?(d(),x(r(st),{key:0,class:"h-4 w-4 stroke-1"})):_.icon==="icon-quiz"?(d(),x(r(ze),{key:1,class:"h-4 w-4 stroke-1"})):_.icon==="icon-exam"?(d(),x(r(Ke),{key:2,class:"h-4 w-4 stroke-1"})):_.icon==="icon-assignment"?(d(),x(r(Ge),{key:3,class:"h-4 w-4 stroke-1"})):(d(),x(r(ve),{key:4,class:"h-4 w-4 text-ink-gray-7 stroke-1"})),g("span",null,E(_.lesson_title),1),_.is_complete?(d(),x(r(Qe),{key:5,class:"h-4 w-4 text-green-700"})):D("",!0)]),_.preview?(d(),v("div",xt,E(_.preview),1)):D("",!0),_.due_date?(d(),v("div",wt,E(a.__("Due: ")+new Intl.DateTimeFormat(r(o).data.language||"en-US",{dateStyle:"medium"}).format(new Date(_.due_date))),1)):D("",!0)])]),_:2},1032,["to"]),l.allowEdit?(d(),v("div",St,[y(r(at),{class:"h-4 w-4 text-ink-gray-5","aria-hidden":"true"})])):D("",!0)])],42,yt)]))),128)),l.allowEdit?(d(),v("div",{key:0,class:"ml-8 mr-4 mt-2 rounded-md border border-dashed border-outline-gray-3 p-3 text-sm text-ink-gray-5 transition hover:border-outline-gray-4 hover:text-ink-gray-7",onDragover:h[2]||(h[2]=L(_=>le(_),["prevent"])),onDrop:L(_=>{var T;return oe(_,p,((T=p.lessons)==null?void 0:T.length)||0)},["prevent"])},[(N=p.lessons)!=null&&N.length?(d(),v("span",$t,E(a.__("Drop here to move to the end of this chapter")),1)):(d(),v("span",Nt,E(a.__("Drop a lesson here to start this chapter")),1))],40,Et)):D("",!0),l.allowEdit?(d(),v("div",Ot,[p.is_scorm_package?D("",!0):(d(),x(S,{key:0,to:{name:"LessonForm",params:{courseName:t.courseName,chapterNumber:p.idx,lessonNumber:p.lessons.length+1}}},{default:C(()=>[y(r(Y),null,{default:C(()=>[Z(E(a.__("Add Lesson")),1)]),_:1})]),_:1},8,["to"]))])):D("",!0)]}),_:2},1024))]),_:2},1032,["defaultOpen"]))),128))],2)]),y(pt,{modelValue:e.value,"onUpdate:modelValue":h[3]||(h[3]=p=>e.value=p),outline:r(c),"onUpdate:outline":h[4]||(h[4]=p=>Fe(c)?c.value=p:null),course:t.courseName,chapterDetail:f()},null,8,["modelValue","outline","course","chapterDetail"])],64)}}};export{Ut as _};
//# sourceMappingURL=CourseOutline-C5dbG8Fg.js.map
