var O=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var B=(u,l,o)=>l in u?O(u,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[l]=o,E=(u,l)=>{for(var o in l||(l={}))M.call(l,o)&&B(u,o,l[o]);if(V)for(var o of V(l))W.call(l,o)&&B(u,o,l[o]);return u},I=(u,l)=>J(u,K(l));var R=(u,l,o)=>new Promise((x,b)=>{var y=m=>{try{h(o.next(m))}catch(k){b(k)}},f=m=>{try{h(o.throw(m))}catch(k){b(k)}},h=m=>m.done?x(m.value):Promise.resolve(m.value).then(y,f);h((o=o.apply(u,l)).next())});import{c as T,u as X,b as F,H as Z,t as q}from"./frappe-ui-Qp90XKmJ.js";import{bV as ee,r as $,c as H,I as te,a8 as re,t as n,b as c,g as d,e as S,u as g,D as _,H as z,O as G,a as D,w as v,C as A,z as w,bS as ae,n as se,cf as oe}from"./vendor-CrP-kEM1.js";const ce={class:"gradebook"},le={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ne={class:"text-2xl font-bold mt-5 mb-4"},ue={key:0,class:"text-gray-500 text-center mt-4"},ie={key:1,class:"overflow-auto"},de={class:"table-auto border-collapse border border-gray-300 w-full"},_e={key:0,class:"block text-gray-500 text-sm"},me={key:0,class:"block text-gray-500 text-sm"},pe={key:0,class:"block text-gray-500 text-sm"},be={key:3},ye={key:0,class:"block text-gray-500 text-sm"},fe={class:"border border-gray-300 px-4 py-2 relative"},ge=["href"],xe={key:0},he=["value","onInput"],ke={key:1},ve=["value","onInput"],Se={__name:"Gradebook",props:{courseName:{type:String,required:!0}},setup(u){const l=ee(),o=u,x=$([]),b=$([]),y=$({}),f=T({url:"seminary.seminary.utils.get_course_details",cache:["course",o.courseName],params:{course:o.courseName},auto:!0}),h=T({url:"seminary.seminary.utils.get_gradebook",cache:["gradebook",o.courseName],params:{course:o.courseName},auto:!0,onSuccess(r){var t;x.value=r.map(a=>I(E({},a),{assessments:a.assessments.map(s=>I(E({},s),{rawscore_card:s.rawscore_card||0,actualextrapt_card:s.actualextrapt_card||0}))})),b.value=((t=r[0])==null?void 0:t.assessments)||[]},onError(r){console.error("Error loading gradebook:",r)}}),m=H(()=>[...b.value].sort((r,t)=>{if(!r.due_date&&t.due_date)return 1;if(r.due_date&&!t.due_date)return-1;if(r.due_date&&t.due_date){const a=new Date(r.due_date),s=new Date(t.due_date);if(a<s)return-1;if(a>s)return 1}return r.title.localeCompare(t.title)})),k=(r,t)=>{const a=r.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return a?a.actualextrapt_card:0},P=(r,t)=>{const a=r.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return a?a.rawscore_card:0},Q=(r,t,a)=>{const s=r.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);s&&(s.actualextrapt_card=parseFloat(a)||0,y.value[s.name]=!0)},U=(r,t,a)=>{const s=r.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);s&&(s.rawscore_card=parseFloat(a)||0,y.value[s.name]=!0)},Y=(r,t)=>{const a=r.assessments.find(s=>s.assessment_criteria===t.assessment_criteria);return a&&y.value[a.name]},j=(r,t)=>R(this,null,function*(){var s;const a=r.assessments.find(i=>i.assessment_criteria===t.assessment_criteria);if(a)try{const i=t.extracredit_scac?"actualextrapt_card":"rawscore_card",e=t.extracredit_scac?a.actualextrapt_card:a.rawscore_card;console.log("Saving cell:",a.name,"with value:",e),yield Z("frappe.client.set_value",{doctype:"Course Assess Results Detail",name:a.name,fieldname:i,value:e}),delete y.value[a.name],q.success(__("Grade saved successfully"))}catch(i){console.error("Error saving cell:",i),q.error(((s=err.messages)==null?void 0:s[0])||err)}});te(()=>l.fullPath,(r,t)=>{h.reload()},{immediate:!0});const C=r=>{if(!r)return"";const t=new Date(r);return isNaN(t)?"":new Intl.DateTimeFormat(void 0,{day:"2-digit",month:"short"}).format(t)},L=H(()=>{var t;let r=[{label:"Courses",route:{name:"Courses"}}];return r.push({label:(t=f==null?void 0:f.data)==null?void 0:t.course,route:{name:"CourseDetail",params:{courseName:o.courseName}}}),r.push({label:"Gradebook",route:{name:"Gradebook",params:{courseName:o.courseName}}}),r});return(r,t)=>{var s,i;const a=re("router-link");return c(),n("div",ce,[d("header",le,[S(g(X),{class:"h-7",items:L.value},null,8,["items"])]),d("h1",ne,"Gradebook for "+_((i=(s=g(f))==null?void 0:s.data)==null?void 0:i.course),1),x.value.length===0?(c(),n("div",ue," There are no students enrolled in this course. ")):(c(),n("div",ie,[d("table",de,[d("thead",null,[d("tr",null,[t[0]||(t[0]=d("th",{class:"border border-gray-300 px-4 py-2 bg-gray-100"},"Student",-1)),(c(!0),n(z,null,G(m.value,e=>(c(),n("th",{key:e.assessment_criteria,class:"border border-gray-300 px-4 py-2 bg-gray-100"},[e.type==="Exam"?(c(),D(a,{key:0,to:{name:"ExamSubmissionCS",params:{courseName:o.courseName,examID:e.exam}},class:"underline"},{default:v(()=>[A(_(e.title)+" ",1),e.due_date?(c(),n("span",_e," ("+_(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):e.type==="Assignment"?(c(),D(a,{key:1,to:{name:"AssignmentSubmissionCS",params:{courseName:o.courseName,assignmentID:e.assignment}},class:"underline"},{default:v(()=>[A(_(e.title)+" ",1),e.due_date?(c(),n("span",me," ("+_(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):e.type==="Quiz"?(c(),D(a,{key:2,to:{name:"QuizSubmissionCS",params:{courseName:o.courseName,quizID:e.quiz}},class:"underline"},{default:v(()=>[A(_(e.title)+" ",1),e.due_date?(c(),n("span",pe," ("+_(C(e.due_date))+") ",1)):w("",!0)]),_:2},1032,["to"])):(c(),n("span",be,[A(_(e.title)+" ",1),e.due_date?(c(),n("span",ye," ("+_(C(e.due_date))+") ",1)):w("",!0)]))]))),128))])]),d("tbody",null,[(c(!0),n(z,null,G(x.value,e=>(c(),n("tr",{key:e.student_card},[d("td",fe,[S(g(F),{text:`Program: ${e.program_std_scr}
Audit: ${e.audit_bool?"Yes":"No"} 
 Active: ${e.active?"Yes":"No"}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:v(()=>[d("span",null,_(e.stuname_roster),1)]),_:2},1032,["text"]),S(g(F),{text:`Send Email to ${e.stuname_roster}`,placement:"bottom","arrow-class":"fill-surface-white"},{default:v(()=>[d("a",{href:`mailto:${e.stuemail_rc}`},[S(g(ae),{class:"absolute right-2 top-2 text-blue-300 cursor-pointer"})],8,ge)]),_:2},1032,["text"])]),(c(!0),n(z,null,G(b.value,p=>(c(),n("td",{key:p.assessment_criteria,class:se([p.extracredit_scac?"bg-blue-100":"","border border-gray-300 px-4 py-2 text-center relative"])},[p.extracredit_scac?(c(),n("div",xe,[d("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:k(e,p),onInput:N=>Q(e,p,N.target.value)},null,40,he)])):(c(),n("div",ke,[d("input",{type:"number",class:"w-full text-center border border-gray-300 rounded",value:P(e,p),onInput:N=>U(e,p,N.target.value)},null,40,ve)])),Y(e,p)?(c(),D(g(oe),{key:2,class:"absolute right-12 top-4 text-blue-300",onClick:N=>j(e,p)},null,8,["onClick"])):w("",!0)],2))),128))]))),128))])])]))])}}};export{Se as default};
//# sourceMappingURL=Gradebook-vJJ0WmtJ.js.map
